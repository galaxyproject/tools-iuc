<tool id="mirmachine" name="Annotation miRNA features in a genome" version="0.1.0" python_template_version="3.5">
    <requirements>
        <container type="singularity">
            mirmachine:0.2.13
        </container>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        MirMachine.py -n '$input_node' -s '$input_species' --genome '$input1' -c ${GALAXY_SLOTS:-8}
    ]]></command>
    <inputs>
        <param type="text" name="input_node" label="Node name. (e.g. Caenorhabditis)" />
        <param type="text" name="input_species" label="Scientific species name separated by underscore (e.g. Caenorhabditis_elegans)" />
        <param type="data" name="input1" format="fa" label="Genome fasta file"/>
    </inputs>
    <outputs>
	<data name="gff_file" format="gff" from_work_dir="results/predictions/gff/${input_species}.PRE.gff" label="${tool.name} on ${on_string}: GFF file"/>
	<data name="filtered_gff_file" format="gff" from_work_dir="results/predictions/filtered_gff/${input_species}.PRE.gff" label="${tool.name} on ${on_string}: filtered GFF file"/>
	<data name="fasta_file" format="fasta" from_work_dir="results/predictions/fasta/${input_species}.PRE.fasta" label="${tool.name} on ${on_string}: fasta sequence of annotation miRNAs"/>
    </outputs>
    <tests>
        <test expect_num_outputs="3">
            <param name="input1" value="ce11_chrI.fa"/>
            <param name="input_node" value="Caenorhabditis"/>
            <param name="input_species" value="Caenorhabditis_elegans"/>
            <output name="gff_file" file="results/predictions/gff/Caenorhabditis_elegans.PRE.gff" type="gff">
                <assert_contents>
                    <has_size value="36944" delta="4000"/>
                </assert_contents>
            </output>
            <output name="filtered_gff_file" file="results/predictions/filtered_gff/Caenorhabditis_elegans.PRE.gff" type="gff">
                <assert_contents>
                    <has_size value="3025" delta="300"/>
                </assert_contents>
            </output>
            <output name="fasta_file" file="results/predictions/fasta/Caenorhabditis_elegans.PRE.fasta" type="fasta">
                <assert_contents>
                    <has_size value="18604" delta="2000"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
Main MirMachine executable

Arguments:
    -n <text>, --node <text>              Node name. (e.g. Caenorhabditis)
    -s <text>, --species <text>           Species name. (e.g. Caenorhabditis_elegans)
    -g <text>, --genome <text>            Genome fasta file location (e.g. data/genome/example.fasta)
    -m <text>, --model <text>             Model type: deutero, proto, combined [default: combined]

Options:
    -a, --add-all-nodes                 Move on the tree both ways.
    -o, --single-node-only              Run only on the given node for miRNA families.
    -p, --print-all-nodes               Print all available node options and exit.
    -l, --print-all-families            Print all available families in this version and exit.
    -t, --print-ascii-tree              Print ascii tree of the tree file.

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubMirMachine,
  author = {Umu, Sinan Ugur},
  year = {2023},
  title = {MirMachine},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/sinanugur/MirMachine},
}</citation>
    </citations>
</tool>

<tool id="concoct_coverage_table" name="CONCOCT: Generate the input coverage table" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>for CONCOCT</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements">
        <requirement type="package" version="1.15.1">samtools</requirement>
    </expand>
    <command detect_errors="exit_code"><![CDATA[
mkdir 'mapping' &&
#for $e in $bamfiles
    ln -s '$e' 'mapping/${e.element_identifier}.sorted.bam' &&
    samtools index 'mapping/${e.element_identifier}.sorted.bam' 'mapping/${e.element_identifier}.bam.bai' &&
    mv 'mapping/${e.element_identifier}.sorted.bam' 'mapping/${e.element_identifier}.bam' &&
#end for
concoct_coverage_table.py
    '$bedfile'
    mapping/*.bam
    > '$output'
    ]]></command>
    <inputs>
        <param name="bedfile" type="data" format="bed" label="Contigs BEDFile" help="The file should have four columns representing: 'Contig ID, Start Position, End Position and SubContig ID' respectively. The Subcontig ID must contain the pattern 'concoct_part_[0-9]*' while the contigs which are not cutup cannot contain this pattern. This file can be generated by the cut_up_fasta tool."/>
        <param name="bamfiles" type="data" format="bam" label="Sorted BAM files" multiple="true" help="BAM files with mappings to the original contigs, after sorting"/>
    </inputs>
    <outputs>
        <data name="output" format="tabular"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="bedfile" value="two_contigs-cut2.bed" ftype="bed"/>
            <param name="bamfiles" value="ten_reads_two_contigs-s.bam" ftype="bam"/>
            <output name="output" ftype="tabular">
                <assert_contents>
                    <has_text text="contig-21000001.concoct_part_0"/>
                    <has_n_lines n="11"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

Accepts an assembled (and possibly cut by the Cut fasta contigs tool) fasta contigs file and a tabular coverage histogram
file (produced by the bedtools Genomve Coverage tool) and outputs a tabular coverage file for use as the input to the
CONCOCT metagenome binning tool.

@HELP_OVERVIEW@
    ]]></help>
    <expand macro="citations"/>
</tool>

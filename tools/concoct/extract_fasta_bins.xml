<tool id="concoct_extract_fasta_bins" name="Extract a fasta file" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>for each cluster in a CONCOCT clustering file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
#if $input_fasta.ext.endswith(".gz")
    gunzip -c '$input_fasta' > input_fasta.fa &&
#else:
    ln -s '$input_fasta' input_fasta.fa &&
#end if

mkdir outdir &&
python '$__tool_directory__/extract_fasta_bins.py'
--input_fasta input_fasta.fa
--input_cluster '$input_cluster'
--output_path 'outdir'
    ]]></command>
    <inputs>
        <param argument="--input_fasta" type="data" format="fasta,fasta.gz" label="Fasta file"/>
        <param argument="--input_cluster" type="data" format="csv" label="CONCOCT clustering file"/>
    </inputs>
    <outputs>
        <collection name="bins" type="list" label="${tool.name} on ${on_string} (bins)">
            <discover_datasets pattern="(?P&lt;designation&gt;.*)\.fa" format="fasta" directory="outdir"/>
        </collection>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_fasta" value="input1.fa.gz" ftype="fasta.gz"/>
            <param name="input_cluster" value="inputcluster1.csv" ftype="csv"/>
            <output_collection name="bins" type="list" count="2">
                <element name="77" ftype="fasta">
                    <assert_contents>
                        <has_size value="2194"/>
                    </assert_contents>
                </element>
                <element name="93" ftype="fasta">
                    <assert_contents>
                        <has_size value="16531"/>
                    </assert_contents>
                </element>
            </output_collection>
        </test>
    </tests>
    <help><![CDATA[
**What it does**

Performs metagenomic binning of fasta contigs by extracting a fasta file for each cluster defined in a
CONCOCT clustering file.

The tool accepts two inputs; the fasta contigs file and the CONCOCT clustering file that was produced using
the same fasta contigs input.  A collection of fasta files is produced.
    ]]></help>
    <expand macro="citations"/>
</tool>

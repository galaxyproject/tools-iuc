<tool id="minfi_ppquantile" name="Minfi Preprocess Quantile" version="@MINFI_VERSION@">
    <description>implements stratified quantile normalization preprocessing</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements">
        <requirement type="package" version="0.6.0">bioconductor-illuminahumanmethylation450kanno.ilmn12.hg19</requirement>
    </expand>
    <command detect_errors="exit_code">
    <![CDATA[
     Rscript '$minfi_pp_script'
    ]]>
    </command>
    <configfiles>
    <configfile name="minfi_pp_script"><![CDATA[
require("minfi", quietly = TRUE)
RGSet <- get(load('$rgset'))

GRSet <- preprocessQuantile(RGSet, fixOutliers = TRUE,
  removeBadSamples = TRUE, badSampleCutoff = 10.5,
  quantileNormalize = TRUE, stratified = TRUE, 
  mergeManifest = FALSE, sex = NULL)

save(GRSet,file = '$grset')

]]> 
    </configfile>
    </configfiles> 
 <inputs>
        <param type="data" name="rgset" format="rdata" label="RGChannelSet" help="These classes represents raw (unprocessed) data from a two color micro array; specifically an Illumina methylation array." />
    </inputs>
    <outputs>
        <data name="grset" format="rdata" label="GenomicRatioSet"/>
    </outputs>
    <tests>
        <test>
            <param name="rgset" value="RGChannelSet.rdata"/>
            <output name="grset" file="QuantileGenomicRatioSet.rdata"/>
        </test>
    </tests>
    <help><![CDATA[
        The normalization procedure is applied to the Meth and Unmeth intensities separately. The distribution of type I and type II signals is forced to be the same by first quantile normalizing the type II probes across samples and then interpolating a reference distribution to which we normalize the type I probes. Since probe types and probe regions are confounded and we know that DNAm distributions vary across regions we stratify the probes by region before applying this interpolation.
    ]]></help>
    <expand macro="citations" />
</tool>
 

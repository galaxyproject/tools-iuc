<tool id="minfi_analyze_tcga" name="Minfi Analysis Pipeline" version="1.0">
    <description>for TCGA data hosted on GDAC-Broadinstitute</description>
    <macros>
        <import>minfi_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir tcga_temp
        &&
        echo "${tarfile},${tarfile.name}" > tcga_temp/config.txt
        &&
        Rscript ${__tool_directory__}/minfi_TCGA_pipeline.R
        --quiet="FALSE"
        --tarfile="${tarfile}"
        --cores=\${GALAXY_SLOTS:-4}
        #if str( $minfi_param_type.minfi_param_type_selector ) == "advanced":
            --b_permutations=${minfi_param_type.b_permutations}
            --smooth=${minfi_param_type.smooth}
            --l_value=${minfi_param_type.l_value}
        #else:
            --b_permutations=25
            --smooth=FALSE
            --l_value=4
        #end if
        ]]> </command>
    <inputs>
        <param name="tarfile" type="data" label="Input GDAC filename"/>
        <conditional name="minfi_param_type">
            <param name="minfi_param_type_selector" type="select" label="Basic or Advanced Minfi Parameters">
                <option value="basic" selected="True">Basic Default settings</option>
                <option value="advanced">Advanced</option>
            </param>
            <when value="basic">
                <!--Do nothing here -->
            </when>
            <when value="advanced">
                <!-- Give options for estimating cell counts here -->
                <!-- Give Bumphunter options here like B,smooth,cutoff, length of dmrs-->
                <param name="b_permutations" type="integer" value="25" label="Number of times resampled" help="Refer the tool's help section" />
                <param name="smooth" type="boolean" checked="false" truevalue="TRUE" falsevalue="FALSE" label="Should a smoothing function be used?" help="Refer the tool's help section" />
                <param name="l_value" type="integer" value="4" label="Length of DMRs to be selected" help="Refer the tool's help section" />
            </when>
        </conditional>      
    </inputs>
    <outputs>
        <!-- PLOT OUTPUTS -->
        <!-- CSV outputs -->
        <data name="dmps.csv" from_work_dir="dmps.csv" format="csv" label="Differentially Methylated positions" />
        <data name="dmrs.csv" from_work_dir="dmrs.csv" format="csv" label="Differentially Methylated Regions using Bumphunter" />
    </outputs>
    <help><![CDATA[

**What it does**

Analyze TCGA illumina 450k array data hosted at the GDAC Broadinstitute firehose. 
http://gdac.broadinstitute.org/runs/stddata__latest/

**Input**:

Currently, an example of a file that this function reads is here:

<http://gdac.broadinstitute.org/runs/stddata__2014_10_17/data/UCEC/20141017/gdac.broadinstitute.org_UCEC.Merge_methylation__humanmethylation450__jhu_usc_edu__Level_3__within_bioassay_data_set_function__data.Level_3.2014101700.0.0.tar.gz>


NOTE: It is an archive of size 8.1Gb

1. Upload the file into galaxy.

2. Run the "Minfi Analysis pipeline for TCGA data" tool on the resultant tar file in your history.

3. This will generate two results, Differentially methylated positions and Differentially methylated regions.

**Output**:

1. Differentially methylated positions

2. Differentially methylated regions.

]]></help>
    <expand macro="citations" />
</tool>


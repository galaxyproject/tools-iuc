<tool id="minfi_qc" name="Minfi qc" version="@MINFI_VERSION@">
    <description>provides a simple quality control matrix and plot</description>
    <macros>
        <import>macros.xml</import>
    </macros>
     <expand macro="requirements" />
    <command detect_errors="exit_code">
    <![CDATA[
        Rscript '$read_qc_script'
     ]]>
    </command>
    <configfiles>
      <configfile name="read_qc_script">
    <![CDATA[
require("minfi", quietly = TRUE)

args <- commandArgs(trailingOnly = TRUE)

input = args[1]
output1 = args[2]
output2 = args[3]

MSet <- get(load('$input_mset'))

qc <- getQC(MSet)

write.table(qc, '$output_qctab')

png('$output_qcpng')
plotQC(qc)
dev.off()
    ]]>
     </configfile>
        </configfiles>
    <inputs>
        <param type="data" name="input_mset" format="rdata" label="MethylSet" help="This class holds preprocessed data for Illumina methylation microarrays, mapped to a genomic
location."/>
    </inputs>
    <outputs>
        <data name="output_qctab" format="txt" label="Quality Control Report"/>
        <data name="output_qcpng" format="png" label="Quality Control Plot"/>
    </outputs>
    <tests>
        <test>
            <param name="input_mset" value="MSet.rdata"/>
            <output name="output_qctab" file="qc.txt"/>
            <output name="output_qcpng" file="qc.png" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
Quality Control (QC) outputs plot of the log median intensity in both the methylated (M) and unmethylated (U) channels. When plotting these two medians against each other the good samples cluster together, while failed samples tend to separate and have lower median intensities.
    ]]></help>
    <expand macro="citations" />
</tool>

<tool id="clair3" name="Clair3" version="@TOOL_VERSION@+galaxy0" profile="21.09">
    <macros>
        <token name="@TOOL_VERSION@">0.1.10</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">clair3</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        #if $ref_source.source == "history"
            ln -s '$ref_source.ref_fasta' reference.fasta &&
        #elif $ref_source.source == "builtin"
            ln -s '$ref_source.ref_fasta_builtin.path' reference.fasta &&
        #end if
        BIN_PATH=\$(dirname \$(which run_clair3.sh))
        #import os
        #if os.getenv('BIN_DIR') is not None
            #set $model_prefix = os.environ.get('BIN_PATH') + '/models/'
        #end if
        
        run_clair3.sh
            --bam_fn='$bam_input'
            --ref_fn=reference.fasta
            --model_path='$model_prefix/$model'
            --platform='ont'
            --output='clair3_output'
            --threads=\${GALAXY_SLOTS:-1}
            #if $bed_fn
                --bed_fn='$bed_fn'
            #end if
            #if $vfc_fn
                --vfc_fn='$vfc_fn'
            #end if
            #if $qual
                --qual='$qual'
            #end if
            #if chunk_size
                --chunk_size='$chunk_size'
            #end if
            $print_ref_calls
            $include_all_ctgs
    ]]></command>
    <inputs>
        <conditional name="ref_source">
            <param type="select" label="Reference genome source" name="source">
                <option value="history" selected="true">History</option>
                <option value="builtin">Built-in</option>
            </param>
            <when value="history">
                <param type="data" format="fasta" name="ref_fasta" label="Reference genome" />
            </when>
            <when value="builtin">
                <param type="select" name="ref_fasta_builtin" label="Reference genome">
                    <options from_data_table="all_fasta" />
                </param>
            </when>
        </conditional>        
        <param type="select" name="model" label="Select model">
            <options from_data_table="models" >
              <column name="value" index="0" />
            </options>
            <validator type="no_options" message="No models available at the moment." />
        </param>
        <param type="data" name="bam_input" format="bam" label="BAM file input. The input file must be samtools indexed." />
        <section name="opt" title="Advanced Parameters" expanded="false">
            <param type="data" name="bed_fn" format="bed" label="Call variants only in the provided bed regions." optional="true" />
            <param type="data" name="vfc_fn" format="vfc" label="Candidate sites VCF file input, variants will only be called at the sites in the VCF file if provided." optional="true" />
            <param type="integer" name="qual" value="0" min="0" max="255" label="If set, variants with >$qual will be marked PASS, or LowQual otherwise." optional="true" />
            <param type="integer" name="chunk_size" value="5" min="1" max="255" label="The size of each chuck for parallel processing, default: 5Mbp." optional="true" />
            <param type="boolean" name="print_ref_calls" truevalue="--print_ref_calls" falsevalue="" label="Show reference calls (0/0) in vcf file, default: disable." />
            <param type="boolean" name="include_all_ctgs" truevalue="--include_all_ctgs" falsevalue="" label="Call variants on all contigs, otherwise call in chr{1..22,X,Y} and {1..22,X,Y}, default: disable." />
        </section>
    </inputs>
    <outputs>
    </outputs>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>

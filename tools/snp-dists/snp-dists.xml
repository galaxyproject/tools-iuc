<tool id="snp_dists" name="SNP distance matrix" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@">
    <description>Compute distance in SNPs between all sequences in a FASTA file</description>
    <macros>
        <token name="@TOOL_VERSION@">1.2.0</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">snp-dists</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        snp-dists -q 
            $a
            $k
            $b
            $L
            -x $x
            -j \${GALAXY_SLOTS:-4}
            '$input' > '$output'
    ]]></command>
    <inputs>
        <param name="input" type="data" format="fasta,fasta.gz" label="FASTA multiple sequence alignment" help="Provide a multiple sequence alignment containing sequences of equal length"/>
        <param argument="-a" type="boolean" truevalue="-a" falsevalue="" label="Count all differences, not just ACTG"/>
        <param argument="-k" type="boolean" truevalue="-k" falsevalue="" label="Keep case, don't uppercase all letters"/>
        <param argument="-b" type="boolean" truevalue="-b" falsevalue="" label="Blank top left corner cell"/>
        <param argument="-L" type="boolean" truevalue="-L" falsevalue="" label="Output lower triangle only (unique pairs)"/>
        <param argument="-x" type="integer" value="99999" label="Stop counting distance beyond this value"/>
    </inputs>
    <outputs>
        <data format="tabular" name="output" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <!-- Test 01: Default parameters -->
        <test expect_num_outputs="1">
            <param name="input" ftype="fasta" value="input1.fasta"/>
            <output name="output" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="MTB_anc\t0\t746\t726\t772\t749"/>
                    <has_text_matching expression="ERR550641\t746\t0\t26\t44\t13"/>
                    <has_text_matching expression="ERR550671\t726\t26\t0\t64\t29"/>
                    <has_text_matching expression="ERR550691\t772\t44\t64\t0\t39"/>
                    <has_text_matching expression="ERR550703\t749\t13\t29\t39\t0"/>
                </assert_contents>
            </output>
        </test>
        <!-- Test 02: Count all differences -->
        <test expect_num_outputs="1">
            <param name="input" ftype="fasta" value="input1.fasta"/>
            <param name="a" value="true"/>
            <output name="output" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="MTB_anc\t0\t747\t727\t773\t750"/>
                    <has_text_matching expression="ERR550641\t747\t0\t26\t44\t13"/>
                    <has_text_matching expression="ERR550671\t727\t26\t0\t64\t29"/>
                    <has_text_matching expression="ERR550691\t773\t44\t64\t0\t39"/>
                    <has_text_matching expression="ERR550703\t750\t13\t29\t39\t0"/>
                </assert_contents>
            </output>
        </test>
        <!-- Test 03: Keep case -->
        <test expect_num_outputs="1">
            <param name="input" ftype="fasta" value="input1.fasta"/>
            <param name="k" value="true"/>
            <output name="output" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="MTB_anc\t0\t742\t722\t768\t745"/>
                    <has_text_matching expression="ERR550641\t742\t0\t26\t44\t13"/>
                    <has_text_matching expression="ERR550671\t722\t26\t0\t64\t29"/>
                    <has_text_matching expression="ERR550691\t768\t44\t64\t0\t39"/>
                    <has_text_matching expression="ERR550703\t745\t13\t29\t39\t0"/>
                </assert_contents>
            </output>
        </test>
        <!-- Test 04: Blank top left corner cell -->
        <test expect_num_outputs="1">
            <param name="input" ftype="fasta" value="input1.fasta"/>
            <param name="b" value="true"/>
            <output name="output" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="MTB_anc\t0\t746\t726\t772\t749"/>
                    <has_text_matching expression="ERR550641\t746\t0\t26\t44\t13"/>
                    <has_text_matching expression="ERR550671\t726\t26\t0\t64\t29"/>
                    <has_text_matching expression="ERR550691\t772\t44\t64\t0\t39"/>
                    <has_text_matching expression="ERR550703\t749\t13\t29\t39\t0"/>
                </assert_contents>
            </output>
    </test>
    <!-- Test 05: Output lower triangle only -->
        <test expect_num_outputs="1">
            <param name="input" ftype="fasta" value="input1.fasta"/>
            <param name="L" value="true"/>
            <output name="output" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="MTB_anc\t0"/>
                    <has_text_matching expression="ERR550641\t746\t0"/>
                    <has_text_matching expression="ERR550671\t726\t26\t0"/>
                    <has_text_matching expression="ERR550691\t772\t44\t64\t0"/>
                    <has_text_matching expression="ERR550703\t749\t13\t29\t39\t0"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
    **snp-dists**

    This tool computes a SNP distance matrix from a multiple sequence alignment (MSA) of
    sequences (all of the same length). Such distance matrices are often used as in
    studies of disease outbreaks.

    The output is a tabular file, for example this matrix describing four M. tuberculosis isolates
    and their relationship to the inferred ancestral reference sequence:

=============== ======= =========   =========   =========   =========
snp-dists 0.6.3	MTB_anc	ERR550641   ERR550671   ERR550691   ERR550703
--------------- ------- ---------   ---------   ---------   ---------
MTB_anc	        0       746         726         772         749
--------------- ------- ---------   ---------   ---------   ---------
ERR550641       746     0           26          44          13
--------------- ------- ---------   ---------   ---------   ---------
ERR550671       726     26          0           64          29
--------------- ------- ---------   ---------   ---------   ---------
ERR550691       772     44          64          0           39
--------------- ------- ---------   ---------   ---------   ---------
ERR550703       749     13          29          39          0
=============== ======= =========   =========   =========   =========

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubsnp-dists,
  author = {Seemann, Torsten},
  year = {2019},
  title = {snp-dists},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/tseemann/snp-dists},
}</citation>
    </citations>
</tool>

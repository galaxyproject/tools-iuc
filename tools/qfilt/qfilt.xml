<?xml version="1.0"?>
<tool id="qfilt" version="1.0.0" name="qfilt">
  <description/>
  <requirements>
    <requirement type="package" version="0.0.1">qfilt</requirement>
  </requirements>
  <stdio>
    <exit_code range="1:"/>
  </stdio>
  <command><![CDATA[
        qfilt -o "$filtered_output"
        #if str($options.advanced) == "advanced":
          -q $options.qscore -l $options.length -m $options.mode
          -s $options.split -P $options.replace -R $options.remove
          -T $options.prefix -t $options.mismatch -f $options.format
          { $options.tolerate_homopolymeric } { $options.tolerate_ambiguous }
        #end if
        -Q "$input_fastq"
    ]]></command>
  <inputs>

    <param name="input_fastq" label="Input FASTA" type="data" format="fastq" help="FASTQ File" />

    <conditional name="options">

      <param label="Additional options" name="advanced" type="select">
        <option value="defaults">Use defaults</option>
        <option value="advanced">Specify additional parameters</option>
      </param>

      <when value="defaults"/>

      <when value="advanced">
        <param label="QScore" name="qscore" type="integer" value="20" default="20" help="minimum per-base quality score below which a read will be split or truncated (default=20)" />
        <param label="Length" name="length" type="integer" value="50" default="50" help="minimum retained fragment LENGTH (default=50)" />
        <param label="Mode" name="mode" type="integer" value="0" default="0" help="MODE is a 3-bitmask (an integer in [0-7], default=0)" />
        <param label="Split" name="split" type="text" help="when encountering a low q-score, split instead of truncate" />
        <param label="Tolerate Homopolymeric" name="tolerate_homopolymeric" type="boolean" truevalue="-p" falsevalue="" help="tolerate low q-score homopolymeric regions" />
        <param label="Tolerate Ambiguous" name="tolerate_ambiguous" type="boolean" truevalue="-a" falsevalue="" help="tolerate low q-score ambiguous nucleotides" />
        <param label="Replace" name="replace" type="text" help="rather than splitting or truncating, replace low quality bases with CHAR this option OVERRIDES all -m mode options" />
        <param label="Remove" name="remove" type="text" help="rather than splitting or truncating, remove reads which contain more than COUNT low quality bases this option only works in COMBINATION with the -P (punch) option" />
        <param label="Prefix" name="prefix" type="text" help="if supplied, only reads with this PREFIX are retained, and the PREFIX is stripped from each contributing read" />
        <param label="Mismatch" name="mismatch" type="integer" value="0" default="0" help="if PREFIX is supplied, prefix matching tolerates at most MISMATCH mismatches (default=0)" />
        <param label="Format" name="format" type="select" help="output in FASTA or FASTQ format (default=FASTA)" >
          <option value="FASTA">FASTA</option>
          <option value="FASTQ">FASTQ</option>
        </param>
        <param label="Debug" name="debug" type="boolean" />
      </when>

    </conditional>

  </inputs>
  <outputs>
    <data format="fasta" name="filtered_output"/>
  </outputs>
  <tests>
    <test>
      <param name="input_fastq" value="qfilt-in1.fastq" />
      <output file="qfilt-out1.fa" ftype="fasta" name="filtered_output" />
    </test>
  </tests>
  <help><![CDATA[
		-h, --help               show this help message and exit
		-o OUTPUT                direct retained fragments to a file named OUTPUT (default=stdout)
		-q QSCORE                minimum per-base quality score below which a read will be split
														 or truncated (default=20)
		-l LENGTH                minimum retained fragment LENGTH (default=50)
		-m MODE                  MODE is a 3-bitmask (an integer in [0-7], default=0):
														 if the lowest bit is set, it is like passing -s;
														 if the middle bit is set, it is like passing -p;
														 and if the highest bit is set, it is like passing -a
		-s                       when encountering a low q-score, split instead of truncate
		-p                       tolerate low q-score homopolymeric regions
		-a                       tolerate low q-score ambiguous nucleotides
		-P CHAR                  rather than splitting or truncating, replace low quality bases with CHAR
														 this option OVERRIDES all -m mode options
		-R COUNT                 rather than splitting or truncating, remove reads which 
														 contain more than COUNT low quality bases
														 this option only works in COMBINATION with the -P (punch) option
		-T PREFIX                if supplied, only reads with this PREFIX are retained,
														 and the PREFIX is stripped from each contributing read
		-t MISMATCH              if PREFIX is supplied, prefix matching tolerates at most
														 MISMATCH mismatches (default=0)
		-f FORMAT                output in FASTA or FASTQ format (default=FASTA)
		-j                       output run diagnostics to stderr as JSON (default is to write ASCII text)
]]></help>
</tool>

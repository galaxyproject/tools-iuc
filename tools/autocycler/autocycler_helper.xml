<tool id="autocycler_helper" name="AutoCycler Helper" version="@TOOL_VERSION@+galaxy0" profile="@PROFILE@">
    <description>Run Autocycler Helper with long reads</description>
    <macros>
          <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code">
	 <![CDATA[

	    #if $reads.is_of_type("fastq")
		  ln -s $reads '$(reads.element_identifier)' &&
	    #else
	          echo "${reads} is not a fastq file"
	    #end if


	    autocycler helper
	    #if $long_read_tool.assembler == "genome_size"
		'$long_read_tool.assembler'
		--reads '$reads.element_identifier'
		--threads \${GALAXY_SLOTS:-4}
		> '$genome_size_stat' 2>&1
	    #else	    
	    	'$long_read_tool.assembler'
            	--reads '$reads.element_identifier'
            	--out_prefix '$reads.element_identifier'
           	 #if $genome_size:
                	--genome_size '$genome_size'
            	#end if
            	--threads \${GALAXY_SLOTS:-4}
            	--read_type '$read_type'
            	#if $min_depth_abs:
                	--min_depth_abs '$min_depth_abs'
            	#end if
            	#if $min_depth_rel:
               		--min_depth_rel '$min_depth_rel'
            	#end if
	    #end if
        ]]>
    </command>

    <inputs>
	<param name="reads" type="data" format="fastq" label="Input long reads (FASTQ format)" required="true"/>
	<conditional name="long_read_tool">
	        <param name="assembler" type="select" label="Tool" required="true">
	            <option value="genome_size">genome_size</option>
	            <option value="flye">flye</option>
	            <option value="miniasm">miniasm</option>
	            <option value="raven">raven</option>
	    	</param>
			<when value="genome_size">
			</when>
			<when value="flye">
			</when>
			<when value="miniasm">
			</when>
			<when value="raven">
			</when>
	</conditional>
        <param name="genome_size" type="text" label="Estimated genome size (e.g., 4.7m)" optional="true"/>
        <param name="read_type" type="select" label="Read type" value="ont_r10">
            <option value="ont_r9">ont_r9</option>
            <option value="ont_r10" selected="true">ont_r10</option>
            <option value="pacbio_clr">pacbio_clr</option>
            <option value="pacbio_hifi">pacbio_hifi</option>
        </param>
        <param name="min_depth_abs" type="integer" label="Minimum absolute depth (optional)" optional="true"/>
        <param name="min_depth_rel" type="float" label="Minimum relative depth (optional)" optional="true"/>
    </inputs>

    <outputs>
	<data name="output_fasta" format="fasta" from_work_dir="*.fasta" label="${tool.name} on ${on_string}: subsample fasta reads">
	     <filter>long_read_tool['assembler'] != 'genome_size'</filter>
       </data>
        <data name="output_gfa" format="gfa1" from_work_dir="*.gfa" label="${tool.name} on ${on_string}: subsample gfa reads">
             <filter>long_read_tool['assembler'] != 'genome_size'</filter>
       </data>
        <data name="genome_size_stat" format="txt" label="${tool.name} on ${on_string}: subsample genome size">
            <filter>long_read_tool['assembler'] == 'genome_size'</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="reads" value="sample_00.fastq"/>
	    <param name="read_type" value="ont_r10"/>
	    <conditional name="long_read_tool">
                <param name="assembler" value="genome_size"/>
            </conditional>
	    <output name="genome_size_stat" file="genome_size_stat.txt" ftype="txt" compare="diff" lines_diff="200"/>  
        </test>
        <test>
            <param name="reads" value="sample_00.fastq"/>
            <param name="read_type" value="ont_r10"/>
            <conditional name="long_read_tool">
                <param name="assembler" value="flye"/>
            </conditional>
            <output name="output" file="raven_00.fasta" ftype="fasta" compare="diff" lines_diff="1000"/>
            <output name="output" file="raven_00.gfa" ftype="gfa1" compare="diff" lines_diff="1000"/>
        </test>
        <test>
	    <param name="reads" value="sample_01.fastq"/>
	    <param name="read_type" value="ont_r10"/>
            <conditional name="long_read_tool">
                <param name="assembler" value="flye"/>
            </conditional>
	    <output name="output" file="flye_01.fasta" ftype="fasta" compare="diff" lines_diff="1000"/>
	    <output name="output" file="flye_01.gfa" ftype="gfa1" compare="diff" lines_diff="1000"/>
    	</test>
    </tests>

    <help><![CDATA[
Autocycler helper is a wrapper for various long-read assemblers, providing a consistent command-line interface and standardised outputs. It is an optional tool: not required for running Autocycler, but helpful for scripting and automation. By standardising how each assembler is invoked, it simplifies the process of generating input assemblies This is the wrapper of the `autocycler helper` command, allowing you to select from multiple genome assembly tasks and configure relevant parameters.

**Input**

- Reads in Fastq file format
- Assembler selection or genome size (genome_size) estimation

**Output**

- a fasta file
- a gfa file

**Tools currently available in this wrapper**:

- **genome_size**

  - Assembly tool - Raven is used for genome size estimation    
	    
- **flye**

  - Assembly tool - flye
	    
- **miniasm**

  - Assembly tool - miniasm and minipolish

- **raven**

  - Assembly tool - Raven 

**Parameters**

- genome_size is unique:  prints output to a text file	    

- Minimum absolute depth: Exclude contigs with read depth less than this absolute value

- Minimum relative depth: Exclude contigs with read depth less than this fraction of the longest contig's depth 


.. class:: infomark

**More Information**

- `Autocycler helper`: https://github.com/rrwick/Autocycler/wiki/Autocycler-helper

**Citations**

    ]]></help>
</tool>


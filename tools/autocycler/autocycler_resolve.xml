<tool id="autocycler_resolve" name="AutoCycler Resolve" version="@TOOL_VERSION@+galaxy0" profile="@PROFILE@">
    <description>resolve consensus sequences from trimmed clusters</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        mkdir cluster_dir &&
        ln -s '$cluster_dir' 'cluster_dir/2_trimmed.gfa' &&
        autocycler resolve
            --cluster_dir 'cluster_dir/'
        ]]></command>
    <inputs>
        <param argument="--cluster_dir" type="data" format="gfa1" label="gfa file" help="typicaly trimmed" />
        <param name="intermediate" type="select" optional="true" multiple="true" label="Intermediate results">
            <option value="bridged">bridged</option>
            <option value="merged">merged</option>
        </param>
    </inputs>
    <outputs>
        <data name="bridged" format="gfa1" from_work_dir="cluster_dir/3_bridged.gfa" label="${tool.name} on ${on_string}: bridged">
            <filter>intermediate and "bridged" in intermediate</filter>
        </data>
        <data name="merged" format="gfa1" from_work_dir="cluster_dir/4_merged.gfa" label="${tool.name} on ${on_string}: merged">
            <filter>intermediate and "merged" in intermediate</filter>
        </data>
        <data name="final" format="gfa1" from_work_dir="cluster_dir/5_final.gfa" label="${tool.name} on ${on_string}: final" />
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="cluster_dir" value="qc_pass/cluster_003/2_trimmed.gfa" ftype="gfa1"/>
            <output name="final" value="qc_pass/cluster_003/5_final.gfa" ftype="gfa1"/>
        </test>
        <test expect_num_outputs="3">
            <param name="cluster_dir" value="qc_pass/cluster_003/2_trimmed.gfa" ftype="gfa1"/>
            <param name="intermediate" value="bridged,merged"/>
            <output name="bridged" value="qc_pass/cluster_003/3_bridged.gfa" ftype="gfa1"/>
            <output name="merged" value="qc_pass/cluster_003/4_merged.gfa" ftype="gfa1"/>
            <output name="final" value="qc_pass/cluster_003/5_final.gfa" ftype="gfa1"/>
        </test>
    </tests>
    <help><![CDATA[
**AutoCycler Resolve Tool**

This tool is intended to run on one cluster. It aims to resolve repeats and ambiguities in the cluster by following these steps:

- Identifying anchors: unitigs which occur exactly once in each of the cluster's contigs.

- Creating bridges: connections between anchors that follow the most common path.

- Applying bridges: first unique bridges (those with no conflicts) and then the most supported conflicting bridges.

- Merging linear sequences into 'consentigs'.

**Inputs**

- Cluster directory (must contain trimmed cluster data from trim step)

**Outputs**

- Consensus 

**Notes**

- Examining the merged dataset can reveal locations of structural heterogeneity in the genome â€“ sites where input assemblies disagreed on the ordering of anchor unitigs.

.. class:: infomark

**More Information**

- `Autocycler resolve`: https://github.com/rrwick/Autocycler/wiki/Autocycler-resolve

**Citations**

    ]]></help>
    <expand macro="citations"/>
</tool>

<tool id="autocycler_clean" name="AutoCycler Clean" version="@TOOL_VERSION@+galaxy0" profile="@PROFILE@">
	<description>and modify assembly graph by removing or duplicating segments</description>
	<macros>
		<import>macros.xml</import>
	</macros>
	<expand macro="requirements"/>
	<command detect_errors="exit_code"><![CDATA[

		#import re
		#set $identifier = re.sub('[^\w\-_\.]', '_', $in_gfa.element_identifier)
		ln -s '$in_gfa' '${identifier}.gfa' &&


		autocycler clean
		--in_gfa '${identifier}.gfa'
		--out_gfa '$cleaned_gfa'
		#if $remove:
		--remove '$remove'
		#end if
		#if $duplicate:
		--duplicate '$duplicate'
		#end if
		]]></command>
	<inputs>
		<param argument="--in_gfa" type="data" format="gfa1" label="Input GFA file"
			help="Assembly graph to clean/modify"/>

		<param argument="-r" name="remove" type="text" optional="false" label="Segments to remove"
			help="Comma-separated list of tig numbers to remove (e.g., '1,5,8')">
			<validator type="regex" message="Enter a comma-separated list of positive integers (e.g., 1,4)">^\d+(,\d+)*$</validator>
		</param>
		<param argument="-d" name="duplicate" type="text" optional="true" label="Segments to duplicate"
			help="Comma-separated list of tig numbers to duplicate (e.g., '2,3,7')">
			<validator type="regex" message="Enter a comma-separated list of positive integers (e.g., 1,4)">^\d+(,\d+)*$</validator>
		</param>
	</inputs>
	<outputs>
		<data name="cleaned_gfa" format="gfa1"/>
	</outputs>
	<tests>
		<test>
			<param name="in_gfa" value="consensus_assembly_unfiltered.gfa"/>
			<param name="remove" value="743,782"/>
			<output name="cleaned_gfa" file="clean.gfa" ftype="gfa1">
				<has_size value="46397"/>
				<has_text text="S       1"/>
				<has_text text="S       50"/>
				<has_n_lines n="171"/>
			</output>
		</test>
	</tests>
	 <help><![CDATA[
**AutoCycler Clean Tool**
Autocycler clean allows users remove or duplicate sequences in a consensus assembly produced by Autocycler combine.

**Inputs**

- Input GFA file (assembly graph)
- Optional lists of segments to remove or duplicate

**Parameters**

- Segments to remove: Comma-separated list of contigs numbers to remove from graph
- Segments to duplicate: Comma-separated list of contigs numbers to duplicate in graph

**Outputs**

- Cleaned/modified GFA file

**Notes**

- Viewing consensus_assembly.gfa in Bandage can be useful for determining which tigs should be kept/deleted.
- Depth values in consensus_assembly.gfa represent the number of input sequences that contributed to each sequence. Users will typically delete lower-depth tigs (contigs) to prioritise resolving higher-depth tigs (contigs).
- The output GFA created by Autocycler clean is also a valid input. This means that you can clean in multiple stages, using the output of one round of cleaning as the input for the next.
- The values for -r and -d can contain spaces if it is enclosed in quotes. For example: -r "7, 8". This allows for copy-pasting from Bandage's 'selected nodes' list.
- If -r and -d are not specified, no sequences will be removed, and the input graph will remain unchanged.
- If any of the specified tigs in -r or -d do not exist in the input graph, Autocycler clean will return an error and terminate. Ensure tig  (contig) IDs match those in the GFA.
- The only tigs (contigs) which can be duplicated are those which contain exactly two links to other tigs. Each copy of the duplicated tig will keep one of the links.
- If an invalid tig (contig) ID is specified in -d (e.g., a contig with more than two links), Autocycler will return an error and terminate. Verify tig (contig) IDs and their properties in Bandage before running the command.
- Useful for manual curation of assembly graphs
- Can remove problematic segments or amplify important ones
- Both removal and duplication can be performed in one operation
- Input tig (contig) numbers should match those in your GFA file

.. class:: infomark

**More Information**

- `Autocycler clean`: https://github.com/rrwick/Autocycler/wiki/Autocycler-clean

**Citations**

		]]></help>
	<expand macro="citations"/>
</tool>

<tool id="autocycler_combine" name="AutoCycler Combine" version="@TOOL_VERSION@+galaxy0" profile="@PROFILE@">
    <description>combine multiple cluster GFA files into final assembly</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        mkdir -p out_dir &&
        autocycler combine
            --in_gfas
            #for $cluster in $in_gfas:
                '$cluster'
            #end for
        --autocycler_dir out_dir/ 
        ]]></command>
    <inputs>
        <param argument="--in_gfas" type="data_collection" collection_type="list" format="gfa1" label="AutoCycler - Combine resolved cluster assemblies"
            help="Final GFA files that passed assembly QC from resolve step (collection of cluster assemblies)"/>
    </inputs>
    <outputs>
        <data name="consensus_assembly_yaml" from_work_dir="out_dir/consensus_assembly.yaml" format="yaml" label="${tool.name} on ${on_string} : consensus assembly yaml"/>
        <data name="consensus_assembly_gfa" from_work_dir="out_dir/consensus_assembly.gfa" format="gfa1" label="${tool.name} on ${on_string} : consensus assembly gfa"/>
        <data name="consensus_assembly_fasta" from_work_dir="out_dir/consensus_assembly.fasta" format="fasta" label="${tool.name} on ${on_string} : consensus assembly fasta"/>
    </outputs>
    <tests>
        <test>
            <param name="in_gfas">
                <collection type="list">
                    <element name="5_final" value="5_final.gfa" ftype="gfa1"/>
                </collection>
            </param>
            <output name="consensus_assembly_yaml" value="consensus_assembly.yaml" ftype="yaml" >
                <assert_contents>
                    <has_text text="consensus_assembly_bases: 8538"/>
                    <has_n_lines n="7"/>
                </assert_contents>
            </output>        
            <output name="consensus_assembly_gfa" value="consensus_assembly.gfa" ftype="gfa1" >
                <assert_contents>
                    <has_size value="8581" delta="100"/>
                </assert_contents>
            </output>
            <output name="consensus_assembly_fasta" value="consensus_assembly.fasta" ftype="fasta">
                <assert_contents>
                    <has_size value="8554"/>
                    <has_line_matching expression="^>.*"/>
                    <has_line_matching expression="^[ACGTN]+$"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
**AutoCycler Combine Tool**

This tool combines multiple cluster GFA files into a final assembly.

**Inputs**

- One or more cluster GFA files (from previous AutoCycler steps)

**Outputs**

- Final combined assembly in GFA format (i.e 5_final.gfa1)
- output files: 1_untrimmed_yaml.yaml, 2_trimmed_yaml.yaml, 1_untrimmed.gfa1, 2_trimmed.gfa1, 3_bridged.gfa1, 4_merged.gfa1

**Notes**

- While Autocycler combine is typically run using each cluster's final graph (5_final.gfa), it can also be run on earlier graphs (e.g. 4_merged.gfa) if desired.        
- This is typically the final assembly step in the AutoCycler pipeline
- Multiple GFA files can be selected for combination
- The output represents the complete assembled sequence graph

.. class:: infomark

**More Information**

- `Autocycler combine`: https://github.com/rrwick/Autocycler/wiki/Autocycler-combine

**Citations**


    ]]></help>
    <expand macro="citations"/>
</tool>

<tool id="minipileup" name="minipileup" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
    <description>a simple variant caller</description>
    <requirements>
        <requirement type="package" version="1.4b">minipileup</requirement>
        <requirement type="package" version="1.21">samtools</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        samtools faidx '$input1';
        minipileup 
        ${general.show_variants_only}
    -f '$input1' -p.2 '$input2' > '$output1'
    ]]></command>
    <inputs>
        <param type="data" name="input1" format="fasta" />
        <param type="data" name="input2" format="bam" />
        <section name="general" title="General options" expanded="true">
            <param type="boolean" name="show_variants_only" label="Show variants only" help="Only changed sites will be shown if Yes" argument="-y" truevalue="-y" falsevalue=""/>
        </section>
    </inputs>
    <outputs>
        <data name="output1" format="vcf" />
    </outputs>
    <tests>
        <test>
            <param name="input1" value="ref.fa"/>
            <param name="input2" value="aln1.bam"/>
            <output name="output1" file="var.vcf"/>
        </test>
    </tests>
    <help><![CDATA[
        Usage: minipileup [options] in1.bam [in2.bam [...]]
Options:
  General:
    -f FILE      reference genome [null]
    -v           show variants only
    -c           output in the VCF format (force -v)
    -C           show count of each allele on both strands
    -e           use '*' to mark deleted bases
    -y           variant calling mode (-vcC -a2 -s5 -q30 -Q20)
    -V           print version number
  Alignment filter:
    -r STR       region in format of 'ctg:start-end' [null]
    -b FILE      BED or position list file to include [null]
    -P           only consider properly paired reads for paired-end reads
    -q INT       minimum mapping quality [0]
    -l INT       minimum alignment length [0]
    -S INT       minimum supplementary alignment length [0]
  Site filter:
    -Q INT       minimum base quality [0]
    -T INT       skip bases within INT-bp from either end of a read [0]
    -s INT       drop alleles with depth<INT [1]
    -a INT       drop alleles with depth<INT on either strand [0]
    -p FLOAT     drop an allele if the allele fraction is below FLOAT [0]

    ]]></help>
</tool>
<?xml version="1.0"?>
<macros>
    <token name="@TOOL_VERSION@">5.2.10.49</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">pisces</requirement>
            <requirement type="package" version="1.11">samtools</requirement>
            <requirement type="package" version="3.0">zip</requirement>
        </requirements>
    </xml>
    <xml name="version_command">
    	<version_command><![CDATA[@DOTNET@ @PISCES@ -v 2>&1 | grep 'Pisces' | cut -f 2 -d ' ' ]]></version_command> <!-- TODO -->
    </xml>
    <xml name="citations">
	    <citations>
	        <citation type="doi">10.1101/291641</citation>
	        <citation type="doi">10.1093/bioinformatics/bty849</citation>
	    </citations>
    </xml>

    <!-- command -->
	
    <token name="@DOTNET@"><![CDATA[/home/stephan/Projects/tools/pisces/dotnet-runtime-2.0.0-linux-x64/dotnet]]></token> <!-- TODO remove -->
    

    <token name="@PISCES@"><![CDATA[/home/stephan/Projects/tools/pisces/Pisces_@TOOL_VERSION@/Pisces.dll]]></token> <!-- TODO remove --> 
    

    <token name="@GEMINI@"><![CDATA[/home/stephan/Projects/tools/pisces/pisces_all_5.3.0.0/pisces_all/Gemini]]></token> <!-- TODO remove -->
    

    <token name="@CREATEGENOMESIZEFILE@"><![CDATA[/home/stephan/Projects/tools/pisces/CreateGenomeSizeFile_@TOOL_VERSION@/CreateGenomeSizeFile.dll]]></token> <!-- TODO remove -->



    <token name="@BAM@"><![CDATA[
## process samples
mkdir data &&
#for $i, $current in enumerate($b)
    ln -s '${current}' 'data/sample_${i}.bam' && ## TODO name pattern?
    ln -s '${current.metadata.bam_index}' 'data/sample_${i}.bam.bai' &&
#end for
    ]]></token>
    <token name="@GENOMESIZE@"><![CDATA[
## process genome to create GenomeSize.xml
mkdir genome &&
ln -s '$genome' 'genome/genome.fasta' &&
@DOTNET@ @CREATEGENOMESIZEFILE@ ## TODO
-g 'genome/' ## folder, '/' required
-s '$genome_description' &&
    ]]></token>
	
    <!-- input -->    

    <xml name="gender">
		<param argument="--gender" type="select" label="Select gender of the sample">
		    <option value="" selected="true">No</option>
		    <option value="true">Male</option>
		    <option value="false">Female</option>
		</param>
    </xml>
    <xml name="genome">
        <param name="genome" type="data" format="fasta" label="Select file with genome" help="(CreateGenomeSizeFile.dll -g)"/> <!-- TODO use reference genomes of Galaxy here? -->
    </xml>
    
    <xml name="genome_description">
        <param name="genome_description" type="text" value="Human (hg19) " label="Select genome description" help="Species name and build, e.g. 'Rattus norvegicus (UCSC rn4)' (CreateGenomeSizeFile.dll -s)"/> <!-- TODO reuqires specific format, e.g. "Human (hg19) " works; "Human (hg19)" not, remove default value ! -->
    </xml>
    <xml name="vcf">
        <param argument="--vcf" type="data" format="vcf" multiple="true" label="Select input file"/>
    </xml>

    <xml name="so">
        <section name="so" title="Stitching options" expanded="true">
            <param argument="--minbasecallquality" type="integer" value="" label="Set minimum basecall quality" help="Cutoff for which, in case of a stitching conflict, bases with qscore less than this value will automatically be disregarded in favor of the mate's bases."/>
            <param argument="--nifydisagreement" type="boolean" truevalue="--nifydisagreement true" falsevalue="--nifydisagreement false" label="Turn high-quality disagreeing overlap bases to Ns?"/>
            <param argument="--maxreadlength" type="integer" value="1024" label="Set maximum read length" help="Maximum expected length of individual reads, used to determine the maximum expected stitched read length (2*len - 1). For optimal performance, set as low as appropriate (i.e. the actual single-read length + max deletion length you expect to stitch) for your data."/>
            <param argument="--dontstitchrepeatoverlap" type="boolean" truevalue="--dontstitchrepeatoverlap true" falsevalue="--dontstitchrepeatoverlap false" checked="true" label="Stitch read pairs whose only overlap is a repeating sequence?"/>
            <param argument="--ignorereadsabovemaxlength" type="boolean" truevalue="--ignorereadsabovemaxlength true" falsevalue="--ignorereadsabovemaxlength false" label="Ignore reads above maximum length?" help="Whether to passively ignore read pairs that would be above the max stitched length (e.g. extremely long deletions)."/>
            <param argument="--countnstowarddisagreeingbases" type="boolean" truevalue="--countnstowarddisagreeingbases true" falsevalue="--countnstowarddisagreeingbases false" label="Count Ns toward disagreeing bases?" help="Whether to count overlapping-base disagreements where one of the mates reports an 'N' as a full-force disagreement (i.e. Nify the base if configured to do so, and count toward the number of disagreements in determining whether the stitching result should be rejected)."/>
            <param argument="--maxnumdisagreeingstitchedbases" type="integer" value="2147483647" label="Set maximum number of stitched bases" help="That can disagree between the two reads before a stitched read is rejected."/>
            <param argument="--stringtagstokeepfromr1" type="text" value="" optional="true" label="Set tags to keep from R1" help="Comma-delimited list of string tags to retain from read 1 when stitching"/>
        </section>
    </xml>

    <xml name="ro">
        <section name="ro" title="Realignment options">
            <param argument="--maskpartialinsertion" type="boolean" truevalue="--maskpartialinsertion true" falsevalue="--maskpartialinsertion false" label="Mask partial insertion?" help="Option to softclip a partial insertion at the end of a realigned read (a complete but unanchored insertion is allowed)."/>
            <param argument="--minimumunanchoredinsertionlength" type="integer" value="0" label="Set minimum unanchored insertion length" help="Minimum length of an unanchored insertion (i.e. no flanking reference base on one side) allowed in a realigned read. Insertions shorter than the specified length will be softclipped. Default value is 0, i.e. allowing unanchored insertions of any length."/>
            <param argument="--softclipunknownindels" type="boolean" truevalue="--softclipunknownindels true" falsevalue="--softclipunknownindels false" label="Softclip out unknown indels?"/>
            <param argument="--checksoftclipsformismatches" type="boolean" truevalue="--checksoftclipsformismatches true" falsevalue="--checksoftclipsformismatches false"  label="Count mismatches in softclips toward total mismatches?" help=""/>
            <param argument="--trackmismatches" type="boolean" truevalue="--trackmismatches true" falsevalue="--trackmismatches false" label="Track and compare mismatches when realigning?"/>
            <param argument="--categoriestorealign" type="select" multiple="true" label="Select categories to realign">
                <option value="ImperfectStitched" selected="true">ImperfectStitched</option>
                <option value="FailStitch" selected="true">FailStitch</option>
                <option value="UnstitchIndel" selected="true">UnstitchIndel</option>
                <option value="Unstitchable" selected="true">Unstitchable</option>
                <option value="Disagree" selected="true">Disagree</option>
                <option value="MessyStitched" selected="true">MessyStitched</option>
                <option value="MessySplit" selected="true">MessySplit</option>
                <option value="UnstitchImperfect" selected="true">UnstitchImperfect</option>
                <option value="LongFragment" selected="true">LongFragment</option>
                <option value="UnstitchMessy" selected="true">UnstitchMessy</option>
                <option value="UnstitchForwardMessy" selected="true">UnstitchForwardMessy</option>
                <option value="UnstitchReverseMessy" selected="true">UnstitchReverseMessy</option>
                <option value="UnstitchForwardMessyIndel" selected="true">UnstitchForwardMessyIndel</option>
                <option value="UnstitchReverseMessyIndel" selected="true">UnstitchReverseMessyIndel</option>
                <option value="UnstitchMessySuspiciousRead" selected="true">UnstitchMessySuspiciousRead</option>
                <option value="UnstitchMessyIndelSuspiciousRead" selected="true">UnstitchMessyIndelSuspiciousRead</option>
                <option value="UnstitchMessySuspiciousMd" selected="true">UnstitchMessySuspiciousMd</option>
            </param>
            <param argument="--categoriestosnowball" type="select" multiple="true" label="Select categories to snowball">
                <option value="ImperfectStitched">ImperfectStitched</option>
                <option value="FailStitch">FailStitch</option>
                <option value="UnstitchIndel">UnstitchIndel</option>
                <option value="Unstitchable">Unstitchable</option>
                <option value="Disagree">Disagree</option>
                <option value="MessyStitched">MessyStitched</option>
                <option value="MessySplit">MessySplit</option>
                <option value="UnstitchImperfect">UnstitchImperfect</option>
                <option value="LongFragment">LongFragment</option>
                <option value="UnstitchMessy">UnstitchMessy</option>
                <option value="UnstitchForwardMessy">UnstitchForwardMessy</option>
                <option value="UnstitchReverseMessy">UnstitchReverseMessy</option>
                <option value="UnstitchForwardMessyIndel">UnstitchForwardMessyIndel</option>
                <option value="UnstitchReverseMessyIndel">UnstitchReverseMessyIndel</option>
                <option value="UnstitchMessySuspiciousRead">UnstitchMessySuspiciousRead</option>
                <option value="UnstitchMessyIndelSuspiciousRead">UnstitchMessyIndelSuspiciousRead</option>
                <option value="UnstitchMessySuspiciousMd">UnstitchMessySuspiciousMd</option>
            </param>
            <param argument="--pairawareeverything" type="boolean" truevalue="--pairawareeverything true" falsevalue="--pairawareeverything false" checked="true" label="Pass everything through pair aware realignment?" help="Or just the expected categories (Disagree, FailStitch, UnstitchIndel)"/>
            <param argument="--forcehighlikelihoodrealigners" type="boolean" truevalue="--forcehighlikelihoodrealigners true" falsevalue="--forcehighlikelihoodrealigners false" label="Force high likelihood realigners?" help="Force realignment in high-likelihood categories even if the neighborhood would not have been eligible for realignment."/>
        </section>
        <section name="rbo" title="Realignment bins options" expanded="true">
            <param argument="--messysitethreshold" type="integer" value="1" label="Set messy site threshold" help="Minimum (raw) number of messy-type reads that must be present in a neighborhood for it to be considered messy and a potential realignable neighborhood. Must also meet the frequency thresholds."/>
            <param argument="--messysitewidth" type="integer" value="500" label="Set messy site width" help="Neighborhood width to use when binning realignment eligibility signals."/>
            <param argument="--collectdepth" type="boolean" truevalue="--collectdepth true" falsevalue="--collectdepth false" checked="true" label="Collect depth to gauge frequency information?"/>            
            <param argument="--imperfectfreqthreshold" type="float" min="0.0" max="1.0" value="0.03" label="Set imperfect frequency threshold" help="Proportion of imperfect reads in bin below which we should not bother to realign. Should be proportional to detection limit and bin width."/>
            <param argument="--indelregionfreqthreshold" type="float" min="0.0" max="1.0" value="0.01" label="Set indel region frequency threshold" help="Proportion of imperfect reads in bin below which we should not bother to realign. Should be proportional to detection limit and bin width."/>
            <param argument="--regiondepththreshold" type="integer" value="5" label="Set region depth threshold" help="When collecting realignment eligibility signals and depth, minimum total number of reads in a neighborhood below which the neighborhood would be ineligible for realignment."/>
            <param argument="--recalculateusablesitesaftersnowball" type="boolean" truevalue="--recalculateusablesitesaftersnowball true" falsevalue="--recalculateusablesitesaftersnowball false" checked="true" label="Recalculate site usability after snowballing?"/>
        </section>
    </xml>



    <!-- output -->



    <!-- help -->

    <token name="@REFERENCES@"><![CDATA[
More information are available on `GitHub <https://github.com/Illumina/Pisces/>`_ and in the `user guide <https://github.com/Illumina/Pisces/wiki>`_.
    ]]></token>
    <token name="@WID@"><![CDATA[
...
    ]]></token>
</macros>
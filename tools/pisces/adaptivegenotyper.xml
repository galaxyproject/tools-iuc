<?xml version="1.0"?>
<tool id="pisces_adaptivegenotyper" name="Pisces AdaptiveGenotyper" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="18.01">
    <description>of binomial mixture models for germline variant calling</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
## skipped --help/-h, --version/-v, --log

## initialize
mkdir 'data' &&
ln -s '${vcf}' 'data/variants.vcf' &&
ln -s '${co.model}' 'data/model.txt' &&

## run
/home/stephan/Projects/tools/pisces/All_5.3.0.0/AdaptiveGenotyper ## TODO
## required
--vcf 'data/variants.vcf'
## common
--outfolder 'results' ## -o, --out
--model 'data/model.txt' ## --models
    ]]></command>
    <inputs>
        <expand macro="vcf"/>
        <section name="co" title="Common options" expanded="true">
            <param name="model" type="data" format="txt" optional="true" label="Select model file" help="(--model, --models)"/>
        </section>
        <section name="oo" title="Output options" expanded="true">
            <param name="out" type="select" multiple="true" optional="false" label="Select output file(s)">
                <option value="ao">Applied options</option>
                <option value="l">Log</option>
                <option value="r" selected="true">Recal variants</option>
            </param>
        </section>
    </inputs>
    <outputs>
        <expand macro="out_ao" tool="AdaptiveGT"/>
        <expand macro="out_l" tool="AdaptiveGT"/>
        <data name="out_r" format="vcf" from_work_dir="results/variants.recal.vcf" label="${tool.name} on ${on_string}: Recal variants">
            <filter>'r' in oo['out']</filter>
        </data>
    </outputs>
    <tests>
        <!-- #1 default -->
        <test expect_num_outputs="3">
            <param name="vcf" value="d.vcf"/>
            <section name="co">
                <param name="model" value="model.txt"/>
            </section>
            <section name="oo">
                <param name="out" value="ao,l,r"/>
            </section>
            <output name="out_ao">
                <assert_contents>
                    <has_size value="2575"/>
                </assert_contents>
            </output>
            <output name="out_l">
                <assert_contents>
                    <has_text_matching expression=".+Ending.+"/>
                </assert_contents>
            </output>
            <output name="out_r">
                <assert_contents>
                    <has_n_lines n="22"/>
                    <!--has_text_matching expression=""/--> <!-- TODO insufficient test data -->
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

@WID@

Pisces AdaptiveGenotyper is a tool for adaptive germline calling of genotypes on VCF.

**Input**

- Somatic, uncrushed variants ((g)VCF), that should be formatted such that each variant allele has its own line. Pisces output has this format by default. In addition, the input needs to either be a gVCF, with all loci reported, or the option -MinVQ 0 needs to be used such that most variants down to 1% are reported.
- Model (TXT), each model should have 4 lines: Line 1: 3+ doubles that specifies the means of each binomial population for SNVs; Line 2: Prior distribution that corresponds to each population. Must have same number of elements as Line 1; Line 3: Means for INDELs, specified in the same format as Line 1; Line 4: Prior distribution of indels, specified in the same format as Line 2; e.g.

    ::

        0.0401130865565965,0.489500734855199,0.997999655451619
        0.764902713140076,0.148462821017266,0.0866344658425057
        0.0370191788092869,0.445738109318784,0.967163008605309
        0.960510660453686,0.027723868566059,0.0117654709802869

**Output**

@HELP_AO@
@HELP_L@
- Recal variants (VCF), with the same convention and structure as the input file but with crushed loci, so that each locus will be in one line.

.. class:: infomark

**References**

@REFERENCES@
    ]]></help>
    <expand macro="citations"/>
</tool>
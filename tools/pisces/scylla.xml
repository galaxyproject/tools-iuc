<?xml version="1.0"?>
<tool id="pisces_scylla" name="Pisces Scylla" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@">
    <description>variant phaser</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
## preprocessing
## genome
#if $co.genome_cond.genome_sel == 'yes'
	@GENOMESIZE@
#end if

## run
/home/stephan/Projects/tools/pisces/All_5.3.0.0/GeminiMulti ## TODO
## required
--bam '$bam'
--vcf '$vcf'

## common
--maxnumthreads \${GALAXY_SLOTS:-4} ## -t
--debug true
--outfolder 'results' ## -o, --out
#if $co.genome_cond.genome_sel == 'yes'
	--genomefolder 'genome' ## -g
#end if

## clustering
$clo.allowclustermerging
$clo.allowworstfitremoval
--clusterconstraint $clo.clusterconstraint

## phasable criteria
$pco.passingvariantsonly
$pco.hetvariantsonly
--chr '$pco.chr'
--minpassingvariantsinnbhd $pco.minpassingvariantsinnbhd
--dist $pco.dist

## clipped support options
$cso.usesoftclippedreads
--minsizeforcliprescue $cso.minsizeforcliprescue

## bam filtering
--minbasecallquality $bfo.minbasecallquality ## --minbq                              
--minmapquality $bfo.minmapquality ## --minmq                             
$bfo.filterduplicates ## --duplicatereadfilter
$bfo.pp ## --onlyuseproperpairs


	]]></command>
	<inputs>


		<param argument="--vcf" type="data" format="vcf" label="Select variant file"/>
		<expand macro="bam" multiple="false" label="Select sample file" help="(--bam)"/>

        <section name="co" title="Common options" expanded="true">
            <conditional name="genome_cond" label="">
                <param name="genome_sel" type="select" label="Apply genome?" help="If 'no' is selected, reference bases reported inside phased variants will be left as 'R'">
                    <option value="no">No</option>
                    <option value="Yes">Yes</option>
                </param>
                <when value="no"/>
                <when value="yes">
        			<!-- CreateGenomeSizeFile.dll -->
        			<expand macro="genome" help="GeminiMulti --genome"/> <!-- TODO -->
        			<expand macro="genome_description"/>
                </when>
            </conditional>
        </section>

		<section name="clo" title="Clustering options" expanded="true">
        	<param argument="--allowclustermerging" type="boolean" truevalue="--allowclustermerging true" falsevalue="--allowclustermerging false" checked="true" label="Allow cluster merging?"/>
        	<param argument="--allowworstfitremoval" type="boolean" truevalue="--allowworstfitremoval true" falsevalue="--allowworstfitremoval false" checked="true" label="Allow worst fit removal?"/>
        	<param argument="--clusterconstraint" type="integer" value="-1" label="Set cluster constraint" help="Analogous to forced ploidy."/>
        </section>

		<section name="pco" title="Phasable criteria options" expanded="true">
			<param argument="--passingvariantsonly" type="boolean" truevalue="--passingvariantsonly true" falsevalue="--passingvariantsonly false" checked="true" label="Passing variants only?"/>
			<param argument="--hetvariantsonly" type="boolean" truevalue="--hetvariantsonly true" falsevalue="--hetvariantsonly false" label="Het variants only?"/>
			<param argument="--maxnbhdstoprocess" type="integer" value="-1" label="Set cap on the number of neighborhoods to process" help="If -1, all neighborhoods will be processed"/>
			<param argument="--chr" type="text" value="" optioanl="true" label="Set chromosome(s) to process" help="Comma separated list"/>
			<param argument="--minpassingvariantsinnbhd" type="integer" min="0" value="0" label="Set minimum number of passing variants required for a neighborhood to be callable"/>
			<param argument="--dist" type="integer" min="" max="" value="" label="Set distance to define how close variants need to be to chain together" help="Should be less than read length."/>
		</section>

		<section name="cso" title="Clipped support options" expanded="true">
			<param argument="--usesoftclippedreads" type="boolean" truevalue="--usesoftclippedreads true" falsevalue="--usesoftclippedreads false" label="Use soft clipped reads?"/>
			<param argument="--minsizeforcliprescue" type="integer" value="6" label="Set minimum size for clip rescue" help="Size (length of ref allele + alt allele) of MNV to rescue supporting clipped reads."/> 
		</section>


        <section name="bfo" title="BAM filtering options" expanded="true">
            <expand macro="minbasecallquality"/>
            <expand macro="minmapquality"/>
            <expand macro="filterduplicates"/>
            <expand macro="pp"/>
        </section>

		<section name="vco" title="Variant calling options" expanded="true">
			<expand macro="minvq"/>
			<expand macro="mindp"/>
			<expand macro="vqfilter"/>
			<expand macro="vffilter"/>
			<expand macro="gqfilter"/>
			<expand macro="mindpfilter"/>
			<expand macro="ssfilter"/>
			<expand macro="nl"/>






















	</inputs>
	<outputs>

	</outputs>
	<tests>

	</tests>
	<help><![CDATA[

	]]></help>
	<expand macro="citations"/>
</tool>
<?xml version="1.0"?>
<tool id="pisces_gemini" name="Pisces Gemini" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@">
    <description>pair-aware indel realigner and read stitcher</description>    
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    
    <command detect_errors="exit_code"><![CDATA[
## preprocessing

## run
dotnet Gemini.dll
## required
--bam $bam
--genome $genome 
## --samtools 
--outfolder 'results'
## common
--chromrefid $co.chromrefid
--minbasecallquality $co.minbasecallquality
$co.filterduplicates
--debug true 
$co.filterpairunmapped
$co.filterforproperpairs
$co.nifydisagreement
## debugsummary 
## --numthreads 
--maxreadlength $co.maxreadlength
$co.dontstitchrepeatoverlap
$co.ignorereadsabovemaxlength
--maxindelsize $co.maxindelsize
$co.allowrescoringorigzero
$co.maskpartialinsertion
--minimumunanchoredinsertionlength $co.minimumunanchoredinsertionlength
--minpreferredsupport $co.minpreferredsupport
--minpreferredanchor $co.minpreferredanchor
--minrequiredindelsupport $co.minrequiredindelsupport
--minrequiredanchor $co.minrequiredanchor
--maxmessthreshold $co.maxmessthreshold 
--binsize $co.binsize 
$co.keepbothsidesoftclips
$co.trustsoftclips
$co.keepprobe
$co.checksoftclipsformismatches
$co.trackmismatches
--categoriestorealign $co.
--categoriestosnowball $co.
--numshardstosnowball $co.numshardstosnowball
$co.pairawareeverything
$co.deferindelstitch
--maxnumdisagreeingstitchedbases $co.maxnumdisagreeingstitchedbases 
$co.samtoolsoldstyle
$co.keepunmerged
##--intermediatedir <PATH>
$co.indexperchrom
$co.stitchonly
$co.realignonly
$co.softclipunknownindels

## postprocessing

    ]]></command>
    <inputs>
        <param argument="--bam" type="data" format="bam" label="Select input file"/>
        <param argument="--genome" type="data" format="bam" label="Select genome"/>

        <section name="co" title="Common options">
            <param argument="--chromrefid" type="integer" min="" max="" value="" label="Set chromosome RefId to filter on"/>
            <param argument="--minbasecallquality " type="integer" min="" max="" value="" label="--minbasecallquality" help="cutoff for which, in case of a stitching conflict, bases with qscore less than this value will automatically be disregarded in favor of the mate's bases."/>
            <param argument="--filterduplicates" type="boolean" truevalue="--filterduplicates true" falsevalue="--filterduplicates false" checked="true" label="--filterduplicates" help="indicating whether reads marked as duplicates shall be filtered"/>
            <param argument="--filterpairunmapped" type="boolean" truevalue="--filterpairunmapped true" falsevalue="--filterpairunmapped false" label="--filterpairunmapped" help="indicating whether read pairs should be filtered when one or both reads are not mapped"/>
            <param argument="--filterforproperpairs" type="boolean" truevalue="--filterforproperpairs" falsevalue="--filterforproperpairs" label="--filterforproperpairs" help="indicating whether reads marked as not proper pairs shall be filtered"/>
            <param argument="--nifydisagreement" type="boolean" truevalue="--nifydisagreement" falsevalue="--nifydisagreement" checked="true" label="indicating whether or not to turn high-quality disagreeing overlap bases to Ns.--nifydisagreement" help=""/>
            <param argument="--maxreadlength" type="integer" min="" max="" value="1024" label="--maxreadlength" help="indicating the maximum expected length of individual reads, used to determine the maximum expected stitched read length (2*len - 1). For optimal performance, set as low as appropriate (i.e. the actual single-read length) for your data."/>
            <param argument="--dontstitchrepeatoverlap" type="boolean" truevalue="--dontstitchrepeatoverlap true" falsevalue="--dontstitchrepeatoverlap false" checked="true" label="--dontstitchrepeatoverlap" help=""/>
            <param argument="--ignorereadsabovemaxlength" type="boolean" truevalue="--ignorereadsabovemaxlength" falsevalue="--ignorereadsabovemaxlength" checked="true" label="--ignorereadsabovemaxlength" help="indicating whether to passively ignore read pairs that would be above the max stitched length (e.g. extremely long deletions)."/>
            <param argument="--maxindelsize" type="integer" min="" max="" value="100" label="Maximum allowed indel size for realignment" help=""/>
            <param argument="--allowrescoringorigzero" type="boolean" truevalue="--allowrescoringorigzero" falsevalue="--allowrescoringorigzero" checked="true" label="--allowrescoringorigzero" help="Option to allow setting mapq of perfectly realigned reads (0 mismatch) to 40 even if original mapq was 0.  If false, perfectly realigned reads with original mapq between 1-20 are still assigned mapq of 40, but those with 0 are left at 0."/>
            <param argument="--maskpartialinsertion" type="boolean" truevalue="--maskpartialinsertion" falsevalue="--maskpartialinsertion" label="Option to softclip a partial insertion at the end of a realigned read (a complete but un-anchored insertion is allowed).--maskpartialinsertion" help=""/>
            <param argument="--minimumunanchoredinsertionlength " type="integer" min="" max="" value="" label="--minimumunanchoredinsertionlength " help="Minimum length of an unanchored insertion (-i.e. no flanking reference base on one side) allowed in a realigned read. Insertions shorter than the specified length will be softclipped. Default value is 0, i.e. allowing unanchored insertions of any length."/>
            <param argument="--minpreferredsupport" type="integer" min="" max="" value="3" label="--minpreferredsupport" help="Instances of a found variant before it can be considered to realign around"/>
            <param argument="--minpreferredanchor" type="integer" min="" max="" value="1" label="--minpreferredanchor" help="Minimum anchor around indel to count an observation toward good evidence."/>
            <param argument="--minrequiredindelsupport" type="integer" min="" max="" value="0" label="--minrequiredindelsupport" help="Don't even allow otherwise strong indels that we attempt to rescue in if they have num observations below this."/>
            <param argument="--minrequiredanchor" type="integer" min="" max="" value="0" label="--minrequiredanchor" help="Don't even allow otherwise strong indels that we attempt to rescue in if they have min anchor below this."/>
            <param argument="--maxmessthreshold " type="integer" min="" max="" value="20" label="--maxmessthreshold " help="Don't allow indels with average mess above this value."/>
            <param argument="--binsize" type="integer" min="" max="" value="0" label="--binsize" help="Size of bin within which to compare indels to determine if a region is too messy to realign around. "/>
            <param argument="--keepbothsidesoftclips" type="boolean" truevalue="--keepbothsidesoftclips" falsevalue="--keepbothsidesoftclips" label="--keepbothsidesoftclips" help="Whether to trust that both-side softclips are probe and should stay softclipped."/>     
            <param argument="--trustsoftclips" type="boolean" truevalue="--trustsoftclips" falsevalue="--trustsoftclips" label="--trustsoftclips" help="Whether to trust softclips. If true, having softclips doesn't automatically trigger indel realignment. Also, won't try to stitch the softclips."/>
            <param argument="--keepprobe" type="boolean" truevalue="--keepprobe" falsevalue="--keepprobe" label="" help="Whether to trust that probe-side softclips are probe and should stay softclipped."/>
            <param argument="--checksoftclipsformismatches" type="boolean" truevalue="--checksoftclipsformismatches" falsevalue="--checksoftclipsformismatches" label="--checksoftclipsformismatches" help="Whether to count mismatches in softclips toward total mismatches."/>
            <param argument="--trackmismatches" type="boolean" truevalue="--trackmismatches" falsevalue="--trackmismatches" label="--trackmismatches" help="Whether to track and compare mismatches when realigning."/>
            <param argument="--categoriestorealign" type="select" multiple="true" label="--categoriestorealign" help="Category names that should be attempted to realign.">
                <option value="" selected="true">ImperfectStitched</option>
                <option value="" selected="true">FailStitch</option>
                <option value="" selected="true">UnstitchIndel</option>
                <option value="" selected="true">Unstitchable</option>
                <option value="" selected="true">Split</option>
                <option value="" selected="true">Disagree</option>
            </param>
            <param argument="--categoriestosnowball" type="text" value="" label="" help="Category names that should be attempted to snowball."/> todo
            <param argument="--numshardstosnowball" type="integer" min="" max="" value="--numshardstosnowball" label="" help="For multithreaded samples, the number of shards from which to gather evidence in snowballing."/> todo default
            <param argument="--pairawareeverything" type="boolean" truevalue="--pairawareeverything" falsevalue="--pairawareeverything" checked="true" label="--pairawareeverything" help="Whether to pass everything through pair aware realignment, or just the expected categories"/>
            <param argument="--deferindelstitch " type="boolean" truevalue="--deferindelstitch " falsevalue="--deferindelstitch " checked="true" label="--deferindelstitch " help="Whether to stitch non-disagreeing indel reads to start, or wait til realignment"/>
            <param argument="--maxnumdisagreeingstitchedbases" type="integer" min="" max="" value="int.MaxValue." label="--maxnumdisagreeingstitchedbases" help="Maximum number of stitched bases that can disagree between the two reads before a stitched read is rejected."/>
            <param argument="--keepunmerged" type="boolean" truevalue="--keepunmerged" falsevalue="--keepunmerged" label="--keepunmerged" help="Whether to keep unmerged bams, for debugging."/>
            <param argument="--indexperchrom" type="boolean" truevalue="--indexperchrom" falsevalue="--indexperchrom" checked="true" label="--indexperchrom" help="Whether to index the per-chromosome bams, for debugging."/>
            <param argument="--stitchonly" type="boolean" truevalue="--stitchonly" falsevalue="--stitchonly" label="--stitchonly" help="Whether to only perform stitching, skipping realignment"/>
            <param argument="--realignonly " type="boolean" truevalue="--realignonly " falsevalue="--realignonly" label="" help="Whether to only perform realignment, skipping stitching."/>
            <param argument="--softclipunknownindels " type="boolean" truevalue="--softclipunknownindels " falsevalue="--softclipunknownindels" label="--softclipunknownindels " help="Whether to softclip out unknown indels."/>
        </section>       
        <section name="oo" title="Output options">
            <param name="out" type="select" multiple="true" optional="false" label="Select output file(s)" help="">
                <option value="" selected="true"></option>
                <option value=""></option>
                <option value="log">Log</option>
            </param>            
        </section>
    </inputs>
    <outputs>

    </outputs>
    <tests>
        <!-- #1 default -->

        <!-- #2 -->
    
    </tests>
    <help><![CDATA[
.. class:: infomark

...

**Input**

...

**Output**

...

.. class:: infomark

**References**

@REFERENCES@
    ]]></help>
    <expand macro="citations"/>
</tool>
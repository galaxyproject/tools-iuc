<tool id='isoplot' name='Isoplot: Generate plots from isocor output' version='0.1.0'>
    <requirements>
        <requirement type='package' version='1.2.4'>isoplot</requirement>
    </requirements>
    <command><![CDATA[
         isoplot '$datafile' 'galaxy' '$format' --value '$value' --template '$template_file'
#if $SP.generate_barplot:
    -bp
#end if
#if $SP.generate_meanplot:
    -mb
#end if
#if $SP.generate_heatmap:
    -hm
#end if
#if $SP.generate_clustermap:
    -cm
#end if
#if $IP.generate_barplot:
    -IB
#end if
#if $IP.generate_meanplot:
    -IM
#end if
#if $IP.generate_heatmap:
    -HM
#end if
#if $stack:
    -s
#end if
#if $verbosity:
    -v
#end if
#if $annotation:
    -a
#end if
-g -z '$output2' > $output1 2> '$output3'
    ]]></command>
    <inputs>
        <param name='datafile' type='data' format='csv, tabular' multiple='true' label='Upload data file' />
        <param name='template_file' type='data' format='csv, xlsx' multiple='true' label='Template file' argument='--template'/>
        <!--param name='run_name' type='text' label='Run name' /-->
        <param name='format' type='select' label='Plot format'>
            <option value='pdf'>pdf</option>
            <option value='jpeg'>jpeg</option>
            <option value='png'>png</option>
            <option value='svg'>svg</option>
            <option value='html'>html</option>
        </param>
        <param name='value' type='select' label='Data to plot' >
            <option value='corrected_area'>Corrected Area</option>
            <option value='isotopologue_fraction'>Isotopologue Fraction</option>
            <option value='mean_enrichment'>Mean Enrichment</option>
        </param>
        <section name='SP' title='Select static plots to generate'>
            <param type='boolean' name='generate_barplot' label='Flag to generate barplots' argument='-bp'
                   optional='true'/>
            <param type='boolean' name='generate_meanplot' label='Flag to generate meaned barplots' argument='-mb'
                   optional='true'/>
            <!--<param type='boolean' name='generate_areaplot' label='Flag to generate stacked area plots'
                   argument='-sa' optional='true'/>/-->
            <param type='boolean' name='generate_heatmap' label='Flag to generate heatmap' argument='-hm'
                   optional='true'/>
            <param type='boolean' name='generate_clustermap' label='Flag to generate clustermap' argument='-cm'
                   optional='true'/>
        </section>
        <section name='IP' title='Select interactive plots to generate'>
            <param type='boolean' name='generate_barplot' label='Flag to generate barplots' argument='-IB'
                   optional='true'/>
            <param type='boolean' name='generate_meanplot' label='Flag to generate meaned barplots' argument='-IM'
                   optional='true'/>
           <!-- <param type='boolean' name='generate_areaplot' label='Flag to generate stacked area plots' argument='-IS'
                   optional='true'/>-->
            <param type='boolean' name='generate_heatmap' label='Flag to generate heatmap' argument='-HM'
                   optional='true'/>
        </section>
        <param type='boolean' name='stack' label='Flag to unstack bars in barplots' argument='-s' optional='true'/>
        <param type='boolean' name='verbosity' label='Flag to get debug information' argument='-v' optional='true'/>
        <param type='boolean' name='annotation' label='Flag to add annotations on the maps' argument='-a'
               optional='true'/>
    </inputs>
    <outputs>
        <data name='output1' format='csv' label='Formatted data used for plotting' />
        <data name='output2' format='zip' label='Resulting plots' />
        <data name='output3' format='txt' label='Run Info' />
    </outputs>
    <help><![CDATA[

Isoplot2: Plotting isotopic labelling MS data
=============================================

**Positional arguments:**

  input_path		Path to datafile
  run_name              Name of the current run
  format                Format of generated file

**optional arguments:**
  -h, --help            show this help message and exit
  --value		Choices: "corrected_area", "isotopologue_fraction", "mean_enrichment". Select values to plot. This option can be given multiple times

  -m METABOLITE         Metabolite(s) to plot. For all, type in 'all'                        
  -c CONDITION          Condition(s) to plot. For all, type in 'all'
  -t TIME               Time(s) to plot. For all, type in 'all'
  -tp, --template TEMPLATE_PATH     Path to template file

  -sa, --stacked_areaplot  Create static stacked areaplot
  -bp, --barplot           Create static barplot
  -mb, --meaned_barplot    Create static barplot with meaned replicates

  -IB, --interactive_barplot		Create interactive stacked barplot
  -IM, --interactive_stacked_meanplot		Create interactive stacked barplot with meaned replicates
  -IS, --interactive_areaplot		Create interactive stacked areaplot
  -hm, --static_heatmap		Create a static heatmap using mean enrichment data
  -cm, --static_clustermap		Create a static heatmap with clustering using mean enrichment data
  -HM, --interactive_heatmap		Create interactive heatmap using mean enrichment data

  -s, --stack           Add option if barplots should be unstacked
  -v, --verbose         Turns logger to debug mode
  -a, --annot           Add option if annotations should be added on maps

    ]]></help>
    <citations>
        <citation type='bibtex'>
    @misc{githubisoplot,
      author = {Le Gregam, Loic},
      year = {2021},
      title = {isoplot},
      publisher = {GitHub},
      journal = {GitHub repository},
      url = {https://github.com/llegregam},
    }</citation>
        </citations>
    </tool>

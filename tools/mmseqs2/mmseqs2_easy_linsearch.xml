<tool id="mmseqs2_easy_linsearch" name="MMseqs2 Fast Linear Search" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>
        for fast homology search scaling linearly
    </description>
    <macros>
        <import>macro.xml</import>
    </macros>
    <expand macro="biotools"/>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    <expand macro="version_command"/>
    <command detect_errors="aggressive"><![CDATA[
mmseqs easy-linsearch
    '$query_fasta'
    #if str($target_source.target_source_select) == "history"
        '$target_source.target_fasta'
    #else
        '$target_source.mmseqs2_db_select.fields.path'/database
    #end if
    'search_results'
    'tmp'

#if str($alph_type.dbtype) == "1"
    --comp-bias-corr-scale $alph_type.comp_bias_corr_scale
    --kmer-per-seq-scale $alph_type.kmer_per_seq_scale
#elif str($alph_type.dbtype) == "2"
    --zdrop $alph_type.zdrop
    --kmer-per-seq-scale $alph_type.kmer_per_seq_scale
    --adjust-kmer-len $alph_type.adjust_kmer_len
#end if
    --dbtype $alph_type.dbtype

    ## Pre-filter options
    @CMD_PREFILTER@
    --spaced-kmer-mode $prefilter.spaced_kmer_mode

    ## Align options
    @CMD_ALIGN@
    @CMD_SEARCH_ALIGN@

    ## K-mer matcher options
    @CMD_KMERMATCHER@

    ## Misc options
    @CMD_MISC@

    ## Output format
    @CMD_FORMAT_OUTPUT@

    ## Search type
    --search-type $search_type

    ## Common options
    @CMD_THREADS@
    --max-seq-len $common.max_seq_len

    ## Expert options
    @CMD_EXPERT@
    ]]></command>
    <inputs>
        <param name="query_fasta" type="data" format="fasta,fasta.gz,fastq,fastq.gz" label="Query FASTA/Q file" help=""/>
        <expand macro="target_source_conditional"/>
        <expand macro="dbtype_conditional_with_kmer_scale"/>
        <param argument="--search-type" type="select" label="Search type" help="">
            <option value="0" selected="true">Auto</option>
            <option value="1">Amino acid</option>
            <option value="2">Translated</option>
            <option value="3">Nucleotide</option>
            <option value="4">Translated nucleotide alignment</option>
        </param>
        <section name="prefilter" title="Pre-filter">
            <expand macro="prefilter_common_parameters"/>
            <param argument="--spaced-kmer-mode" type="select" label="Spaced k-mer mode" help="">
                <option value="0" selected="true">Use consecutive positions in k-mers</option>
                <option value="1">Use spaced k-mers</option>
            </param>
        </section>
        <section name="align" title="Align">
            <expand macro="align_common_parameters"/>
            <expand macro="search_align_parameters" evalue_default="1.000E-03" min_seq_id_default="0" cov_default="0" max_rejected_default="2147483647" max_accept_default="2147483647"/>
        </section>
        <section name="kmermatcher" title="K-mer matcher">
            <expand macro="kmermatcher_parameters"/>
        </section>
        <section name="misc" title="Misc">
            <expand macro="misc_parameters"/>
        </section>
        <expand macro="output_format_section"/>
        <expand macro="common_section"/>
        <section name="expert" title="Expert">
            <expand macro="expert_common_parameters"/>
        </section>
    </inputs>
    <outputs>
        <data name="output" format="tabular" from_work_dir="search_results" label="${tool.name} on ${on_string}">
            <change_format>
                <when input="output_format.format_mode" value="1" format="sam"/>
                <when input="output_format.format_mode" value="3" format="html"/>
            </change_format>
        </data>
    </outputs>
    <tests>
        <!-- Test: Default protein self-search -->
        <test expect_num_outputs="1">
            <param name="query_fasta" value="small_proteins.fasta" ftype="fasta"/>
            <conditional name="target_source">
                <param name="target_source_select" value="history"/>
                <param name="target_fasta" value="small_proteins.fasta" ftype="fasta"/>
            </conditional>
            <output name="output" ftype="tabular">
                <assert_contents>
                    <has_n_columns n="12"/>
                    <has_text text="sp_prot"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help format="markdown"><![CDATA[
@HELP_HEADER@

**Usage**

MMseqs easy-linsearch performs fast linear-time homology searches using k-mer matching.
It accepts FASTA/FASTQ files directly and produces alignment results.

Unlike easy-search (which uses a cascaded, sensitivity-tunable approach), easy-linsearch
uses a fixed k-mer matching heuristic that scales linearly with database size.
Use easy-linsearch when speed is more important than sensitivity, especially for very
large databases.

**Output formats**

- BLAST-TAB (default): Tab-separated alignment table with customizable columns
- SAM: Standard alignment format
- BLAST-TAB with lengths: Includes query and target sequence lengths
- Pretty HTML: Visual alignment display
- BLAST-TAB with headers: Includes column header line

@HELP_FOOTER@
    ]]></help>
    <expand macro="citations"/>
</tool>

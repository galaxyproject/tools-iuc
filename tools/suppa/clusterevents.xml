<?xml version="1.0"?>
<tool id="suppa_clusterevents" name="SUPPA clusterEvents" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@">
    <description>using a density-based method</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="aggressive"><![CDATA[
suppa.py clusterEvents
-d '$d'
-p '$p'
-st $st
-dt $dt
-e $e
-c $c_cond.c_sel
#if $c_cond.c_sel == 'OPTICS'
    -s $c_cond.s
#end if
-n $n
#if $g
    -g '$g'
#end if
-o 'results'
#if 'log' in $out
    |& tee '$out_log'
#end if
        ]]></command>
    <inputs>
        <param argument="-d" type="data" format="tabular" label="Select DPSI file" help="Generated from SUPPA diffSplice operation."/>
        <param argument="-p" type="data" format="tabular" label="Select PSIVEC file" help="Generated from SUPPA diffSplice operation."/>
        <param argument="-g" type="text" value="" label="Specify ranges of column numbers that specify replicates per condition" help="Column numbers have to be continuous, with no overlapping or missing columns between them (e.g. 1-3,4-6)."/>
        <param argument="-st" type="float" min="0.0" max="1.0" value="0.0" label="Set p-value threshold to consider an event significant from the DPSI file"/>
        <!-- some PSI values are > 1.0, skipped attribute max -->
        <param argument="-dt" type="float" min="0.0" value="0.05" label="Set Lower-bound for the absolute delta PSI value to cluster" help=""/>
        <param argument="-e" type="float" min="0.0" max="1.0" value="0.05" label="Set maximum euclidean distance" help="To consider two events as members of the same cluster"/>
        <param argument="-n" type="integer" min="1" value="20" label="Set minimum number of events required per cluster"/>
        <conditional name="c_cond">
            <param name="c_sel" type="select" label="Select clustering method" help="(-c)">
                <option value="DBSCAN" selected="true">DBSCAN</option>
                <option value="OPTICS">OPTICS</option>
            </param>
            <when value="DBSCAN"/>
            <when value="OPTICS">
                <!-- some PSI values are > 1.0, skipped attribute max -->
                <param argument="-s" type="float" min="0.0" value="0.05" label="Set maximum distance in PSI space of an event to a cluster"/>
            </when>
        </conditional>
        <param name="out" type="select" multiple="true" optional="false" label="Select output file(s)" help="Only shown in history if selected here and generated by the specific run.">
            <option value="clustvec" selected="true">Results</option>
            <option value="log">Log</option>
        </param>
    </inputs>
    <outputs>
        <data name="out_clustvec" format="tabular" from_work_dir="results.clustvec" label="${tool.name} on ${on_string}: Clustvec">
            <filter>'clustvec' in out</filter>
        </data>
        <data name="out_log" format="txt" label="${tool.name} on ${on_string}: Log">
            <filter>'log' in out</filter>
        </data>
    </outputs> 
    <tests> 
        <!-- 
        Test dataset is to small and tests will fail with error codes.
        Working data files are available at https://github.com/comprna/SUPPA_supplementary_data/ .               
        -->

        <!-- #1 default -->
        <test expect_num_outputs="1" expect_exit_code="1" expect_failure="true">
            <param name="d" value="sample.dpsi"/>
            <param name="p" value="sample.psivec"/>
            <param name="g" value="1-3,4-6"/>
        </test>
        <!-- #2 default -->
        <test expect_num_outputs="2" expect_exit_code="0" expect_failure="true">
            <param name="d" value="sample.dpsi"/>
            <param name="p" value="sample.psivec"/>
            <param name="g" value="1-3,4-6"/>
            <param name="st" value="0.1"/>
            <param name="dt" value="0.06"/>
            <param name="e" value="0.06"/>
            <param name="n" value="21"/>
            <conditional name="c_cond">
                <param name="c_sel" value="OPTICS"/>
                <param name="s" value="0.06"/>
            </conditional>
            <param name="out" value="clustvec,log"/>
        </test>
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

@WID@

Using the relative abundances (PSI values) of (transcript or local) events in all samples, and the information of which events change significantly in at least one comparison, SUPPA calculates clusters of events using a density-based clustering. Density-based clustering has various advantages over other methods: it does not require to choose the number of clusters, as this is driven by the data; and it cluster together events that even though they might not have similar PSI values, they behave similarly across conditions as long as there are sufficient events between them. 

**Input**

@DPSI@
@PSIVEC@

**Output**

@CLUSTVEC@

.. class:: infomark

**References**

@REFEENCES@
    ]]></help>
    <expand macro="citations"/>
</tool>
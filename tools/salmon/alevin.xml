<tool id="alevin" name="alevin" version="@VERSION@">
    <description>Quantification and analysis of 3â€™ tagged-end single-cell sequencing data</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        @indexing@
        @alevinrun@
        ]]>
    </command>
    <inputs>
        <expand macro="index"/>
        <expand macro="alevin"/>
    </inputs>
    <outputs>
        <data name="quants_mat.gz" label="quants_mat.gz" format="mtx" from_work_dir="output/alevin/quants_mat.gz">
            <filter>optional["dumpMtx"] != "Yes"</filter>
        </data>
        <data name="quants_mat.mtx.gz" label="quants_mat.mtx.gz" format="mtx" from_work_dir="output/alevin/quants_mat.mtx.gz">
            <filter>optional["dumpMtx"]</filter>
        </data>
        <data name="quants_mat_cols.txt" label="quants_mat_cols.txt" format="txt" from_work_dir="output/alevin/quants_mat_cols.txt"/>
        <data name="quants_mat_rows.txt" label="quants_mat_rows.txt" format="txt" from_work_dir="output/alevin/quants_mat_rows.txt"/>
        <data name="quants_tier_mat.gz" label="quants_tier_mat.gz" format="mtx" from_work_dir="output/alevin/quants_tier_mat.gz"/>
        <data name="alevin.log" label="alevin.log" format="txt" from_work_dir="output/alevin/alevin.log"/>
        <data name="featureDump.txt" label="featureDump.txt" format="txt" from_work_dir="output/alevin/featureDump.txt"/>
        <data name="whitelist.txt" label="whitelist.txt" format="txt" from_work_dir="output/alevin/whitelist.txt"/>
        <data name="bfh.txt" label="bfh.txt" format="txt" from_work_dir="output/alevin/bfh.txt">
            <filter>optional["dumpBfh"] == "Yes"</filter>
        </data>
        <data name="quants_mean_mat.gz" label="quants_mean_mat.gz" format="mtx" from_work_dir="output/alevin/quants_mean_mat.gz">
            <filter>optional["numCellBootstraps"]</filter>
        </data>
        <data name="quants_var_mat.gz" label="quants_var_mat.gz" format="mtx" from_work_dir="output/alevin/quants_var_mat.gz">
            <filter>optional["numCellBootstraps"]</filter>
        </data>
        <data name="quants_boot_rows.txt" label="quants_boot_rows.txt" format="txt" from_work_dir="output/alevin/quants_boot_rows.txt">
            <filter>optional["numCellBootstraps"]</filter>
        </data>
        <collection name="aux_info" type="list" label="Aux_info from alevin on ${on_string}">
            <data name="alevinmeta_info.json" format="json" from_work_dir="output/aux_info/alevin_meta_info.json"/>
            <data name="ambig_info.tsv" format="tsv" from_work_dir="output/aux_info/ambig_info.tsv"/>
            <data name="meta_info.json" format="json" from_work_dir="output/aux_info/meta_info.json"/>
            <data name="expected_bias.gz" format="txt" from_work_dir="output/aux_info/expected_bias.gz"/>
            <data name="fld.gz" format="txt" from_work_dir="output/aux_info/fld.gz"/>
            <data name="observed_bias.gz" format="txt" from_work_dir="output/aux_info/observed_bias.gz"/>
            <data name="observed_bias.gz_3p" format="txt" from_work_dir="output/aux_info/observed_bias_3p.gz"/>
            <data name="flenDist.txt" format="txt" from_work_dir="output/libParams/flenDist.txt"/>
            <data name="salmon_quant.log" format="txt" from_work_dir="output/logs/salmon_quant.log"/>
        </collection>
    </outputs>
    <tests>
        <test expect_num_outputs="18">
            <param name="fasta" value="minitranscript.fa"/>
            <!--<conditional name="preindexed">
                <param name="indexed" value="history"/>
                <param name="fasta" value="minitranscript.fa"/>
            </conditional>-->
            <conditional name="pairstraight">
                <param name="readselect" value="paired"/>
                <param name="file1" value="fastqs/moreminifastq1.fastq.gz"/>
                <param name="file2" value="fastqs/moreminifastq2.fastq.gz"/>
                <param name="orientation" value="I"/>
                <param name="strandedness" value="SR"/>
            </conditional>
            <param name="protocol" value="--chromium"/>
            <param name="tgmap" value="minitxp.tsv"/>
            <param name="optional.dumpMtx" value="Yes"/>
            <param name="dumpMtx" value="Yes"/>
            <output name="quants_mat.mtx.gz" file="alevin_mat.mtx.gz" ftype="mtx" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
        @salmonhelp@
        @alevinhelp@
    ]]></help>
    <expand macro="citations"/>
</tool>

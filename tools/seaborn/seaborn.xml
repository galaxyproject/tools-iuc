<tool id="seaborn" name="seaborn" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="20.01" license="MIT">
    <description>generate various plots using seaborn</description>

    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="edam"/>
    <expand macro="requirements"/>
    <expand macro="creator" />

    <command detect_errors="exit_code"><![CDATA[
        python3 "${run_script}"
    ]]></command>

    <configfiles>
        <configfile name="run_script"><![CDATA[

@INIT@

plot = $plot

fig = plot(
    data,
    #if $x
    x = data.columns.values[$x - 1],
    #end if
    #if $y
    y = data.columns.values[$y - 1],
    #end if
    #if $hue
    hue = data.columns.values[$hue - 1],
    #end if
    #if $legend
    legend = $legend,
    #end if
    #if $kind
    kind = '$kind'
    #end if
)

#if $legend_pos
plt.legend(loc='$legend_pos')
#end if

plt.savefig(f"{output_file}", format=output_format, dpi=300)
        ]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="inputs"/>
        <expand macro="transformation"/>

        <param name="plot" type="select" label="Plot to choose from seaborn" help="Select the type of plot you want to generate using seaborn. Each option corresponds to a specific seaborn plotting function.">
            <option value="sns.scatterplot">scatterplot</option>
            <option value="sns.displot">displot</option>
            <option value="sns.jointplot">jointplot</option>
            <option value="sns.barplot">barplot</option>
            <option value="sns.boxplot">boxplot</option>
            <option value="sns.violinplot">violinplot</option>
            <option value="sns.lmplot">lmplot</option>
        </param>

        <conditional name="header">
            <param name="has_header" type="boolean" label="Does your table have a header?" truevalue="yes" falsevalue="no" checked="true" help="Specify whether the input data contains a header row. If yes, column names will be used for selection." refresh_on_change="true">
                <option value="yes" selected="true">yes</option>
                <option value="no">no</option>
            </param>
            <when value="yes">
                <param name="x" type="data_column" data_ref="input_data" label="x-axis column" optional="true" use_header_names="true" help="Select the column from the input data to use for the x-axis of the plot."/>
                <param name="y" type="data_column" data_ref="input_data" label="y-axis column" optional="true" use_header_names="true" help="Select the column from the input data to use for the y-axis of the plot."/>
                <param name="hue" type="data_column" data_ref="input_data" label="column to use as hue" optional="true" use_header_names="true" help="Select a column to group data by color (hue) in the plot. This is useful for visualizing categorical data."/>
            </when>
            <when value="no">
                <param name="x" type="data_column" data_ref="input_data" label="x-axis column" optional="true" help="Select the column from the input data to use for the x-axis of the plot."/>
                <param name="y" type="data_column" data_ref="input_data" label="y-axis column" optional="true" help="Select the column from the input data to use for the y-axis of the plot."/>
                <param name="hue" type="data_column" data_ref="input_data" label="column to use as hue" optional="true" help="Select a column to group data by color (hue) in the plot. This is useful for visualizing categorical data."/>
            </when>
        </conditional>

        <section name="advanced" title="Advanced Options">
            <param name="kind" type="select" label="Kind specification" optional="true" help="Specify the kind of plot to generate for multi-plot functions like `sns.relplot` or `sns.catplot`.">
                <option value="hist">Histogram</option>
                <option value="kde">Kernel Density Estimate</option>
                <option value="reg">Regression</option>
                <option value="scatter">Scatter</option>
                <option value="hex">Hexbin</option>
                <option value="resid">Residual</option>
                <option value="ecdf">Empirical Cumulative Distribution Function</option>
            </param>
            <param name="legend" type="select" label="Legend" help="Specify the type of legend to display on the plot. Options include 'auto', 'brief', 'full', or None to disable the legend." optional="true">
                <option value="'auto'">auto</option>
                <option value="'brief'">brief</option>
                <option value="'full'">full</option>
                <option value="False">None</option>
                <sanitizer invalid_char="">
                    <valid initial="string.ascii_letters">
                        <add value="'" />
                    </valid>
                </sanitizer>
            </param>
            <param name="legend_pos" type="select" optional="true" label="Legend position" help="Choose the position of the legend on the plot. Options include various corners and sides of the plot.">
                <option value="center right">center right</option>
                <option value="center left">center left</option>
                <option value="upper right">upper right</option>
                <option value="upper left">upper left</option>
                <option value="lower right">lower right</option>
                <option value="lower left">lower left</option>
            </param>
        </section>
    </inputs>
    <outputs>
        <data name="output_file" format="png" label="${tool.name} ${plot} of ${on_string}" />
    </outputs>
    <tests>
        <!-- Hint: You can use [ctrl+alt+t] after defining the inputs/outputs to auto-scaffold some basic test cases. -->
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

This tool allows you to generate a variety of plots using the Seaborn library, a Python data visualization library based on Matplotlib. It supports multiple plot types, including scatter plots, bar plots, box plots, and more. The tool is designed to work with tabular data in formats such as TSV, CSV, TXT, or Parquet.

Seaborn provides a high-level interface for drawing attractive and informative statistical graphics. This tool integrates Seaborn's functionality into Galaxy, enabling users to create publication-quality plots without requiring programming knowledge.

**Usage**

1. **Input**: Provide a tabular data file in one of the supported formats (TSV, CSV, TXT, or Parquet). Optionally, specify whether the first column should be treated as the index.
2. **Plot Type**: Choose the type of plot you want to generate (e.g., scatterplot, barplot, boxplot).
3. **Advanced Options**: Customize the plot further by specifying parameters such as legend type, legend position, and data transformations.
4. **Output**: The tool generates a PNG image of the plot, which can be downloaded or used in further analyses.

**Example Input**

Here is an example of a simple input dataset:

+------------+------------+------------+
| Category   | Value1     | Value2     |
+============+============+============+
| A          | 10         | 20         |
+------------+------------+------------+
| B          | 15         | 25         |
+------------+------------+------------+
| C          | 20         | 30         |
+------------+------------+------------+

**Example Output**

If you select a scatterplot with `Value1` on the x-axis and `Value2` on the y-axis, the tool will generate a scatterplot visualizing the relationship between these two variables.

**Parameters**

- **Input Data Table**: Upload your data file in TSV, CSV, TXT, or Parquet format.
- **Plot Type**: Select the type of plot to generate (e.g., scatterplot, barplot, etc.).
- **Legend**: Specify the type of legend to display (e.g., auto, brief, full, or None).
- **Legend Position**: Choose the position of the legend on the plot (e.g., upper right, lower left, etc.).
- **Data Transformation**: Apply transformations such as log10 or log2 to numerical data.

**Links**

- For more information about Seaborn, visit the official documentation: https://seaborn.pydata.org/
- For detailed parameter descriptions, refer to the Galaxy tool documentation.

**Output**

The tool generates a PNG file containing the plot. The file can be downloaded or used as input for other tools in Galaxy.

    ]]></help>
    <expand macro="citation"/>
</tool>
<macros>
    <token name="@TOOL_VERSION@">0.13.2</token>
    <token name="@VERSION_SUFFIX@">0</token>

    <xml name="edam">
        <edam_topics>
            <edam_topic>topic_0092</edam_topic>
        </edam_topics>
        <edam_operations>
            <edam_operation>operation_0337</edam_operation>
        </edam_operations>
    </xml>

    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">seaborn</requirement>
            <yield/>
        </requirements>
    </xml>

    <xml name="inputs">
        <param argument="--input_data" type="data" format="tsv,txt,csv,parquet" label="Input data table" help="Input data file" />
        <param argument="index_col" type="boolean" truevalue="0" falsevalue="None" checked="false" label="Is the first column the index?" help="TODO" />
    </xml>

    <xml name="transformation">
        <param name="transformation" type="select" label="Transformation" help="Transformation function to apply to the data">
            <option value="lambda x: x" selected="true">None</option>
            <option value="np.log10">np.log10</option>
            <option value="np.log2">np.log2</option>
        </param>
    </xml>

    <token name="@INIT@">
import pandas as pd
import seaborn as sns
import numpy as np
import matplotlib.pyplot as plt

file_name = "$input_data"
file_extension = "$input_data.ext"

index_col = $index_col
transformation = $transformation
output_format = "png"
output_file = "${output_file}"

# load and transform data
if file_extension == "csv":
    df = pd.read_csv(file_name, index_col=index_col)
elif file_extension in ["tsv", "tabular"]:
    df = pd.read_csv(file_name, sep="\t", index_col=index_col)
elif file_extension == "parquet":
    df = pd.read_parquet(file_name, index_col=index_col)
else:
    raise ValueError(f"Unsupported file format: {file_extension}")
data = df.apply(lambda x: transformation(x) if np.issubdtype(x.dtype, np.number) else x)
    </token>

    <xml name="creator">
        <creator>
            <person
                givenName="Helge"
                familyName="Hecht"
                url="https://github.com/hechth"
                identifier="0000-0001-6744-996X" />
            <organization
                url="https://www.recetox.muni.cz/"
                email="GalaxyToolsDevelopmentandDeployment@space.muni.cz"
                name="RECETOX MUNI" />
        </creator>
    </xml>

    <xml name="citation">
        <citations>
            <citation type="doi">10.21105/joss.03021</citation>
        </citations>
    </xml>
</macros>
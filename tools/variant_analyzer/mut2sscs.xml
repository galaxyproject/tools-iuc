<?xml version="1.0" encoding="UTF-8"?>
<tool id="mut2sscs" name="DCS mutations to SSCS stats:" version="1.0.0" profile="19.01">
    <description>Extracts all tags from the single stranded consensus sequence (SSCS) bam file that carry a mutation at the same position a mutation is called in the duplex consensus sequence (DCS) and calculates their frequencies</description>
    <macros>
        <import>va_macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="2.7">python</requirement>
        <requirement type="package" version="1.4.0">matplotlib</requirement>
        <requirement type="package" version="0.15">pysam</requirement>
    </requirements>
    <command><![CDATA[
        ln -s '$file2' bam_input.bam &&
        ln -s '${file2.metadata.bam_index}' bam_input.bam.bai &&
        python '$__tool_directory__/mut2sscs.py' 
        --mutFile '$file1'
        --bamFile bam_input.bam
        --outputJson '$output_json'
    ]]>
    </command>
    <inputs>
        <param name="file1" type="data" format="tabular" label="DCS Mutation File" optional="false" help="TABULAR file with DCS mutations. See Help section below for a detailed explanation."/>
        <param name="file2" type="data" format="bam" label="SSCS BAM File" optional="false" help="BAM file with aligned SSCS reads."/>
    </inputs>
    <outputs>
        <data name="output_json" format="json" label="${tool.name} on ${on_string}: JSON"/>
    </outputs>
    <tests>
        <test>
            <param name="file1" value="DCS_Mutations_test_data_VA.tabular"/>
            <param name="file2" value="SSCS_test_data_VA.bam"/>
            <output name="output_json" file="SSCS_counts_test_data_VA.json" lines_diff="2"/>
        </test>
    </tests>
    <help> <![CDATA[
**What it does**

Takes a tabular file with DCS mutations and a BAM file of aligned SSCS reads 
as input and writes statistics about tags of reads that carry a mutation in the 
SSCS at the same position a mutation is called in the DCS to a user specified output file..

**Input** 

**Dataset 1:** Tabular file with duplex consesus sequence (DCS) mutations as 
generated by the **Variant Annotator** tool.

**Dataset 2:** BAM file of aligned single stranded consensus sequence (SSCS) 
reads. This file can be obtained by the tool `Map with BWA-MEM 
<https://arxiv.org/abs/1303.3997>`_.

**Dataset 3:** Tabular file with reads as produced by the 
**Du Novo: Align families** tool of the `Du Novo Analysis Pipeline 
<https://doi.org/10.1186/s13059-016-1039-4>`_

**Output**

The output is a json file containing dictonaries with stats of tags that carry a mutation in the SSCS 
at the same position a mutation is called in the DCS.

    ]]> 
    </help>
    <expand macro="citation" />
</tool>

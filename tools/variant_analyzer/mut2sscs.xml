<?xml version="1.0" encoding="UTF-8"?>
<tool id="mut2sscs" name="DCS mutations to SSCS stats:" version="2.0.0" profile="19.01">
    <description>Extracts all tags from the single stranded consensus sequence (SSCS) bam file that carry a mutation at the same position a mutation is called in the duplex consensus sequence (DCS) and calculates their frequencies</description>
    <macros>
        <import>va_macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command><![CDATA[
        ln -s '$file2' bam_input.bam &&
        ln -s '${file2.metadata.bam_index}' bam_input.bam.bai &&
        python '$__tool_directory__/mut2sscs.py' 
        --mutFile '$file1'
        --bamFile bam_input.bam
        --outputJson '$output_json'
    ]]>
    </command>
    <inputs>
        <param name="file1" type="data" format="vcf" label="DCS Mutation File" optional="false" help="VCF file with DCS mutations. See Help section below for a detailed explanation."/>
        <param name="file2" type="data" format="bam" label="SSCS BAM File" optional="false" help="BAM file with aligned SSCS reads."/>
    </inputs>
    <outputs>
        <data name="output_json" format="json" label="${tool.name} on ${on_string}: JSON"/>
    </outputs>
    <tests>
        <test>
            <param name="file1" value="FreeBayes_test.vcf"/>
            <param name="file2" value="SSCS_test.bam"/>
            <output name="output_json" file="SSCS_counts_test.json" lines_diff="2"/>
        </test>
    </tests>
    <help> <![CDATA[
**What it does**

Takes a VCF file with DCS mutations and a BAM file of aligned SSCS reads 
as input and writes statistics about tags of reads that carry a mutation in the 
SSCS at the same position a mutation is called in the DCS to a user specified output file..

**Input** 

**Dataset 1:** VCF file with duplex consesus sequence (DCS) mutations. E.g. 
generated by the `FreeBayes variant caller <https://arxiv.org/abs/1207.3907>`_.

**Dataset 2:** BAM file of aligned single stranded consensus sequence (SSCS) 
reads. This file can be obtained by the tool `Map with BWA-MEM 
<https://arxiv.org/abs/1303.3997>`_.

**Output**

The output is a json file containing dictonaries with stats of tags that carry a mutation in the SSCS 
at the same position a mutation is called in the DCS.

    ]]> 
    </help>
    <expand macro="citation" />
</tool>

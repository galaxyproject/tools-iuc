<tool id="cialign" name="CIAlign" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" python_template_version="3.6" profile="21.05">
    <description>
        CIAlign a tool to clean, visualise and analyse a multiple sequence alignment
    </description>
    <!-- Import -->
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <version_command>cialign --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        CIAlign --infile $input
                --outfile_stem output

                ###### Basic Options
                #if $basic_options.inifile
                    --inifile '$basic_options.inifile'
                #end if
                $basic_options.all
                $basic_options.clean
                $basic_options.visualise
                $basic_options.interpret
                $basic_options.silent
                
                ###### Remove Divergent options
                #if str($remove_divergent_cond.remove_divergent_param) == "true": 
                    --remove_divergent
                    #if $remove_divergent_cond.remove_divergent_retain:
                        --remove_divergent_retain "$remove_divergent_cond.remove_divergent_retain"
                    #end if
                    #if $remove_divergent_cond.remove_divergent_retain_str:
                        --remove_divergent_retain_str "$remove_divergent_cond.remove_divergent_retain_str"
                    #end if
                    #if $remove_divergent_cond.remove_divergent_retain_list:
                        --remove_divergent_retain_list '$remove_divergent_cond.remove_divergent_retain_list'
                    #end if
                #end if

                ###### Remove Insertions options
                #if str($remove_insertions_cond.remove_insertions_param) == "true": 
                    --remove_insertions
                    --insertion_min_size $remove_insertions_cond.insertion_min_size
                    --insertion_max_size $remove_insertions_cond.insertion_max_size
                    --insertion_min_flank $remove_insertions_cond.insertion_min_flank
                    --insertion_min_perc $remove_insertions_cond.insertion_min_perc
                #end if

                ###### Crop Ends options
                #if str($crop_ends_cond.crop_ends_param) == "true":
                    --crop_ends
                    --crop_ends_mingap_perc $crop_ends_cond.crop_ends_mingap_perc
                    --crop_ends_redefine_perc $crop_ends_cond.crop_ends_redefine_perc
                    #if $crop_ends_cond.crop_ends_retain:
                        --crop_ends_retain "$crop_ends_cond.crop_ends_retain"
                    #end if
                    #if $crop_ends_cond.crop_ends_retain_str:
                        --crop_ends_retain_str "$crop_ends_cond.crop_ends_retain_str"
                    #end if
                    #if $crop_ends_cond.crop_ends_retain_list:
                        --crop_ends_retain_list '$crop_ends_cond.crop_ends_retain_list'
                    #end if
                #end if

                ###### Remove Short options
                #if str($remove_short_cond.remove_short_param) == "true":
                    --remove_short
                    --remove_min_length $remove_short_cond.remove_min_length
                    #if $remove_short_cond.remove_short_retain:
                        --remove_short_retain "$remove_short_cond.remove_short_retain"
                    #end if
                    #if $remove_short_cond.remove_short_retain_str:
                        --remove_short_retain "$remove_short_cond.remove_short_retain_str"
                    #end if
                    #if $remove_short_cond.remove_short_retain_list:
                        --remove_short_retain "$remove_short_cond.remove_short_retain_list"
                    #end if
                #end if

                #if $keep_gaponly
                    --keep_gaponly
                #end if

                ###### Crop Divergent options
                #if str($crop_divergent_cond.crop_divergent_param) == "true":
                    --crop_divergent
                    --crop_divergent_min_prop_ident $crop_divergent_cond.crop_divergent_min_prop_ident
                    --crop_divergent_min_prop_nongap $crop_divergent_cond.crop_divergent_min_prop_nongap
                    --crop_divergent_buffer_size $crop_divergent_cond.crop_divergent_buffer_size
                #end if
                
                ###### Retain options
                #if str($retain_cond.retain_param) == "true":
                    #if $retain_cond.retain:
                        --retain "$retain_cond.retain"
                    #end if
                    #if $retain_cond.retain_str:
                        --retain_str "$retain_cond.retain_str"
                    #end if
                    #if $retain_cond.retain_list:
                        --retain_list "$retain_cond.retain_list"
                    #end if
                #end if

                ###### Outputs (Visualisation Functions)
                $output.plot_input
                $output.plot_output
                $output.plot_markup
                $output.plot_consensus_identity
                $output.plot_consensus_similarity
                --plot_width $output.output_settings.plot_width
                --plot_height $output.output_settings.plot_height
                $output.output_settings.plot_keep_numbers
                $output.output_settings.plot_force_numbers
                --plot_identity_palette "$output.output_settings.plot_identity_palette"
                --plot_identity_gap_col "$output.output_settings.plot_identity_gap_col"
                --plot_similarity_palette "$output.output_settings.plot_similarity_palette"
                --plot_similarity_gap_col "$output.output_settings.plot_similarity_gap_col"
                --palette "$output.output_settings.palette"

                ###### Sequence logos Options
                #if str($sequence_logo_cond.sequence_logo_param) == "true":
                    --make_sequence_logo
                    --sequence_logo_type "$sequence_logo_cond.sequence_logo_type"
                    --sequence_logo_dpi $sequence_logo_cond.sequence_logo_dpi
                    --sequence_logo_font "$sequence_logo_cond.sequence_logo_font"
                    --sequence_logo_nt_per_row $sequence_logo_cond.sequence_logo_nt_per_row
                    #if $sequence_logo_cond.logo_start:
                        --logo_start $sequence_logo_cond.logo_start
                    #end if
                    #if $sequence_logo_cond.logo_end:
                        --logo_end $sequence_logo_cond.logo_end
                    #end if
                #end if

                ###### Outputs Statistics Plots
                $statistcs_plots.plot_stats_input
                $statistcs_plots.plot_stats_input
                --plot_stats_dpi $statistcs_plots.stats_settings.plot_stats_dpi
                --plot_stats_height $statistcs_plots.stats_settings.plot_stats_width
                --plot_stats_width $statistcs_plots.stats_settings.plot_stats_height
                --plot_stats_colour $statistcs_plots.stats_settings.plot_stats_colour

                ###### Interpretation Functions
                ### consensus sequences
                #if str($consensus_sequences_cond.consensus_sequences_param) == "true":
                    --make_consensus
                    --consensus_type "$consensus_sequences_cond.consensus_type"
                    $consensus_sequences_cond.consensus_keep_gaps
                #end if
                
                ### Position Matrices
                $position_matrices.pwm_input
                $position_matrices.pwm_output
                #if $position_matrices.matrices_settings.pwm_start:
                    --pwm_start $position_matrices.matrices_settings.pwm_start
                #end if
                #if $position_matrices.matrices_settings.pwm_end:
                    --pwm_end $position_matrices.matrices_settings.pwm_end
                #end if
                --pwm_freqtype "$position_matrices.matrices_settings.pwm_freqtype"
                --pwm_alphatype "$position_matrices.matrices_settings.pwm_alphatype"
                --pwm_alphaval $position_matrices.matrices_settings.pwm_alphaval
                $position_matrices.pwm_output_blamm
                $position_matrices.pwm_output_meme
                
                ### Similarity Matrices
                $similarity_matrices.make_similarity_matrix_input
                $similarity_matrices.make_similarity_matrix_output
                --make_simmatrix_keepgaps $similarity_matrices.similarity_matrices_settings.make_simmatrix_keepgaps
                --make_simmatrix_dp $similarity_matrices.similarity_matrices_settings.make_simmatrix_dp
                --make_simmatrix_minoverlap $similarity_matrices.similarity_matrices_settings.make_simmatrix_minoverlap

                ###### Editing Functions
                #if str($editing_functions.get_section_cond.get_section_param) == "true":
                    --get_section
                    --section_start $editing_functions.get_section_cond.section_start
                    --section_end $editing_functions.get_section_cond.section_end
                #end if
                $editing_functions.replace_input_tu
                $editing_functions.replace_input_ut
                $editing_functions.replace_output_tu
                $editing_functions.replace_output_ut
                ### Unaligning
                $editing_functions.unalign_input
                $editing_functions.unalign_output
                ### Removing Duplicates
                $editing_functions.deduplicate_ids
                --duporder $editing_functions.duporder
    ]]></command>
    <inputs>
        <param name="input" type="data" format="fasta"/>
        <param name="prefix" type="text" value="CIAlign" label="output data prefix:"/>
        <!-- BASIC options -->
        <section name="basic_options" title="Basic Options" expanded="true">
            <param argument="--inifile" type="data" format="ini" optional="true" label="Config File" help="Upload a configuration file containing all required settings and parameters." />
            <param argument="--all" type="boolean" truevalue="--all" falsevalue="" checked="false" label="Use All Functions" help="Enable all available functions with default parameters unless overridden."/>
            <param argument="--clean" type="boolean" truevalue="--clean" falsevalue="" checked="false" label="Use Cleaning Functions" help="Enable all cleaning functions with default parameters unless specified."/>
            <param argument="--visualise" type="boolean" truevalue="--visualise" falsevalue="" checked="false" label="Plot Mini-Alignments" help="Generate plots for all mini-alignments using default parameters."/>
            <param argument="--interpret" type="boolean" truevalue="--interpret" falsevalue="" checked="false" label="Use Interpretation Functions" help="Enable all interpretation functions with default parameters unless specified."/>
            <param argument="--silent" type="boolean" truevalue="--silent" falsevalue="" checked="false" label="Silent Mode" help="Suppress screen output and progress messages."/>
        </section>
        <!-- Remove divergent options -->
        <conditional name="remove_divergent_cond">
            <param name="remove_divergent_param" type="select" label="Remove Sequences Below Proportion" help="Remove sequences with identity below a specified proportion of conserved positions.">
                <option value="true" >yes</option>
                <option value="false" selected="true">option is not used</option>
            </param>            
            <when value="true">
                <!-- Remove divergent sub parameters -->
                <param argument="--remove_divergent_minperc" type="float" value="0.65" min="0" max="1" label="Minimum Identity Proportion" help="Minimum proportion of positions that must match the most common base or amino acid for a sequence to be kept."/>
                <param argument="--remove_divergent_retain" type="text" value="" label="Retain Sequence by Name" help="Always keep the sequence with this exact name, even if it doesnâ€™t meet the minimum identity threshold."/>
                <param argument="--remove_divergent_retain_str" type="text" value="" label="Retain Sequences Containing Text" help="Always keep sequences whose names contain this text."/>            
                <param argument="--remove_divergent_retain_list" type="file" format="text" value="" optional="true" label="Retain Sequences from File" help=" Do not remove sequences whose names are listed in this file."/>            
            </when>
        </conditional>
        <!-- Remove Insertions options -->
        <conditional name="remove_insertions_cond">
            <param name="remove_insertions_param" type="select" label="Remove Rare Insertions" help="Remove insertions not present in the majority of sequences.">
                <option value="true" >yes</option>
                <option value="false" selected="true">option is not used</option>
            </param>            
            <when value="true">
                <!-- Remove insertions sub parameters -->
                <param argument="--insertion_min_size" type="integer" value="3" min="1" label="Minimum Insertion Size" help="Only remove insertions larger than this number of residues. Must be less than or equal to the number of columns in your alignment."/>
                <param argument="--insertion_max_size" type="integer" value="200" min="1" max="10000" label="Maximum Insertion Size" help="Only remove insertions smaller than this number of residues."/>
                <param argument="--insertion_min_flank" type="integer" value="5" min="0"  label="Minimum Flank Size" help="Minimum number of bases required on each side of an insertion. Must be less than half the alignment length."/>            
                <param argument="--insertion_min_perc" type="float" value="0.5" min="0" max="1" label="Minimum Presence Proportion" help="Remove insertions found in less than this proportion of sequences."/>            
            </when>
        </conditional>
        <!-- Crop Ends options -->
        <conditional name="crop_ends_cond">
            <param name="crop_ends_param" type="select" label="Crop Sequence Ends" help="Trim ends of sequences if they are poorly aligned.">
                <option value="true" >yes</option>
                <option value="false" selected="true">option is not used</option>
            </param>            
            <when value="true">
                <!-- Crop Ends sub parameters -->
                <param argument="--crop_ends_mingap_perc" type="float" value="0.05" min="0" max="0.6" label="Minimum Gap Change Threshold" help="Minimum proportion of sequence length (excluding gaps) used to detect significant change in gap numbers."/>            
                <param argument="--crop_ends_redefine_perc" type="float" value="0.1" min="0" max="0.5" label="Region Proportion to Check" help="Proportion of the sequence (excluding gaps) checked at each end to redefine cropping boundaries."/>            
                <param argument="--crop_ends_retain" type="text" value="" label="Retain Sequence by Name" help="Do not crop the sequence with this exact name. Can be used multiple times."/>
                <param argument="--crop_ends_retain_str" type="text" value="" label="Retain Sequences Containing Text" help="Do not crop sequences whose names contain this text. Case-sensitive."/>            
                <param argument="--crop_ends_retain_list" type="file" format="text" value="" optional="true" label="Retain Sequences from File" help="Do not crop sequences listed in this file. Names must exactly match those in the input FASTA file."/>
            </when>
        </conditional>
        <!-- Remove Short options -->
        <conditional name="remove_short_cond">
            <param name="remove_short_param" type="select" label="Remove Short Sequences" help="Remove sequences shorter than a specified length (excluding gaps).">
                <option value="true" >yes</option>
                <option value="false" selected="true">option is not used</option>
            </param>            
            <when value="true">
                <!-- Remove Short sub parameters -->
                <param argument="--remove_min_length" type="integer" value="50" min="0" label="Minimum Sequence Length" help="Remove sequences shorter than this length, excluding gaps."/>            
                <param argument="--remove_short_retain" type="text" value="" label=" Retain Sequence by Name" help="Do not remove the sequence with this exact name. Can be used multiple times."/>
                <param argument="--remove_short_retain_str" type="text" value="" label="Retain Sequences Containing Text" help="Do not remove sequences whose names contain this text. Case-sensitive."/>            
                <param argument="--remove_short_retain_list" type="file" format="text" value="" optional="true" label="Retain Sequences from File" help="Do not remove sequences listed in this file. Names must exactly match those in the input FASTA file."/>
            </when>
        </conditional>
        <!-- Keep Gap Only -->
        <param argument="--keep_gaponly" type="boolean" truevalue="--keep_gaponly" falsevalue="" checked="false" label="Keep Gap-Only Columns" help=" Keep columns in the alignment that consist entirely of gaps."/>
        <!-- Crop Divergent options -->
        <conditional name="crop_divergent_cond">
            <param name="crop_divergent_param" type="select" label="Crop Divergent Sequences" help="Remove highly divergent regions to improve alignment quality by focusing on more conserved parts.">
                <option value="true" >yes</option>
                <option value="false" selected="true">option is not used</option>
            </param>            
            <when value="true">
                <!-- Crop Divergent sub parameters -->
                <param argument="--crop_divergent_min_prop_ident" type="float" value="0.5" min="0.01" max="1" label="Minimum Identity Proportion" help="Minimum proportion of sequences that must share the same residue in a column."/>            
                <param argument="--crop_divergent_min_prop_nongap" type="float" value="0.5" min="0.01" max="1" label="Minimum Non-Gap Proportion" help="Minimum proportion of sequences that must contain a non-gap residue in a column."/>            
                <param argument="--crop_divergent_buffer_size" type="integer" value="5" min="1" label="Buffer Size" help="Number of consecutive columns that must meet the identity and non-gap criteria to retain a region."/>            
            </when>
        </conditional>
        <!-- Retain options -->
        <conditional name="retain_cond">
            <param name="retain_param" type="select" label="Retain Specific Sequences" help="Specify sequences that should not be edited or removed during row-wise functions.">
                <option value="true" >yes</option>
                <option value="false" selected="true">option is not used</option>
            </param>            
            <when value="true">
                <!-- Retain sub parameters -->
                <param argument="--retain" type="text" value="" label="Retain Sequence with This Name" help="Do not edit or remove the sequence with this exact name during row-wise functions. Can be used multiple times."/>
                <param argument="--retain_str" type="text" value="" label="Retain Sequences Containing This String" help="Do not edit or remove sequences with names containing this text. Case-sensitive."/>            
                <param argument="--retain_list" type="file" format="text" value="" optional="true" label="Retain Sequences from File" help="Do not edit or remove sequences listed in this file. Sequence names must exactly match the input."/>
            </when>
        </conditional>
        <!-- Visualisation options -->
        <section name="output" title="Visualisation Plots" expanded="false">
            <param argument="--plot_input" type="boolean" checked="false" falsevalue="" truevalue="--plot_input" label="plot input" help="visualisation of the input alignment"/>
            <param argument="--plot_output" type="boolean" checked="false" falsevalue="" truevalue="--plot_output" label="plot output" help="visualisation of the cleaned output alignment"/>
            <param argument="--plot_markup" type="boolean" checked="false" falsevalue="" truevalue="--plot_markup" label="plot markup" help="visualisation of the input alignment with deleted rows and columns marked"/>
            <param argument="--plot_consensus_identity" type="boolean" checked="false" falsevalue="" truevalue="--plot_consensus_identity" label="plot consensus identity" help="Plot a mini alignment showing positions which are identical to or differ from the consensus."/>
            <param argument="--plot_consensus_similarity" type="boolean" checked="false" falsevalue="" truevalue="--plot_consensus_similarity" label="plot consensus similarity" help="Plot a mini alignment showing positions based on their score when when compared via a substitution matrix to the consensus."/>        
            <section name="output_settings" title="Output Settings" expanded="false">
                <param argument="--plot_width" type="integer" value="5" label="plot width" help="Mini alignment width in inches."/>
                <param argument="--plot_height" type="integer" value="3" label="plot height" help="Mini alignment height in inches."/>
                <param argument="--plot_keep_numbers" type="boolean" checked="false" falsevalue="" truevalue="--plot_keep_numbers" label="plot keep numbers" help="If specified, for mini alignments based on CIAlign output with smaller than 10 sequences (or if force_numbers is switched on) the rows will be labelled based on the input alignment, rather than renumbered."/>
                <param argument="--plot_force_numbers" type="boolean" checked="false" falsevalue="" truevalue="--plot_force_numbers" label="plot force numbers" help="Force all rows to be numbered on the mini alignments rather than labelling e.g. every 10th row for larger plots. Will cause labels to overlap on large plots."/>
                <param argument="--plot_identity_palette" type="text" value="bone" label="plot identity palette" help="Matplotlib palette name for identity mini alignments."/>
                <param argument="--plot_identity_gap_col" type="text" value="white" label="plot identity gap col" help="Colour for gaps in identity mini alignments."/>
                <param argument="--plot_similarity_palette" type="text" value="bone" label="plot similarity palette" help="Matplotlib palette name for similarity mini alignments."/>
                <param argument="--plot_similarity_gap_col" type="text" value="white" label="plot similarity gap col" help="Colour for gaps in similarity mini alignments."/>
                <param argument="--palette" type="text" value="CBS" label="Colour palette" help="Colour palette. Currently implemented CBS (colour blind safe) or bright."/>
            </section>
        </section>
        <!-- Sequence Logos -->
        <conditional name="sequence_logo_cond">
            <param name="sequence_logo_param" type="select" label="make sequence logo?" help=" 	Draw a sequence logo.">
                <option value="true" >yes</option>
                <option value="false" selected="true">option is not used</option>
            </param>            
            <when value="true">
                <!-- sequence_logo sub parameters -->
                <param argument="--sequence_logo_type" type="select" label="Type of sequence logo:" help="Type of sequence logo - bar/text/both">
                    <option value="bar">bar</option>
                    <option value="text" selected="true">text</option>
                    <option value="both">both</option>
                </param> 
                <param argument="--sequence_logo_dpi" type="integer" value="300" label="Resolution (DPI)" help="DPI (dots per inch) for sequence logo. "/>
                <param argument="--sequence_logo_font" type="text" value="monospace" label="Logo Font:" help="Font for bases / amino acids in a text based sequence logo"/>
                <param argument="--sequence_logo_nt_per_row" type="integer" value="50" label="Number of Bases/amino acids per row:" help="Number of bases / amino acids to show per row in the sequence logo, where the logo is too large to show on a single line"/>
                <param argument="--logo_start" type="integer" optional="true" label="Logo Start" help="Start sequence logo"/>
                <param argument="--logo_end" type="integer" optional="true" label="Logo End" help="End sequence logo"/>
            </when>
        </conditional>
        <!-- Statistics Plots -->
        <section name="statistcs_plots" title="Statistics Plots" expanded="false">
            <param argument="--plot_stats_input" type="boolean" checked="false" falsevalue="" truevalue="--plot_stats_input" label="plot stats input" help="Plot the statistics for the input MSA"/>        
            <param argument="--plot_stats_output" type="boolean" checked="false" falsevalue="" truevalue="--plot_stats_output" label="plot stats input" help="Plot the statistics for the output MSA"/>        
            <section name="stats_settings" title="Statistics Plots Settings" expanded="false">
                <param argument="--plot_stats_dpi" type="integer" value="300" label="DPI" help="DPI for coverage plot"/>
                <param argument="--plot_stats_width" type="integer" value="5" label="plot width" help="Width for coverage plot (inches)"/>
                <param argument="--plot_stats_height" type="integer" value="3" label="plot height" help="Height for coverage plot (inches)"/>
                <param argument="--plot_stats_colour" type="text" value="blue" label="Colour" help="Colour for coverage plot (hex code or name)"/>
            </section>
        </section>
        <!-- Consensus Sequences -->
        <conditional name="consensus_sequences_cond">
            <param name="consensus_sequences_param" type="select" label="create consensus sequences?" help="This generates a consensus sequence based on the cleaned alignment.">
                <option value="true" >yes</option>
                <option value="false" selected="true">option is not used</option>
            </param>            
            <when value="true">
                <!-- consensus_sequences -->
                <param argument="--consensus_type" type="select" label="type of consensus sequence:" help="can be majority, to use the most common character at each position in the consensus, even if this is a gap, or majority_nongap, to use the most common non-gap character at each position">
                    <option value="majority" selected="true">majority</option>
                    <option value="majority_nongap">majority_nongap</option>
                </param> 
                <param argument="--consensus_keep_gaps" type="boolean" truevalue="--consensus_keep_gaps" falsevalue="" checked="false" label="with gaps?" help="should gaps be included in the consensus"/>            
            </when>
        </conditional>
        <!-- Position Matrices -->
        <section name="position_matrices" title="Position Matrices" expanded="false">
            <param argument="--pwm_input" type="boolean" checked="false" falsevalue="" truevalue="--pwm_input" label="generate input matrices" help="Generate a position frequency matrix, position probability matrix and position weight matrix based on the input alignment"/>        
            <param argument="--pwm_output" type="boolean" checked="false" falsevalue="" truevalue="--pwm_output" label="generate output matrices" help="Generate a position frequency matrix, position probability matrix and position weight matrix based on the cleaned output alignment"/>        
            <section name="matrices_settings" title="Position Matrices Settings" expanded="false">
                <param argument="--pwm_start" type="integer" optional="true" label="Start the PWM" help="Start the PWM and other matrices from this column of the input alignment"/>
                <param argument="--pwm_end" type="integer" optional="true" label="End the PWM" help="End the PWM and other matrices at this column of the input alignment"/>
                <param argument="--pwm_freqtype" type="select" label="Type of background frequency matrix:" help="Type of background frequency matrix to use when generating the PWM. Should be 'equal', 'calc', 'calc2' or 'user'. 'equal', assume all residues are equally common, 'calc', frequency is calculated using the PFM, 'calc2', frequency is calculated using the full alignment (same as calc if pwm_start and pwm_end are not specified).">
                    <option value="equal" selected="true">equal</option>
                    <option value="calc">calc</option>
                    <option value="calc2">calc2</option>
                </param> 
                <param argument="--pwm_alphatype" type="select" label="Alpha value:" help="If alphatype is 'calc', alpha is calculated as frequency(base), If alpha type is 'user' the user provides the value of alpha as pwm_alphatype. To run without pseudocounts set pwm_alphatype as user and pwm_alphaval as 0.">
                    <option value="user">user</option>
                    <option value="calc" selected="true">calc</option>
                </param>
                <param argument="--pwm_alphaval" type="integer" value="1" label="Alpha value" help="User defined value of the alpha parameter to use as a pseudocount in the PPM."/>
            </section>
            <param argument="--pwm_output_blamm" type="boolean" checked="false" falsevalue="" truevalue="--pwm_output_blamm" label="output for BLAM" help="Output PPM formatted for BLAMM software"/>        
            <param argument="--pwm_output_meme" type="boolean" checked="false" falsevalue="" truevalue="--pwm_output_meme" label="output for MEME" help="Output PPM formatted for MEME software"/>        
        </section>
        <!-- Similarity Matrices -->
        <section name="similarity_matrices" title="Similarity Matrices" expanded="false">
            <param argument="--make_similarity_matrix_input" type="boolean" checked="false" falsevalue="" truevalue="--make_similarity_matrix_input" label="input similarity matrix" help="Make a similarity matrix for the input alignment"/>        
            <param argument="--make_similarity_matrix_output" type="boolean" checked="false" falsevalue="" truevalue="--make_similarity_matrix_output" label="output similarity matrix" help="Make a similarity matrix for the output alignment"/>        
            <section name="similarity_matrices_settings" title="Similarity Matrices Settings" expanded="false">
                <param argument="--make_simmatrix_keepgaps" type="integer" value="0" label="keep gaps" help="0 - exclude positions which are gaps in either or both sequences from similarity calculations, 1 - exclude positions which are gaps in both sequences, 2 - include all positions"/>
                <param argument="--make_simmatrix_dp" type="integer" value="4" label="decimal places" help="Number of decimal places to display in the similarity matrix output file"/>
                <param argument="--make_simmatrix_minoverlap" type="integer" value="1" label="Minimum overlap:" help="Minimum overlap between two sequences to have non-zero similarity in the similarity matrix"/>
            </section>
        </section>
        <!-- Editing Functions -->
        <section name="editing_functions" title="Editing Functions" expanded="false">
            <!-- get section -->
            <conditional name="get_section_cond">
            <param name="get_section_param" type="select" label="Retrieve and process a section of the alignment?">
                <option value="true" >yes</option>
                <option value="false" selected="true">no</option>
            </param>            
            <when value="true">
                <param argument="--section_start" type="integer" label="section start: " help="Start position in the original alignment for the section to be extracted"/>        
                <param argument="--section_end" type="integer" label="section end: " help="End position in the original alignment for the section to be extracted"/>        
            </when>
        </conditional>
            <!-- replace bases-->
            <param argument="--replace_input_tu" type="boolean" checked="false" falsevalue="" truevalue="--replace_input_tu" label="replace input tu " help="Generates a copy of the input alignment with T's instead of U's"/>        
            <param argument="--replace_input_ut" type="boolean" checked="false" falsevalue="" truevalue="--replace_input_ut" label="replace input ut " help="Generates a copy of the input alignment with U's instead of T's"/>        
            <param argument="--replace_output_tu" type="boolean" checked="false" falsevalue="" truevalue="--replace_output_tu" label="replace output tu " help="Generates a copy of the output alignment with T's instead of U's"/>        
            <param argument="--replace_output_ut" type="boolean" checked="false" falsevalue="" truevalue="--replace_output_ut" label="replace output ut " help="Generates a copy of the output alignment with U's instead of T's"/>        
            <!-- Unaligning -->
            <param argument="--unalign_input" type="boolean" checked="false" falsevalue="" truevalue="--unalign_input" label=" input alignment with no gaps " help="Generates a copy of the input alignment with no gaps"/>        
            <param argument="--unalign_output" type="boolean" checked="false" falsevalue="" truevalue="--unalign_output" label=" out alignment with no gaps " help="Generates a copy of the output alignment with no gaps"/>        
            <param argument="--deduplicate_ids" type="boolean" checked="false" falsevalue="" truevalue="--deduplicate_ids" label="remove duplicates" help="Remove sequences with duplicate names from the input."/>        
            <param argument="--duporder" type="select" label="Duplicates order:" help="Set to first to keep the first instance of the sequence name and last to keep the last">
                    <option value="first" selected="true">first</option>
                    <option value="last">last</option>
            </param>
        </section>
    </inputs>
    <!-- TOOL Outputs-->
    <outputs>
        <data name="cleaned" format="fasta" from_work_dir="output_cleaned.fasta" label="${prefix}: Cleaned Alignment"/>
        <data name="removed" format="txt" from_work_dir="output_removed.txt" label="${prefix}: Removed Sequences"/>
        <data name="log" format="txt" from_work_dir="output_log.txt" label="${prefix}: Log File"/>
        <data name="plot_input" format="png" from_work_dir="output_input.png" label="${prefix}: Input Plot">
            <filter>output['plot_input'] or basic_options['visualise']</filter>
        </data>
        <data name="plot_output" format="png" from_work_dir="output_output.png" label="${prefix}: Output Plot">
            <filter>output['plot_output'] or basic_options['visualise']</filter>
        </data>
        <data name="plot_markup" format="png" from_work_dir="output_markup.png" label="${prefix}: Markup Plot">
            <filter>output['plot_markup'] or basic_options['visualise']</filter>
        </data>
        <data name="plot_consensus_identity" format="png" from_work_dir="output_plot_consensus_identity.png" label="${prefix}: Consensus Identity Plot">
            <filter>output['plot_consensus_identity'] or basic_options['visualise']</filter>
        </data>
        <data name="plot_consensus_similarity" format="png" from_work_dir="output_plot_consensus_similarity.png" label="${prefix}: Consensus Similarity Plot">
            <filter>output['plot_consensus_similarity'] or basic_options['visualise']</filter>
        </data>
        <data name="logo_bar" format="png" from_work_dir="output_logo_bar.png" label="${prefix}: Logo Bar Chart">
            <filter>sequence_logo_cond['sequence_logo_param'] == 'true' and (sequence_logo_cond['sequence_logo_type'] == 'bar' or sequence_logo_cond['sequence_logo_type'] == 'both')</filter>
        </data>
        <data name="logo_text" format="png" from_work_dir="output_logo_text.png" label="${prefix}: Logo Text Chart">
            <filter>sequence_logo_cond['sequence_logo_param'] == 'true' and (sequence_logo_cond['sequence_logo_type'] == 'text' or sequence_logo_cond['sequence_logo_type'] == 'both')</filter>
        </data>
        <!-- Statistics Plots-->
        <data name="input_coverage" format="png" from_work_dir="output_input_coverage.png" label="${prefix}: Input Coverage">
            <filter>statistcs_plots['plot_stats_input']</filter>
        </data>
        <data name="input_information_content" format="png" from_work_dir="output_input_information_content.png" label="${prefix}: Input Info Content">
            <filter>statistcs_plots['plot_stats_input']</filter>
        </data>
        <data name="input_shannon_entropy" format="png" from_work_dir="output_input_shannon_entropy.png" label="${prefix}: Input Entropy">
            <filter>statistcs_plots['plot_stats_input']</filter>
        </data>
        <data name="input_resfreq" format="png" from_work_dir="output_input_resfreq.png" label="${prefix}: Input ResFreq">
            <filter>statistcs_plots['plot_stats_input']</filter>
        </data>
        <data name="input_changefreq" format="png" from_work_dir="output_input_changefreq.png" label="${prefix}: Input ChangeFreq">
            <filter>statistcs_plots['plot_stats_input']</filter>
        </data>
        <data name="output_coverage" format="png" from_work_dir="output_output_coverage.png" label="${prefix}: Output Coverage">
            <filter>statistcs_plots['plot_stats_output']</filter>
        </data>
        <data name="output_information_content" format="png" from_work_dir="output_output_information_content.png" label="${prefix}: Output Info Content">
            <filter>statistcs_plots['plot_stats_output']</filter>
        </data>
        <data name="output_shannon_entropy" format="png" from_work_dir="output_output_shannon_entropy.png" label="${prefix}: Output Entropy">
            <filter>statistcs_plots['plot_stats_output']</filter>
        </data>
        <data name="output_resfreq" format="png" from_work_dir="output_output_resfreq.png" label="${prefix}: Output ResFreq">
            <filter>statistcs_plots['plot_stats_output']</filter>
        </data>
        <data name="output_changefreq" format="png" from_work_dir="output_output_changefreq.png" label="${prefix}: Output ChangeFreq">
            <filter>statistcs_plots['plot_stats_output']</filter>
        </data>
        <!-- consensus -->
        <data name="output_consensus" format="fasta" from_work_dir="output_consensus.fasta" label="${prefix}: Consensus Sequence">
            <filter>consensus_sequences_cond['consensus_sequences_param'] == 'true'</filter>
        </data>
        <data name="output_with_consensus" format="fasta" from_work_dir="output_with_consensus.fasta" label="${prefix}: Cleaned + Consensus">
            <filter>consensus_sequences_cond['consensus_sequences_param'] == 'true'</filter>
        </data>
        <!-- Matrices -->
        <data name="pwm_input" format="txt" from_work_dir="output_pwm_input.txt" label="${prefix}: PWM Input">
            <filter>position_matrices['pwm_input']</filter>
        </data>
        <data name="ppm_input" format="txt" from_work_dir="output_ppm_input.txt" label="${prefix}: PPM Input">
            <filter>position_matrices['pwm_input']</filter>
        </data>
        <data name="pfm_input" format="txt" from_work_dir="output_pfm_input.txt" label="${prefix}: PFM Input">
            <filter>position_matrices['pwm_input']</filter>
        </data>
        <data name="ppm_meme_input" format="txt" from_work_dir="output_ppm_meme.txt" label="${prefix}: PPM for MEME (Input)">
            <filter>position_matrices['pwm_input']</filter>
        </data>
        <data name="blamm_input" format="png" from_work_dir="output_blamm_input.png" label="${prefix}: PPM for BLAMM (Input)">
            <filter>position_matrices['pwm_input']</filter>
        </data>
        <data name="pwm_output" format="txt" from_work_dir="output_pwm_output.txt" label="${prefix}: PWM Output">
            <filter>position_matrices['pwm_output']</filter>
        </data>
        <data name="ppm_output" format="txt" from_work_dir="output_ppm_output.txt" label="${prefix}: PPM Output">
            <filter>position_matrices['pwm_output']</filter>
        </data>
        <data name="pfm_output" format="txt" from_work_dir="output_pfm_output.txt" label="${prefix}: PFM Output">
            <filter>position_matrices['pwm_output']</filter>
        </data>
        <data name="ppm_meme_output" format="txt" from_work_dir="output_ppm_meme.txt" label="${prefix}: PPM for MEME (Output)">
            <filter>position_matrices['pwm_output']</filter>
        </data>
        <data name="blamm_output" format="png" from_work_dir="output_blamm_output.png" label="${prefix}: PPM for BLAMM (Output)">
            <filter>position_matrices['pwm_output']</filter>
        </data>
        <!-- Similarity Matrix -->
        <data name="input_similarity" format="tsv" from_work_dir="output_input_similarity.tsv" label="${prefix}: Input Similarity">
            <filter>similarity_matrices['make_similarity_matrix_input']</filter>
        </data>
        <data name="output_similarity" format="tsv" from_work_dir="output_input_similarity.tsv" label="${prefix}: Output Similarity">
            <filter>similarity_matrices['make_similarity_matrix_output']</filter>
        </data>
        <!-- Replaced bases alignments-->
        <data name="T_input" format="fasta" from_work_dir="output_T_input.fasta" label="${prefix}: Input: T instead of U">
            <filter>editing_functions['replace_input_tu']</filter>
        </data>
        <data name="U_input" format="fasta" from_work_dir="output_U_input.fasta" label="${prefix}: Input: U instead of T">
            <filter>editing_functions['replace_input_ut']</filter>
        </data>
        <data name="T_output" format="fasta" from_work_dir="output_T_output.fasta" label="${prefix}: Output: T instead of U">
            <filter>editing_functions['replace_output_tu']</filter>
        </data>
        <data name="U_output" format="fasta" from_work_dir="output_U_output.fasta" label="${prefix}: Output: U instead of T">
            <filter>editing_functions['replace_output_ut']</filter>
        </data>
        <!-- Unaligned -->
        <data name="unaligned_input" format="fasta" from_work_dir="output_unaligned_input.fasta" label="${prefix}: Unaligned Input">
            <filter>editing_functions['unalign_input']</filter>
        </data>
        <data name="unaligned_output" format="fasta" from_work_dir="output_unaligned_output.fasta" label="${prefix}: Unaligned Output">
            <filter>editing_functions['unalign_output']</filter>
        </data>
    </outputs>
    <!-- include tests-->
    <expand macro="tests"/>
    <!-- include help--> 
    <expand macro="help"/>
    <citations>
        <citation type="bibtex">
            @misc{githubCIAlign,
            author = {LastTODO, FirstTODO},
            year = {TODO},
            title = {CIAlign},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/KatyBrown/CIAlign},}
            </citation>
    </citations>
</tool>
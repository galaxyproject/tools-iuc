<macros>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">sourmash</requirement>
            <requirement type="package" version="*">zip</requirement>
        </requirements>
    </xml>
    <token name="@TOOL_VERSION@">4.9.4</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <token name="@PROFILE@">21.05</token>
    <xml name="citations">
        <citations>
            <citation type="doi">10.21105/joss.06830</citation>
        </citations>
        <creator>
        <organization name="Galaxy Europe"/>
        <person givenName="Ahmad" familyName="Mahagna" url="https://github.com/Smkingsize"/>
        <person givenName="Saim" familyName="Momin" url="https://github.com/SaimMomin12"/>
    </creator>
    </xml>
    <!-- Pick list Macros -->
    <token name="@Picklist_copy_file@"><![CDATA[
    #if $picklist_cond.picklist_param == "true":
        ln -s $picklist_cond.picklist_file list.csv &&
    #end if
    ]]></token>
    <token name="@Picklist_commandline@"><![CDATA[
    #if $picklist_cond.picklist_param=="true": 
        #set exp = 'list.csv:md5:md5:%s' % (str($picklist_cond.pickstyle))
        --picklist $exp
    #end if
    ]]></token>
    <token name="@Picklist_help@">
    **Picklist**

    Picklist is a feature by which you can select or “pick out” signatures based on values in a CSV file. 
    This is typically used to index, extract, or search a subset of a large collection where modifying the collection itself isn’t desired.

    In your labels.csv file only list the signatures you want to include/exclude.

    You can generate the *label.csv files* using the Output parameter *output labels csv* in Sourmash compare. 
    
    or using *sourmash sig describe --csv out.csv signatures* or *sourmash sig manifest -o out.csv 'filename_or_db'* to construct an initial CSV file that you can then edit further and use as a picklist as above.    
    </token>
    <xml name="picklist_macro">
        <conditional name="picklist_cond" label="Picklist">
            <param name="picklist_param" label="Picklist" type="select" help="Please read Help section at the end!">
                <option value="true">Yes</option>
                <option value="false" selected="true">No</option>
            </param>
            <when value="true">
                <param name="picklist_file" type="data" format="csv" label="Picklist file" help="input signatures files (created with souramsh sksetch)"/>
                <param name="pickstyle" type="select" label="Pick style" help="Weather to include or exclude picked signatures">
                    <option value="include" selected="true">include</option>
                    <option value="exclude">exclude</option>
                </param>
            </when>
            <when value="false"/>
        </conditional>
    </xml>
    <!-- Common parameters -->
    <token name="@common_params_commandline@"><![CDATA[
    $sig_select.mol_type
    #if $sig_select.ksize:
        --ksize $sig_select.ksize
    #end if
    #if $sig_select.scaled:
        --scaled $sig_select.scaled
    #end if
    ]]></token>
    <xml name="common_params">
        <section name="sig_select" title="Signature selectors" expanded="false">
            <param argument="--ksize" type="integer" optional="true" min="1" max="64" label="K-mer size" help="K-mer size to select. Must match the k-mer size of input signatures. Common values: 21, 31, 51"/>
            <param argument="--scaled" type="integer" optional="true" min="100" max="1000000" label="Scaled parameter" help="Downsample to this scaled value."/>
            <param name="mol_type" type="select" label="Molecule type" help="Choose the molecule/encoding for signatures to include in this index. All signatures must match this.">
                <option value="--dna" selected="true">DNA</option>
                <option value="--rna" >RNA</option>
                <option value="--protein">Protein (20 aa)</option>
                <option value="--dayhoff">Dayhoff (AA)</option>
                <option value="--hp">Hydrophobic-Polar (AA)</option>
                <option value="--skipm1n3_prot">Protein skipmer m1n3</option>
                <option value="--skipm2n3_prot">Protein skipmer m2n3</option>
            </param>
        </section>
    </xml>
    <!-- Taxonomy Inputs -->
    <token name="@tax_inputs_command@"><![CDATA[
        $tax.subcommand
        -o output
        -g 
        #for $g in $tax.gather_csv:
            $g
        #end for
        -t $tax.taxonomy_csv
        -F
        #for $fmt in $tax.output_format:
            $fmt
        #end for
        --rank $tax.rank
    ]]></token>
    <xml name="tax_inputs">
        <param name="gather_csv" argument="-g" type="data" format="csv" multiple="true" label="gather CSV" help="One or more  CSVs from sourmash gathe"/>
        <param name="taxonomy_csv" argument="-t" type="data" format="csv,binary" label="taxonomy CSV" help="Taxonomy File. Database lineages CSV or SQLite database"/>
    </xml>
    <xml name="rank">
        <param name="rank" type="select" label="Rank" help=" Classify to this rank (tax genome) or summarize taxonomy at this rank and above (tax metagenome). Note that the taxonomy CSV must contain lineage information at this rank">
                <option value="species" selected="true">Species</option>
                <option value="strain" >Strain</option>
                <option value="genus">Genus</option>
                <option value="family">Family</option>
                <option value="order">Order</option>
                <option value="class">Class</option>
                <option value="phylum">Phylum</option>
                <option value="superkingdom">Superkingdom</option>
        </param>
    </xml>
    <xml name="tax_files" token_help="">
        <param name="taxonomy_files" argument="--taxonomy" type="data" multiple="true" format="csv,binary" label="taxonomy CSV Files or SQLite database">
            <help>@HELP@</help>
        </param>
    </xml>
    <!-- Signature -->
    <xml name="single_signature">
        <param name="signature" type="data" format="json" label="signature file" help="TODO"/>
    </xml>
    <xml name="multiple_signatures">
        <param name="signatures" type="data" format="json" multiple="true" label="signature files" help="TODO"/>
    </xml>
    <token name="@list_inputs@"><![CDATA[
    $sig.subcommand
    #for $sig in $sig.signatures:
        $sig
    #end for
    ]]></token>
    #for $sig in $sig.signatures:
        $sig
    #end for
</macros>
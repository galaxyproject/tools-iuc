<macros>
    <!-- Meta parameters -->
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">sourmash</requirement>
            <requirement type="package" version="3.0">zip</requirement>
        </requirements>
    </xml>
    <token name="@TOOL_VERSION@">4.9.4</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <token name="@PROFILE@">25.0</token>
    <xml name="citations">
        <citations>
            <citation type="doi">10.21105/joss.06830</citation>
        </citations>
        <creator>
            <organization name="Galaxy Europe"/>
            <person givenName="Ahmad" familyName="Mahagna" url="https://github.com/Smkingsize"/>
            <person givenName="Saim" familyName="Momin" url="https://github.com/SaimMomin12"/>
        </creator>
    </xml>
    
    <!-- input signature -->
    <xml name="single_signature">
        <param name="signature" type="data" format="sourmash.sig" label="signature file" help="Input signature file"/>
    </xml>
    <!-- input signatures -->
    <xml name="signatures_macro">
        <param name="signatures" type="data" format="sourmash.sig" multiple="true" label="signature files" help="Input signature files."/>
    </xml>
    <!-- generic -->
    <token name="@signatures_command@"><![CDATA[
    #for $s in $signatures:
        $s
    #end for
    ]]></token>
    <!-- tool specific: sourmash_signature.xml-->
    <token name="@signatures_command_sig@"><![CDATA[
    $sig.subcommand
    #for $s in $sig.signatures:
        $s
    #end for
    ]]></token>
    <!-- ksize -->
    <xml name="ksize_macro">
        <param argument="--ksize" type="integer" optional="true" value="" min="1" max="64" label="K-mer size" help="Select the k-mer size of the signature to use. It must match the k-mer size of one or more of the input signatures. Common values: 21, 31, 51."/>
    </xml>
    <token name="@ksize_command@"><![CDATA[
    #if $ksize:
        --ksize $sig_select.ksize
    #end if
    ]]></token>
    <!-- mol type -->
    <xml name="mol_type_macro">
        <param name="mol_type" type="select" label="Molecule type" optional="true" help="Choose the molecule/encoding for signatures to perform function on. All signatures must match this.">
            <option value="--dna" selected="true">DNA</option>
            <option value="--rna" >RNA</option>
            <option value="--protein">Protein (20 aa)</option>
            <option value="--dayhoff">Dayhoff (AA)</option>
            <option value="--hp">Hydrophobic-Polar (AA)</option>
            <option value="--skipm1n3">Protein skipmer m1n3</option>
            <option value="--skipm2n3">Protein skipmer m2n3</option>
        </param>    
    </xml>
    <token name="@mul_type_command@"><![CDATA[
    $mol_type
    ]]></token>
    <!-- scaled -->
    <xml name="scaled_macro">
        <param argument="--scaled" type="integer" optional="true" value="" min="100" max="1000000" label="Scaled parameter" help="Downsample to this scaled value."/>
    </xml>
    <token name="@scaled_command@"><![CDATA[
    #if $scaled:
        --scaled $scaled
    #end if
    ]]></token>
    <!-- Use this token when signatures selectors are inside a section (sig_select) -->
    <token name="@common_params_commandline@"><![CDATA[
    $sig_select.mol_type
    #if $sig_select.ksize:
        --ksize $sig_select.ksize
    #end if
    #if $sig_select.scaled:
        --scaled $sig_select.scaled
    #end if
    ]]></token>

    <!-- Picklist -->
    <xml name="picklist_macro">
        <section name="picklist" title="Picklist" expanded="false">
            <param name="picklist_file" type="data" optional="true" format="csv" label="Picklist file" help="input signatures files (created with souramsh sksetch)"/>
            <param name="pickstyle" type="select" optional="true" label="Pick style" help="Wether to include or exclude picked signatures. Used only when picklist file is uploaded!">
                <option value="include" selected="true">include</option>
                <option value="exclude">exclude</option>
            </param>
        </section>
    </xml>
    <token name="@Picklist_copy_file@"><![CDATA[
    #if $picklist.picklist_file:
        ln -s $picklist.picklist_file list.csv &&
    #end if
    ]]></token>
    <token name="@Picklist_commandline@"><![CDATA[
    #if $picklist.picklist_file: 
        #set exp = 'list.csv:md5:md5:%s' % (str($picklist.pickstyle))
        --picklist $exp
    #end if
    ]]></token>
    <token name="@Picklist_help@">
    **Picklist**

    Picklist is a feature by which you can select or “pick out” signatures based on values in a CSV file. 
    This is typically used to index, extract, or search a subset of a large collection where modifying the collection itself isn’t desired.

    To use Picklist just upload a file listting only the signatures you want to include/exclude.
    ! Please note to chose a pickstyle **only** if a picklist file is uploaded !

    You can generate the *label.csv files* using the Output parameter *output labels csv* in Sourmash compare. 
    
    or using *sourmash sig describe --csv out.csv signatures* or *sourmash sig manifest -o out.csv 'filename_or_db'* to construct an initial CSV file that you can then edit further and use as a picklist as above.

    </token>
    <!-- Taxonomy Inputs -->
    <token name="@tax_inputs_command@"><![CDATA[
        -o output
        -g 
        #for $g in $gather_csv:
            $g
        #end for
        -t $taxonomy_csv
        -F
        #for $fmt in $output_format:
            $fmt
        #end for
        --rank $rank
    ]]></token>
    <xml name="tax_inputs">
        <param name="gather_csv" argument="-g" type="data" format="csv" multiple="true" label="gather CSV" help="One or more  CSVs from sourmash gather"/>
        <param name="taxonomy_csv" argument="-t" type="data" format="csv,sqlite" label="taxonomy CSV" help="Taxonomy File. Database lineages CSV or SQLite database"/>
    </xml>
    <xml name="rank">
        <param name="rank" type="select" label="Rank" help=" Classify to this rank (tax genome) or summarize taxonomy at this rank and above (tax metagenome). Note that the taxonomy CSV must contain lineage information at this rank">
                <option value="species" selected="true">Species</option>
                <option value="strain" >Strain</option>
                <option value="genus">Genus</option>
                <option value="family">Family</option>
                <option value="order">Order</option>
                <option value="class">Class</option>
                <option value="phylum">Phylum</option>
                <option value="superkingdom">Superkingdom</option>
        </param>
    </xml>
    <xml name="tax_files" token_help="">
        <param name="taxonomy_files" argument="--taxonomy" type="data" multiple="true" format="csv,sqlite" label="taxonomy CSV Files or SQLite database" help="One or more properly formatted taxonomy files (CSV or SQLite). sourmash also supports LIN and ICTV lineage information in compatible taxonomy files." />
    </xml>
    <token name="@taxa_file_help@">
    **Taxonomy File Structure**

    Taxonomy files are in csv or sqlite format and they store a mapping of the identifiers from the signature names to the standard seven NCBI/GTDB taxonomy ranks - superkingdom, phylum, class, order, family, genus, and species.

    Example:

    *ident,superkingdom,phylum,class,order,family,genus,species*
    GCF_001881345.1,d__Bacteria,p__Proteobacteria,c__Gammaproteobacteria,o__Enterobacterales,f__Enterobacteriaceae,g__Escherichia,s__Escherichia coli


    </token>
    <!-- signature reoccuring params-->
    <token name="@sig_params@"><![CDATA[
    #if $sig.ksize:
        --ksize $sig.ksize
    #end if
    #if $sig.mol_type:
        $sig.mol_type
    #end if
    ]]></token>
    <xml name="sig_flatten" token_help="">
        <param argument="--flatten" type="boolean" truevalue="--flatten" falsevalue="" checked="false" label="Flatten">
            <help>@HELP@</help>
        </param>
    </xml>
</macros>
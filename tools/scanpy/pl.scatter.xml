<tool id="pl.scatter" name="pl.scatter" version="1.3.1+galaxy1">
    <description>Scatter plot along observations or variables axes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
            python $script_file
        ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@

sc.settings.figdir = '.'

sc.pl.scatter(
    adata=adata,
    #if $type.type == 'xy'
    x='$type.x',
    y='$type.y',
        #if $type.color
    color='$type.color',
        #end if
    layers=('$type.layer_x', '$type.layer_y', '$type.layer_color'),
    #else
        basis='$type.basis',
    #end if
    use_raw=$use_raw,
    sort_order=$sort_order,
    #if $groups
    groups=$groups.replace(' ','').split(','),
    #end if
    projection='$plot.projection',
    legend_loc='$plot.legend_loc',
    legend_fontsize=$plot.legend_fontsize,
    legend_fontweight='$plot.legend_fontweight',
    palette='$plot.palette',
    frameon=$plot.frameon,
    right_margin=$plot.right_margin,
    size=$plot.size,
    #if $plot.title
    title=$plot.title.split(','),
    #end if
    show=False,
    save='.$plot.format')
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="inputs_anndata"/>
        <conditional name="type">
            <param name="type" type="select" label="Plotting tool that computed coordinates" help="">
                <option value="xy">Using coordinates</option>
                <option value="basis">Using tool that computes coordinates</option>
            </param>
            <when value="xy">
                <param argument="x" type="text" value="" label="x coordinate" help="Index or key from either `.obs` or `.var`"/>
                <param argument="y" type="text" value="" label="y coordinate" help="Index or key from either `.obs` or `.var`"/>
                <param argument="color" type="text" value="" optional="true" label="Key for annotations of observations/cells or variables/genes" help="Index or key from either `.obs` or `.var`"/>
                <param argument="layer_x" type="text" value="X" label="Layers for x coordinate" help="Use the `layers` attribute of `adata` if present"/>
                <param argument="layer_y" type="text" value="X" label="Layers for y coordinate" help="Use the `layers` attribute of `adata` if present"/>
                <param argument="layer_color" type="text" value="X" label="Layers for color" help="Use the `layers` attribute of `adata` if present"/>
            </when>
            <when value="basis">
                <param argument="basis" type="select" label="Plotting tool that computes coordinates" help="">
                    <option value="pca">pca (need to run on `tl.pca` output)</option>
                    <option value="tsne">tsne (need to run on `tl.tsne` output)</option>
                    <option value="umap">umap (need to run on `tl.umap` output)</option>
                    <option value="diffmap">diffmap (need to run on `tl.diffmap` output)</option>
                    <option value="draw_graph_fr">draw_graph_fr (need to run on `tl.draw_graph` output)</option>
                </param>
            </when>
        </conditional>
        <param argument="use_raw" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Use `raw` attribute of input if present" help=""/>
        <param argument="sort_order" type="boolean" truevalue="True" falsevalue="False" checked="true" label="Plot data points with higher values on top of others?" help="For continuous annotations used as color parameter"/>
        <param argument="groups" type="text" value="" optional="true" label="Categories to which restrict in categorical observation annotation" help=""/>
        <!--<param argument="components" type="text" value="1,2" label="Components" help="For instance, ['1,2', '2,3']. To plot all available components use 'all'"/>-->
        <section name="plot" title="Plot attributes">
            <param argument="projection" type="select" label="Projection of plot" help="">
                <option value="2d">2d</option>
                <option value="3d">3d</option>
            </param>
            <param argument="legend_loc" type="select" label="Location of legend" help="">
                <option value="none">none</option>
                <option value="right margin" selected="true">right margin</option>
                <option value="on data">on data</option>
                <option value="on data export">on data export</option>
                <option value="best">best</option>
                <option value="upper right">upper right</option>
                <option value="upper left">upper left</option>
                <option value="lower left">lower left</option>
                <option value="lower right">lower right</option>
                <option value="center left">center left</option>
                <option value="center right">center right</option>
                <option value="lower center">lower center</option>
                <option value="upper center">upper center</option>
                <option value="center">center</option>
            </param>
            <param argument="legend_fontsize" type="integer" value="1" label="Legend font size" help=""/>
            <param argument="legend_fontweight" type="select" label="Legend font weight" help="">
                <option value="light">light</option>
                <option value="normal" selected="true">normal</option>
                <option value="medium">medium</option>
                <option value="semibold">semibold</option>
                <option value="bold">bold</option>
                <option value="heavy">heavy</option>
                <option value="black">black</option>
            </param>
            <param argument="palette" type="select" label="Colors to use for plotting g categorical annotation groups" help="">
                <expand macro="matplotlib_pyplot_colormap"/>
            </param>
            <param argument="frameon" type="boolean" truevalue="True" falsevalue="False" checked="true" label="Draw a frame around the scatter plot?" help=""/>
            <param argument="right_margin" type="float" value="1" label="Width of the space right of each plotting panel" help=""/>
            <param argument="size" type="float" value="1" label="Point size" help=""/>
            <param argument="title" type="text" value="" optional="true" label="Title for panels" help="Titles must be separated by a comma"/>
            <param name="format" type="select" label="Format for saving figures">
                <option value="png">png</option>
                <option value="pdf">pdf</option>
                <option value="svg">svg</option>
            </param>
        </section>
    </inputs>
    <outputs>
        <data name="out_png" format="png" from_work_dir="*.png" label="${tool.name} on ${on_string}">
            <filter>plot['format'] == 'png'</filter>
        </data>
        <data name="out_pdf" format="pdf" from_work_dir="*.pdf" label="${tool.name} on ${on_string}">
            <filter>plot['format'] == 'pdf'</filter>
        </data>
        <data name="out_svg" format="svg" from_work_dir="*.svg" label="${tool.name} on ${on_string}">
            <filter>plot['format'] == 'svg'</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="pp.pca.krumsiek11.h5ad" />
            </conditional>
            <conditional name="type">
                <param name="type" value="basis"/>
                <param name="basis" value="pca"/>
            </conditional>
            <param name="use_raw" value="False"/>
            <param name="sort_order" value="True"/>
            <section name="plot">
                <param name="projection" value="2d"/>
                <param name="legend_loc" value="right margin"/>
                <param name="legend_fontsize" value="1"/>
                <param name="legend_fontweight" value="normal"/>
                <param name="palette" value="inferno"/>
                <param name="frameon" value="True"/>
                <param name="right_margin" value="1"/>
                <param name="size" value="1"/>
                <param name="format" value="png"/>
            </section>
            <output name="out_png" file="pl.scatter.pca.krumsiek11.png"/>
        </test>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="krumsiek11.h5ad" />
            </conditional>
            <conditional name="type">
                <param name="type" value="xy"/>
                <param name="x" value="EKLF"/>
                <param name="y" value="Cebpa"/>
                <param name="color" value="EgrNab"/>
                <param name="layer_x" value="X"/>
                <param name="layer_y" value="X"/>
                <param name="layer_color" value="X"/>
            </conditional>
            <param name="use_raw" value="False"/>
            <param name="sort_order" value="True"/>
            <section name="plot">
                <param name="projection" value="2d"/>
                <param name="legend_loc" value="best"/>
                <param name="legend_fontsize" value="1"/>
                <param name="legend_fontweight" value="normal"/>
                <param name="palette" value="bwr"/>
                <param name="frameon" value="False"/>
                <param name="right_margin" value="1"/>
                <param name="size" value="1"/>
                <param name="title" value="A title"/>
                <param name="format" value="png"/>
            </section>
            <output name="out_png" file="pl.scatter.krumsiek11.png"/>
        </test>
    </tests>
    <help><![CDATA[
Color the plot using annotations of observations (`.obs`), variables
(`.var`) or expression of genes (`.var_names`).

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.pl.scatter.html#scanpy.api.pl.scatter>`__
    ]]></help>
    <expand macro="citations"/>
</tool>

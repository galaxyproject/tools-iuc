<tool id="pl.heatmap" name="pl.heatmap" version="1.3.1+galaxy1">
    <description>Heatmap of the expression values of set of genes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
            python $script_file
        ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@

sc.settings.figdir = '.'

@CMD_params_var_group@

sc.pl.heatmap(@CMD_params_plots@ @CMD_params_figsize@
    #if $seaborn_heatmap.vmin
    vmin=$seaborn_heatmap.vmin,
    #end if
    #if $seaborn_heatmap.vmax
    vmax=$seaborn_heatmap.vmax,
    #end if
    cmap='$seaborn_heatmap.cmap',
    #if $seaborn_heatmap.center
    center=$seaborn_heatmap.center,
    #end if
    annot=$seaborn_heatmap.annot,
    linewidths=$seaborn_heatmap.linewidths,
    linecolor='$seaborn_heatmap.linecolor',
    cbar=$seaborn_heatmap.cbar,
    square=$seaborn_heatmap.square,
    show=False)
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="params_plots"/>
        <expand macro="param_figsize"/>
        <section name="seaborn_heatmap" title="Parameters for seaborn.heatmap">
            <param argument="vmin" type="float" value="" optional="true" label="Minimum value to anchor the colormap" help="If not set, it is inferred from the data and other keyword arguments"/>
            <param argument="vmax" type="float" value="" optional="true" label="Maximum value to anchor the colormap" help="If not set, it is inferred from the data and other keyword arguments"/>
            <param argument="cmap" type="select" label="Color palette">
                <expand macro="seaborn_color_palette_options"/>
            </param>
            <param argument="center" type="float" value="" optional="true" label="Value at which to center the colormap" help=""/>
            <param argument="annot" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Write the data value in each cell?" help=""/>
            <param argument="linewidths" type="float" value="0" label="Width of the lines that will divide each cell" help=""/>
            <param argument="linecolor" type="text" value="white" label="Color of the lines that will divide each cell" help=""/>
            <param argument="cbar" type="boolean" truevalue="True" falsevalue="False" checked="true" label="Draw a colorbar?" help=""/>
            <param argument="square" type="boolean" truevalue="True" falsevalue="False" checked="false" label="set the Axes aspect to 'equal' so each cell will be square-shaped?" help=""/>
        </section>
    </inputs>
    <outputs>
        <expand macro="plot_output"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="krumsiek11.h5ad" />
            </conditional>
            <conditional name="var_names">
                <param name="type" value="all"/>
            </conditional>
            <param name="groupby" value=""/>
            <param name="log" value="False"/>
            <param name="use_raw" value="False"/>
            <param name="num_categories" value="7"/>
            <conditional name="figsize">
                <param name="test" value="no"/>
            </conditional>
            <param name="dendrogram" value="False"/>
            <repeat name="var_group_positions">
                <param name="start" value="1"/>
                <param name="end" value="4"/>
                <param name="label" value="1"/>
            </repeat>
            <repeat name="var_group_positions">
                <param name="start" value="3"/>
                <param name="end" value="6"/>
                <param name="label" value="the label"/>
            </repeat>
            <param name="format" value="png"/>
            <section name="seaborn_heatmap">
                <param name="cmap" value="Oranges_r"/>
                <param name="annot" value="False"/>
                <param name="linewidths" value="0"/>
                <param name="linecolor" value="white"/>
                <param name="cbar" value="True"/>
                <param name="square" value="False"/>
            </section>
            <output name="out_png" file="pl.heatmap.krumsiek11_all.png" ftype="png" compare="sim_size"/>
        </test>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="krumsiek11.h5ad" />
            </conditional>
            <conditional name="var_names">
                <param name="type" value="custom"/>
                <param name="var_names" value="Gata1, Fog1, EKLF, Fli1, SCL, Cebpa"/>
            </conditional>
            <param name="groupby" value="cell_type"/>
            <param name="log" value="False"/>
            <param name="use_raw" value="False"/>
            <param name="num_categories" value="7"/>
            <conditional name="figsize">
                <param name="test" value="yes"/>
                <param name="width" value="10" />
                <param name="height" value="10" />
            </conditional>
            <param name="dendrogram" value="False"/>
            <param name="format" value="png"/>
            <section name="seaborn_heatmap">
                <param name="cmap" value="Oranges_r"/>
                <param name="annot" value="False"/>
                <param name="linewidths" value="0"/>
                <param name="linecolor" value="white"/>
                <param name="cbar" value="True"/>
                <param name="square" value="False"/>
            </section>
            <output name="out_png" file="pl.heatmap.krumsiek11_custom_var_names.png" ftype="png" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
Plot an heatmap of the expression values of set of genes..

If `groupby` is given, the heatmap is ordered by the respective group. For
example, a list of marker genes can be plotted, ordered by clustering. If
the `groupby` observation annotation is not categorical the observation
annotation is turned into a categorical by binning the data into the number
specified in `num_categories`.

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.pl.heatmap.html#scanpy.api.pl.heatmap>`__
    ]]></help>
    <expand macro="citations"/>
</tool>

<?xml version="1.0" encoding="utf-8"?>
<tool id="scanpy-read-10x" name="Scanpy Read10x" version="@TOOL_VERSION@+galaxy0">
    <description>into hdf5 object handled by scanpy</description>
    <macros>
        <import>scanpy_macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
ln -s '${matrix}' matrix.mtx &&
ln -s '${genes}' genes.tsv &&
ln -s '${barcodes}' barcodes.tsv &&
scanpy-read-10x.py
    -d ./
    -o read_10x.h5
    -F '${output_format}'
    -v '${var_names}'
    ]]></command>

    <inputs>
        <param name="matrix" type="data" format="txt"/>
        <param name="genes" type="data" format="tsv"/>
        <param name="barcodes" type="data" format="tsv"/>
        <expand macro="output_object_params"/>
        <param name="var_names" type="select" label="Attribute used as annotation index">
            <option value="gene_ids" selected="true">Gene ID</option>
            <option value="gene_symbols">Gene symbol</option>
        </param>
    </inputs>

    <outputs>
        <data name="output_h5" format="h5" from_work_dir="read_10x.h5" label="${tool.name} on ${on_string}: ${output_format}"/>
    </outputs>

    <tests>
        <test>
            <param name="matrix" value="matrix.mtx"/>
            <param name="genes" value="genes.tsv"/>
            <param name="barcodes" value="barcodes.tsv"/>
            <param name="output_format" value="anndata"/>
            <output name="output_h5" file="read_10x.h5" ftype="h5" compare="sim_size"/>
        </test>
    </tests>

    <help><![CDATA[
@HELP@
    ]]></help>
    <expand macro="citations"/>
</tool>

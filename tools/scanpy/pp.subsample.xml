<tool id="pp.subsample" name="pp.subsample" version="1.3.1+galaxy1">
    <description>Subsample to a fraction of the number of observations.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
          python $script_file
      ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@

sc.pp.subsample(
    data=adata,
    #if $type.type == 'fraction'
    fraction=$type.fraction,
    #else if $type.type == 'n_obs'
    n_obs=$type.n_obs,
    #end if
    random_state=$random_state,
    copy=False)

@CMD_anndata_write_outputs@
  ]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="inputs_anndata"/>
        <conditional name="type">
            <param name="type" type="select" label="Type of subsampling">
                <option value="fraction">By fraction</option>
                <option value="n_obs">By number of observation</option>
            </param>
            <when value="fraction">
                <param argument="fraction" type="float" value="" label="Subsample to this `fraction` of the number of observations" help=""/>
            </when>
            <when value="n_obs">
                <param argument="n_obs" type="integer" value="" label="Subsample to this number of observations" help=""/>
            </when>
        </conditional>
        <param argument="random_state" type="integer" value="0" label="Random seed to change subsampling" help=""/>
        <expand macro="anndata_output_format"/>
    </inputs>
    <outputs>
        <expand macro="anndata_outputs"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="krumsiek11.h5ad" />
            </conditional>
            <conditional name="type">
                <param name="type" value="fraction" />
                <param name="fraction" value="0.5"/>
            </conditional>
            <param name="random_state" value="0"/>
            <param name="anndata_output_format" value="h5ad" />
            <output name="anndata_out_h5ad" file="pp.subsample.krumsiek11_fraction.h5ad" ftype="h5" compare="sim_size"/>
        </test>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="krumsiek11.h5ad" />
            </conditional>
            <conditional name="type">
                <param name="type" value="n_obs" />
                <param name="n_obs" value="10"/>
            </conditional>
            <param name="random_state" value="0"/>
            <param name="anndata_output_format" value="h5ad" />
            <output name="anndata_out_h5ad" file="pp.subsample.krumsiek11_n_obs.h5ad" ftype="h5" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
Subsample to a fraction of the number of observations.

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.pp.subsample.html#scanpy.api.pp.subsample>`__
      ]]></help>
    <expand macro="citations"/>
</tool>

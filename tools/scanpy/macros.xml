<macros>
    <xml name="requirements">
        <requirements>
          <requirement type="package" version="1.3.1">scanpy</requirement>
          <requirement type="package" version="2.0.10">loompy</requirement>
        </requirements>
    </xml>
    <xml name="citations">
        <citations>
            <citation type="doi">10.1186/s13059-017-1382-0</citation>
        </citations>
    </xml>
    <token name="@CMD_imports@"><![CDATA[
import scanpy.api as sc
import pandas as pd
import numpy as np
    ]]>
    </token>
    <xml name="inputs_anndata">
        <conditional name="input">
            <param name="format" type="select" label="Format for the annotated data matrix">
                <option value="loom">loom</option>
                <option value="h5ad">h5ad-formatted hdf5</option>
            </param>
            <when value="loom">
                <param name="adata" type="data" format="loom" label="Annotated data matrix"/>
                <param name="sparse" type="boolean" truevalue="True" falsevalue="False" checked="true" label="Is the data matrix to read sparse?"/>
                <param name="cleanup" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Cleanup?"/>
                <param name="x_name" type="text" value="spliced" label="X_name"/>
                <param name="obs_names" type="text" value="CellID" label="obs_names"/>
                <param name="var_names" type="text" value="Gene" label="var_names"/>
            </when>
            <when value="h5ad">
                <param name="adata" type="data" format="h5" label="Annotated data matrix"/>
            </when>
        </conditional>
    </xml>
    <token name="@CMD_read_inputs@"><![CDATA[
#if $input.format == 'loom'
adata = sc.read_loom(
    '$input.adata',
    sparse='$input.sparse',
    cleanup='$input.cleanup',
    X_name='$input.x_name',
    obs_names='$input.obs_names',
    var_names='$input.var_names')
#else if $input.format == 'h5ad'
adata = sc.read_h5ad('$input.adata')
#end if
]]>
    </token>
    <xml name="anndata_output_format">
        <param name="anndata_output_format" type="select" label="Format to write the annotated data matrix">
            <option value="loom">loom</option>
            <option value="h5ad">h5ad-formatted hdf5</option>
        </param>
    </xml>
    <xml name="anndata_modify_output_input">
        <conditional name="modify_anndata">
            <param name="modify_anndata" type="select" label="Return modify annotate data matrix?">
                <option value="true">Yes</option>
                <option value="false">No</option>
            </param>
            <when value="true">
                <expand macro="anndata_output_format"/>
            </when>
            <when value="false"/>
        </conditional>
    </xml>
    <xml name="anndata_outputs">
        <data name="anndata_out_h5ad" format="h5" from_work_dir="anndata.h5ad" label="${tool.name} on ${on_string}: Annotated data matrix">
            <filter>anndata_output_format == 'h5ad'</filter>
        </data>
        <data name="anndata_out_loom" format="loom" from_work_dir="anndata.loom" label="${tool.name} on ${on_string}: Annotated data matrix">
            <filter>anndata_output_format == 'loom'</filter>
        </data>
    </xml>
    <xml name="anndata_modify_outputs">
        <data name="anndata_out_h5ad" format="h5" from_work_dir="anndata.h5ad" label="${tool.name} on ${on_string}: Annotated data matrix">
            <filter>modify_anndata['modify_anndata'] == 'true' and modify_anndata['anndata_output_format'] == 'h5ad'</filter>
        </data>
        <data name="anndata_out_loom" format="loom" from_work_dir="anndata.loom" label="${tool.name} on ${on_string}: Annotated data matrix">
            <filter>modify_anndata['modify_anndata'] == 'true' and modify_anndata['anndata_output_format'] == 'loom'</filter>
        </data>
    </xml>
    <token name="@CMD_anndata_write_outputs@"><![CDATA[
#if $anndata_output_format == 'loom'
adata = write_loom('anndata.loom')
#else if $anndata_output_format == 'h5ad'
adata.write('anndata.h5ad')
#end if
]]>
    </token>
    <token name="@CMD_anndata_write_modify_outputs@"><![CDATA[
#if $modify_anndata.modify_anndata == 'true'
    #set $anndata_output_format = $modify_anndata.anndata_output_format
@CMD_anndata_write_outputs@
#end if
]]>
    </token>
    <xml name="seaborn_color_palette_options">
        <option value="Accent">Accent</option>
        <option value="Accent_r">Accent_r</option>
        <option value="Blues">Blues</option>
        <option value="Blues_r">Blues_r</option>
        <option value="BrBG">BrBG</option>
        <option value="BrBG_r">BrBG_r</option>
        <option value="BuGn">BuGn</option>
        <option value="BuGn_r">BuGn_r</option>
        <option value="BuPu">BuPu</option>
        <option value="BuPu_r">BuPu_r</option>
        <option value="CMRmap">CMRmap</option>
        <option value="CMRmap_r">CMRmap_r</option>
        <option value="Dark2">Dark2</option>
        <option value="Dark2_r">Dark2_r</option>
        <option value="GnBu">GnBu</option>
        <option value="GnBu_r">GnBu_r</option>
        <option value="Greens">Greens</option>
        <option value="Greens_r">Greens_r</option>
        <option value="Greys">Greys</option>
        <option value="Greys_r">Greys_r</option>
        <option value="OrRd">OrRd</option>
        <option value="OrRd_r">OrRd_r</option>
        <option value="Oranges">Oranges</option>
        <option value="Oranges_r">Oranges_r</option>
        <option value="PRGn">PRGn</option>
        <option value="PRGn_r">PRGn_r</option>
        <option value="Paired">Paired</option>
        <option value="Paired_r">Paired_r</option>
        <option value="Pastel1">Pastel1</option>
        <option value="Pastel1_r">Pastel1_r</option>
        <option value="Pastel2">Pastel2</option>
        <option value="Pastel2_r">Pastel2_r</option>
        <option value="PiYG">PiYG</option>
        <option value="PiYG_r">PiYG_r</option>
        <option value="PuBu">PuBu</option>
        <option value="PuBuGn">PuBuGn</option>
        <option value="PuBuGn_r">PuBuGn_r</option>
        <option value="PuBu_r">PuBu_r</option>
        <option value="PuOr">PuOr</option>
        <option value="PuOr_r">PuOr_r</option>
        <option value="PuRd">PuRd</option>
        <option value="PuRd_r">PuRd_r</option>
        <option value="Purples">Purples</option>
        <option value="Purples_r">Purples_r</option>
        <option value="RdBu">RdBu</option>
        <option value="RdBu_r">RdBu_r</option>
        <option value="RdGy">RdGy</option>
        <option value="RdPu">RdPu</option>
        <option value="RdPu_r">RdPu_r</option>
        <option value="RdYlBu">RdYlBu</option>
        <option value="RdYlBu_r">RdYlBu_r</option>
        <option value="RdYlGn">RdYlGn</option>
        <option value="RdYlGn_r">RdYlGn_r</option>
        <option value="Reds">Reds</option>
        <option value="Reds_r">Reds_r</option>
        <option value="Set1">Set1</option>
        <option value="Set1_r">Set1_r</option>
        <option value="Set2">Set2</option>
        <option value="Set2_r">Set2_r</option>
        <option value="Set3">Set3</option>
        <option value="Set3_r">Set3_r</option>
        <option value="Spectral">Spectral</option>
        <option value="Spectral_r">Spectral_r</option>
        <option value="Wistia">Wistia</option>
        <option value="Wistia_r">Wistia_r</option>
        <option value="YlGn">YlGn</option>
        <option value="YlGn_r">YlGn_r</option>
        <option value="YlGnBu">YlGnBu</option>
        <option value="YlGnBu_r">YlGnBu_r</option>
        <option value="YlOrBr">YlOrBr</option>
        <option value="YlOrBr_r">YlOrBr_r</option>
        <option value="YlOrRd">YlOrRd</option>
        <option value="YlOrRd_r">YlOrRd_r</option>
        <option value="afmhot">afmhot</option>
        <option value="afmhot_r">afmhot_r</option>
        <option value="autumn">autumn</option>
        <option value="autumn_r">autumn_r</option>
        <option value="binary">binary</option>
        <option value="binary_r">binary_r</option>
        <option value="bone">bone</option>
        <option value="bone_r">bone_r</option>
        <option value="brg">brg</option>
        <option value="brg_r">brg_r</option>
        <option value="bwr">bwr</option>
        <option value="bwr_r">bwr_r</option>
        <option value="cividis">cividis</option>
        <option value="cividis_r">cividis_r</option>
        <option value="cool">cool</option>
        <option value="cool_r">cool_r</option>
        <option value="coolwarm">coolwarm</option>
        <option value="coolwarm_r">coolwarm_r</option>
        <option value="copper">copper</option>
        <option value="copper_r">copper_r</option>
        <option value="cubehelix">cubehelix</option>
        <option value="cubehelix_r">cubehelix_r</option>
        <option value="flag">flag</option>
        <option value="flag_r">flag_r</option>
        <option value="gist_earth">gist_earth</option>
        <option value="gist_earth_r">gist_earth_r</option>
        <option value="gist_gray">gist_gray</option>
        <option value="gist_gray_r">gist_gray_r</option>
        <option value="gist_heat">gist_heat</option>
        <option value="gist_heat_r">gist_heat_r</option>
        <option value="gist_ncar">gist_ncar</option>
        <option value="gist_ncar_r">gist_ncar_r</option>
        <option value="gist_rainbow">gist_rainbow</option>
        <option value="gist_rainbow_r">gist_rainbow_r</option>
        <option value="gist_stern">gist_stern</option>
        <option value="gist_stern_r">gist_stern_r</option>
        <option value="gist_yarg">gist_yarg</option>
        <option value="gist_yarg_r">gist_yarg_r</option>
        <option value="gnuplot">gnuplot</option>
        <option value="gnuplot_r">gnuplot_r</option>
        <option value="gnuplot2">gnuplot2</option>
        <option value="gnuplot2_r">gnuplot2_r</option>
        <option value="gray">gray</option>
        <option value="gray_r">gray_r</option>
        <option value="hot">hot</option>
        <option value="hot_r">hot_r</option>
        <option value="hsv">hsv</option>
        <option value="hsv_r">hsv_r</option>
        <option value="icefire">icefire</option>
        <option value="icefire_r">icefire_r</option>
        <option value="inferno">inferno</option>
        <option value="inferno_r">inferno_r</option>
        <option value="jet">jet</option>
        <option value="jet_r">jet_r</option>
        <option value="magma">magma</option>
        <option value="magma_r">magma_r</option>
        <option value="mako">mako</option>
        <option value="mako_r">mako_r</option>
        <option value="nipy_spectral">nipy_spectral</option>
        <option value="nipy_spectral_r">nipy_spectral_r</option>
        <option value="ocean">ocean</option>
        <option value="ocean_r">ocean_r</option>
        <option value="pink">pink</option>
        <option value="pink_r">pink_r</option>
        <option value="plasma">plasma</option>
        <option value="plasma_r">plasma_r</option>
        <option value="prism">prism</option>
        <option value="prism_r">prism_r</option>
        <option value="rainbow">rainbow</option>
        <option value="rainbow_r">rainbow_r</option>
        <option value="rocket">rocket</option>
        <option value="rocket_r">rocket_r</option>
        <option value="seismic">seismic</option>
        <option value="seismic_r">seismic_r</option>
        <option value="spring">spring</option>
        <option value="spring_r">spring_r</option>
        <option value="summer">summer</option>
        <option value="summer_r">summer_r</option>
        <option value="tab10">tab10</option>
        <option value="tab10_r">tab10_r</option>
        <option value="tab20">tab20</option>
        <option value="tab20_r">tab20_r</option>
        <option value="tab20b">tab20b</option>
        <option value="tab20b_r">tab20b_r</option>
        <option value="tab20c">tab20c</option>
        <option value="tab20c_r">tab20c_r</option>
        <option value="terrain">terrain</option>
        <option value="terrain_r">terrain_r</option>
        <option value="twilight">twilight</option>
        <option value="twilight_r">twilight_r</option>
        <option value="twilight_shifted">twilight_shifted</option>
        <option value="twilight_shifted_r">twilight_shifted_r</option>
        <option value="viridis">viridis</option>
        <option value="viridis_r">viridis_r</option>
        <option value="vlag">vlag</option>
        <option value="vlag_r">vlag_r</option>
        <option value="winter">winter</option>
        <option value="winter_r">winter_r</option>
    </xml>
</macros>

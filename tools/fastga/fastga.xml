<tool id="fastga" name="FastGA" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>align long sequences</description>
    <macros>
        <import>fastga_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        ## FastGA directly string matches the file extensions
        ## symlinks are used to bypass that restriction
        ln -s '$input1' 'input1.${input1.ext}' &&
        ln -s '$input2' 'input2.${input2.ext}' &&
        FastGA
        '${output_settings.out.format}'
        #if str( $output_settings.out.format ) == "-paf":
            #if str( $output_settings.out.cigar_string ) != "no":
                '${output_settings.out.cigar_string}'
            #end if
            #if str( $output_settings.out.cs_string ) != "no":
                '${output_settings.out.cs_string}'
            #end if
        #end if
        #if str( $use_soft_mask ) == "-M":
            '-M'
        #end if
        #if str( $use_sym_seeding ) == "-S":
            '-S'
        #end if
        '-f${adaptive_seed_count_cutoff}'
        '-c${minimum_seed_coverage}'
        '-s${new_seed_threshold}'
        '-l${minimum_alignment_length}'
        '-i${minimum_alignment_identity}'
        'input1.${input1.ext}' 'input2.${input2.ext}' 
        #if str( $output_settings.out.format ) != "-1:output":
            > output
        #end if
    ]]></command>
    <inputs>
        <param name="input1" type="data" label="FASTA sequence" format="fasta,fasta.gz"/>
        <param name="input2" type="data" label="FASTA sequence" format="fasta,fasta.gz"/>
        <param name="use_soft_mask" type="boolean" label="Use soft mask information if available (-M)" checked="false" truevalue="-M" falsevalue=""/>
        <param name="use_sym_seeding" type="boolean" label="Use symmetric seeding (-S)" checked="false" truevalue="-S" falsevalue=""/>
        <param name="adaptive_seed_count_cutoff" type="integer" label="Adaptive seed count cutoff (-f)" value="10" min="0" max="255"/>
        <param name="minimum_seed_coverage" type="integer" label="Minimum seed chain coverage in both genomes (-c)" value="85" min="0" max="2147483647"/>
        <param name="new_seed_threshold" type="integer" label="Threshold for starting a new seed chain (-s)" value="1000" min="0" max="2147483647"/>
        <param name="minimum_alignment_length" type="integer" label="Minimum alignment length (-l)" value="100" min="0" max="2147483647"/>
        <param name="minimum_alignment_identity" type="float" label="Minimum alignment identity (-i)" value="0.7" min="0.55" max="0.99999999999999994"/>
        <section name="output_settings" expanded="False" title="Output">
            <conditional name="out">
                <param name="format" type="select" label="Specify the output format">
                    <option value="-paf" selected="true">paf (-paf)</option>
                    <option value="-psl">psl (-psl)</option>
                    <option value="-1:output">1aln (-1)</option>
                </param>
                <when value="-paf">
                    <param name="cigar_string" type="select" label="Use CIGAR string?">
                        <option value="no" selected="true">No CIGAR string</option>
                        <option value="-pafx">CIGAR string with X's (-pafx)</option>
                        <option value="-pafm">CIGAR string with ='s (-pafm)</option>
                    </param>
                    <param name="cs_string" type="select" label="Use CS string?">
                        <option value="no" selected="true">No CS string</option>
                        <option value="-pafs">CS string in short form (-pafs)</option>
                        <option value="-pafS">CS string in long form (-pafS)</option>
                    </param>
                </when>
                <when value="-psl"/>
                <when value="-1:output"/>
            </conditional>
        </section>
    </inputs>
    <outputs>
        <data name="output" format="paf" from_work_dir="output">
            <change_format>
                <when input="output_settings.out.format" value="-paf" format="paf"/>
                <when input="output_settings.out.format" value="-psl" format="psl"/>
                <when input="output_settings.out.format" value="-1:output" format="txt"/>
            </change_format>
        </data>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input1" value="chrM_hg38.fa.gz"/>
            <param name="input2" value="chrM_mm39.fa.gz"/>
            <section name="output_settings">
                <conditional name="out">
                    <param name="format" value="-paf"/>
                </conditional>
            </section>
            <output name="output" file="chrM_HGvMM.paf" ftype="paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input1" value="chrM_hg38.fa.gz"/>
            <param name="input2" value="chrM_mm39.fa.gz"/>
            <section name="output_settings">
                <conditional name="out">
                    <param name="format" value="-psl"/>
                </conditional>
            </section>
            <output name="output" file="chrM_HGvMM.psl" ftype="psl"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input1" value="chrM_hg38.fa.gz"/>
            <param name="input2" value="chrM_mm39.fa.gz"/>
            <section name="output_settings">
                <conditional name="out">
                    <param name="format" value="-paf"/>
                    <param name="cigar_string" value="-pafx"/>
                </conditional>
            </section>
            <output name="output" file="pafx.paf" ftype="paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input1" value="chrM_hg38.fa.gz"/>
            <param name="input2" value="chrM_mm39.fa.gz"/>
            <section name="output_settings">
                <conditional name="out">
                    <param name="format" value="-paf"/>
                    <param name="cigar_string" value="-pafm"/>
                    <param name="cs_string" value="-pafS"/>
                </conditional>
            </section>
            <output name="output" file="pafmS.paf" ftype="paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input1" value="chrM_hg38.fa.gz"/>
            <param name="input2" value="chrM_mm39.fa.gz"/>
            <section name="output_settings">
                <conditional name="out">
                    <param name="format" value="-1:output"/>
                </conditional>
            </section>
        </test>
    </tests>
    <help><![CDATA[
        
Usage: FastGA [-vkMS] [-L:<log:path>] [-T<int(8)>] [-P<dir($TMPDIR)>] [<format(-paf)>]
              [-f<int(10)>] [-c<int(85)> [-s<int(1000)>] [-l<int(100)>] [-i<float(.7)]
              <source1:path>[<precursor>] [<source2:path>[<precursor>]]

         <format> = -paf[mxsS]* | -psl | -1:<align:path>[.1aln]

         <precursor> = .gix | .1gdb | <fa_extn> | <1_extn>

             <fa_extn> = (.fa|.fna|.fasta)[.gz]
             <1_extn>  = any valid 1-code sequence file type

      -v: Verbose mode, output statistics as proceed.
      -k: Keep any generated .1gdb's and .gix's.
      -M: Use soft mask information if available.
      -S: Use symmetric seeding (not recommended).
      -L: Output log to specified file.
      -T: Number of threads to use.
      -P: Directory to use for temporary files.

      -paf: Stream PAF output
        -pafx: Stream PAF output with CIGAR string with X's
        -pafm: Stream PAF output with CIGAR string with ='s
        -pafs: Stream PAF output with CS string in short form
        -pafS: Stream PAF output with CS string in long form
        
      -psl: Stream PSL output
      -1: Generate 1-code output to specified file

      -f: adaptive seed count cutoff
      -c: minimum seed chain coverage in both genomes
      -s: threshold for starting a new seed chain
      -l: minimum alignment length
      -i: minimum alignment identity
      -S: seed adaptamers from both genomes


    ]]></help>
    <expand macro="citations" />
</tool>

<tool id="orthologer" name="orthologer" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.05">
    <description>Compute orthology</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
    ## required in order to prevent 'orthologer -c create' from printing to stderr
    export MAP_ORTHODB_DATA="/tmp" &&
    
    ## creates environment and config file
    ## -L -> maximum nr of processes in parallel
    orthologer -c create -L \${GALAXY_SLOTS} &&

    ## copy input fasta
    touch orthology_import.txt &&
    
    #import os
    #for $fasta in $fsfiles:
      #set $label=os.path.basename($fasta.element_identifier).split('.')[0]
      echo '+$label' '$fasta' >> orthology_import.txt &&
    #end for

    ## import fasta files and set project label
    ./orthologer.sh manage -f orthology_import.txt &&

    ## ensure the config file is conform
    ./orthologer.sh -t todo/orthology_import.todo -u &&
    
    ## run orthology
    echo "===> START RUN" &&
    ./orthologer.sh -r all &&
    echo "===> END OF RUN" &&
    
    ## create result
    grep -v '^#' Cluster/orthology_import.og_map > orthology.txt

    ]]></command>
    <inputs>
        <param name="fsfiles" type="data" multiple="true" format="fasta" label="Fasta file"/>
    </inputs>
    <outputs>
        <data name="orthology" label="${tool.name} on ${on_string}: computed orthology" format="txt" from_work_dir="orthology.txt"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="fsfiles" value="test-fasta/hsapi.fs,test-fasta/mputo.fs,test-fasta/mmula.fs"/>
            <output name="orthology" file="refortho.og"/>
        </test>
    </tests>
    <help><![CDATA[
    Orthologer computes orthology among a set of proteoms as given by fasta files.
    
.. class:: warningmark
    
For larger scale computations or if your computation requires fine tuning, the galaxy tool is not suitable.
Please use the tool as described at https://www.orthologer.org .

**Input data**

- A set of FASTA files with protein sequences. Each FASTA file represents one species.

**Output**

- The computed orthology.

]]></help>
<expand macro="citations" />
</tool>

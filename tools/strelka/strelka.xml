<tool id="strelka" name="strelka" version="2.9.10">
    <requirements>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[

        echo '$testcase' &> $output_stderr &&

        ## symbolic links and index files
            ln -s '$input_bam1' ./input_bam1.bam &&
            samtools index ./input_bam1.bam &&
            ln -s '$input_bam2' ./input_bam2.bam &&
            samtools index ./input_bam2.bam &&
            ln -s '$input_ref' ./input_ref.fasta &&
            samtools faidx ./input_ref.fasta && 

        ## tool: configuration
        configureStrelkaGermlineWorkflow.py
            --bam ./input_bam1.bam
            --bam ./input_bam2.bam
            --referenceFasta ./input_ref.fasta
            --runDir ./results &&

        ## tool: workflow execution
        ./results/runWorkflow.py
            -m local
            -j ${GALAXY_SLOTS:-8} 
    ]]></command>
    <inputs>
        <param argument="--bam" name="input_bam1" multiple="false" type="data" format="bam" label="Input first BAM" help=""/>
        <param argument="--bam" name="input_bam2" multiple="false" type="data" format="bam" label="Input second BAM" help=""/>
        <param argument="--referenceFasta" name="input_ref" multiple="false" type="data" format="fasta" label="Input Reference" help=""/>

        <!-- Temp -->
        <param name="testcase" type="hidden" value="strelkaSomaticDemoAnalysis"/>
    </inputs>
    <outputs>
        <data name="genome_s1" format="data" from_work_dir="results/results/variants/genome.S1.vcf.gz" label="Genome S1"/>
        <data name="genome_s2" format="data" from_work_dir="results/results/variants/genome.S2.vcf.gz" label="Genome S2"/>
        <data name="variants" format="data" from_work_dir="results/results/variants/variants.vcf.gz" label="Variants"/>
        
        <!-- Temp -->
        <data name="output_stderr" format="txt" label="stderr"/>
   </outputs>
    <tests>
        <!-- germline -->
        <test>
            <param name="testcase" value="strelkaGermlineDemoAnalysis" />
            <param name="input_bam1" value="sample1.bam" ftype="bam"/>
            <param name="input_bam2" value="sample2.bam" ftype="bam"/>
            <param name="input_ref" value="hg98.fa" ftype="fasta"/>

            <output name="output_stderr">
                <assert_contents>
                    <has_text text="strelkaGermlineDemoAnalysis" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        Help
    ]]></help>
    <citations>
        <citation type="doi">10.1038/s41592-018-0051-x</citation>
    </citations>
</tool>
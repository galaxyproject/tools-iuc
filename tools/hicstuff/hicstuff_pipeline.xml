<tool id="hicstuff_pipeline" name="hicstuff full pipeline" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" python_template_version="3.5">
    <description>generates a Hi-C contact matrix</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        hicstuff pipeline --genome $genome --outdir results $forward_reads $reverse_reads
    ]]></command>
    <inputs>
        <param type="data" name="genome" format="fasta" label="Genome fasta file"/>
        <param type="data" name="forward_reads" format="fastqsanger" label="Forward reads"/>
        <param type="data" name="reverse_reads" format="fastqsanger" label="Reverse reads"/>
    </inputs>
    <outputs>
        <data name="abs_fragments_contacts_weighted" from_work_dir="./results/abs_fragments_contacts_weighter.txt" format="tabular"/>
        <data name="fragments_list" from_work_dir="./results/fragments_list.txt" format="tabular"/>
        <data name="info_contigs" from_work_dir="./results/info_contigs.txt" format="tabular"/>
    </outputs>
    <tests>
	<test>
            <param name="genome" value="seq.fa.gz" />
            <param name="forward_reads" value="sample.reads_for.fastq.gz" />
	    <param name="reverse_reads" value="sample.reads_rev.fastq.gz" />
	    <output name="info_contigs" file="info_contigs.txt"/>
	    <assert_stderr>
		    <has_text text="Contact map generated" />
            </assert_stderr>
        </test>
    </tests>
    <help><![CDATA[

hicstuff is a toolkit to generate and manipulate Hi-C matrices. 

The "hicstuff full pipeline" tool generates a Hi-C contact matrix.
Output files can be used with instaGRAAL downstream.

-----------
Input files
-----------
* the fasta genome file
* forward reads
* reverse reads

------------
Output files
------------
* abs_fragments_contacts_weighter.txt: Sparse matrix file with 3 columns the rows, column and values of nonzero pixels. The first row contains the shape and total number of nonzero pixels in the matrix.
* fragments_list.txt: Contains genomic coordinates of the matrix bins (row/columns).
* info_contigs.txt: Contains chromosome names, theirs length and number of bins.

    ]]></help>
    <expand macro="citations" />
</tool>

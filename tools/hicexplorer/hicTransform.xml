<tool id="hicexplorer_hictransform" name="@BINARY@" version="@WRAPPER_VERSION@.0">
    <description>transforms a matrix to a obs_exp, pearson and covariance matrix</description>
    <macros>
        <token name="@BINARY@">hicTransform</token>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[

        #if str($matrix_conditional.matrix_type) == 'cool':
            ln -s $matrix_conditional.matrix_cool matrix.cool &&
            #set $matrix_name = 'matrix.cool'
        #elif str($matrix_conditional.matrix_type) == 'h5':
            ln -s $matrix_conditional.matrix_h5 matrix.h5 &&
            #set $matrix_name = 'matrix.h5'
        #end if

        hicTransform --matrix '$matrix_name'
        --method all

        #if $outputFormat == 'h5'
            --outFileName matrix.h5
        #elif $outputFormat == 'cool'
            --outFileName matrix.cool
        #end if

]]>
    </command>
    <inputs>
        <expand macro='matrix_h5_cooler' />
        <param name='outputFormat' type='select' label="Output file format">
            <option value='h5'>HiCExplorer format</option>
            <option value="cool">cool</option>
        </param>

    </inputs>
    <outputs>
        <data name="obs_exp_h5" from_work_dir="obs_exp_matrix.h5" format="h5">
            <filter>outputFormat == 'h5'</filter>
        </data>
        <data name="pearson_h5" from_work_dir="pearson_matrix.h5" format="h5">
            <filter>outputFormat == 'h5'</filter>
        </data>
        <data name="covariance_h5" from_work_dir="covariance_matrix.h5" format="h5">
            <filter>outputFormat == 'h5'</filter>
        </data>
        <data name="obs_exp_cool" from_work_dir="obs_exp_matrix.cool" format="cool">
            <filter>outputFormat == 'cool'</filter>
        </data>
        <data name="pearson_cool" from_work_dir="pearson_matrix.cool" format="cool">
            <filter>outputFormat == 'cool'</filter>
        </data>
        <data name="covariance_cool" from_work_dir="covariance_matrix.cool" format="cool">
            <filter>outputFormat == 'cool'</filter>
        </data>

    </outputs>
    <tests>
        <test>
            <conditional name="matrix_conditional">
                <param name="matrix_type" value='h5'/>
                <param name="matrix_h5" value="small_test_matrix_50kb_res.h5"/>
            </conditional>
            <param name="outputFormat" value="h5" />
            <output name="obs_exp_h5" file="obs_exp_small_50kb.h5" ftype="h5" compare="sim_size"/>
            <output name="pearson_h5" file="pearson_small_50kb.h5" ftype="h5" compare="sim_size"/>
            <output name="covariance_h5" file="covariance_small_50kb.h5" ftype="h5" compare="sim_size"/>
        </test>
        <test>
            <conditional name="matrix_conditional">
                <param name="matrix_type" value='h5'/>
                <param name="matrix_h5" value="small_test_matrix_50kb_res.h5"/>
            </conditional>
            <param name="outputFormat" value="cool" />
            <output name="obs_exp_cool" file="obs_exp_small_50kb.cool" ftype="cool" compare="sim_size"/>
            <output name="pearson_cool" file="pearson_small_50kb.cool" ftype="cool" compare="sim_size"/>
            <output name="covariance_cool" file="covariance_small_50kb.cool" ftype="cool" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
Transformation of matrix for plotting
=====================================
`hicTransform` computes three matrices: an observed/expected matrix based on it a
pearson correlation matrix and based on it a covariance matrix. These three matrices
can be used with `hicPlotMatrix` for an A / B compartment analysis.

Input
-----
- the matrix to be transformed

Parameters
__________
- Output file format: h5 or cool

Output
------
- observed/expected matrix
- pearson correlation matrix 
- covariance matrix.

| For more information about HiCExplorer please consider our documentation on readthedocs.io_

.. _readthedocs.io: http://hicexplorer.readthedocs.io/en/latest/index.html
]]></help>
    <expand macro="citations" />
</tool>

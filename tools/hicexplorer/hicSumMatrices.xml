<tool id="hicexplorer_hicsummatrices" name="@BINARY@" version="@WRAPPER_VERSION@.0">
    <description>combines Hi-C matrices of the same size</description>
    <macros>
        <token name="@BINARY@">hicSumMatrices</token>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[

        #if str($matrix_conditional.matrix_type) == 'cool':
            #for $counter, $m in enumerate($matrix_conditional.matrix_cool):
                ln -s '$m' ${counter}.cool &&
            #end for
            #set $m = '" "'.join([ '%s.cool' % $counter for $counter, $matrix in enumerate($matrix_conditional.matrix_cool) ])
            
        #elif str($matrix_conditional.matrix_type) == 'h5':
             #for $counter, $m in enumerate($matrix_conditional.matrix_h5):
                ln -s '$m' ${counter}.h5 &&
            #end for
            #set $m = '" "'.join([ '%s.h5' % $counter for $counter, $matrix in enumerate($matrix_conditional.matrix_h5) ])
            
        #end if

        hicSumMatrices
            --matrices "$m"
        #if $outputFormat == 'h5'
            --outFileName matrix.h5
        #elif $outputFormat == 'cool'
            --outFileName matrix.cool
        #end if
]]>
    </command>
    <inputs>
        <expand macro='matrix_h5_cooler_multiple'/>
        
        <param name='outputFormat' type='select' label="Output file format">
            <option value='h5'>HiCExplorer format</option>
            <option value="cool">cool</option>
        </param>
    </inputs>
    <outputs>
        <data name="outFileName_h5" from_work_dir="matrix.h5" format="h5">
            <filter>outputFormat == 'h5'</filter>
        </data>
        <data name="outFileName_cool" from_work_dir="matrix.cool" format="cool">
            <filter>outputFormat == 'cool'</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <conditional name="matrix_conditional">
                <param name="matrix_type" value='h5'/>
                <param name="matrix_h5" value="hicCorrectMatrix_result1.npz.h5,hicCorrectMatrix_result1.npz.h5"/>
            </conditional>
            <!-- <param name="matrices" value="hicCorrectMatrix_result1.npz.h5,hicCorrectMatrix_result1.npz.h5"/> -->
            <param name='outputFormat' value='h5'/>
            <output name="outFileName_h5" file="hicSumMatrices_result1.npz.h5" ftype="h5" compare="sim_size" delta="70000"/>
        </test>
    </tests>
    <help><![CDATA[
Summation of matrices
=====================

``hicSumMatrix`` is combining two (or more) contact matrices of the same size to one. 
This is useful if replicates of an Hi-C experiment should be merged into one contact matrix to 
increase the power of the data. It is the nature of Hi-C that real contact cannot be distinguished
 from noise, especially with a low contact count. The more contacts are given, the more likely it is 
 that a high number of contacts are real contact or contain at least a high amount. Therefore it is 
 a common way to merge replicates of Hi-C experiments to increase the validity of the experiment.

Input
-----

Parameters
__________
- two or matrices of the same shape.

Output
------
The summed matrix.

| For more information about HiCExplorer please consider our documentation on readthedocs.io_

.. _readthedocs.io: http://hicexplorer.readthedocs.io/en/latest/index.html
]]></help>
    <expand macro="citations" />
</tool>

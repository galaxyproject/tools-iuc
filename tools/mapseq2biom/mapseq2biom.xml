<tool id="mapseq2biom" name="mapseq2biom" version="1.0+galaxy0" profile="21.05">
    <description>creates out of the MAPseq output a tab-separated output file, also generates an output file suitable for the use with Krona</description>
    <requirements>
        <requirement type="package" version="5.26">perl</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        perl '$__tool_directory__/mapseq2biom.pl' --otuTable '$otu_table' --query '$query' --outfile '$otu_tsv' --label '$label' --taxid --notaxidfile '$otu_tsv_notaxid'
        
        #if $krona.krona:
            --krona '$krona_format';
        #end if

    ]]></command>
    <inputs>
        <param type="data" name="otu_table" format="txt" label="OTU table" help="The OTU table produced for the taxonomies found in the reference databases that was used with MAPseq" />
        <param type="data" name="query" format="txt" label="MAPseq output" help="The output from the MAPseq that assigns a taxonomy to a sequence" />
        <param type="text" name="label" label="Label to add to the top of the outfile" />
        <section name="krona" title="krona output" expanded="true">
            <param type="boolean" name="krona" label="Create file suitale for use with Krona" truevalue="true" falsevalue="false" checked="false" />
        </section>
    </inputs>
    <outputs>
        <data name="otu_tsv" format="tabular" label="output_taxIDs"/>
        <data name="otu_tsv_notaxid" format="tabular" label="output_no_taxIDs" />
        <data name="krona_format" format="tabular" label="krona_input" >
            <filter>(krona['krona'])</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="otu_table" value="test-otu" />
            <param name="query" value="test-mapseq" />
            <param name="label" value="test" />
            <section name="krona">
                <param name="krona" value="true" />
            </section>
            <output name="otu_tsv_notaxid" file="test-mapseq.tsv" />
            <output name="krona_format" file="test.txt" />
        </test>
    </tests>
    <help><![CDATA[

Options
-------
  krona    : <string>, output file name for the Krona text. (Optional).

  label    : <string>, lable to add to the top of the outfile OTU table.

  h|help   : prints this message.

Example
-------
**test.mapseq:**

# mapseq v1.2.3 (Oct  2 2018)

#query	dbhit	bitscore	identity	matches	mismatches	gaps	query_start	query_end	dbhit_start	dbhit_end	strand		ITS2

test.1	355527192	204	0.9863636493682861	217	1	2	0	218	0	220	-		sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales;f__Didymellaceae;g__Ectophoma;s__Ectophoma_multirostrata

test.2	555948006	248	0.8478803038597107	340	42	19	200	582	192	593	-		sk__Eukaryota;k__Fungi

test.4	406352048	217	0.9127272963523865	251	22	2	106	381	169	442	-		sk__Eukaryota;k__Fungi;p__

**test.otu:**

1	sk__Eukaryota;k__Fungi

2	sk__Eukaryota;k__Fungi;p__;c__;o__;f__;g__;s__uncultured_fungus

3	sk__Eukaryota;k__Fungi;p__Ascomycota

4	sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales

5	sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales;f__Astrosphaeriellaceae;g__Pithomyces

6	sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales;f__Coniothyriaceae;g__Coniothyrium

7	sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales;f__Didymellaceae

8	sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales;f__Didymellaceae;g__Ectophoma

9	sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales;f__Didymellaceae;g__Ectophoma;s__Ectophoma_multirostrata

10	sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales;f__Didymosphaeriaceae;g__Paraconiothyrium;s__Paraconiothyrium_cyclothyrioides

**output_no_taxID:**

# Constructed from biom file

# OTU ID	label	taxonomy

1	2.0	sk__Eukaryota;k__Fungi

9	1.0	sk__Eukaryota;k__Fungi;p__Ascomycota;c__Dothideomycetes;o__Pleosporales;f__Didymellaceae;g__Ectophoma;s__Ectophoma_multirostrata

**output_for_krona:**

2	sk__Eukaryota	k__Fungi

1	sk__Eukaryota	k__Fungi	p__Ascomycota	c__Dothideomycetes	o__Pleosporales	f__Didymellaceae	g__Ectophoma	s__Ectophoma_multirostrata


    ]]></help>
    <citations>
        <citation type="doi">10.1093/nar/gkac1080</citation>
    </citations>
</tool>
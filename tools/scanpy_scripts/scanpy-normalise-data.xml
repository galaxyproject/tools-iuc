<?xml version="1.0" encoding="utf-8"?>
<tool id="scanpy-normalise-data" name="Scanpy NormaliseData" version="0.0.2">
  <macros>
    <import>scanpy_macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command detect_errors="exit_code"><![CDATA[
ln -s $input_obj_file input.h5;
scanpy-normalise-data.py -i input.h5
                         -f $input_format
                         -o output.h5
                         -F $output_format
			 -s $scale_factor
#if $save_raw
                         --save-raw
#end if
]]></command>

  <inputs>
    <expand macro="input_object_params"/>
    <expand macro="output_object_params"/>
    <param name="scale_factor" type="float" label="Target number to normalise to" value="1e4"/>
    <param name="save_raw" type="boolean" checked="true"/>
  </inputs>

  <outputs>
    <data name="output_h5" format="h5" label="" from_work_dir="output.h5"/>
  </outputs>

  <tests>
    <test>
      <param name="input_obj_file" value="filter_genes.h5"/>
      <param name="input_format" value="anndata"/>
      <param name="output_format" value="anndata"/>
      <param name="scale_factor" value="1e4"/>
      <param name="save_raw" value="false"/>
      <output name="output_h5" file="normalise_data.h5" ftype="h5" compare="sim_size"/>
    </test>
  </tests>

  <help><![CDATA[
usage: scanpy-normalise-data.py [options]

optional arguments:
  -h, --help            show this help message and exit

  --debug               Print debug information.

  -i INPUT_OBJECT_FILE, --input-object-file INPUT_OBJECT_FILE
                        Path to anndata or loom file.

  -f {loom,anndata,auto-detect}, --input-format {loom,anndata,auto-detect}
                        Format for input object: loom/anndata/[auto-detect].

  -o OUTPUT_OBJECT_FILE, --output-object-file OUTPUT_OBJECT_FILE
                        File name in which to store serialized python object.

  -F {loom,anndata,auto-detect}, --output-format {loom,anndata,auto-detect}
                        Format for output object: loom/anndata/[auto-detect].

  -s SCALE_FACTOR, --scale-factor SCALE_FACTOR
                        Aimed counts per cell after normalisation, default: 1e4

  -r, --save-raw        Save raw quantification in log scale before normalisation.


]]></help>
  <expand macro="citations"/>
</tool>

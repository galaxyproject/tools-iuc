<tool id="mist_call" name="Minimap2-inferred sequence typing (MiST) call" version="@MIST_VERSION@+galaxy0" profile="21.05">
    <description>Calls alleles from a FASTA file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        mist call

        --fasta $section_input.fasta
        --sample-id "$section_input.fasta.name"
        --db $section_input.db.fields.path

        #if 'tsv' in $output_files:
            --out-tsv $out_tsv
        #end if
        #if 'json' in $output_files:
            --out-json $out_json
        #end if

        --multi $section_options.multi
        --threads \${GALAXY_SLOTS:-1}
    ]]></command>
    <inputs>
        <!-- Input files -->
        <section name="section_input" title="Input" expanded="true">
            <param argument="--fasta" type="data" format="fasta" label="Input FASTA file"/>
            <param argument="--db" type="select" label="(cg)MLST scheme">
                <options from_data_table="mist_dbs"/>
            </param>
        </section>

        <!-- Options -->
        <section name="section_options" title="Options" expanded="true">
            <param argument="--multi" type="select" label="Multi-hit strategy" help="Strategy to handle multiple perfect matches.">
                <option value="all">All</option>
                <option value="first">First</option>
                <option value="longest" selected="true">Longest</option>
            </param>
        </section>

        <!-- Output -->
        <param name="output_files" type="select" display="checkboxes" optional="true" multiple="true" label="Output files">
            <option value="json" selected="false">JSON</option>
            <option value="tsv" selected="true">Tabular (TSV)</option>
        </param>
    </inputs>
    <outputs>
        <data name="out_tsv" format="tabular" label="MiST - ${section_input.db.fields.name} on ${on_string} (TSV)">
            <filter>'tsv' in output_files</filter>
        </data>
        <data name="out_json" format="json" label="MiST - ${section_input.db.fields.name} on ${on_string} (JSON)">
            <filter>'json' in output_files</filter>
        </data>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="section_input|fasta" value="query-perfect_hits.fasta"/>
            <param name="section_input|db" value="example_scheme" />
        </test>
    </tests>
    <help><![CDATA[
        **How to run**

        1. Select a FASTA file as input
        2. Select a (cg)MLST database
        3. Run the tool

        **More information**

        More information and tutorials are available on the **MiST wiki**:
        https://github.com/BioinformaticsPlatformWIV-ISP/MiST/wiki
    ]]></help>
    <citations>
        <citation type="doi">https://doi.org/10.1186/s12864-025-12324-z</citation>
    </citations>
</tool>

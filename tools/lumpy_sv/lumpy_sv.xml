<tool id="lumpy_sv" name="LUMPY" version="@WRAPPER_VERSION@">
    <description>is a probabilistic framework for structural variant discovery</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">lumpy-sv</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[

    ln '$input_sample_file' ./sample.input.bam &&
    samtools view -h ./sample.input.bam | samblaster --excludeDups --addMateTags --maxSplitCount 2 --minNonOverlap 20 | samtools view -h -S -b - > ./sample.bam &&

    samtools view -b -F 1294 ./sample.bam > ./sample.discordants.unsorted.bam &&
    samtools view -h ./sample.bam | extractSplitReads_BwaMem -i stdin | samtools view -Sb - > ./sample.splitters.unsorted.bam &&

    samtools sort ./sample.discordants.unsorted.bam > ./sample.discordants.bam &&
    samtools sort ./sample.splitters.unsorted.bam > ./sample.splitters.bam &&

    pe_arr=(\$(samtools view -r readgroup1 ./sample.bam | tail -n+100000 | python \$CONDA_PREFIX/share/lumpy-sv-*/scripts/pairend_distro.py -r 101 -X 4 -N 10000 -o sample.lib1.histo | grep -oP '(?<=:)\w+')) &&

    lumpy
        -mw 4
        -tt 0
        -pe id:sample,bam_file:sample.discordants.bam,histo_file:sample.lib1.histo,mean:\${pe_arr[0]},stdev:\${pe_arr[1]},read_length:101,min_non_overlap:101,discordant_z:5,back_distance:10,weight:1,min_mapping_threshold:20
        -sr id:sample,bam_file:sample.splitters.bam,back_distance:10,weight:1,min_mapping_threshold:20
        > ./sample.vcf
    ]]></command>
    <inputs>
        <param name="input_sample_file" type="data" format="bam" multiple="false" label="Sample file" help="Sample file in .BAM format." />
        <param name="min_mapping_threshold" type="integer" value="1" label="min_mapping_threshold" help="" />
        <param name="back_distance" type="integer" value="1" label="back_distance" help="" />
        <param name="tt" type="integer" value="1" label="tt" help="" />
        <param name="e" type="integer" value="1" label="e" help="" />
        <param name="discordant_z" type="integer" value="1" label="discordant_z" help="" />
        <param name="mw" type="integer" value="1" label="mw" help="" />
        <param name="read_legth" type="integer" value="101" label="Read length" help="" />
    </inputs>
    <outputs>
        <data name="out_sample" format="bam" label="${tool.name} on ${on_string}: sample" from_work_dir="sample.bam" />
    </outputs>
    <tests>
    </tests>
    <help><![CDATA[
LUMPY
=============

A probabilistic framework for structural variant discovery.

For more information see the LUMPY documentation_.

.. _documentation: https://github.com/arq5x/lumpy-sv

    ]]></help>
     <citations>
         <citation type="doi">10.1186/gb-2014-15-6-r84</citation>
    </citations>
</tool>

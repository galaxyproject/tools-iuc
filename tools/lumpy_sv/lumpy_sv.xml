<tool id="lumpy_sv" name="LUMPY" version="@WRAPPER_VERSION@">
    <description>is a probabilistic framework for structural variant discovery</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">lumpy-sv</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[

    ln '$input_sample_file' ./sample.input.bam &&
    samtools collate -O --output-fmt sam ./sample.input.bam | samblaster --excludeDups --addMateTags --maxSplitCount 2 --minNonOverlap 20 | samtools view -h -S -b - > ./sample.bam &&

    samtools view -b -F 1294 ./sample.bam > ./sample.discordants.unsorted.bam &&
    samtools view -h ./sample.bam | extractSplitReads_BwaMem -i stdin | samtools view -Sb - > ./sample.splitters.unsorted.bam &&

    samtools sort ./sample.discordants.unsorted.bam > ./sample.discordants.bam &&
    samtools sort ./sample.splitters.unsorted.bam > ./sample.splitters.bam &&

    pe_var=\$(samtools view -r id1 ./sample.bam | tail -n+'$stat_tail_n' | python \$CONDA_PREFIX/share/lumpy-sv-*/scripts/pairend_distro.py -r '$read_legth' -X 4 -N 10000 -o sample.lib1.histo | tr '\t' ',') &&

    lumpy
        -mw '$mw'
        -tt '$tt'
        #if $e:
        -e
        #end if
        -pe id:sample1,bam_file:sample.discordants.bam,histo_file:sample.lib1.histo,\${pe_var},read_length:'$read_legth',min_non_overlap:101,discordant_z:'$discordant_z',back_distance:'$back_distance',weight:'$weight',min_mapping_threshold:'$min_mapping_threshold'
        -sr id:sample1,bam_file:sample.splitters.bam,back_distance:'$back_distance',weight:'$weight',min_mapping_threshold:'$min_mapping_threshold'
        > ./sample.vcf
    ]]></command>
    <inputs>
        <param name="input_sample_file" type="data" format="bam" multiple="false" label="Sample file" help="Sample file in .BAM format." />
        <param name="min_mapping_threshold" type="integer" value="20" label="min_mapping_threshold" help="" />
        <param name="back_distance" type="integer" value="10" label="back_distance" help="" />
        <param name="tt" type="integer" value="0" label="tt" help="" />
        <param name="discordant_z" type="integer" value="5" label="discordant_z" help="" />
        <param name="mw" type="integer" value="4" label="mw" help="" />
        <param name="weight" type="integer" value="1" label="sample weight" help="" />
        <param name="read_legth" type="integer" value="101" label="Read length" help="" />
        <param name="stat_tail_n" type="integer" value="100000" label="TAIL" help="" />
        <param name="e" type="boolean" checked="true" label="Show evidence for each call" help="" />
    </inputs>
    <outputs>
        <data name="out_sample" format="vcf" label="${tool.name} on ${on_string}: sample" from_work_dir="sample.vcf" />
    </outputs>
    <tests>
    </tests>
    <help><![CDATA[
LUMPY
=============

A probabilistic framework for structural variant discovery.

For more information see the LUMPY documentation_.

.. _documentation: https://github.com/arq5x/lumpy-sv

    ]]></help>
     <citations>
         <citation type="doi">10.1186/gb-2014-15-6-r84</citation>
    </citations>
</tool>

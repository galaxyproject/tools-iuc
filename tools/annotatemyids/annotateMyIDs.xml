<tool id="annotateMyIDs" name="annotateMyIDs" version="0.3">
    <description>Will annotate a generic set of identifiers</description>
    <requirements>
        <requirement type="package" version="3.3.0">bioconductor-org.hs.eg.db</requirement>
        <requirement type="package" version="3.4.0">bioconductor-org.mm.eg.db</requirement>
        <requirement type="package" version="3.4.0">bioconductor-org.dm.eg.db</requirement>
        <requirement type="package" version="3.4.1">bioconductor-org.dr.eg.db</requirement>
        <requirement type="package" version="1.3.2">r-optparse</requirement>
    </requirements>
    <stdio>
        <regex match="Execution halted"
               source="both"
               level="fatal"
               description="Execution halted." />
        <regex match="Error in"
               source="both"
               level="fatal"
               description="An undefined error occured, please check your input carefully and contact your administrator." />
        <regex match="Fatal error"
               source="both"
               level="fatal"
               description="An undefined error occured, please check your input carefully and contact your administrator." />
    </stdio>
    <version_command><![CDATA[
echo $(R --version | grep version | grep -v GNU)", org.Hs.eg.db version" $(R --vanilla --slave -e "library(org.Hs.eg.db); cat(sessionInfo()\$otherPkgs\$org.Hs.eg.db\$Version)" 2> /dev/null | grep -v -i "WARNING: ")", org.Dr.eg.db version" $(R --vanilla --slave -e "library(org.Dr.eg.db); cat(sessionInfo()\$otherPkgs\$org.Dr.eg.db\$Version)" 2> /dev/null | grep -v -i "WARNING: ")", org.Dm.eg.db version" $(R --vanilla --slave -e "library(org.Dm.eg.db); cat(sessionInfo()\$otherPkgs\$org.Dm.eg.db\$Version)" 2> /dev/null | grep -v -i "WARNING: ")", org.Mm.eg.db version" $(R --vanilla --slave -e "library(org.Mm.eg.db); cat(sessionInfo()\$otherPkgs\$org.Mm.eg.db\$Version)" 2> /dev/null | grep -v -i "WARNING: ")", optparse version" $(R --vanilla --slave -e "library(optparse); cat(sessionInfo()\$otherPkgs\$optparse\$Version)" 2> /dev/null | grep -v -i "WARNING: ")
    ]]></version_command>
    <command><![CDATA[
        Rscript '$__tool_directory__/annotateMyIDs.r' --id_file '$id_file'
        --out_tab '$out_tab'
        --id_type '$id_type'
        --file_has_header '$file_has_header'
        --organism '$organism'
        --include_go '$include_go'
        --include_kegg '$include_kegg'
    ]]></command>
    <inputs>
        <param name="id_file" type="data" format="tabular" label="File with identifiers to be annotated" help="A tabular file with IDs in the first column." />
        <param name="organism" type="select" label="What organism?">
            <option value="hs" selected="true">Human</option>
            <option value="mm">Mouse</option>
            <option value="dm">Fruit fly</option>
            <option value="dr">Zebrafish</option>
        </param>
        <param name="id_type" type="select" label="What type of identifiers are in your file?">
            <option value="ENSEMBL" selected="true">Ensembl</option>
            <option value="ENTREZID">Entrez ID</option>
            <option value="REFSEQ">RefSeq</option>
            <option value="SYMBOL">Gene Symbol</option>
            <option value="GO">GO</option>
            <option value="MAP">KEGG</option>
        </param>
        <param name="file_has_header" type="boolean" label="Does the input ranked gene list have a header line?" help="If this option is set to TRUE, the tool will assume that the ranked gene-list has a column heading and the gene names commence on the second line" />
        <param name="include_go" type="boolean" label="Include GO?" help="If this option is set to TRUE, GO IDs will be included in the output. This could make the table rather large as some genes may be associated with many GO terms" />
        <param name="include_kegg" type="boolean" label="Include KEGG?" help="If this option is set to TRUE, KEGG IDs will be included in the output. This could make the table rather large as some genes may be associated with many KEGG terms" />
    </inputs>
    <outputs>
        <data name="out_tab" format="tabular" label="Annotation for your IDs" />
    </outputs>
    <tests>
        <test><!-- Ensure gene symbols input works -->
            <param name="id_file" value="genelist.txt" ftype="tabular"/>
            <param name="id_type" value="SYMBOL"/>
            <param name="organism" value="hs"/>
            <output name="out_tab" file="out.tab" />
        </test>
        <test><!-- Ensure Ensembl ids input works -->
            <param name="id_file" value="ensembl_ids.tab" ftype="tabular"/>
            <param name="id_type" value="ENSEMBL"/>
            <param name="organism" value="hs"/>
            <output name="out_tab" file="out_ensembl.tab" />
        </test>
    </tests>
    <help><![CDATA[

.. class:: infomark

**What it does**

A generic tool to get genomic annotation for a generic set of IDs, using the Bioconductor annotation data packages. Supported organisms are human, mouse, fruit fly and zebrafish.

**Inputs**

A tab-delimited file with identifiers in the first column. Supported identifiers are Ensembl, Entrez ID, RefSeq, Gene Symbol, GO and KEGG.

**Outputs**

A tab-delimited file containing the columns below. Optionally, GO and KEGG terms can be selected to be output, and will be added as additional columns.

Example:

=============== ============ ========== =================================
**ENSEMBL**     **ENTREZID** **SYMBOL** **GENENAME**
--------------- ------------ ---------- ---------------------------------
ENSG00000091831  2099        ESR1       estrogen receptor 1
ENSG00000082175  5241        PGR        progesterone receptor
ENSG00000141736  2064        ERBB2      erb-b2 receptor tyrosine kinase 2
ENSG00000012048  672         BRCA1      breast cancer 1
ENSG00000139618  675         BRCA2      breast cancer 2
ENSG00000129514  3169        FOXA1      forkhead box A1
ENSG00000171862  5728        PTEN       phosphatase and tensin homolog
ENSG00000141510  7157        TP53       tumor protein p53
=============== ============ ========== =================================

    ]]></help>
        <citations>
            <citation type="bibtex">
                @unpublished{None,
                author = {Mark Dunning},
                title = {annotateMyIDs},
                year = {2017},
                eprint = {None},
                url = {}
         }</citation>
    </citations>
</tool>

<tool id="chewbbaca_allelecallevaluator" name="chewBBACA AlleleCallEvaluator" version="@CHEW_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Build an interactive report for allele calling results evaluation</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir './input' &&
        mkdir './schema' &&
        #for $file in $input_file
        ln -sf $file './input/${file.element_identifier}' &&
        #end for
        unzip $input_schema -d './schema' &&
        chewBBACA.py AlleleCallEvaluator
            #if $annotations:
                -a $annotations
            #end if
            $light
            $no_pa
            $no_dm
            $no_tree
            $cg_alignment
            -i './input' -g './schema/schema_seed/' -o '${allelecall_report.files_path}' &&
        cp '${allelecall_report.files_path}/allelecall_report.html' '$allelecall_report'
    ]]></command>
    <inputs>
        <param name="input_file" type="data_collection" collection_type="list" label="AlleleCall Results" format="tabular"/>
        <param name="input_schema" format="zip" type="data" label="Schema Files in zip format" help="The schema directory contains the loci FASTA files and a folder named 'short' that contains the FASTA files with the loci representative alleles."/>
        <section name="advanced" title="Advanced options">
            <param argument="--annotations" type="data" format="tabular" label="Annotation file" help="File created by the UniprotFinder module" optional="true" />
            <param argument="--light" type="boolean" truevalue="--light" falsevalue="" checked="false" label="Do not compute the presence-absence matrix, the distance matrix,  and the Neighbor-Joining tree." />
            <param argument="--no-pa" type="boolean" truevalue="--no-pa " falsevalue="" checked="false" label="Do not compute the presence-absence matrix" />
            <param argument="--no-dm" type="boolean" truevalue="--no-dm " falsevalue="" checked="false" label="Do not compute the distance matrix" />
            <param argument="--no-tree" type="boolean" truevalue="--no-tree " falsevalue="" checked="false" label="Do not compute the Neighbor-Joining tree" />
            <param argument="--cg-alignment" type="boolean" truevalue="--cg-alignment " falsevalue="" checked="false" label="Compute the MSA of the core genome loci, even if `--no-tree` is provided" />
        </section>
    </inputs>
    <outputs>
        <data format="html" name="allelecall_report" label="${tool.name} on ${on_string}: AlleleCall Report"/>
    </outputs>
    <tests>
        <test>
            <param name="input_file">
                <collection type="list">
                    <element name="cds_coordinates.tsv" value="cds_coordinates.tsv" ftype="tabular"/>
                    <element name="loci_summary_stats.tsv" value="loci_summary_stats.tsv" ftype="tabular"/>
                    <element name="results_alleles.tsv" value="results_alleles.tsv" ftype="tabular"/>
                    <element name="results_statistics.tsv" value="results_statistics.tsv" ftype="tabular"/>
                </collection>
            </param>
            <param name="input_schema" value="GCA_000007265.1_ASM726v1_schema_seed.zip"/>
            <output name="allelecall_report" file="allelecall_report.html" compare="sim_size"/>
        </test>
        <test>
            <param name="input_file">
                <collection type="list">
                    <element name="cds_coordinates.tsv" value="cds_coordinates.tsv" ftype="tabular"/>
                    <element name="loci_summary_stats.tsv" value="loci_summary_stats.tsv" ftype="tabular"/>
                    <element name="results_alleles.tsv" value="results_alleles.tsv" ftype="tabular"/>
                    <element name="results_statistics.tsv" value="results_statistics.tsv" ftype="tabular"/>
                </collection>
            </param>
            <param name="input_schema" value="GCA_000007265.1_ASM726v1_schema_seed.zip"/>
            <param name="annotations" value="schema_seed_annotations.tsv"/>
            <output name="allelecall_report" file="allelecall_report_annot.html" compare="sim_size"/>
        </test>
    </tests>
    <help>
chewBBACA is a software suite for the creation and evaluation of core genome and whole genome MultiLocus Sequence Typing (cg/wgMLST) schemas and results.

The AlleleCallEvaluator module allows users to generate an interactive HTML report to evaluate allele calling results generated by the AlleleCall module. The report provides summary statistics to evaluate results per sample and per locus (with the possibility to provide a TSV file with loci annotations to include on a table). The report includes components to display a heatmap representing the loci presence-absence matrix, a heatmap representing the distance matrix based on allelic differences and a Neighbor-Joining (NJ) tree based on the MSA of the core genome loci.

.. class:: infomark

**Note**

You have to uncompress the archive and open the HTML file with a browser.

.. class:: warningmark

**Warning**

The JS bundle is necessary to visualize the HTML report. Do not move or delete this file.

    </help>
    <expand macro="citations" />
</tool>
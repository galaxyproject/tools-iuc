<tool id="AlleleCallEvaluator" name="chewBBACA AlleleCallEvaluator" version="@CHEW_VERSION@+galaxy0" python_template_version="3.5" profile="21.05">
    <description>Build an interactive report for allele calling results evaluation</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir './input' &&
        mkdir './schema' &&
        #for $file in $input_file
        cp $file './input/${file.element_identifier}' &&
        #end for
        unzip $input_schema -d './schema' &&
        chewBBACA.py AlleleCallEvaluator
            #if str($annotations) != 'None'
                -a $annotations
            #end if
            $light
            $no_pa
            $no_dm
            $no_tree
            $cg_alignment
            -i './input' -g './schema/schema_seed/' -o './output'
    ]]></command>
    <inputs>
        <param name="input_file" type="data_collection" collection_type="list" label="AlleleCall Results" format="tabular"/>
        <param name="input_schema" format="zip" type="data" multiple="true" label="Schema Files in zip format" help="The schema directory contains the loci FASTA files and a folder named 'short' that contains the FASTA files with the loci representative alleles."/>
        <section name="advanced" title="Advanced options">
            <param argument="--annotations" type="data" format="tabular" label="Annotation file" help="File created by the UniprotFinder module" optional="true" />
            <param argument="--light" type="boolean" truevalue="--light" falsevalue="" checked="false" label="Do not compute the presence-absence matrix, the distance matrix  and the Neighbor-Joining tree." />
            <param argument="--no-pa" type="boolean" truevalue="--no-pa " falsevalue="" checked="false" label="Do not compute the presence-absence matrix" />
            <param argument="--no-dm" type="boolean" truevalue="--no-dm " falsevalue="" checked="false" label="Do not compute the distance matrix" />
            <param argument="--no-tree" type="boolean" truevalue="--no-tree " falsevalue="" checked="false" label="Do not compute the Neighbor-Joining tree" />
            <param argument="--cg-alignment" type="boolean" truevalue="--cg-alignment " falsevalue="" checked="false" label="Compute the MSA of the core genome loci, even if `--no-tree` is provided" />
        </section>
    </inputs>
    <outputs>
        <data format="html" name="allelecall_report" from_work_dir="output/allelecall_report.html" label="${tool.name} on ${on_string}: AlleleCall Report"/>
    </outputs>
    <tests>
        <test>
            <param name="input_file">
                <collection type="list">
                    <element name="cds_coordinates.tsv" value="cds_coordinates.tsv" ftype="tabular"/>
                    <element name="loci_summary_stats.tsv" value="loci_summary_stats.tsv" ftype="tabular"/>
                    <element name="results_alleles.tsv" value="results_alleles.tsv" ftype="tabular"/>
                    <element name="results_statistics.tsv" value="results_statistics.tsv" ftype="tabular"/>
                </collection>
            </param>
            <param name="input_schema" value="GCA_000007265.1_ASM726v1_schema_seed.zip"/>
            <output name="allelecall_report" file="allelecall_report.html" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
chewBBACA version: 3.3.3
Authors: Rafael Mamede, Pedro Cerqueira, Mickael Silva, João Carriço, Mário Ramirez
Github: https://github.com/B-UMMI/chewBBACA
Documentation: https://chewbbaca.readthedocs.io/en/latest/index.html
Contacts: imm-bioinfo@medicina.ulisboa.pt

===================================
  chewBBACA - AlleleCallEvaluator
===================================

  -i, --input-files INPUT_FILES            Path to the directory that contains the allele calling
                                           results. (default: None)
                                           
  -g, --schema-directory SCHEMA_DIRECTORY  Path to the schema directory. (default: None)
                                           
  -o, --output-directory OUTPUT_DIRECTORY  Path to the output directory where the report HTML files
                                           will be generated. (default: None)
                                           
  -a, --annotations ANNOTATIONS            Path to the TSV file created by the UniprotFinder module.
                                           (default: None)
                                           
  --light                                  Do not compute the presence-absence matrix, the distance
                                           matrix and the Neighbor-Joining tree. (default: False)
                                           
  --no-pa                                  Do not compute the presence-absence matrix. (default:
                                           False)
                                           
  --no-dm                                  Do not compute the distance matrix. (default: False)
                                           
  --no-tree                                Do not compute the Neighbor-Joining tree. (default:
                                           False)
                                           
  --cg-alignment                           Compute the MSA of the core genome loci, even if --no-
                                           tree is provided. (default: False)

    ]]></help>
    <expand macro="citations" />
</tool>
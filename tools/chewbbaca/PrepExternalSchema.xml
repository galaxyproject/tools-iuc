<tool id="PrepExternalSchema" name="chewBBACA PrepExternalSchema" version="@CHEW_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Adapt an external schema to be used with chewBBACA</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir './schema' &&
        unzip '$input_schema' -d './schema' &&
        chewBBACA.py PrepExternalSchema
            #if str($training_file) != 'None'
                --ptf '$training_file'
            #end if            
            --bsr $blast_score_ratio
            --l $minimum_length
            --t $translation_table
            --st $size_threshold
            $size_filter
            -g './schema/schema_seed/' -o './schema_seed' &&
        zip -r PExternalschema_seed.zip './schema_seed'
    ]]></command>
    <inputs>
        <param format="zip" name="input_schema" type="data" multiple="true" label="Schema Files in zip format" help="The schema directory contains the loci FASTA files and a folder named 'short' that contains the FASTA files with the loci representative alleles."/>
        <section name="advanced" title="Advanced options">
            <param argument="--training-file" type="data" format="binary" label="Prodigal training file" optional="true" />
            <param argument="--blast-score-ratio" type="float" min="0.0" max="1.0" value="0.6" label="BLAST Score Ratio value" /> 
            <param argument="--minimum-length" type="integer" min="0" value="0" label="Minimum sequence length value"/>
            <param argument="--translation-table" type="integer" min="0" value="11" label="Genetic code used to predict genes and to translate coding sequences"/>
            <param argument="--size-threshold" type="float" min="0" value="0.2" label="CDS size variation threshold"/>
            <param argument="--size-filter" type="boolean" truevalue="--size-filter" falsevalue="" checked="false" label="Size filter" help="Apply the minimum length and size threshold values to filter out alleles during schema adaptation" />
        </section>
    </inputs>
    <outputs>
        <data format="zip" name="schema" from_work_dir="PExternalschema_seed.zip" label="${tool.name} on ${on_string}: PrepExternal Schema files"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_schema" value="GCA_000007265.1_ASM726v1_schema_seed.zip"/>
            <param name="size_filter" value="false"/>
            <output name="schema" file="GCA_000007265.1_ASM726v1_PExternalschema_seed.zip" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[

        --ptf, --training-file     (Optional) Path to the Prodigal training file that will be included in
                                the adapted schema (default: None).

        --bsr, --blast-score-ratio (Optional) The BLAST Score Ratio value that will be used to adapt
                                the external schema (default: 0.6).

        --l, --minimum-length      (Optional) Minimum sequence length accepted. Sequences with a length
                                value smaller than the value passed to this argument will be discarded
                                (default: 0).

        --t, --translation-table   (Optional) Genetic code to use for CDS translation. Must match the
                                genetic code used to create the training file (default: 11).

        --st, --size-threshold     (Optional) CDS size variation threshold. At the default value of
                                0.2, alleles with size variation +-20 percent when compared to the
                                representative will not be included in the final schema (default:
                                0.2).

        --size-filter              (Optional) Apply the minimum length and size threshold values to
                                filter out alleles during schema adaptation (default: False).
    ]]></help>
    <expand macro="citations" />
</tool>
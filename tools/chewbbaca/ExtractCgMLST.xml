<tool id="ExtractCgMLST" name="chewBBACA ExtractCgMLST" version="@CHEW_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Determine the set of loci that constitute the core genome</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir './input' &&
        #for $file in $input_file
        ln -sf $file './input/${file.element_identifier}.tsv' &&
        #end for
        chewBBACA.py ExtractCgMLST
        --t $threshold
        #if str($genes2remove) != 'false'
            --r './input/paralogous_counts.tsv'
        #end if 
        #if str($genomes2remove) != 'None'
            --g $genomes2remove
        #end if 
        -i './input/results_alleles.tsv' -o './output' &&
    zip -r ExtractCgMLST.zip './output'
    ]]></command>
    <inputs>
        <param name="input_file" type="data_collection" collection_type="list" label="AlleleCall Results" format="tabular"/>
        <section name="advanced" title="Advanced options">
            <param argument="--genomes2remove" type="data" format="txt" label="Genomes/rows to remove from the matrix" optional="true" help="One genome identifier per line"/>
            <param argument="--threshold" type="text" value="0.95 0.99 1" label="threshold" help="Genes that constitute the core genome must be in a proportion of genomes that is at least equal to this value. Users can provide multiple values">
                <validator type="regex">[ .0-9]+</validator>
            </param>
            <param name="genes2remove" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Remove paralogous counts?" help="the list of genes listed in the &quot;paralogous_counts.tsv&quot; file created by the AlleleCall process. --genes2remove"/>
        </section>
    </inputs>
    <outputs>
        <data format="zip" name="ExtractCgMLST" from_work_dir="ExtractCgMLST.zip" label="${tool.name} on ${on_string}: ExtractCgMLST files"/>
    </outputs>
    <tests>
        <test>
            <param name="input_file">
                <collection type="list">
                    <element name="results_alleles" value="results_alleles.tsv" ftype="tabular"/>
                </collection>
            </param>
            <output name="ExtractCgMLST" file="ExtractCgMLST.zip" compare="sim_size"/>
        </test>
    </tests>
    <help>
chewBBACA is a software suite for the creation and evaluation of core genome and whole genome MultiLocus Sequence Typing (cg/wgMLST) schemas and results.

cgMLST schemas are defined as the set of loci that are present in all strains under analysis or, due to sequencing/assembly limitations, >95% of strains analyzed. In order to have a robust definition of a cgMLST schema for a given bacterial species, a set of representative strains of the diversity of a given species should be selected. 

.. class:: infomark

**Note**

The user can define a **space-separated** list of values for --threshold
    </help>
    <expand macro="citations" />
</tool>
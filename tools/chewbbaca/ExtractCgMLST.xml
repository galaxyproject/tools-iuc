<tool id="ExtractCgMLST" name="chewBBACA ExtractCgMLST" version="@CHEW_VERSION@+galaxy0" python_template_version="3.5" profile="21.05">
    <description>Determine the set of loci that constitute the core genome</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir './input' &&
        #for $file in $input_file
        cp $file './input/${file.element_identifier}' &&
        #end for
        chewBBACA.py ExtractCgMLST
        --t $threshold
        #if str($genes2remove) != 'false'
            --r './input/paralogous_counts.tsv'
        #end if 
        #if str($genomes2remove) != 'None'
            --g $genomes2remove
        #end if 
        -i './input/results_alleles.tsv' -o './output' &&
    zip -r ExtractCgMLST.zip './output'
    ]]></command>
    <inputs>
        <param name="input_file" type="data_collection" collection_type="list" label="AlleleCall Results" format="tabular"/>
        <section name="advanced" title="Advanced options">
            <param argument="--genomes2remove" type="data" format="txt" label="Genomes/rows to remove from the matrix" optional="true" help="One genome identifier per line"/>
            <param argument="--threshold" type="text" value="0.95 0.99 1" label="threshold" help="Genes that constitute the core genome must be in a proportion of genomes that is at least equal to this value. Users can provide multiple values">
                <validator type="regex">[ .0-9]+</validator>
            </param>
            <param name="genes2remove" type="boolean" truevalue="true" falsevalue="false" checked="false" label="Remove paralogous counts?" help="--genes2remove"/>
        </section>
    </inputs>
    <outputs>
        <data format="zip" name="ExtractCgMLST" from_work_dir="ExtractCgMLST.zip" label="${tool.name} on ${on_string}: ExtractCgMLST files"/>
    </outputs>
    <tests>
        <test>
            <param name="input_file">
                <collection type="list">
                    <element name="results_alleles.tsv" value="results_alleles.tsv" ftype="tabular"/>
                </collection>
            </param>
            <output name="ExtractCgMLST" file="ExtractCgMLST.zip" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
chewBBACA version: 3.3.3
Authors: Rafael Mamede, Pedro Cerqueira, Mickael Silva, João Carriço, Mário Ramirez
Github: https://github.com/B-UMMI/chewBBACA
Documentation: https://chewbbaca.readthedocs.io/en/latest/index.html
Contacts: imm-bioinfo@medicina.ulisboa.pt

=============================
  chewBBACA - ExtractCgMLST
=============================
  --t, --threshold THRESHOLD [THRESHOLD ...]  Genes that constitute the core genome must be in a
                                              proportion of genomes that is at least equal to this
                                              value. Users can provide multiple values. (default:
                                              [0.95, 0.99, 1])

  --r, --genes2remove GENES2REMOVE            Path to file with a list of genes/columns to remove
                                              from the matrix (one gene identifier per line).
                                              (default: False)
                                              
  --g, --genomes2remove GENOMES2REMOVE        Path to file with a list of genomes/rows to remove
                                              from the matrix (one genome identifier per line).
                                              (default: False)

    ]]></help>
    <expand macro="citations" />
</tool>
<tool id="CreateSchema" name="chewBBACA CreateSchema" version="@CHEW_VERSION@+galaxy0" python_template_version="3.5" profile="21.05">
    <description>Create a gene-by-gene schema</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        mkdir ./input &&
        #for $file in $input_file
        cp $file ./input/${file.element_identifier} &&
        #end for
        chewBBACA.py CreateSchema 
            #if str($advanced.training_file) != 'None'
                --ptf '$advanced.training_file'
            #end if
            --bsr $blast_score_ratio
            --l $minimum_length
            --t $translation_table
            --st $size_threshold
            --pm $prodigal_mode
            -i ./input -o ./output &&
        cd output/ &&
        zip -r schema_seed.zip ./schema_seed
    ]]></command>
    <inputs>
        <param format="fasta" name="input_file" type="data" multiple="True" label="Genome assemblies in FASTA format"/>
        <section name="advanced" title="Advanced options">
            <param argument="--training_file" type="data" format="binary" label="Prodigal training file" optional="true" />
            <param argument="--blast_score_ratio" type="float" min="0.0" max="1.0" value="0.6" label="BLAST Score Ratio value" /> 
            <param argument="--minimum_length" type="integer" min="1" value="201" label="Minimum sequence length value"/>
            <param argument="--translation_table" type="integer" min="0" value="11" label="Genetic code used to predict genes and to translate coding sequences"/>
            <param argument="--size_threshold" type="float" min="0" value="0.2" label="CDS size variation threshold"/>
            <param argument="--prodigal_mode" type="select" label="Prodigal Mode" help="single for finished genomes, reasonable quality draft genomes and big viruses. meta for metagenomes, low quality draft genomes, small viruses, and small plasmids">
                <option value="single" selected="true">
                        single
                    </option>
                    <option value="meta">
                        meta
                    </option>
            </param>
        </section>
        <section name="output" title="Output options">
            <param name="show_cds_invalid" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Output invalid CDS file?"/>
            <param name="show_cds_coord" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Output CDS coordinates File?"/>
        </section>
    </inputs>
    <outputs>
        <data format="zip" name="schema" from_work_dir="output/schema_seed.zip" label="${tool.name} on ${on_string}: Schema files"/>
        <data format="txt" name="txt_file" from_work_dir="output/invalid_cds.txt" label="${tool.name} on ${on_string}: invalid CDS">
            <filter>output['show_cds_invalid']</filter>
        </data>
        <data format="tsv" name="tst_file" from_work_dir="output/cds_coordinates.tsv" label="${tool.name} on ${on_string}: CDS coordinates">
            <filter>output['show_cds_coord']</filter>
        </data>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
        <param name="input_file" value="GCA_000007265.1_ASM726v1_genomic.fna"/>
        <output name="schema" file="GCA_000007265.1_ASM726v1_schema_seed.zip"/>
        </test>
    </tests>
    <help><![CDATA[
chewBBACA version: 3.3.3
Authors: Rafael Mamede, Pedro Cerqueira, Mickael Silva, João Carriço, Mário Ramirez
Github: https://github.com/B-UMMI/chewBBACA
Documentation: https://chewbbaca.readthedocs.io/en/latest/index.html
Contacts: imm-bioinfo@medicina.ulisboa.pt

============================
chewBBACA - CreateSchema
============================
usage: 
Create schema from genome assemblies.

positional arguments:
CreateSchema

options:

-i, --input-files [INPUT_FILES]               Path to the directory that contains the input FASTA
                                                files. Alternatively, a file with a list of full
                                                paths to FASTA files, one per line. (default: None)
                                                
-o, --output-directory OUTPUT_DIRECTORY       Output directory where the process will store
                                                intermediate files and create the schema's
                                                directory. (default: None)
                                                
--ptf, --training-file PTF_PATH               Path to the Prodigal training file. (default: None)
                                                
--bsr, --blast-score-ratio BLAST_SCORE_RATIO  BLAST Score Ratio value. Sequences with alignments
                                                with a BSR value equal to or greater than this value
                                                will be considered as sequences from the same gene.
                                                (default: 0.6)
                                                
--l, --minimum-length MINIMUM_LENGTH          Minimum sequence length value. Coding sequences
                                                shorter than this value are excluded. (default: 201)
                                                
--t, --translation-table TRANSLATION_TABLE    Genetic code used to predict genes and to translate
                                                coding sequences. (default: 11)
                                                
--st, --size-threshold SIZE_THRESHOLD         CDS size variation threshold. Added to the schema's
                                                config file and used to identify alleles with a
                                                length value that deviates from the locus length
                                                mode during the allele calling process. (default:
                                                0.2)
                                                
--pm, --prodigal-mode {single,meta}           Prodigal running mode ("single" for finished
                                                genomes, reasonable quality draft genomes and big
                                                viruses. "meta" for metagenomes, low quality draft
                                                genomes, small viruses, and small plasmids).
                                                (default: single)
                                                

It is strongly advised to provide a training file to create a schema. Module documentation available
at https://chewbbaca.readthedocs.io/en/latest/user/modules/CreateSchema.html
        ]]>
    </help>
    <expand macro="citations" />
</tool>
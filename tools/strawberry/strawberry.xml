<tool id='strawberry' name='Strawberry' version='@TOOL_VERSION@+galaxy@VERSION_SUFFIX@' profile='20.01'>
    <description>genome-guided transcript-level assembler and quantification</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro='xrefs' />
    <expand macro='requirements' />
    <command detect_errors='exit_code'><![CDATA[
    /home/strawberry/bin/strawberry $mode_conditional.mode_options
    #if $GTF
        --GTF '${GTF}'
    #end if
    --min-exon-cov $min_exon_cov
    --min-mapping-qual $min_mapping_qual
    $strand_type
    --max-junction-splice-size $max_junction_splice_size
    --min-junction-splice-size $min_junction_splice_size
    --min-isoform-frac $min_isoform_frac
    $allow_multimapped_hits
    #if $mode_conditional == ''
        @ASSEMBLY_PARAMETERS@
        @QUANTIFICATION_PARAMETERS@
    #elif $mode_conditional == '--no-assembly'
        @QUANTIFICATION_PARAMETERS@
    #else
        @ASSEMBLY_PARAMETERS@
    #end if
    --output-gtf output.gtf
    --num-threads \${GALAXY_SLOTS:-2}
    $bam_file
    && ls -lah
    ]]>    </command>
    <inputs>
        <param name="bam_file" type="data" format="bam" label="BAM file" help="This step can be done using any splice-awareness aligner, e.g. Tophat 2, GSNAP, HISAT 2. 
            The BAM file needs to be sorted according to the genomic positions. If you use Tophat, the default output is already sorted. For other software, you might 
            have to sort their outputs before running Strawberry. This can be done using Samtools command samtools sort. Strawberry is designed for Illumina pair-end reads." />
        <param argument="--GTF" type="data" format="gff3,gtf" optional="true" label="Reference transcripts annotation file" help="Current support gff3 and gtf format."/>
        <param argument="--min-exon-cov" type="float" min="0" max="1" value="1" label="Min exon coverage" help="Minimum exon coverage" />
        <param argument="--min-mapping-qual" type="integer" min="0" value="0" label="Min mapping quality" help="Minimum mapping quality to be included in the analysis" />
        <param name="strand_type" type="select" label="Specify the type of library">
            <option value="">Disabled</option>
            <option value="--fr">FR-secondstrand</option>
            <option value="--rf">RF-firststrand</option>
        </param>
        <param argument="--max-junction-splice-size" type="integer" min="0" value="300000" label="Max junction splice size" help="Maximum spliced junction" />
        <param argument="--min-junction-splice-size" type="integer" min="0" value="20" label="Min junction splice size" help="Minimum spliced junction size" />
        <param argument="--min-isoform-frac" type="float" min="0" max="1" value="0.01" label="Min isoform fraction" help="Minimum isoform fraction" />
        <param argument="--allow-multimapped-hits" type="boolean" truevalue="--allow-multimapped-hits" falsevalue="" label="Allow multimapped hits" help="By default, Strawberry only use reads which map to unique position in the genome" />
        <param argument="--logfile" type="boolean" truevalue="--logfile" falsevalue="" label="Generate log file"/>
        <conditional name="mode_conditional">
            <param name="mode_options" type="select" label="Mode options">
                <option value="">Assembly and quantification mode</option>
                <option value="--no-assembly">Quantification mode</option>
                <option value="--no-quant">Assembly mode</option>
            </param>
            <when value="">
                <expand macro="assembly_parameters"/>
                <expand macro="quantification_parameters"/>
            </when>
            <when value="--no-quant">
                <expand macro="assembly_parameters"/>
            </when>
            <when value="--no-assembly">
                <expand macro="quantification_parameters"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output_gtf" format="gtf" from_work_dir="output.gtf" label="${tool.name} on ${on_string}: Quantification"/>
    </outputs>
    <tests>

    </tests>
    <help><![CDATA[

.. class:: infomark

**Purpose**
----

]]>    </help>
    <expand macro="citations"/>
</tool>

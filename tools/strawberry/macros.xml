<macros>
    <token name="@TOOL_VERSION@">1.1.1</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <xml name="xrefs">
      <xrefs>
        <xref type="bio.tools">strawberry</xref>
      </xrefs>
    </xml>
    <xml name="requirements">
        <requirements>
            <container type="docker">ruolinliu/strawberry:v@TOOL_VERSION@</container>
        </requirements>
    </xml>
    <xml name="citations">
        <citations>
            <citation type="doi">10.1371/journal.pcbi.1005851</citation>
        </citations>
    </xml>
    <param name="outputs" type="select" label="Output files">
        <option value="--logfile">Log file</option>
    </param>
    <token name="@ASSEMBLY_PARAMETERS@">
        --min-transcript-size $mode_conditional.assembly_section.min_transcript_size
        --max-overlap-distance $mode_conditional.assembly_section.max_overlap_distance
        -s $mode_conditional.assembly_section.min_anchor_size
        --small-anchor-alpha $mode_conditional.assembly_section.small_anchor_alpha
        --min-support-4-intron $mode_conditional.assembly_section.min_support_4_intron
        $mode_conditional.assembly_section.combine_short_transfrag
        --min-depth-4-transcript $mode_conditional.assembly_section.min_depth_4_transcript
    </token>
    <xml name="assembly_parameters">
        <section name="assembly_section" title="Assembly options" expanded="true">
            <param argument="--min-transcript-size" type="integer" min="0" value="200" label="Min transcript size" help="Minimum transcript size to be assembled" />
            <param argument="--max-overlap-distance" type="integer" min="0" value="30" label="Max overlap distance" help="Maximum distance between read clusters to be merged" />
            <param argument="--min-anchor-size" type="integer" min="0" value="10" label="Min anchor size" help="Read overhang less than this value is subject to Binomial test" />
            <param argument="--small-anchor-alpha" type="float" min="0" max="1" value="0" label="Small anchor alpha" help="Threshold alpha for junction binomial test filter" />
            <param argument="--min-support-4-intron" type="integer" min="1" value="2" label="Min support for intron" help="Minimum number of spliced aligned reads requited to support a intron" />
            <param argument="-combine-short-transfrag" type="boolean" truevalue="-combine-short-transfrag" falsevalue="" label="Combine short transfrag" help="Merging non-overlap short transfrags" />
            <param argument="--min-depth-4-transcript" type="float" min="0.1" value="1" label="Min depth for transcripts" help="Minimum average read depth for transcript" />
        </section>
    </xml>
    <token name="@QUANTIFICATION_PARAMETERS@">
        --bias-correction ###################FALTA
        --fragment-context fragment_context.tab ##################FALTA
        #if $mode_conditional.quantification_section.insert_size_conditional == 'enabled'
            --insert-size-mean-and-sd '${$mode_conditional.quantification_section.mean}/{$mode_conditional.quantification_section.sd}'
        #end if
        --filter-low-expression $mode_conditional.quantification_section.filter_low_expression
    </token>
    <xml name="quantification_parameters">
        <section name="quantification_section" title="Quantification options" expanded="true">
            <param argument="--bias-correction" type="data" format="data" label="Bias correction" optional="true" help="Specify a reference genome for bias correction in FASTA format" />
            <param argument="--fragment-context" type="boolean" truevalue="--fragment-context" falsevalue="" label="Fragment context" help="Generate a file with the fragment context for differential expression" />
            <conditional name="insert_size_conditional">
                <param argument="--insert-size-mean-and-sd" type="select" label="Specify insert size mean and standard deviation">
                    <option value="enabled">Enabled</option>
                    <option value="disabled" selected="true">Disabled</option>
                </param>
                <when value="enabled">
                    <param name="mean" type="integer" min="0" optional="true" label="Mean insert size"/>
                    <param name="sd" type="integer" min="0" optional="true" label="Insert size standard deviation"/>
                </when>
                <when value="disabled"/>
            </conditional>
            <param argument="--filter-low-expression" type="float" min="0" max="1" value="0" label="Filter low expression" help="Skip isoforms whose relative expression (within locus) are less that this number" />
        </section>
    </xml>
</macros>

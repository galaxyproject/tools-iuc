<tool id="csaw_mixedClusters" name="mixedClusters" version="@VERSION@.0">
  <description>tests for mixed DB clusters</description>
  <macros>
    <import>csaw_macros.xml</import>
  </macros>
  <expand macro="requirements" />
  <command detect_errors="exit_code"><![CDATA[
    Rscript '$script']]>
  </command>
  <configfiles>
    <configfile name="script"><![CDATA[
## Setup R error handling to go to stderr
options(show.error.messages=F, error=function(){cat(geterrmessage(),file=stderr());q("no",1,F)})
loc <- Sys.setlocale("LC_MESSAGES", "en_US.UTF-8")

## Import library
library(csaw)

comTest_ids <-scan("$ids", what = integer())
comTest_tab <- read.table("$tab", sep="", header=T)
#if str($weight) != ''
    comTest_w <- scan("$weight", what=numeric())
#else
    comTest_w <- NULL
#end if
@COLNAMES@

result <- mixedClusters(ids, tab, weight=comTest_w, pval.col=pval_col, fc.col=fc_col)
write.table(result, file="$output", row.names=FALSE)

]]>
    </configfile>
  </configfiles>
  <inputs>
    <expand macro="combineTest_param" />
  </inputs>
  <outputs>
    <data name="output" format="txt" label="${tool.name} on ${on_string}: mixedClusters output" />
  </outputs>
  <tests>
    <test>
      <param name="ids" value="mixedClusters_ids.tabular" />
      <param name="tab" value="mixedClusters_tab.tabular" />
      <param name="weight" value="" />
      <param name="pval_col" value="" />
      <param name="fc_col" value="" />
      <output name="output" value="combineTests_output.txt" />
    </test>
  </tests>
  <help><![CDATA[
      Intersects two one-sided tests to determine if a cluster contains DB events in both directions.

      This function converts two-sided p-values to one-sided counterparts for each direction of log-fold change. For each direction, the corresponding one-sided p-values are combined to yield a combined p-value for each cluster. Each cluster is associated with two combined p-values (one in each direction), which are intersected using the Bergerâ€™s intersection-union test (IUT). The IUT p-value provides evidence against the null hypothesis that either direction is not significant. In short, a low p-value is only possible if there is DB in both directions. This formally identifies mixed clusters corresponding to complex DB events. The two-sided p-values in should be independent of the sign of the log-fold change under the null hypothesis. This may not be true for all hypothesis tests, so caution is required when supplying values in tab.
    ]]></help>
  <expand macro="citations" />
</tool>
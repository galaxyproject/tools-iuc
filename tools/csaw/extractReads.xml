<tool id="csaw_extractReads" name="extractReads" version="@VERSION@.0">
    <description>extracts reads from a BAM file</description>
     <macros>
       <import>csaw_macros.xml</import>
    </macros>
     <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        Rscript '$script'
    ]]></command>
    <configfiles>
        <configfile name="script"><![CDATA[
## Setup R error handling to go to stderr
options(show.error.messages=F, error=function(){cat(geterrmessage(),file=stderr());q("no",1,F)})
loc <- Sys.setlocale("LC_MESSAGES", "en_US.UTF-8")

## Import library
library(csaw)
library(Rsamtools)

##extractReads
   
bamFiles <- c()
#for $i in $bam_input
    bamFiles <- c(bamFiles, '${i.bam_file}')
#end for
indexBam(bamFiles)

 @GRANGES@

extractReads(bam.file, region, ext=NA, param=readParam(), as.reads=FALSE)
]]>
        </configfile>
    </configfiles>
    <inputs>
        <repeat name="bam_input" title="Upload indexed BAM files in sorted order" >
            <param name="bam_file" type="data" format="bam" label="BAM file" />
        </repeat>
        <param name="GRanges" type="text" label="Sequence Names of length 1 describing the region of interest" />
        <param name="IRanges" type="data" format="tabular" label="Ranges" help="Upload as a dataframe where the first column is the start position and the second column is the end position." />>


ext an integer scalar or list specifying the fragment length for directional read extension
param a readParam object specifying how reads should be extracted
as.reads a logical scalar indicating whether reads should be returned instead of fragments
for paired-end data
        
    </inputs>
    <outputs>
        <data name="output" format="txt" label="${tool.name} on ${on_string}: extractReads output" />
    </outputs>

    <tests>
        <test>
            
        </test>
    </tests>

    <help><![CDATA[
       Extract reads from a BAM file with the specified parameter settings.
    ]]></help>
    <expand macro="citations" />
</tool>
<tool id="mash_dist" name="mash dist" version="@TOOL_VERSION@+galaxy0" profile="@PROFILE@">
    <description>Estimate distance between query sequences</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="xref"/>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
        #set REFERENCE = "reference."+$reference.ext
        #set QUERY = "query."+$query.ext
        ln -s '$reference' $REFERENCE &&
        ln -s '$query' $QUERY &&
        mash dist
            #if $table_output:
                -t
            #end if
                -p \${GALAXY_SLOTS:-1}
            #if $pvalue:
                -v $pvalue
            #end if
            #if $distance:
                -d $distance
            #end if
            $REFERENCE
            $QUERY
            > '$output'
            ]]></command>
    <inputs>
        <param name="table_output" type="boolean" truevalue="-t" falsevalue="" checked="true" label="Table output?" help="Will not report p-values, but fields will be blank if they do not meet the p-value threshold"/>
        <param name="reference" type="data" format="@INTYPES@,msh" label="Reference"/>
        <param name="query" type="data" format="@INTYPES@,msh" label="Query"/>
        <param name="pvalue" type="float" argument="-v" value="1.0" min="0" max="1.0" label=" Maximum p-value"/>
        <param name="distance" type="float" argument="-d" value="1.0" min="0" max="1.0" label="Maximum distance"/>
    </inputs>
    <outputs>
        <data name="output" format="tsv" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="table_output" value="true"/>
            <param name="reference" value="ERR024951_seqtk_sample_1000_1.fastq" ftype="fastqsanger"/>
            <param name="query" value="ERR024951_seqtk_sample_1000_2.fastq" ftype="fastqsanger"/>
            <output name="output">
                <assert_contents>
                    <has_text text="0.203604"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
        <param name="table_output" value="true"/>
        <param name="reference" value="ERR024951_seqtk_sample_1000_1.fastq.gz" ftype="fastqsanger.gz"/>
        <param name="query" value="ERR024951_seqtk_sample_1000_2.fastq.gz" ftype="fastqsanger.gz"/>
        <output name="output">
            <assert_contents>
                <has_text text="0.203604"/>
            </assert_contents>
        </output>
        </test>
        <test expect_num_outputs="1">
            <param name="table_output" value="true"/>
            <param name="reference" value="test_06_mash_sketch.msh" ftype="msh"/>
            <param name="query" value="test_07_mash_sketch.msh" ftype="msh"/>
            <output name="output">
                <assert_contents>
                    <has_text text="1"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="table_output" value="true"/>
            <param name="reference" value="m64326e_231117_100511.hifi_reads.bc2068--bc2068.msh" ftype="msh"/>
            <param name="query" value="m64326e_231130_052019.hifi_reads.bc2068--bc2068.msh" ftype="msh"/>
            <output name="output">
                <assert_contents>
                    <has_text text="0.0149234"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[

**What it does**

  Estimate the distance of each query sequence to the reference. Both the
  reference and queries can be fasta or fastq, gzipped or not, or Mash sketch
  files (.msh) with matching k-mer sizes. Query files can also be files of file
  names (see -l). Whole files are compared by default (see -i). The output
  fields are [reference-ID, query-ID, distance, p-value, shared-hashes].

  ]]></help>
    <expand macro="citations"/>
</tool>
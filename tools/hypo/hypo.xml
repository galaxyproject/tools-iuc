<tool id="hypo" name="Polish an assembly using hypo" version="0.1.0" profile="20.05">
    <requirements>
        <requirement type="package">hypo</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        #for $fastq in $reads_short:
            echo '$fastq' >>  short_reads.txt &&
        #end for
        hypo
        --reads-short @short_reads.txt 
        --draft '$draft' 
        --bam-sr '$bam_sr'
        --coverage-short '$coverage_short '
        --size-ref '$size_ref'
        -t "\${GALAXY_SLOTS:-1}"
        -o '$out_fasta'
        --processing-size '$processing_size'
        --kind-sr '$kind_sr'
        #if $bam_lr
            --bam-lr '$bam_lr'
        #end if
    ]]></command>
    <inputs>
        <param argument="--reads-short" type="data" format="txt" multiple="true" label="List of illumina FASTQ files" help="List of files containing file names in each line can be passed with @ prefix." />
        <param argument="--draft" type="data" format="fasta,fasta.gz" label="Draft genome assembly"/>
        <param argument="--bam-lr" type="data" format="bam" optional="true" label="Bam file with ONT reads aligned" help="Input file name containing the alignments of long reads against the draft (in BAM format; must have CIGAR information)."/>
        <param argument="--bam-sr" type="data" format="bam" label="BAM file with illumina read alignments" help="Input file name containing the alignments of short reads against the draft (in BAM/SAM format; must have CIGAR information)."/>
        <param argument="--coverage-short" type="integer" value="" min="0" label="Aproximate mean coverage of the short reads"/>
        <param argument="--processing-size" type="integer" value="1" label="Number of contigs to be processed in one batch" help="Lower value means less memory usage but slower speed."/>
        <param argumen="--size-ref" type="text" label="Aproximate size of the genome" help="A number can be followed by units k/m/g; e.g. 10m, 2.3g."/>
        <param argument="--kind-sr" type="select"  label="Kind of the short reads">
            <option value="sr" selected="true">Corresponding to NGS reads like Illumina reads (sr)</option>
            <option value="ccs">Corresponding to HiFi reads like PacBio CCS reads (ccs)</option>
        </param> 
    </inputs>
    <outputs>
        <data name="out_fasta" format="fasta"/>
    </outputs>
    <tests>
    <test>
        <param name="draft" value="test2.fasta" ftype="fasta"/>
        <param name="reads_short" value="Illumina.1.fastq.gz,Illumina.2.fastq.gz"/>
        <param name="size_ref" value="10k" />
        <param name="processing_size" value="1" />
        <param name="coverage_short" value="35"/>
        <param name="bam_sr" value="Illumina.test2.bam" ftype="bam" />
        <param name="bam_lr" value="ONT.test2.bam" ftype="bam" />
        <output name="out_fasta" file="hypo_polished.fasta" ftype="fasta" />
    </test>
    </tests>
    <help><![CDATA[
        
 Usage: hypo <args>

 ** Mandatory args:
	-r, --reads-short <str>
	Input file name containing reads (in fasta/fastq format; can be compressed). A list of files containing file names in each line can be passed with @ prefix.

	-d, --draft <str>
	Input file name containing the draft contigs (in fasta/fastq format; can be compressed). 

	-b, --bam-sr <str>
	Input file name containing the alignments of short reads against the draft (in bam/sam format; must have CIGAR information). 

	-c, --coverage-short <int>
	Approximate mean coverage of the short reads. 

	-s, --size-ref <str>
	Approximate size of the genome (a number; could be followed by units k/m/g; e.g. 10m, 2.3g). 


 ** Optional args:
	-B, --bam-lr <str>
	Input file name containing the alignments of long reads against the draft (in bam/sam format; must have CIGAR information). 
	[Only Short reads polishing will be performed if this argument is not given]

	-o, --output <str>
	Output file name. 
	[Default] hypo_<draft_file_name>.fasta in the working directory.

 	-t, --threads <int>
	Number of threads. 
	[Default] 1.

 	-p, --processing-size <int>
	Number of contigs to be processed in one batch. Lower value means less memory usage but slower speed. 
	[Default] All the contigs in the draft.

 	-k, --kind-sr <str>
	Kind of the short reads. 
	[Valid Values] 
		sr	(Corresponding to NGS reads like Illumina reads) 
		ccs	(Corresponding to HiFi reads like PacBio CCS reads) 
	[Default] sr.

 	-m, --match-sr <int>
	Score for matching bases for short reads. 
	[Default] 5.

 	-x, --mismatch-sr <int>
	Score for mismatching bases for short reads. 
	[Default] -4.

 	-g, --gap-sr <int>
	Gap penalty for short reads (must be negative). 
	[Default] -8.

 	-M, --match-lr <int>
	Score for matching bases for long reads. 
	[Default] 3.

 	-X, --mismatch-lr <int>
	Score for mismatching bases for long reads. 
	[Default] -5.

 	-G, --gap-lr <int>
	Gap penalty for long reads (must be negative). 
	[Default] -4.

 	-n, --ned-th <int>
	Threshold for Normalised Edit Distance of long arms allowed in a window (in %). Higher number means more arms allowed which may slow down the execution.
	[Default] 20.

 	-q, --qual-map-th <int>
	Threshold for mapping quality of reads. The reads with mapping quality below this threshold will not be taken into consideration. 
	[Default] 2.

 	-i, --intermed
	Store or use (if already exist) the intermediate files. 
	[Currently, only Solid kmers are stored as an intermediate file.].

 	-h, --help
	Print the usage. 


    ]]></help>
</tool>

<tool id="rrmcorer" name="RRM-Scorer: quick predictions RRM-RNA binding" version="1.0.9">
    <description>Predict RNA Recognition Motif (RRM) scores for protein sequences and any RNA target purely based on their sequences.</description>
    <requirements>

        <requirement type="package" version="1.0.9">rrmscorer</requirement>
    </requirements>
   <command detect_errors="exit_code"><![CDATA[
mkdir -p ./json ./tabular ./fasta ./plots &&
#set $options = []

#if $tool_parameters.custom_rna_target.custom_rna_target:
    $options.append("-r '" + str($tool_parameters.custom_rna_target.target) + "'")
#elif $plot_options.top_scoring_rna:
    $options.append("-t")
#end if

$options.append("-w " + str($tool_parameters.window_size))

#if $plot_options.generate_plots:
    $options.append("-p 'plots'")
#end if

#if $plot_options.generate_fasta:
    $options.append("-a 'fasta'")
#end if

#if $input_sequence.fasta_input:
    echo "Using FASTA input: $input_sequence.fasta_input" &&
    python -m rrmscorer -j 'json' -c 'tabular' --fasta '$input_sequence.fasta_input' ${' '.join($options)} &&
#elif $input_sequence.uniprot_id:
    echo "Using UniProt ID: $input_sequence.uniprot_id" &&
    python -m rrmscorer -j 'json' -c 'tabular' -u '$input_sequence.uniprot_id' ${' '.join($options)} &&
#else:
    echo "Either a UniProt ID or a FASTA file is required for running this tool. Please provide one of them." >&2
    exit 1 &&
#end if
ls -l ./json ./tabular ./fasta ./plots
]]></command>
    <inputs>
        <section name="input_sequence" title="Input sequence">
            <param type="data" name="fasta_input" format="fasta" label="Protein sequence(s) FASTA format" help="Provide a FASTA file containing the protein sequences." optional="true"/>
            <param type="text" name="uniprot_id" label="OR Protein identifier from Uniprot" value="P19339" help="Provide a UniProt ID (e.g. P19339)." optional="true">
                <validator type="empty_field" message="Missing UniProt ID or sequence in FASTA format." />
            </param>
        </section>

        <section name="tool_parameters" title="Tool parameters" help="Configure this section to select the predictions to be executed">
            <conditional name="custom_rna_target">
                <param name="custom_rna_target" type="boolean" label="Custom RNA target" help="Enable custom RNA target for the predictions." />
                <when value="true">
                    <param name="target" type="text" label="Target RNA sequence (min. 5 nucleotides)" help="Provide a valid target RNA sequence."/>
                </when>
            </conditional>
            <param name="window_size" type="select" label="The window size to test (Only 3 and 5 nucleotide windows are accepted)">
                <option value="5" selected="true">5</option>
                <option value="3">3</option>
            </param>
        </section>

        <section name="plot_options" title="Plot options" help="Configure plot output">
            <param name="generate_plots" type="boolean" label="Generate score plots for all the RNA possible windows" help="Enable to generate score plots." />
            <param name="top_scoring_rna" type="boolean" label="Find the top-scoring RNA for the specified RRM(s) and plot their sequence logo" help="Enable to find and plot the top-scoring RNA." />
            <param name="generate_fasta" type="boolean" label="Generate a fasta file with each input sequence aligned to the HMM" help="Enable to generate a fasta file with aligned sequences." />
        </section>
    </inputs>

    <outputs>
        <collection name="split_csv" type="list" label="Predictions by sequence">
            <discover_datasets pattern="__designation_and_ext__" directory="tabular" visible="true" />
        </collection>
        <collection name="split_json" type="list" label="Predictions by sequence">
            <discover_datasets pattern="__designation_and_ext__" directory="json" visible="true" />
        </collection>
        <collection name="split_fasta" type="list" label="Predictions by sequence">
            <discover_datasets pattern="__designation_and_ext__" directory="fasta" visible="true" />
        </collection>
        <collection name="split_plots" type="list" label="Predictions by sequence">
            <discover_datasets pattern="__designation_and_ext__" directory="plots" visible="true" />
        </collection>

    </outputs>

<tests>
   

    <test>
    <!-- Test 1 -->
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>
        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-r 'AUGGCU'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text="-c 'tabular'"/>
        </assert_command>
        
    </test>
    <!-- Test 2 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>

        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-r 'AUGGCU'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text="-c 'tabular'"/>
        </assert_command>

        <output_collection name="split_csv" type="list" count = "2"/>
        <output_collection name="split_json" type="list" count = "2"/>
        <output_collection name="split_fasta" type="list" count = "0"/>
        <output_collection name="split_plots" type="list" count = "0"/>   

    </test>
    <!-- Test 3 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>

        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-r 'AUGGCU'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text="-c 'tabular'"/>
        </assert_command>

        <output_collection name="split_csv" type="list" count="2"/>          
        <output_collection name="split_json" type="list" count="2"/>
        <output_collection name="split_fasta" type="list" count="0"/>
        <output_collection name="split_plots" type="list" count="0"/>

    </test>

    <!-- Test 4 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>

        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-r 'AUGGCU'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text="-c 'tabular'"/>
            <has_text text="-p 'plots'"/>
            <has_text text="-a 'fasta'"/>
        </assert_command>

        <output_collection name="split_csv" type="list" count="123"/>          
        <output_collection name="split_json" type="list" count="2"/>
        <output_collection name="split_fasta" type="list" count="0"/>
        <output_collection name="split_plots" type="list" count="0"/>
        
    </test>

    <!-- Test 5 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>

        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-r 'AUGGCU'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text="-c 'tabular'"/>
        </assert_command>

        <output_collection name="split_csv" type="list" count="2"/>
        <output_collection name="split_json" type="list" count="2"/>
        <output_collection name="split_fasta" type="list" count="0"/>
        <output_collection name="split_plots" type="list" count="0"/>
        
    </test>
    <!-- Test 6 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>
        <param name="generate_fasta" value="true"/>


        <assert_command>
        <has_text text="-u 'P19339'"/>
        <has_text text="-r 'AUGGCU'"/>
        <has_text text="-w 5"/>
        <has_text text="-j 'json'"/>
        <has_text text= "-c 'tabular'"/>
        <has_text text= "-a 'fasta'"/>

        </assert_command>

        <output_collection name="split_csv" type="list" count="2"/>     
        <output_collection name="split_json" type="list" count="2"/>       
        <output_collection name="split_fasta" type="list" count="2"/>      
        <output_collection name="split_plots" type="list" count="0"/>

        </test>
    <!-- Test 7 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="false"/>
        <param name="window_size" value="5"/>
        <param name="top_scoring_rna" value="true"/>


        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text= "-c 'tabular'"/>
        </assert_command>

        <output_collection name="split_csv" type="list" count="0"/>     
        <output_collection name="split_json" type="list" count="2"/>       
        <output_collection name="split_fasta" type="list" count="0"/>      
        <output_collection name="split_plots" type="list" count="0"/>

        </test>
    <!-- Test 8 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="false"/>
        <param name="window_size" value="5"/>
        <param name="top_scoring_rna" value="true"/>
        <param name="generate_plots" value='true'/>
        <param name="top_scoring_rna" value='true'/>


        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text= "-c 'tabular'"/>
            <has_text text= "-p 'plots'"/>

        </assert_command>

        <output_collection name="split_csv" type="list" count="0"/>     
        <output_collection name="split_json" type="list" count="2"/>       
        <output_collection name="split_fasta" type="list" count="0"/>      
        <output_collection name="split_plots" type="list" count="8"/>

        </test>
     <!-- Test 9 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="false"/>
        <param name="window_size" value="5"/>
        <param name="top_scoring_rna" value="false"/>
        <param name="generate_plots" value='true'/>
        

    <!-- Test 10 -->
        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text= "-c 'tabular'"/>
            <has_text text= "-p 'plots'"/>

        </assert_command>

        <output_collection name="split_csv" type="list" count="0"/>     
        <output_collection name="split_json" type="list" count="0"/>       
        <output_collection name="split_fasta" type="list" count="0"/>      
        <output_collection name="split_plots" type="list" count="0"/>

        </test>

    
    <!-- Test 11 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>
        <param name="top_scoring_rna" value="true"/>
        <param name="generate_plots" value="false"/>
        <param name="generate_fasta" value="true"/>


        <assert_command>
        <has_text text="-u 'P19339'"/>
        <has_text text="-r 'AUGGCU'"/>
        <has_text text="-w 5"/>
        <has_text text="-j 'json'"/>
        <has_text text= "-c 'tabular'"/>
        <has_text text= "-a 'fasta'"/>

        </assert_command>

        <output_collection name="split_csv" type="list" count="2"/>     
        <output_collection name="split_json" type="list" count="2"/>       
        <output_collection name="split_fasta" type="list" count="2"/>      
        <output_collection name="split_plots" type="list" count="0"/>

        </test>
    <!-- Test 12 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>

        <param name="generate_plots" value="false"/>
        <param name="generate_fasta" value="true"/>


        <assert_command>
        <has_text text="-u 'P19339'"/>
        <has_text text="-r 'AUGGCU'"/>
        <has_text text="-w 5"/>
        <has_text text="-j 'json'"/>
        <has_text text= "-c 'tabular'"/>
        <has_text text= "-a 'fasta'"/>

        </assert_command>

        <output_collection name="split_csv" type="list" count="2"/>     
        <output_collection name="split_json" type="list" count="2"/>       
        <output_collection name="split_fasta" type="list" count="2"/>      
        <output_collection name="split_plots" type="list" count="0"/>

        </test>
    <!-- Test 13 -->
    <test>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="false"/>
        <param name="window_size" value="5"/>
        <param name="top_scoring_rna" value="true"/>
        <param name="generate_plots" value='true'/>
        <param name="generate_fasta" value="true"/>
        <param name="top_scoring_rna" value='true'/>


        <assert_command>
            <has_text text="-u 'P19339'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text= "-c 'tabular'"/>
            <has_text text= "-p 'plots'"/>
            <has_text text= "-a 'fasta'"/>

        </assert_command>

        <output_collection name="split_csv" type="list" count="0"/>     
        <output_collection name="split_json" type="list" count="2"/>       
        <output_collection name="split_fasta" type="list" count="2"/>      
        <output_collection name="split_plots" type="list" count="8"/>

        </test>
    <!-- Test 14 -->
    <test>
        <param name="fasta_input" value="input.fasta" ftype="fasta"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>
        <param name="generate_fasta" value="true"/>

        <assert_command>
            <has_text text="--fasta"/>
            <has_text text="-r 'AUGGCU'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text="-c 'tabular'"/> 
        </assert_command>

        <output_collection name="split_csv" type="list" count = "2"/>
        <output_collection name="split_json" type="list" count = "2"/>
        <output_collection name="split_fasta" type="list" count = "0"/>
        <output_collection name="split_plots" type="list" count = "0"/>   

    </test>

    <test>
        <param name="fasta_input" value="input.fasta" ftype="fasta"/>
        <param name="uniprot_id" value="P19339"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="5"/>
        <param name="generate_fasta" value="true"/>

        <assert_command>
            <has_text text="--fasta"/>
            <has_text text="-u 'P19339'"/>
            <has_text text="-r 'AUGGCU'"/>
            <has_text text="-w 5"/>
            <has_text text="-j 'json'"/>
            <has_text text="-c 'tabular'"/> 
        </assert_command>

        <output_collection name="split_csv" type="list" count = "2"/>
        <output_collection name="split_json" type="list" count = "2"/>
        <output_collection name="split_fasta" type="list" count = "0"/>
        <output_collection name="split_plots" type="list" count = "0"/>   

    </test>

    <test>
        <param name="fasta_input" value="input.fasta" ftype="fasta"/>
        <param name="custom_rna_target" value="true"/>
        <param name="target" value="AUGGCU"/>
        <param name="window_size" value="4"/>
        <param name="generate_fasta" value="true"/>

        <assert_command>
            <has_text text="--fasta"/>
            <has_text text="-u 'P19339'"/>
            <has_text text="-r 'AUGGCU'"/>
            <has_text text="-w 4"/>
            <has_text text="-j 'json'"/>
            <has_text text="-c 'tabular'"/> 
        </assert_command>

        <output_collection name="split_csv" type="list" count = "2"/>
        <output_collection name="split_json" type="list" count = "2"/>
        <output_collection name="split_fasta" type="list" count = "0"/>
        <output_collection name="split_plots" type="list" count = "0"/>   

    </test>

</tests>

    <help><![CDATA[
    This tool allows you to predict RNA Recognition Motif (RRM) scores for protein sequences provided in FASTA format or as UniProt IDs.

    **Inputs:**
    - **Protein sequence(s) FASTA format:** Provide a FASTA file containing the protein sequences.
    - **Protein identifier from Uniprot:** Provide a UniProt ID (e.g. P19339).
    - **Custom RNA target:** Enable or disable the use of a custom RNA target for the predictions.
    - **Target:** Provide a valid target RNA sequence (minimum 5 nucleotides) if Custom RNA target is enabled.
    - **The window size to test:** Select the window size (3 or 5 nucleotides).
    - **Plot options:** Configure plot output options.

    ]]>
    </help>
</tool>
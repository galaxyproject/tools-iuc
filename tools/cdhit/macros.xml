<?xml version="1.0"?>
<macros>
    <token name="@TOOL_VERSION@">4.8.1</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <xml name="requirements">
        <requirements>
        	<!-- both recipes use the same GitHub repository -->
        	<requirement type="package" version="@TOOL_VERSION@">cd-hit</requirement>
        	<requirement type="package" version="@TOOL_VERSION@">cd-hit-auxtools</requirement>
        </requirements>
    </xml>
    <xml name="citations">
    	<citations>
			<citation type="doi">10.1093/bioinformatics/17.3.282</citation>
			<citation type="doi">10.1093/bioinformatics/18.1.77</citation>
			<citation type="doi">10.1093/bioinformatics/btl158</citation>
			<citation type="doi">10.1093/bioinformatics/bts565</citation>
			<citation type="doi">10.1093/bioinformatics/btq003</citation>
			<citation type="doi">10.1186/1471-2105-11-187</citation>
			<citation type="doi">10.1093/bib/bbs035</citation>
		</citations>
    </xml>

    <!--
        command
    -->

    <token name="@LOG@"><![CDATA[
#if $out.log
    |& tee -a '$out_log'
#end if
    ]]></token>

    <!--
        input
    -->

    <xml name="a" token_default="">
		<param argument="-a" type="float" value="@DEFAULT@" label="Set abundance cutoff"/>
	</xml>
	<xml name="A">
		<param argument="-A" type="integer" min="0" value="0" label="Set minimal alignment coverage control for both sequences" help="Minimum number of residues of both sequences that must be covered."/>
	</xml>
	<xml name="aL">
    	<param argument="-aL" type="float" min="0.0" max="1.0" value="0.0" label="Set alignment coverage for the longer sequence" help="Fraction of the longer sequence that must be covered."/>
    </xml>
	<xml name="AL">
    	<param argument="-AL" type="integer" min="0" value="99999999" label="Set alignment coverage control for the longer sequence" help="If set to 60 and the length of the sequence is 400 then the alignment must be >= 340 (400-60) residues."/>
    </xml>
	<xml name="aS">
    	<param argument="-aS" type="float" min="0.0" max="1.0" value="0.0" label="Set alignment coverage for the shorter sequence" help="Fraction of the shorter sequence that must be covered."/>
    </xml>
    <xml name="AS">
    	<param argument="-AS" type="integer" min="0" value="99999999" label="Set alignment coverage control for the shorter sequence" help="If set to 60 and the length of the sequence is 400 then the alignment must be >= 340 (400-60) residues."/>
	</xml>
    <xml name="b" token_default="">
		<param argument="-b" type="integer" min="0" value="@DEFAULT@" label="Set band width of alignment"/>
    </xml>
    <xml name="bak">
    	<param argument="-bak" type="boolean" truevalue="-bak 1" falsevalue="" label="Create backup cluster file?"/>
    </xml>
    <xml name="c" token_default="">
		<param argument="-c" type="float" min="0.0" max="1.0" value="@DEFAULT@" label="Set sequence identity threshold" help="Global sequence identity: number of identical alignment positions divided by the full length of the shorter sequence."/>
    </xml>
    <xml name="d">
        <param argument="-d" type="integer" value="0" label="Set description length" help="Set truncate value at the first whitespace character"/>
    </xml>
    <xml name="est">
    	<param argument="-cx" type="integer" value="0" label="Set length to keep after trimming the tail of sequences in the first file"/>
        <param argument="-cy" type="integer" value="0" label="Set length to keep after trimming the tail of sequences in the second file"/>
    	<expand macro="gap" default="-6"/>
        <expand macro="gapext"/>
        <param argument="-mask" type="text" optional="true" label="Set letters to mask out" help="NX to mask out both 'N' and 'X'"/>
        <expand macro="match"/>
        <expand macro="mismatch" default="-2"/>
        <param argument="-r" type="boolean" truevalue="-r 1" falsevalue="-r 0" checked="false" label="Compare both strands?"/>
    </xml>
	<xml name="g">
    	<param argument="-g" type="boolean" truevalue="-g 1" falsevalue="-g 0" checked="false" label="Use accurate but slow mode?" help="Default algorithm: a sequence is clustered to the first cluster that meet the threshold (fast cluster). If set to true, the program will cluster it into the most similar cluster that meet the threshold (accurate but slow mode) but either 1 or 0 won't change the representatives of final clusters."/>
    </xml>
	<xml name="G">
	    <conditional name="G_cond">
	        <param name="G_sel" type="select" label="Select sequence identity type to set advanced parameters" help="Local sequence identity: number of identical amino alignment positions divided by the length of the alignment. Note: in local mode one of -aL, aS, or A must be > 0!">
	            <option value="-G 1" selected="true">Global (-G 1)</option>
	            <option value="-G 0">Local (-G 0)</option>
	        </param>
	        <when value="-G 1"/>
	        <when value="-G 0">
	        	<expand macro="A"/>
	            <expand macro="aL"/>
	            <expand macro="AL"/>
	            <expand macro="aS"/>
	            <expand macro="AS"/>	            
	            <param argument="-s" type="float" min="0.0" max="1.0" value="0.0" label="Set length difference cutoff" help="If set to 0.9, the shorter sequences need to be at least 90% length of the representative of the cluster"/>
	            <param argument="-S" type="integer" min="0" value="999999" label="Set length difference cutoff in residues" help="If set to 60, the length difference between the shorter sequences and the representative of the cluster can not be bigger than 60"/>
	            <yield/>
	        </when>
	    </conditional>
	</xml>
	<xml name="gap" token_default="">
		<param argument="-gap" type="integer" value="@DEFAULT@" label="Set gap opening score"/>
	</xml>
	<xml name="gapext">
		<param name="gapext" argument="-gap-ext" type="integer" value="-1" label="Set gap extension score"/>
	</xml>
    <xml name="log">
    	<param name="log" type="boolean" label="Create log file?"/>
    </xml>
	<xml name="match">
		<param argument="-match" type="integer" value="2" label="Set match score" help="1 for T-U and N-N"/>
	</xml>
	<xml name="mismatch" token_default="">
		<param argument="-mismatch" type="integer" value="@DEFAULT@" label="Set mismatch score"/>
	</xml>
    <xml name="n" token_default="" token_help="">
        <param argument="-n" type="integer" value="@DEFAULT@" label="Set word length" help="@HELP@"/>
    </xml>
	<xml name="s2">
		<param argument="-s2" type="float" min="0.0" max="1.0" value="1.0" label="Set length difference cutoff for other sequences" help="By default, seqs in (-i) >= seqs in (-i2) in a same cluster if set to 0.9, seqs in (-i) may just >= 90% seqs in (-i2)."/>
	</xml>
	<xml name="S2">
		<param argument="-S2" type="integer" min="0" value="0" label="Set length difference cutoff in residues for other sequences" help="By default, seqs in (-i) >= seqs in (-i2) in a same cluster if set to 60, seqs in (-i2) may 60aa longer than seqs in (-i)."/>
	</xml>
	<xml name="t">
		<param argument="-t" type="integer" value="2" label="Set tolerance for redundance"/>
	</xml>

    <!--
        output
    -->

    <xml name="out_clusters">
        <data name="out_clusters" format="txt" from_work_dir="result.clstr" label="${tool.name} on ${on_string}: Cluster"/>
    </xml>
    <xml name="out_clusters_backup">
        <data name="out_clusters_backup" format="txt" from_work_dir="result.bak.clstr" label="${tool.name} on ${on_string}: Backup cluster">
            <filter>out['bak']</filter>
        </data>
    </xml>
    <xml name="out_sequences">
        <data name="out_sequences" format="fasta" from_work_dir="result" label="${tool.name} on ${on_string}: Representative sequences" />
    </xml>
    <xml name="out_log">
        <data name="out_log" format="txt" label="${tool.name} on ${on_string}: Log">
            <filter>out['log']</filter>
        </data>
    </xml>

    <!--
        help
    -->

    <token name="@CLUSTER@"><![CDATA[
- Cluster file, e.g.

::

    >Cluster 0
    0   528nt, >MISEQ-1639_50_00000... *
    1   528nt, >MISEQ-1639_50_00000... at +/100.00%
    >Cluster 1
    0   503nt, >MISEQ-1639_51_00000... *
  [...]
    ]]></token>
    <token name="@CLUSTER_BACKUP@"><![CDATA[
- Backup cluster file, e.g.

::

    251 166nt, >MISEQ-1639_50_00000... *
    183 249nt, >MISEQ-1639_51_00000... *
    45  322nt, >MISEQ-1639_78_00000... *
    218 240nt, >MISEQ-1639_51_00000... *
    ]]></token>
    <token name="@WID@"><![CDATA[
*CD-HIT* is a program for clustering biological sequences to reduce sequence redundancy and improve the performance of other sequence analyses. *CD-HIT* stands for Cluster Database at High Identity with Tolerance and uses a greedy incremental clustering approach.
    ]]></token>

    <token name="@REFERENCES@"><![CDATA[
More information can be found on the `project website <http://weizhongli-lab.org/cd-hit/>`_, a `wiki <https://github.com/weizhongli/cdhit/wiki>`_ and `GitHub <https://github.com/weizhongli/cdhit>`_. A web server is a available `here <http://weizhong-lab.ucsd.edu/cdhit-web-server/cgi-bin/index.cgi>`_.
    ]]></token>
</macros>
<tool id="cd_hit_lap" name="CD-HIT lap" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@">
    <description>identifies overlapping reads</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <version_command><![CDATA[cd-hit | grep "CD-HIT version" | cut -d" " -f 4]]></version_command>
    <command detect_errors="exit_code"><![CDATA[
cd-hit-lap
-d $d
-i '$i'
-m $m
-o 'result'
-p $p
-s $s
@LOG@
    ]]></command>
    <inputs>
        <param argument="-i" type="data" format="fasta" label="Select file with sequences to divide"/>
        <param argument="-m" type="integer" value="20" label="Set minimum length of overlapping part"/>
        <param argument="-p" type="float" min="0.0" max="1.0" value="0" label="Set minimum percentage of overlapping part"/>
        <expand macro="d"/>
        <param argument="-s" type="integer" value="0" label="Set random number seed for shuffling" help="Shuffled before sorting by length. 0 means no shuffling."/>
        <section name="out" title="Output options">
            <expand macro="log"/>
        </section>
    </inputs>
    <outputs>
        <expand macro="out_clusters"/>
        <expand macro="out_sequences"/>
        <expand macro="out_log"/>
    </outputs>
    <tests>
        <!-- #1 default -->
        <test expect_num_outputs="2">
            <param name="i" value="nucleotide_sequences.fasta"/>
            <output name="out_clusters">
                <assert_contents>
                    <has_n_lines n="74"/>
                    <has_line line=">Cluster 36"/>
                </assert_contents>
            </output>
            <output name="out_sequences">
                <assert_contents>
                    <has_n_lines n="74"/>
                    <has_line line=">F23Fcsw_96640"/>
                    <has_text_matching expression="TCCGTACACTCAGGGATA.+"/>
                </assert_contents>
            </output>
        </test>
        <!-- #2 custom -->
        <test expect_num_outputs="3">
            <param name="i" value="nucleotide_sequences.fasta"/>
            <param name="m" value="20"/>
            <param name="p" value="0.01"/>
            <param name="d" value="1"/>
            <param name="s" value="1"/>
            <section name="out">
                <param name="log" value="true"/>
            </section>
            <output name="out_clusters">
                <assert_contents>
                    <has_n_lines n="74"/>
                    <has_line line=">Cluster 36"/>
                </assert_contents>
            </output>
            <output name="out_sequences">
                <assert_contents>
                    <has_n_lines n="74"/>
                    <has_line line=">F23Fcsw_96640"/>
                    <has_text_matching expression="TCCGTACACTCAGGGATA.+"/>
                </assert_contents>
            </output>
            <output name="out_log">
                <assert_contents>
                    <has_line line="Done!"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

@WID@

*CD-HIT-LAP* is part of *CD-HIT* and extracts pairs of overlapping reads by clustering based on tail-head overlaps (with perfect matching). The basic clustering strategy is the same as that in standard *CD-HIT* programs. In this program, each read is clustered as either a 'representative' or a 'redundant' read. For each 'redundant' read, it must have a prefix that is identical a suffix of its representative read.

**Input**

Sequences in FASTQ or FASTA file format.

**Output**

Cluster file in which the alignment positions indicate how the reads are overlapped. Visit the `project wiki <https://github.com/weizhongli/cdhit/wiki/3.-User's-Guide#cdhitlap>`_ for more details.

::

    >Cluster 0
    0   75nt, >1_lane2_624... *
    1   75nt, >1_lane2_7169... at 1:65:11:75/+/100.00%
    2   75nt, >1_lane2_36713... at 69:1:1:69/-/100.00%
    3   75nt, >1_lane2_141482... at 1:56:20:75/+/100.00%

.. class:: infomark

**References**

@HELP_REFERENCES@
    ]]></help>
    <expand macro="citations"/>
</tool>
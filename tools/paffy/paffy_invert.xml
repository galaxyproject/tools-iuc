<tool id="paffy_invert" name="Paffy invert" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>swaps the query and target in a PAF file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        set -o pipefail; 

        ## Uncompress input PAF file if necessary and pipe it
        @UNCOMPRESS_PAF@

        ## Run main command
        paffy invert
            --logLevel 'INFO'
             
        ## Compress output if requested by user 
        @COMPRESS_PAF@
    ]]></command>
    <inputs>
        <expand macro="input_paf"/>
        <expand macro="params_conditional_compression"/>
    </inputs>
    <outputs>
        <data name="out_file" format="paf" label="${tool.name} on ${on_string}">
            <change_format>
                <when input="compression.type" value="gz" format="paf.gz"/>
            </change_format>
        </data>
    </outputs>
    <tests>
        <!-- Test 1: Tool defaults -->
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <output name="out_file" ftype="paf">
                <assert_contents>
                    <has_text text="simCow.chr6&#009;602619&#009;2&#009;3857&#009;+&#009;simDog.chr6&#009;593897&#009;3&#009;3510&#009;2364&#009;4205&#009;255&#009;AS:i:103043"/>
                    <has_text text="simDog.chr6&#009;593897&#009;3&#009;3510&#009;+&#009;simCow.chr6&#009;602619&#009;2&#009;3857&#009;2364&#009;4205&#009;255&#009;AS:i:103043" negate="true"/>
                </assert_contents>
            </output>
        </test>
        <!-- Test 2: Compressed input (.gz) -->
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <output name="out_file" ftype="paf">
                <assert_contents>
                    <has_text text="simCow.chr6&#009;602619&#009;2&#009;3857&#009;+&#009;simDog.chr6&#009;593897&#009;3&#009;3510&#009;2364&#009;4205&#009;255&#009;AS:i:103043"/>
                    <has_text text="simDog.chr6&#009;593897&#009;3&#009;3510&#009;+&#009;simCow.chr6&#009;602619&#009;2&#009;3857&#009;2364&#009;4205&#009;255&#009;AS:i:103043" negate="true"/>
                </assert_contents>
            </output>
        </test>
        <!-- Test 3: Compressed input & output (.gz) -->
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <conditional name="compression">
                <param name="type" value="gz"/>
            </conditional>
            <output name="out_file" ftype="paf.gz">
                <assert_contents>
                    <has_size size="37969"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
Paffy invert swaps the query and target columns in a PAF file. 
This is useful for reinterpreting the alignment from the perspective of the original target without remapping sequences. 
The process involves updating coordinates and regenerating the CIGAR string to maintain alignment validity relative to the new query sequence. 
As output, a new PAF file is generated with the inverted alignments.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
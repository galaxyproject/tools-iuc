<tool id="faffy_merge" name="Faffy merge" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>merges multiple FASTA files into a single FASTA file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        ## --inputFile is a file with a list of file paths pointing to the FASTA's
        #for $i, $fasta_file in enumerate($input_fasta):
            #set temp_fasta_file = "file_${i}.fasta"
            #if $fasta_file.ext.endswith('.gz')
                gunzip -c '$fasta_file' > '$temp_fasta_file' &&
                echo '$temp_fasta_file' >> file_list.txt &&
            #else if $fasta_file.ext.endswith('.bz2')
                bunzip2 -c '$fasta_file' > '$temp_fasta_file' &&
                echo '$temp_fasta_file' >> file_list.txt &&
            #else
                echo '$fasta_file' >> file_list.txt &&
            #end if
        #end for
        faffy merge
            --logLevel 'INFO'
            --outputFile '$out_file'
            --inputFile file_list.txt
    ]]></command>
    <inputs>
        <expand macro="params_fastaList"/>
    </inputs>
    <outputs>
        <data name="out_file" format="fasta" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_fasta">
                <collection type="list">
                    <element name="000" value="faffy_chunk_output/0.fa" ftype="fasta"/>
                    <element name="001" value="faffy_chunk_output/1.fa" ftype="fasta"/>
                    <element name="002" value="faffy_chunk_output/2.fa" ftype="fasta"/>
                </collection>
            </param>
            <output name="out_file" ftype="fasta">
                <assert_contents>
                    <has_line line=">simCow.chr6"/>
                    <has_size value="602635"/>
                    <has_n_lines n="4"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_fasta">
                <collection type="list">
                    <element name="000" value="faffy_chunk_overlap_output/0.fa" ftype="fasta"/>
                    <element name="001" value="faffy_chunk_overlap_output/1.fa" ftype="fasta"/>
                    <element name="002" value="faffy_chunk_overlap_output/2.fa" ftype="fasta"/>
                </collection>
            </param>
            <output name="out_file" ftype="fasta">
                <assert_contents>
                    <has_line line=">simCow.chr6"/>
                    <has_line line=">simDog.chr6"/>
                    <has_size value="902659"/>
                    <has_n_lines n="6"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
Faffy merge takes a list of FASTA files and combines them into a single FASTA file, preserving all sequences and handling overlaps. 
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
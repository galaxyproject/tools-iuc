<tool id="paffy_upconvert" name="paffy upconvert" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>converts coordinates of PAF alignments to refer to extracted subsequences</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        paffy upconvert
            #for $fasta_file in $input_fasta:
                '$fasta_file'
            #end for
            --logLevel "INFO"
            --outputFile '$out_file'
            #if $input_paf.ext.endswith(".gz")
                < gunzip -c '$input_paf' 
            #else:
                --inFile '$input_paf'
            #end if
    ]]></command>
    <inputs>
        <expand macro="input_paf"/>
        <expand macro="params_fastaList"/>
    </inputs>
    <outputs>
        <data name="out_file" format="paf" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <param name="input_fasta">
                <collection type="list">
                    <element name="001" value="simCow.chr6.range.fasta" ftype="fasta"/>
                    <element name="002" value="simDog.chr6.range.fasta" ftype="fasta"/>
                </collection>
            </param>
            <output name="out_file" ftype="paf" file="paffy_upconvert_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <param name="input_fasta">
                <collection type="list">
                    <element name="001" value="simCow.chr6.range.fasta" ftype="fasta"/>
                    <element name="002" value="simDog.chr6.range.fasta" ftype="fasta"/>
                </collection>
            </param>
            <output name="out_file" ftype="paf" file="paffy_upconvert_output.paf"/>
        </test>
    </tests>
    <help><![CDATA[
Paffy upconvert converts global alignment coordinates into local coordinates relative to provided subsequences.
This is useful for analyzing specific regions of interest instead of whole chromosomes.
It parses the start offset from the FASTA header (formatted as ``>Name|Length|Start``) and adjusts the PAF coordinates relative to the chunk.

Adjusted alignemnts are indicated indem the target or query name contain the length and start offset information of the subsequence.
Adjusted alignments are identified by sequence names that include the length and start offset of the subsequence.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
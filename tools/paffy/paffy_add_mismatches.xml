<tool id="paffy_add_mismatches" name="paffy add mismatches" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>encodes mismatches in PAF alignments</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        paffy add_mismatches
            #for $fasta_file in $input_fasta:
                '$fasta_file'
            #end for
            $removeMismatches
            --logLevel "INFO"
            --outputFile '$out_file'
            #if $input_paf.ext.endswith(".gz")
                < gunzip -c '$input_paf' 
            #else:
                --inputFile '$input_paf'
            #end if
    ]]></command>
    <inputs>
        <expand macro="input_paf"/>
        <expand macro="params_fastaList"/>
        <param argument="--removeMismatches" type="boolean" truevalue="--removeMismatches" falsevalue="" checked="false" label="Remove mismatches" help="This will remove 'X' and '=' encoding and replacing with 'M'"/>  
    </inputs>
    <outputs>
        <data name="out_file" format="paf" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <param name="input_fasta">
                <collection type="list">
                    <element name="001" value="simCow.chr6.fasta" ftype="fasta"/>
                    <element name="002" value="simDog.chr6.fasta" ftype="fasta"/>
                </collection>
            </param>
            <output name="out_file" ftype="paf" file="paffy_add_mismatches_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <param name="input_fasta">
                <collection type="list">
                    <element name="001" value="simCow.chr6.fasta" ftype="fasta"/>
                    <element name="002" value="simDog.chr6.fasta" ftype="fasta"/>
                </collection>
            </param>
            <output name="out_file" ftype="paf" file="paffy_add_mismatches_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="paffy_add_mismatches_output.paf"/>
            <param name="input_fasta">
                <collection type="list">
                    <element name="001" value="simCow.chr6.fasta" ftype="fasta"/>
                    <element name="002" value="simDog.chr6.fasta" ftype="fasta"/>
                </collection>
            </param>
            <param name="removeMismatches" value="true"/>
            <output name="out_file" ftype="paf" file="testPaf.paf"/>
        </test>
    </tests>
    <help><![CDATA[
Paffy add mismatches processes a PAF file and updates the CIGAR strings to encode matches and mismatches. 
Standard 'M' encodings are converted into '=' for matching bases and 'X' for mismatching bases by comparing the aligned sequences against the FASTA sequences that were used to generate the PAF file.
Optionally, the tool can also reverse this process, collapsing '=' and 'X' operations back into 'M'.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
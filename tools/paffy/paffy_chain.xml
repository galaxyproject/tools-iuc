<tool id="paffy_chain" name="paffy chain" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>chains records in the PAF file into chains</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        paffy chain
            --maxGapLength $maxGapLength
            --chainGapOpen $chainGapOpen
            --chainGapExtend $chainGapExtend
            --trimFraction $trimFraction
            --logLevel "INFO"
            --outputFile '$out_file'
            #if $input_paf.ext.endswith(".gz")
                < gunzip -c '$input_paf' 
            #else:
                --inputFile '$input_paf'
            #end if
    ]]></command>
    <inputs>
        <expand macro="input_paf"/>
        <param argument="--maxGapLength" type="integer" min="0" value="1000000" label="Max gap length" help="The maximum allowable length of a gap in either sequence to chain"/> 
        <param argument="--chainGapOpen" type="integer" min="0" value="5000" label="Chain gap open" help="The cost of opening a chain gap"/> 
        <param argument="--chainGapExtend" type="integer" min="1" value="1" label="Chain gap extend" help="The cost of extending a chain gap"/> 
        <expand macro="params_trimFraction"/>
    </inputs>
    <outputs>
        <data name="out_file" format="paf" label="${tool.name} on ${on_string}: Chained PAF"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <output name="out_file" ftype="paf" file="paffy_chain_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <output name="out_file" ftype="paf" file="paffy_chain_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <param name="maxGapLength" value="10000"/>
            <param name="chainGapExtend" value="5"/>
            <output name="out_file" ftype="paf" file="paffy_chain_maxGapLength_chainGapExtend_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <param name="maxGapLength" value="10000"/>
            <param name="chainGapOpen" value="1000"/>
            <output name="out_file" ftype="paf" file="paffy_chain_maxGapLength_chainGapOpen_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <param name="maxGapLength" value="10000"/>
            <param name="chainGapOpen" value="1000"/>
            <param name="trimFraction" value="0.75"/>
            <output name="out_file" ftype="paf" file="paffy_chain_maxGapLength_chainGapOpen_trimFraction_output.paf"/>
        </test>
    </tests>
    <help><![CDATA[
Paffy chain groups individual PAF alignment records into chains that represent longer alignment blocks between sequences. 
Chaining is useful for getting synteny information, where multiple local alignments belong to the same larger structure. 
Each chain is rescored as a whole, and chain membership is indicated in the output PAF using the 'cn' tag.
Optionally, alignments can be trimmed from each end, allowing slightly overlapping alignments to be chained.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
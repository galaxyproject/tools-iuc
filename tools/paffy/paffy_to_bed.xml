<tool id="paffy_to_bed" name="paffy to bed" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>creates a BED file representing alignment coverage on query sequences</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        paffy to_bed
            #if $alignment.exclude == '--excludeAligned':
                --excludeAligned
            #else if $alignment.exclude == '--excludeUnaligned':
                --excludeUnaligned
            #end if
            $includeInverted
            $binary
            --minSize $minSize
            --logLevel "INFO"
            --outputFile '$out_file'
            #if $input_paf.ext.endswith(".gz")
                < gunzip -c '$input_paf' 
            #else:
                --inputFile '$input_paf'
            #end if
    ]]></command>
    <inputs>
        <expand macro="input_paf"/>
        <conditional name="alignment">
            <param name="exclude" type="select" label="Alignment coverage exclusion">
                <option value="" selected="true">Include intervals with any alignment coverage (default)</option>
                <option value="--excludeAligned">Exclude intervals with > 0 alignment coverage (--excludeAligned)</option>
                <option value="--excludeUnaligned">Exclude intervals with 0 alignment coverage (--excludeUnaligned)</option>
            </param>
            <when value=""/>
            <when value="--excludeAligned"/>
            <when value="--excludeUnaligned"/>
        </conditional>
        <param argument="--minSize" type="integer" min="1" value="1" label="Min size" help="Exclude any interval shorter than this given length"/> 
        <param argument="--binary" type="boolean" truevalue="--binary" falsevalue="" checked="false" label="Binary output for alignments" help="If enabled, outputs 0 for unaligned and 1 for aligned, rather than reporting the actual number of alignments"/>  
        <param argument="--includeInverted" type="boolean" truevalue="--includeInverted" falsevalue="" checked="false" label="Include target sequence" help="Flip the alignments to also include the target sequences"/>   
    </inputs>
    <outputs>
        <data name="out_file" format="bed" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <output name="out_file" ftype="bed" file="paffy_to_bed_output.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <output name="out_file" ftype="bed" file="paffy_to_bed_output.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <param name="minSize" value="100"/>
            <output name="out_file" ftype="bed" file="paffy_to_bed_minSize_output.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <param name="binary" value="true"/>
            <output name="out_file" ftype="bed" file="paffy_to_bed_binary_output.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <conditional name="alignment">
                <param name="exclude" value="--excludeUnaligned"/>
            </conditional>
            <output name="out_file" ftype="bed" file="paffy_to_bed_excludeUnaligned_output.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <conditional name="alignment">
                <param name="exclude" value="--excludeAligned"/>
            </conditional>
            <output name="out_file" ftype="bed" file="paffy_to_bed_excludeAligned_output.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <conditional name="alignment">
                <param name="exclude" value="--excludeUnaligned"/>
            </conditional>
            <param name="minSize" value="100"/>
            <param name="binary" value="true"/>
            <output name="out_file" ftype="bed" file="paffy_to_bed_multiple_output.bed"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <conditional name="alignment">
                <param name="exclude" value="--excludeUnaligned"/>
            </conditional>
            <param name="minSize" value="100"/>
            <param name="binary" value="true"/>
            <param name="includeInverted" value="true"/>
            <output name="out_file" ftype="bed" file="paffy_to_bed_multiple_includeInverted_output.bed"/>
        </test>
    </tests>
    <help><![CDATA[
Paffy to bed creates a BED file representing the coverage of alignments on the query sequences of the PAF alignments.
The output describes how many alignments cover each interval along the query sequences. 
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
<tool id="paffy_trim" name="Paffy trim" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>trims the ends of a PAF alignment</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        #if $input_paf.ext.endswith('.gz')
            gunzip -c '$input_paf' |
        #end if
        paffy trim
            #if $trim.byIdentity == 'true':
                --trimFraction $trim.trimFraction
                --trimIdentity $trim.trimIdentity
            #else:
                --trimFraction $trim.trimFraction
                --fixedTrim
            #end if
            --logLevel 'INFO'
            --outputFile '$out_file'
            #if not $input_paf.ext.endswith('.gz')
                --inputFile '$input_paf'
            #end if
    ]]></command>
    <inputs>
        <expand macro="input_paf"/>
        <conditional name="trim">
            <param name="byIdentity" type="select" label="Trimming options">
                <option value="true" selected="true">Trim based on identity (Default)</option>
                <option value="false">Trim by fixed length</option>
            </param>
            <when value="true">
                <param argument="--trimIdentity" type="float" min="0" value="0.05" max="1" label="Trim identity threshold" help="Trims tails where the identity falls below a threshold relative to the overall alignment identity. Formula: x - (x * t), where t is this value and x is the overall alignment identity based on the fraction of aligned and matched bases (if CIGAR encodes mismatches as 'X') or simply aligned bases. A value of 1 will result in no trim, while 0 will result in maximal trim. The final length trimmed is capped by the given 'Trim fraction' value below"/> 
                <expand macro="params_trimFraction"/>
            </when>
            <when value="false">
                <expand macro="params_trimFraction"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="out_file" format="paf" label="${tool.name} on ${on_string}: Trimmed PAF"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <conditional name="trim">
                <param name="byIdentity" value="true"/>
                <param name="trimIdentity" value="0.95"/>
                <param name="trimFraction" value="1"/>
            </conditional>
            <output name="out_file" ftype="paf" file="paffy_trim_byIdentity_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <conditional name="trim">
                <param name="byIdentity" value="true"/>
                <param name="trimIdentity" value="0.95"/>
                <param name="trimFraction" value="1"/>
            </conditional>
            <output name="out_file" ftype="paf" file="paffy_trim_byIdentity_output.paf"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <conditional name="trim">
                <param name="byIdentity" value="false"/>
                <param name="trimFraction" value="0.75"/>
            </conditional>
            <output name="out_file" ftype="paf" file="paffy_trim_output.paf"/>
        </test>
    </tests>
    <help><![CDATA[
Paffy trim removes bases from both ends of alignments in a PAF file.
The tool trims alignment ends where local identity drops below a threshold relative to the overall alignment identity, where the overall alignment identity is based on the fraction of aligned and matched bases (if CIGAR encodes mismatches as 'X') or simply aligned bases.
Alternatively, a fixed fraction of aligned bases can be trimmed from each end regardless of identity.
As output, a new PAF file is generated with the trimmed alignments.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
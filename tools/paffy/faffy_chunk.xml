<tool id="faffy_chunk" name="Faffy chunk" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>breaks FASTA file(s) into smaller files</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        faffy chunk
            #for $fasta_file in $input_fasta:
                #if $fasta_file.ext.endswith('.gz')
                    <(gunzip -c '$fasta_file')
                #else if $fasta_file.ext.endswith('.bz2')
                    <(bzip2 -dk '$fasta_file')
                #else
                    '$fasta_file'
                #end if
            #end for
            --logLevel 'INFO'
            --chunkSize $chunkSize
            --overlap $overlap
            --dir chunks
    ]]></command>
    <inputs>
        <expand macro="params_fastaList"/>
        <param argument="--chunkSize" type="integer" min="1" value="10000000" label="Chunk size" help="The chunk size of a sequence"/>   
        <param argument="--overlap" type="integer" min="0" value="100000" label="Overlap size" help="The overlap size (each chunked sequence will have the length: chunkSize + overlap)"/>   
    </inputs>
    <outputs>
        <collection name="out_chunks" type="list" label="${tool.name} on ${on_string}: Chunked FASTA">
            <discover_datasets pattern="(?P&lt;designation&gt;\d+)\.fa" directory="chunks" format="fasta"/>
        </collection>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_fasta">
                <collection type="list">
                    <element name="001" value="simCow.chr6.fasta.gz" ftype="fasta"/>
                </collection>
            </param>
            <param name="chunkSize" value="300000"/>
            <param name="overlap" value="0"/>
            <output_collection name="out_chunks" type="list" count="3">
                <element name="0" file="faffy_chunk_output/0.fa" ftype="fasta"/>
                <element name="1" file="faffy_chunk_output/1.fa" ftype="fasta"/>
                <element name="2" file="faffy_chunk_output/2.fa" ftype="fasta"/>
            </output_collection>
        </test>
        <test expect_num_outputs="1">
            <param name="input_fasta">
                <collection type="list">
                    <element name="001" value="simCow.chr6.fasta.bz2" ftype="fasta"/>
                    <element name="002" value="simDog.chr6.fasta" ftype="fasta"/>
                </collection>
            </param>
            <param name="chunkSize" value="300000"/>
            <param name="overlap" value="10"/>
            <output_collection name="out_chunks" type="list" count="4">
                <element name="0" file="faffy_chunk_overlap_output/0.fa" ftype="fasta"/>
                <element name="1" file="faffy_chunk_overlap_output/1.fa" ftype="fasta"/>
                <element name="2" file="faffy_chunk_overlap_output/2.fa" ftype="fasta"/>
                <element name="3" file="faffy_chunk_overlap_output/3.fa" ftype="fasta"/>
            </output_collection>
        </test>
    </tests>
    <help><![CDATA[
Faffy chunk breaks one or more FASTA sequences into smaller, overlapping chunks. 
Each chunk retains its position information by appending ``|Length|Start`` to the sequence header, where start is the 0-based coordinate in the original sequence.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
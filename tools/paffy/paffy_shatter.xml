<tool id="paffy_shatter" name="Paffy shatter" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>breaks up PAF alignments into individual matches</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive">
        <![CDATA[
        set -o pipefail; 
        
        ## Uncompress input PAF file if necessary and pipe it
        @UNCOMPRESS_PAF@

        ## Run main command
        paffy shatter
            --logLevel 'INFO'

        ## Compress output if requested by user 
        @COMPRESS_PAF@
    ]]></command>
    <inputs>
        <expand macro="input_paf"/>
        <expand macro="params_conditional_compression"/>
    </inputs>
    <outputs>
        <data name="out_file" format="paf" label="${tool.name} on ${on_string}">
            <change_format>
                <when input="compression.type" value="gz" format="paf.gz"/>
            </change_format>
        </data>
    </outputs>
    <tests>
        <!-- Test 1: Tool defaults -->
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf"/>
            <output name="out_file" ftype="paf">
                <assert_contents>
                    <has_text text="simDog.chr6&#009;593897&#009;3&#009;43&#009;+&#009;simCow.chr6&#009;602619&#009;2&#009;42&#009;40&#009;40&#009;255&#009;AS:i:103043&#009;s1:i:0&#009;cg:Z:40M"/>
                    <has_text text="cg:Z:40M2D83M1I16M1I183M4I33M1" negate="true"/>
                    <has_n_lines n="15175"/>
                </assert_contents>
            </output>
        </test>
        <!-- Test 2: Compressed input (.gz) -->
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <output name="out_file" ftype="paf">
                <assert_contents>
                    <has_text text="simDog.chr6&#009;593897&#009;3&#009;43&#009;+&#009;simCow.chr6&#009;602619&#009;2&#009;42&#009;40&#009;40&#009;255&#009;AS:i:103043&#009;s1:i:0&#009;cg:Z:40M"/>
                    <has_text text="cg:Z:40M2D83M1I16M1I183M4I33M1" negate="true"/>
                    <has_n_lines n="15175"/>
                </assert_contents>
            </output>
        </test>
        <!-- Test 3: Compressed input & output (.gz) -->
        <test expect_num_outputs="1">
            <param name="input_paf" value="testPaf.paf.gz"/>
            <conditional name="compression">
                <param name="type" value="gz"/>
            </conditional>
            <output name="out_file" ftype="paf.gz">
                <assert_contents>
                    <has_size size="241288"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
Paffy shatter breaks each alignment in a PAF file into smaller, gapless sub-alignments by splitting records at every indel event. 
It produces a separate PAF record for each contiguous block of aligned bases.
As output, a new PAF file is generated containing these shattered segments, with coordinates and CIGAR strings automatically recalculated for each individual block.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
<macros>
    <token name="@TOOL_VERSION@">1.0</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <token name="@PROFILE@">25.0</token>

    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">amas</requirement>
        </requirements>
    </xml>

    <xml name="version_command">
        <version_command>python -m amas.AMAS -h</version_command>
    </xml>

    <token name="@SYMLINK_INPUTS@"><![CDATA[
        ## Create symlinks with original filename for consistent tests
        #for $f in $input_files
            #set $safename_input = re.sub('[^\w\-_\.]', '_', $f.element_identifier)
            ln -s '${f}' "${safename_input}";
        #end for
    ]]></token>

    <token name="@INPUT_FILENAMES@"><![CDATA[
            #for $f in $input_files
                #set $safename_input = re.sub('[^\w\-_\.]', '_', $f.element_identifier)
                '${safename_input}'
            #end for
    ]]></token>

    <xml name="input_format">
        <param name="in_format" type="select" label="Format of the input file">
            <option value="fasta">fasta</option>
            <option value="phylip">phylip</option>
            <option value="phylip-int">phylip-int</option>
            <option value="nexus">nexus(sequential)</option>
            <option value="nexus-int">nexus(interleaved)</option>
        </param>
    </xml>

    <xml name="output_format" token_name="out_format" token_label="Format of the output file">
        <param name="out_format" type="select" label="@LABEL@">
            <option value="fasta">fasta</option>
            <option value="phylip">phylip</option>
            <option value="phylip-int">phylip-int</option>
            <option value="nexus">nexus (sequential)</option>
            <option value="nexus-int">nexus (interleaved)</option>
        </param>
    </xml>

    <xml name="data_type">
        <param name="data_type" type="select" label="Data type">
            <option value="aa">Protein alignments</option>
            <option value="dna">Nucleotide alignments</option>
        </param>
    </xml>

    <xml name="check_align">
        <param argument="--check-align" type="boolean" label="Check if input sequences are aligned" checked="false" truevalue="--check-align" falsevalue="" />
    </xml>

    <xml name="collection_outputs" token_name="alignments" token_label="alignment files">
        <collection name="@NAME@_fasta" type="list" label="@LABEL@ (FASTA)">
            <discover_datasets pattern="(?P&lt;name&gt;.+-out\..+)" format="fasta" />
            <filter>out_format == "fasta"</filter>
        </collection>
        
        <collection name="@NAME@_phylip" type="list" label="@LABEL@ (PHYLIP)">
            <discover_datasets pattern="(?P&lt;name&gt;.+-out\..+)" format="phylip" />
            <filter>out_format == "phylip" or out_format == "phylip-int"</filter>
        </collection>
        
        <collection name="@NAME@_nexus" type="list" label="@LABEL@ (NEXUS)">
            <discover_datasets pattern="(?P&lt;name&gt;.+-out\..+)" format="nex" />
            <filter>out_format == "nexus" or out_format == "nexus-int"</filter>
        </collection>
    </xml>

    <token name="@AMAS_SHARED_HELP@"><![CDATA[
        **About AMAS**

        AMAS (Alignment manipulation and summary statistics) is designed for modern phylogenomics workflows involving hundreds of taxa and thousands of loci.

        Source code and manual: https://github.com/marekborowiec/AMAS
    ]]></token>

    <xml name="citations">
        <citations>
            <citation type="doi">10.7717/peerj.1660</citation>
        </citations>
    </xml>
</macros>
<tool id="ucsc_maffrags" name="mafFrags" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@" license="MIT">
    <description>Extract MAFs from regions specified in a BED file</description>
    <macros>
        <token name="@TOOL_VERSION@">482</token>
        <token name="@VERSION_SUFFIX@">0</token>
        <token name="@PROFILE@">24.2</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">ucsc-maffrags</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        cp '$ucsc_db_connection' "\${HOME}/.hg.conf" &&
        chmod 600 "\${HOME}/.hg.conf" &&
        mafFrags '$genome' '$track' '$bed_file'
        $bed12
        $thickOnly   
        $meFirst
        $txStarts
        $refCoords
        out.maf
        ]]>
    </command>
    <configfiles>
        <configfile name="ucsc_db_connection"><![CDATA[
#European MariaDB server
db.host=genome-euro-mysql.soe.ucsc.edu
db.user=genomep
db.password=password
central.db=hgcentral
central.host=genome-euro-mysql.soe.ucsc.edu
central.user=genomep
central.password=password
gbdbLoc1=http://hgdownload.soe.ucsc.edu/gbdb/
forceTwoBit=on 
        ]]></configfile>
    </configfiles>
    <inputs>
        <param name="bed_file" type="data" format="bed" label="Input BED file" help="Input BED file can be either BED6 or BED12"/>
        <param name="genome" type="text" label="Enter Genome database name" help="Name should match with the UCSC Table Browser Entries (For Eg. mm10, hg19, hg38)"/>
        <param name="track" type="text" label="Enter UCSC Table name for desired table of the above genome" help="Table name should match with the UCSC Table Browser Entries (For eg. knownGene, all_mrna)"/>
        <param name="bed12" type="boolean" truevalue="-bed12" falsevalue="" label="BED12 format input" help="Check if your input BED file is BED12" checked="false"/>
        <param name="thickOnly" type="boolean" truevalue="-thickOnly" falsevalue="" label="Use only thickStart/thickEnd region" checked="false"/>
        <param name="meFirst" type="boolean" truevalue="-meFirst" falsevalue="" label="Put reference genome first in MAF" checked="false"/>
        <param name="txStarts" type="boolean" truevalue="-txStarts" falsevalue="" label="Add txstart r-lines" checked="false"/>
        <param name="refCoords" type="boolean" truevalue="-refCoords" falsevalue="" label="Output reference coordinates" checked="false"/>
    </inputs>
    <outputs>
        <data name="output" format="maf" from_work_dir="out.maf" label="${tool.name} on ${on_string}:Output MAF"/>
    </outputs>
    <tests>
        <!-- Test 01: Testing with default options -->
        <test expect_num_outputs="1">
            <param name="genome" value="hg19"/>
            <param name="track" value="multiz46way"/>
            <param name="bed_file" value="mafFrag_in.bed"/>
            <param name="bed12" value="false"/>
            <param name="thickOnly" value="false"/>
            <param name="meFirst" value="false"/>
            <param name="txStarts" value="false"/>
            <param name="refCoords" value="false"/>
            <output name="output" ftype="maf">
                <assert_contents>
                    <has_n_lines n="46"/>
                    <has_size value="1050494"/>
                </assert_contents>
            </output>
        </test>

        <!-- Test 02: Testing with bed12 options -->
        <test expect_num_outputs="1">
            <param name="genome" value="hg19"/>
            <param name="track" value="multiz46way"/>
            <param name="bed_file" value="mafFrag_in12.bed"/>
            <param name="bed12" value="true"/>
            <param name="thickOnly" value="false"/>
            <param name="meFirst" value="false"/>
            <param name="txStarts" value="false"/>
            <param name="refCoords" value="false"/>
            <output name="output" ftype="maf">
                <assert_contents>
                    <has_n_lines n="46"/>
                    <has_size value="1050408"/>
                </assert_contents>
            </output>
        </test>

        <!-- Test 03: Testing with onlyThick options -->
        <test expect_num_outputs="1">
            <param name="genome" value="hg19"/>
            <param name="track" value="multiz46way"/>
            <param name="bed_file" value="mafFrag_in12.bed"/>
            <param name="bed12" value="true"/>
            <param name="thickOnly" value="true"/>
            <param name="meFirst" value="false"/>
            <param name="txStarts" value="false"/>
            <param name="refCoords" value="false"/>
            <output name="output" ftype="maf">
                <assert_contents>
                    <has_n_lines n="45"/>
                    <has_size value="386279"/>
                </assert_contents>
            </output>
        </test>

        <!-- Test 04: Testing with meFirst options -->
        <test expect_num_outputs="1">
            <param name="genome" value="hg19"/>
            <param name="track" value="multiz46way"/>
            <param name="bed_file" value="mafFrag_in.bed"/>
            <param name="bed12" value="false"/>
            <param name="thickOnly" value="false"/>
            <param name="meFirst" value="true"/>
            <param name="txStarts" value="false"/>
            <param name="refCoords" value="false"/>
            <output name="output" ftype="maf">
                <assert_contents>
                    <has_n_lines n="46"/>
                    <has_size value="1050494"/>
                </assert_contents>
            </output>
        </test>

        <!-- Test 05: Testing with txStarts options -->
        <test expect_num_outputs="1">
            <param name="genome" value="hg19"/>
            <param name="track" value="multiz46way"/>
            <param name="bed_file" value="mafFrag_in.bed"/>
            <param name="bed12" value="false"/>
            <param name="thickOnly" value="false"/>
            <param name="meFirst" value="false"/>
            <param name="txStarts" value="true"/>
            <param name="refCoords" value="false"/>
            <output name="output" ftype="maf">
                <assert_contents>
                    <has_n_lines n="47"/>
                    <has_size value="1051077"/>
                </assert_contents>
            </output>
        </test>

        <!-- Test 06: Testing with refCoords options -->
        <test expect_num_outputs="1">
            <param name="genome" value="hg19"/>
            <param name="track" value="multiz46way"/>
            <param name="bed_file" value="mafFrag_in.bed"/>
            <param name="bed12" value="false"/>
            <param name="thickOnly" value="false"/>
            <param name="meFirst" value="false"/>
            <param name="txStarts" value="false"/>
            <param name="refCoords" value="true"/>
            <output name="output" ftype="maf">
                <assert_contents>
                    <has_n_lines n="46"/>
                    <has_size value="1051053"/>
                </assert_contents>
            </output>
        </test>
    </tests>

    <help><![CDATA[
mafFrags is a command-line tool from the UCSC Genome Browser suite that extracts multiple alignment format (MAF) blocks from a specified alignment track (e.g., multiz46way) based on genomic regions defined in a BED file. It is useful for retrieving alignments for specific genes, exons, or regions across multiple species.

    ]]></help>
        <citations>
            <citation type="bibtex">
                @misc{mafFrags,
                author = {Kent UCSC},
                title = {mafFrags: A tool for extracting MAFs from regions specified in a BED file},
                note = {Tool for extracting MAFs from regions specified in a BED file}
            </citation>
    </citations>
    <creator>
        <person givenName="Saim" familyName="Momin" url="https://github.com/SaimMomin12" identifier="https://orcid.org/0009-0003-9935-828X"/>
        <organization name="Galaxy Europe" url="https://galaxyproject.org/eu/"/>
    </creator>
</tool>

<tool id="bellerophon" name="Filter 5' chimeric reads" version="@VERSION@" profile="20.01">
    <description>from Arima-HiC alignments</description>
    <macros>
        <token name="@VERSION@">1.0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@VERSION@">bellerophon</requirement>
    </requirements>
    <version_command>bellerophon --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        #if $forward.ext == 'qname_sorted.bam':
            ln -s '${forward}' forward.bam &&
            ln -s '${forward.metadata.bam_index}' 'forward.bai' &&
        #end if

        #if $reverse.ext == 'qname_sorted.bam':
            ln -s '${reverse}' reverse.bam &&
            ln -s '${reverse.metadata.bam_index}' 'reverse.bai' &&
        #end if

        bellerophon
        --forward ./forward.bam
        --reverse ./reverse.bam
        --quality $quality
        --output '$outfile'
        ]]>
    </command>
    <inputs>
        <param argument="--forward" type="data" format="sam,qname_input_sorted" label="First set of reads" help="This is usually the forward reads in your experiment." />
        <param argument="--reverse" type="data" format="sam,qname_input_sorted" label="Second set of reads" help="This is usually the reverse reads in your experiment." />
        <param argument="--quality" type="integer" value="20" label="Minimum mapping quality" help="" />
    </inputs>
    <outputs>
        <data name="outfile" format="qname_input_sorted" />
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="forward" value="genomescope-in1.tab" />
            <param name="reverse" value="21" />
            <param name="quality" value="20" />
            <output name="outfile" file="merged-out.bam" ftype="qname_sorted.bam" />
        </test>
    </tests>
    <help><![CDATA[

Filter single-mapped aignment files (BAM,SAM, or CRAM) for chimeric-reads with a high-quality mapping on both sides of a ligation junction,
retaining the 5Â´ side of that mapping, then merge them into one paired-end BAM file.

This is often needed for HiC data generated with the Arima-HiC protocol.


]]>    </help>
    <citations>
    </citations>
</tool>

<tool id="odgi_untangle" name="odgi untangle" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="24.1">
    <description>project paths into reference-relative segments</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
odgi untangle
--input '$input'
#if str($query_path)
    --query-path '$query_path'
#end if
#if str($target_path)
    --target-path '$target_path'
#end if
#if str($query_paths)
    --query-paths '$query_paths'
#end if
#if str($target_paths)
    --target-paths '$target_paths'
#end if
#if str($merge_dist)
    --merge-dist $merge_dist
#end if
#if str($n_best)
    --n-best $n_best
#end if
#if str($min_jaccard)
    --min-jaccard $min_jaccard
#end if
#if str($cut_every)
    --cut-every $cut_every
#end if
$paf_output
#if str($cut_points_input)
    --cut-points-input '$cut_points_input'
#end if
#if $cut_points_output
    $cut_points_output '$cut_points'
#end if
#if str($step_index)
    --step-index '$step_index'
#end if
@THREADS@
> '$output'
    ]]></command>
    <inputs>
        <param argument="--input" type="data" format="odgi" label="Input odgi graph"/>
        <param argument="--query-path" type="text" optional="true" label="Single query path name"/>
        <param argument="--target-path" type="text" optional="true" label="Single target (reference) path name"/>
        <param argument="--query-paths" type="data" format="txt" optional="true" label="List of query paths" help="One path name per line."/>
        <param argument="--target-paths" type="data" format="txt" optional="true" label="List of target (reference) paths" help="One path name per line."/>
        <param argument="--merge-dist" type="integer" optional="true" min="0" label="Merge segments shorter than this length (bp)"/>
        <param argument="--n-best" type="integer" optional="true" min="1" label="Number of best mappings to report per segment"/>
        <param argument="--min-jaccard" type="float" optional="true" min="0" max="1" label="Minimum Jaccard threshold"/>
        <param argument="--cut-every" type="integer" optional="true" min="1" label="Cut every N base pairs before untangling"/>
        <param argument="--paf-output" type="boolean" truevalue="--paf-output" falsevalue="" checked="false" label="Emit PAF instead of BEDPE"/>
        <param argument="--cut-points-input" type="data" format="txt" optional="true" label="Preset cut-point node IDs"/>
        <param argument="--cut-points-output" type="boolean" truevalue="--cut-points-output" falsevalue="" checked="false" label="Write detected cut-point node IDs"/>
        <param argument="--step-index" type="data" format="txt" optional="true" label="Precomputed step index"/>
    </inputs>
    <outputs>
        <expand macro="standard_tabular_output"/>
        <data name="cut_points" format="tabular" label="${tool.name} on ${on_string}: cut points">
            <filter>cut_points_output</filter>
        </data>
    </outputs>
    <tests/>
    <help format="markdown"><![CDATA[
@HELP_HEADER@

`odgi untangle` lifts query paths into target (reference) space and reports a BEDPE (or PAF) table describing the projected segments.
Use it to decompose paralogous regions or explore complex relationships between haplotypes and references.

### Inputs

- **Input odgi graph**: Variation graph in `.og` format.
- **Single query/target path name**: Directly select paths in the graph.
- **List of query/target paths**: Supply text files (one path per line) for batch untangling.
- **Merge segments shorter than this length**: Smooth tiny fragments by merging into neighboring segments.
- **Number of best mappings / Minimum Jaccard threshold**: Tune sensitivity of reported hits.
- **Cut every N base pairs**: Enforce regular segments along the sorted graph.
- **Emit PAF instead of BEDPE**: Toggle output format.
- **Preset cut-point node IDs / Write detected cut-point node IDs**: Reuse or capture boundary nodes.
- **Precomputed step index**: Speed up position lookups with an external index.

### Outputs

- **Tabular**: Untangle results as BEDPE (default) or PAF.
- **cut points**: Optional list of node IDs where untangle introduced boundaries.
    ]]></help>
    <expand macro="citations"/>
</tool>

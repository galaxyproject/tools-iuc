<tool id="genomic_super_signature" name="GenomicSuperSignature" version="0.1.0" profile="20.01">
    <requirements>
        <requirement type="package" version="1.0.1">bioconductor-genomicsupersignature</requirement>
        <requirement type="package" version="1.7.1">r-optparse</requirement>
        <requirement type="package" version="2021d">tzdata</requirement>
        <!--
        <requirement type="package" version="1.1">openssl</requirement>
        -->
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        TMPDIR="\$PWD" Rscript gss.R --input '$input' --model '$model' --method '$method'  --maxFrom '$maxFrom' --level '$level' --scale '$scale' --numOut $numOut --outDir out
    ]]></command>
    <inputs>
        <param argument="--input" type="data" format="tabular,tsv" label="Tabular count matrix"/>
        <param argument="--model" type="data" format="rdata" label="RAVmodel to apply" help="You can download a model using the GenomicSuperSingature Downloader tool"/>
        <param argument="--method" type="select" label="Select a correlation coefficient">
            <option value="pearson">Pearson</option>
            <option value="kendall">Kendall</option>
            <option value="spearman">Spearman</option>
        </param>
        <param argument="--maxFrom" type="select" label="Select whether to display the maximum value from dataset's PCs or avgLoadings" help="With Principal Component (PC), the maximum correlation coefficient from top 8 PCs for each avgLoading will be selected as an output. If you choose Average Loading, the Average Loading with the maximum correlation coefficient with each Principal Component will be in the output.">
            <option value="pc">Principal Components</option>
            <option value="avgLoading">Average Loading</option>
        </param>
        <param argument="--level" type="select" label="Output format of validated result" help="max will output the matrix containing only the maximum coefficient. To get the coefficient of all 8 PCs, set this argument to all.">
            <option value="max">Max</option>
            <option value="all">All</option>
        </param>
        <param argument="--scale" type="boolean" truevalue="TRUE" falsevalue="FALSE" checked="false" label="Normalize rows of datasets?"/>
        <param argument="--numOut" type="integer" min="1" value="3" label="The number of top validated RAVs to check"/>
    </inputs>
    <outputs>
        <data name="plots" format="pdf" label="GenomicSuperSignature plots"/>
    </outputs>
    <tests>
        <test>
            <param name="input" value="bcellViperExpr.tsv" ftype="tabular"/>
            <param name="model" value="RAVmodel_PLIERpriors.rds" ftype="rds"/>
            <param name="method" value="Pearson"/>
            <param name="maxFrom" value="Principal Components"/>
            <param name="level" value="Max"/>
            <param name="numOut" value="1"/>
            <output name="plots" value="plotOut.pdf" ftype="pdf"/>
        </test>
    </tests>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>

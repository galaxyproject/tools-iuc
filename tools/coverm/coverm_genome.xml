<tool id="coverm-genome" name="CoverM-GENOME" version="@TOOL_VERSION@" python_template_version="3.5">
    <macros>
        <import>macros.xml</import>
        <token name="@INPUT_FORMATS@">fa,fna,fasta,fastq,fastq.gz,fasta.gz,fna.gz,fa.gz</token>
        <token name="@TOOL_VERSION@">0.2.1</token>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[

        coverm genome
            #if $reads.read_type == "paired":
                -1 ${" ".join(map(str, $reads.read1))}
                -2 ${" ".join(map(str, $reads.read2))}
            #end if
            #if $reads.read_type == "paired_collection":
                -c {" ".join(map(str, $reads.paired_reads))}
            #end if
            #if $reads.read_type == "single":
                --single $reads.read1
            #end if
            #if $reads.read_type == "interleaved":
                --interleaved {" ".join(map(str, $reads.interleaved))}
            #end if
            #if $reads.read_type == "bam":
                -b {" ".join(map(str, $reads.bam))}
            #end if
            #if $genome.select_genome == "single_ref":
                #if $genome.ref_source.source == "history":
                    -r $genome.ref_source.ref_fasta_history
                #end if
                #if $genome-ref_source.source == "builtin":
                    -r $genome_ref_source.ref_fasta.builtin.fields.path
                #end if
                $genome.ref_as_index
                #if $genome.separator:
                    -s $genome.separator
                #end if
                $genome.single_genome
                $genome.genome_definition
            #elif $genome-select_genome == "multiple_genomes":
                -f {" ".join(map(str, $genome.genomes))}
            #end if
            -o output.tsv

    ]]></command>
    <inputs>
        <expand macro="reads"/>
        <conditional name="genome">
            <param type="select" label="Choose whether you want to provide a single FASTA file of contigs as genome reference or multiple FASTA files." name="select_genome" >
                <option value="single_ref">Single reference</option>
                <option value="multiple_genomes">Multiple genomes</option>
            </param>
            <when value="multiple_genomes">
                <param type="data" name="genomes" format="fasta" multiple="true" label="FASTA files of each genome" />
            </when>
            <when value="single_ref" >
                        <conditional name="ref_source">
                            <param type="select" label="Reference genome source" name="source">
                                <option value="history" selected="true">History</option>
                                <option value="builtin">Built-in</option>
                            </param>
                            <when value="history">
                                <param type="data" name="ref_fasta_history" label="Single FASTA file of contigs" format="fasta" />
                            </when>
                            <when value="builtin">
                                <param type="select" name="ref_fasta_builtin" label="Reference genome">
                                    <options from_data_table="all_fasta" />
                                </param>
                            </when>
                        </conditional>
                <param type="boolean" name="ref_as_index" truevalue="--minimap2-reference-is-index" falsevalue="" optional="true" label="Treat reference as a minimap2 database, not as a FASTA file." />
                <param type="text" name="separator" optional="true" label="Character, that separates genome names from contig names in the reference file." >
                    <option value=" ">Space</option>
                    <option value=",">Comma</option>
                    <option value=";">Semicolon</option>
                    <option value="-">Hyphen</option>
                </param>
                <param type="boolean" name="single_genome" truevalue="--single-genome" falsevalue="" optional="true" label="Treat the reference file as single genome" />
                <param type="data" name="genome_definition" format="tsv" label="File containing newline-separated list of genome_name and contig, separated by tab, to define the genome of each contig." />
            </when>
        </conditional> 
    </inputs>
    <outputs>
        <data name="output1" format="tsv" from_work_dir="./output.tsv"/>
    </outputs>
    <tests>
        <test>
            <param name="read_type" value="paired"/>
            <param name="read1" value="test1.fastq.gz"/>
            <param name="read2" value="test2.fastq.gz"/>
            <param name="selcet_genome" value="single_ref"/>
            <param name="source" value="builtin"/>
            <param name="ref_fasta_builtin" value="TestGenome"/>
            <param name="separator" value=" "/>
            <output name="output1" file="output.tsv" ftype="tsv"/>
        </test>
    </tests>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
</tool>
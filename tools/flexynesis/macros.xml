<macros>
    <token name="@TOOL_VERSION@">0.2.10</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <token name="@PROFILE@">24.1</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">flexynesis</requirement>
            <yield/>
        </requirements>
    </xml>
    <xml name="edam">
        <edam_topics>
            <edam_topic>topic_0622</edam_topic>
            <edam_topic>topic_3474</edam_topic>
            <edam_topic>topic_2640</edam_topic>
        </edam_topics>
        <edam_operations>
            <edam_operation>operation_3197</edam_operation>
            <edam_operation>operation_2403</edam_operation>
            <edam_operation>operation_2426</edam_operation>
        </edam_operations>
    </xml>
    <xml name="advanced">
        <section name="advanced" title="Advanced Options">
            <param argument="--fusion_type" type="select" label="Fusion method" help="How to fuse the omics layers?">
                <option value="intermediate">intermediate</option>
                <option value="early">early</option>
            </param>
            <param argument="--finetuning_samples" type="integer" min="0" value="0" label="fine-tuning" help="Number of samples from the test dataset to use for fine-tuning the model. Set to 0 to disable fine-tuning." />
            <param argument="--variance_threshold" type="float" min="0" max="100" value="1" label="Variance threshold" help="Variance threshold (as percentile) to drop low variance features. Set to 0 for no variance filtering." />
            <param argument="--correlation_threshold" type="float" min="0" max="1" value="0.8" label="Correlation threshold" help="Correlation threshold to drop highly redundant features. Set to 1 for no redundancy filtering." />
            <param argument="--subsample" type="integer" min="0" value="0" label="Subsample" help="Downsample training set to randomly drawn N samples for training." />
            <param argument="--features_min" type="integer" min="0" value="500" label="Features min" help="Minimum number of features to retain after feature selection." />
            <param argument="--features_top_percentile" type="float" min="0" value="20" label="Features top percentile" help="Top percentile features (among the features remaining after variance filtering and data cleanup) to retain after feature selection." />
            <param argument="--log_transform" type="boolean" truevalue="True" falsevalue="False" checked="false" label="log transform" help="Whether to apply log-transformation to input data matrices. " />
            <param argument="--early_stop_patience" type="integer" min="-1" value="10" label="Early stop patience" help="How many epochs to wait when no improvements in validation loss are observed. Set to -1 to disable early stopping." />
            <param argument="--hpo_iter" type="integer" min="1" value="100" label="Hyperparameter Iterations" help="Number of iterations for hyperparameter optimisation." />
            <param argument="--hpo_patience" type="integer" min="0" value="10" label="Hyperparameter patience" help="How many hyperparameter optimisation iterations to wait for when no improvements are observed. Set to 0 to disable early stopping." />
            <param argument="--use_cv" type="boolean" truevalue="--use_cv" falsevalue="" checked="false" label="Cross validation" help="If set, a 5-fold cross-validation training will be done. Otherwise, a single training on 80 percent of the dataset is done. " />
            <param argument="--use_loss_weighting" type="boolean" truevalue="True" falsevalue="False" checked="true" label="Loss weighting" help="Whether to apply loss-balancing using uncertainty weights method." />
            <param argument="--evaluate_baseline_performance" type="boolean" truevalue="--evaluate_baseline_performance" falsevalue="" checked="false" label="Evaluate baseline performance" help="Enables modeling also with Random Forest + SVMs to see the performance of off-the-shelf tools on the same dataset." />
            <param argument="--disable_marker_finding" type="boolean" truevalue="--disable_marker_finding" falsevalue="" checked="false" label="Disable marker finding" help="f set, marker discovery after model training is disabled." />
        </section>
    </xml>
    <xml name="all_param">
        <param name="train" type="data" format="csv" multiple="true" label="Train data" help="You need one clin.csv and at least one omics.csv"/>
        <param name="test" type="data" format="csv" multiple="true" label="Test data" help="You need one clin.csv and at least one omics.csv"/>
        <param argument="--data_types" type="text" optional="false" label="Data types" help="Which omics data matrices to work on; comma-separated (e.g., 'gex,cnv').">
            <sanitizer invalid_char="">
                <valid initial="string.printable"></valid>
            </sanitizer>
        </param>
        <conditional name="training_type">
            <param name="model" type="select" label="Type of Analysis" >
                <option value="s_train">Supervised training</option>
                <option value="us_train">Unsupervised Training</option>
                <option value="cm_train">Cross-modality Training</option>
            </param>
            <when value="s_train">
                <conditional name="model_class" label="Model class">
                    <param argument="--model_class" type="select" label="Model class" help="The kind of model class to instantiate">
                        <option value="DirectPred">DirectPred</option>
                        <option value="GNN">GNN</option>
                        <option value="MultiTripletNetwork">MultiTripletNetwork</option>
                        <option value="RandomForest">RandomForest</option>
                        <option value="SVM">SVM</option>
                        <option value="RandomSurvivalForest">RandomSurvivalForest</option>
                    </param>
                    <when value="DirectPred"></when>
                    <when value="GNN">
                        <param argument="--gnn_conv_type" type="select" label="GNN convolution type" help="Which graph convolution type to use.">
                            <option value="GC">GC</option>
                            <option value="GCN">GCN</option>
                            <option value="SAGE">SAGE</option>
                        </param>
                        <param argument="--string_organism" type="select" label="string organism" help="STRING DB organism">
                            <option value="9606">Homo sapiens</option>
                            <option value="10090">Mus musculus</option>
                            <option value="10116">Rattus norvegicus</option>
                            <option value="9544">Macaca mulatta</option>
                        </param>
                        <param argument="--string_node_name" type="select" label="String node name" help="">
                            <option value="gene_name">Gene name</option>
                            <option value="gene_id">Gene id</option>
                        </param>
                    </when>
                    <when value="MultiTripletNetwork"/>
                    <when value="RandomForest"></when>
                    <when value="SVM"></when>
                    <when value="RandomSurvivalForest"></when>
                </conditional>
                <param argument="--target_variables" type="text" label="Target variables" help="Which variables in 'clin.csv' to use for predictions, comma-separated if multiple.">
                    <sanitizer invalid_char="">
                        <valid initial="string.printable"></valid>
                    </sanitizer>
                </param>
                <param argument="--surv_event_var" type="text" label="Survival event" help="Which column in 'clin.csv' to use as event/status indicator for survival modeling.">
                    <sanitizer invalid_char="">
                        <valid initial="string.printable"></valid>
                    </sanitizer>
                </param>
                <param argument="--surv_time_var" type="text" label="Survival time" help="Which column in 'clin.csv' to use as time/duration indicator for survival modeling.">
                    <sanitizer invalid_char="">
                        <valid initial="string.printable"></valid>
                    </sanitizer>
                </param>
                <expand macro="advanced"/>
            </when>
            <when value="us_train">
                <param argument="--model_class" type="select" label="Model class" help="The kind of model class to instantiate">
                    <option value="supervised_vae">supervised_vae</option>
                </param>
                <expand macro="advanced"/>
            </when>
            <when value="cm_train">
                <param argument="--model_class" type="select" label="Model class" help="The kind of model class to instantiate">
                    <option value="CrossModalPred">CrossModalPred</option>
                </param>
                <param argument="--input_layers" type="text" label="Input layers" help="Which data types to use as input/encoded layers, comma-separated if multiple.">
                    <sanitizer invalid_char="">
                        <valid initial="string.printable"></valid>
                    </sanitizer>
                </param>
                <param argument="--output_layers" type="text" label="Output layers" help="Which data types to use as output/decoded layers, comma-separated if multiple.">
                    <sanitizer invalid_char="">
                        <valid initial="string.printable"></valid>
                    </sanitizer>
                </param>
                <expand macro="advanced"/>
            </when>               
        </conditional>   
    </xml>
    <xml name="citations">
        <citations>
            <citation type="doi">10.1101/2024.07.16.603606</citation>
        </citations>
    </xml>
</macros>

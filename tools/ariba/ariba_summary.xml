<tool id="ariba_sum" name="ARIBA summary" version="@VERSION@">
    <description>
        Summarises the results from one or more runs of ARIBA
    </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="version_command" />

    <command detect_errors="exit_code"><![CDATA[
        
        #import re
        ## Creates symlinks for each input file based on the Galaxy 'element_identifier'
        ## Used so that a human-readable name appears in the output table (instead of 'dataset_xyz.dat')
        #set $named_input_files = ''
        #for $input_file in $ariba_reports
            ## Add single quotes around each input file identifier
            ##set $_input_file = "'{}'".format($input_file.element_identifier)
            #set $_input_file = re.sub('[^\w\-_\.]', '_', $input_file.element_identifier)
            ln -s '${input_file}' ${_input_file} &&
            #set $named_input_files = $named_input_files + ' ' + $_input_file
        #end for
        ariba summary 
        
        --preset $options.preset

        #if $options.no_tree
            $options.no_tree
        #end if

        --min_id $options.min_id
        out 

        '$named_input_files'

    ]]>    </command>
    <inputs>
        <param name="ariba_reports" format="tabular,txt" type="data" multiple="true" label="Report (tsv) file from ARIBA run" help="This command requires one or more report tsv file generated by ARIBA run command."/>
        <section name="options" title="Optional Arguments">
                <param name="preset" type="select" label="Select a preset">
                    <option value="minimal" selected="True">minimal</option>
                    <option value="cluster_all">cluster all</option>
                    <option value="cluster_var_groups">cluster var groups</option>
                    <option value="all">all</option>
                    <option value="all_no_filter">all no filter</option>
                </param>   
                <param argument="--no_tree" type="boolean" truevalue="--no_tree" falsevalue="" checked="false" label="Do not make phandango tree" help="" />
                <param argument="--min_id" type="integer" value="90" label="Minimum percent identity cutoff to count as assembled" help="(Default: 90)"/>
        </section>
    </inputs>

    <outputs>
        <data name="log" format="tabular"  label="${tool.name} on ${on_string} log file"/>
        <data name="summary_csv" format="tabular"  label="${tool.name} on ${on_string} report file" from_work_dir="out.csv" />
        <data name="phandango_csv" format="csv" label="${tool.name} on ${on_string}: Phandango CSV" from_work_dir="out.phandango.csv" />
        <data name="phandango_tree" format="tre" label="${tool.name} on ${on_string}: Phandango Tree file" from_work_dir="out.phandango.tre">
            <filter>no_tree is False</filter>
        </data>
    </outputs>

    <help><![CDATA[
            **Usage**: ariba summary out in.report.1.tsv in.report.2.tsv ...

            This tool summarises the results from one or more runs of ARIBA.
           
    ]]>    </help>

    <expand macro="citations" />
</tool>
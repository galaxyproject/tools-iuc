<tool id="cramtools" name="cramtools BAM to CRAM" version="3.0">
    <description>cramtools converting BAM to CRAM format</description>

    <macros>
        <import>cramtools_macros.xml</import>
    </macros>

    <expand macro="requirements" />
    <expand macro="stdio" />
    <expand macro="version_command" />

    <command>
    <!--
      Options:
         - -capture-all-tags              Capture all tags. (default: false)
         - -capture-tags                  Capture the tags listed, for example 'OQ:XA:XB' (default: )
         - -encrypt                       Encrypt the CRAM file. (default: false)
         - -ignore-md5-mismatch           Fail on MD5 mismatch if true, or correct (overwrite) the checksums and continue if false. (default: false)
         - -ignore-tags                   Ignore the tags listed, for example 'OQ:XA:XB' (default: )
         - -inject-sq-uri                 Inject or change the @SQ:UR header fields to point to ENA reference service.  (default: false)
         - -lossless-quality-score, -Q    Preserve all quality scores. Overwrites ' - -lossless-quality-score'. (default: false)
         - -lossy-quality-score-spec, -L  A string specifying what quality scores should be preserved. (default: )
         - -max-records                   Stop after compressing this many records.  (default: 9223372036854775807)
         - -preserve-read-names, -n       Preserve all read names. (default: false)
    -->
    <![CDATA[
        @PREPROCESS_FASTA_FILE@
        
        java
            -jar \$CRAMTOOLS_ROOT_DIR/jars/cramtools-3.0.jar
            cram
                -l INFO
                
                --capture-all-tags
            
                #if str($input_alignment.ext) == 'sam':
                    --input-is-sam 
                #end if
        
                -I $input_alignment
                -R "${input_reference}.fa"
                -O $output_alignment
    ]]>
    </command>

    <inputs>
        <param name="input_alignment" type="data" format="bam,sam" label="BAM or SAM alignment file"/>
        <param name="input_reference" type="data" format="fasta" label="FASTA reference"/>
    </inputs>

    <outputs>
        <data format="cram" name="output_alignment" label="{$tool.name} on ${on_string}"></data>
    </outputs>

    <tests>
        <test>
            <param name="input_alignment" value="test.bam" ftype="bam" />
            <param name="input_reference" value="test.fa" />
            
            <output name="output_alignment" file="test.cram"  compare="sim_size" delta="250" /><!-- Some headers may change, depending on file paths -->
        </test>
        <test>
            <param name="input_alignment" value="test.sam" ftype="sam" />
            <param name="input_reference" value="test.fa" />
            
            <output name="output_alignment" file="test.cram"  compare="sim_size" delta="250" /><!-- Some headers may change, depending on file paths -->
        </test>
    </tests>

    <help>
    </help>

    <citations>
    </citations>
</tool>

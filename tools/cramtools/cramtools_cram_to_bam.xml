<tool id="cramtools" name="cramtools CRAM to BAM" version="3.0">
    <description>cramtools converting CRAM to BAM format</description>

    <macros>
        <import>cramtools_macros.xml</import>
    </macros>

    <expand macro="requirements" />
    <expand macro="stdio" />
    <expand macro="version_command" />

    <command>
    <![CDATA[
        @PREPROCESS_FASTA_FILE@
        
        java
            -jar \$CRAMTOOLS_ROOT_DIR/jars/cramtools-3.0.jar
            bam
                -l INFO
                -b
                
                $calculate_md_tag
                $calculate_nm_tag
                --default-quality-score $default_quality_score
                
                -I $input_alignment
                -R "${reference_source.input_reference}.fa"
                -O $output_alignment
    ]]>
    </command>

    <inputs>
        <param name="input_alignment" type="data" format="cram" label="CRAM file"/>
        <expand macro="fasta_input" />
        
        <param name="calculate_md_tag" type="boolean" truevalue="--calculate-md-tag" falsevalue="" checked="false" label="Calculate MD tag." />
        <param name="calculate_nm_tag" type="boolean" truevalue="--calculate-nm-tag" falsevalue="" checked="false" label="Calculate NM tag." />
        
        <param name="default_quality_score" type="integer" min="33" value="63" label="Base quality score used as a default value when the original quality score was lost due to compression."  help="Only works if the initial CRAM file was made with lossy base quality compression" />
    </inputs>

    <outputs>
        <data name="output_alignment" format="bam" label="$tool.name on ${on_string}"/>
    </outputs>

    <tests>
        <test>
            <param name="input_alignment" value="test.cram" />
            <param name="reference_source_selector" value="history" />
            <param name="input_reference" value="test.fa" />

            <param name="calculate_md_tag" value="" />
            <param name="calculate_nm_tag" value="" />
            <param name="default_quality_score" value="63" />


            <output name="output_alignment" file="test.bam"  compare="sim_size" delta="250" />
        </test>
    </tests>

    <help>
**What this tool does**

Converts alignments from the CRAM format to the BAM format.
    </help>

    <citations>
    </citations>
</tool>

<tool id="inspect-eset" name="Inspect ESet Object" version="@GALAXY_VERSION@+@PACKAGE_VERSION@"
      python_template_version="3.5" license="GPL-3.0-or-later" >
    <macros>
        <token name="@GALAXY_VERSION@">0</token>
        <!-- The ESet inspector and MuSiC tool can have independent Galaxy versions
             but should reference the same package version always. -->
        <token name="@PACKAGE_VERSION@">0.1.1</token>
    </macros>
    <requirements>
        <requirement type="package" version="@PACKAGE_VERSION@" >music-deconvolution</requirement>
        <requirement type="package" version="0.9.3" >r-cowplot</requirement>
        <requirement type="package" version="1.4.4" >r-reshape2</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
Rscript --vanilla '$__tool_directory__/scripts/inspect.R' '$conf'
]]></command>
    <configfiles>
        <configfile name="conf" >

null_str_vec = function(gstr){
   tokens = unlist(as.vector(strsplit(gstr, split=",")))
   if (length(tokens) == 0){
      return(NULL)
   }
   if (length(tokens) == 1){
      return(tokens[[1]])
   }
   return(tokens)
}

rds_eset = readRDS('$rds_eset')
inspector = null_str_vec('$inspector')
outfile_tab='$out_tab'

        </configfile>
    </configfiles>
    <inputs>
        <param name="rds_eset" label="ESet Dataset" type="data" format="rdata.eset" />
        <param name="inspector" label="Inspect" type="select"
               help="Inspect an aspect of the ESet dataset" >
            <!-- See: https://www.rdocumentation.org/packages/Biobase/versions/2.32.0/topics/eSet -->
            <option value="print" selected="true">General Information</option>
            <option value="exprs" >Expression Data Table</option>
            <option value="pData" >PhenoType Data Table</option>
            <option value="fData" >Feature Data Table</option>
            <option value="dims" >Dimension</option>
            <option value="experimentData" />
            <option value="signature" />
            <option value="annotation" />
            <option value="abstract" />
        </param>
    </inputs>
    <outputs>
        <data name="out_tab" format="tabular" label="${tool.name} on ${on_string}: Inspection Result" />
    </outputs>
    <tests>
        <test expect_num_outputs="1" >
            <!-- Inspect 0 -->
            <param name="rds_eset" value="EMTABesethealthy.subset.rds" />
            <param name="inspector" value="print" />
            <output name="out_tab" >
                <assert_contents>
                    <has_text text="sampleNames: AZ_A10 AZ_A11 ... HP1502401_K15 (250 total)" />
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1" >
            <!-- Inspect 1 -->
            <param name="rds_eset" value="EMTABesethealthy.subset.rds" />
            <param name="inspector" value="pData" />
            <output name="out_tab" >
                <assert_contents>
                    <has_n_columns n="5" />
                    <has_text_matching expression="AZ_A10\s+1\s+Non T2D\s+1\s+5\s+delta" />
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1" >
            <!-- Inspect 2 -->
            <param name="rds_eset" value="EMTABesethealthy.subset.rds" />
            <param name="inspector" value="dims" />
            <output name="out_tab" >
                <assert_contents>
                    <has_n_columns n="1" />
                    <has_text_matching expression="Samples\s+\d{1,4}"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
    <citations>
        <citation type="bibtex">
            @misc{falcon2007introduction,
            title={An introduction to bioconductorâ€™s expressionset class},
            author={Falcon, Seth and Morgan, Martin and Gentleman, Robert},
            year={2007}
            }
        </citation>
    </citations>
</tool>
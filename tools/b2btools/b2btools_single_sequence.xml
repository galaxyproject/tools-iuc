<tool
    id="b2btools_single_sequence"
    name="b2bTools: Biophysical predictors for single sequences"
    version="3.0.5+galaxy0"
    license="GPL-3.0"
    python_template_version="3.5"
    profile="21.05">
    <description>from their amino-acid sequences</description>
    <xrefs>
        <xref type="bio.tools">b2btools</xref>
    </xrefs>
    <requirements>
        <requirement type="package" version="3.0.5">b2btools</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
mkdir -p ./tabular ./plots &&
python '$__tool_directory__/script.py' --file '$input' --output ./tabular --json '$predictions_output'
#if $section_predictors.dynamine == 'true':
    --dynamine
#end if
#if $section_predictors.disomine == 'true':
    --disomine
#end if
#if $section_predictors.efoldmine == 'true':
    --efoldmine
#end if
#if $section_predictors.agmata == 'true':
    --agmata
#end if
#if $section_plot.plot == 'true' or $section_plot.plot_all == 'true':
    --plot-output ./plots
#end if
#if $section_plot.plot == 'true':
    --plot
#end if
#if $section_plot.plot_all == 'true':
    --plot_all
#end if
#if $section_plot.highlight == 'true':
    --highlight
#end if
    ]]></command>
    <inputs>
        <param type="data" name="input" format="fasta" label="Protein sequences in FASTA format" help="FASTA file of protein sequences"/>
        <section name="section_predictors" title="Biophyisical predictors" help="Configure this section to select the predictions to be executed">
            <param
                name="dynamine"
                type="boolean"
                label="DynaMine: Dynamics"
                truevalue="true"
                falsevalue="false"
                help="Fast predictor of protein backbone dynamics using only sequence information as input. The version here also predicts side-chain dynamics and secondary structure predictors using the same principle." />
            <param
                name="disomine"
                type="boolean"
                label="DisoMine: Disorder"
                truevalue="true"
                falsevalue="false"
                help="Predicts protein disorder with recurrent neural networks not directly from the amino acid sequence, but instead from more generic predictions of key biophysical properties, here protein dynamics, secondary structure and early folding."/>
            <param
                name="efoldmine"
                type="boolean"
                label="EFoldMine: Early folding"
                truevalue="true"
                falsevalue="false"
                help="Predicts from the primary amino acid sequence of a protein, which amino acids are likely involved in early folding events."/>
            <param
                name="agmata"
                type="boolean"
                label="Agmata: Beta aggregation"
                truevalue="true"
                falsevalue="false"
                help="Single-sequence based predictor of protein regions that are likely to cause beta-aggregation."/>
        </section>
        <section name="section_plot" title="Plot options" help="Configure plot output">
            <param
                name="plot"
                type="boolean"
                label="Plot predicted values by sequence"
                truevalue="true"
                falsevalue="false"
                help="This option plots predicted values in different files"/>
            <param
                name="plot_all"
                type="boolean"
                label="Plot all sequences together"
                truevalue="true"
                falsevalue="false"
                help="This option plots all sequences together in order to compare predicted values of different sequences"/>
            <param
                name="highlight"
                type="boolean"
                label="Highlight regions of interest"
                truevalue="true"
                falsevalue="false"
                help="Highlight biophysical regions on the background of the plots"/>
        </section>
    </inputs>
    <outputs>
        <data name="predictions_output" label="Predictions in JSON format" format="json" />
        <collection name="split_output" type="list" label="Tabular predictions by sequence">
            <discover_datasets pattern="__name_and_ext__" format="tabular" directory="tabular" visible="true" />
        </collection>
        <collection name="split_output_plots" type="list" label="Plots">
            <discover_datasets pattern="__name_and_ext__" format="png" directory="plots" visible="true" />
        </collection>
    </outputs>
    <tests>
        <!-- Test 1: All the predictors were selected, plotting both individual and aggregated charts -->
        <test expect_exit_code="0">
            <param name="input" value="input.fasta" ftype="fasta"/>
            <section name="section_predictors">
                <param name="dynamine" value="true"/>
                <param name="disomine" value="true"/>
                <param name="efoldmine" value="true"/>
                <param name="agmata" value="true"/>
            </section>
            <section name="section_plot">
                <param name="plot" value="true"/>
                <param name="plot_all" value="true"/>
                <param name="highlight" value="true"/>
            </section>
            <assert_command>
                <has_text text="--dynamine" />
                <has_text text="--disomine" />
                <has_text text="--agmata" />
                <has_text text="--efoldmine" />
                <has_text text="--json" />
                <has_text text="--plot_all" />
                <has_text text="--highlight" />
                <has_text text="--highlight" />
                <has_text text="--output" />
                <has_text text="--plot-output" />
            </assert_command>
            <output name="predictions_output" value="test_output.json" ftype="json"/>
            <!-- 11 sequences = 11 TSV files -->
            <output_collection name="split_output" type="list" count="11">
                <element name="random_sequence_01_consisting_of_40_residues" file="random_sequence_01_consisting_of_40_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_02_consisting_of_40_residues" file="random_sequence_02_consisting_of_40_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_03_consisting_of_30_residues" file="random_sequence_03_consisting_of_30_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_04_consisting_of_40_residues" file="random_sequence_04_consisting_of_40_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_05_consisting_of_30_residues" file="random_sequence_05_consisting_of_30_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_06_consisting_of_45_residues" file="random_sequence_06_consisting_of_45_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_07_consisting_of_30_residues" file="random_sequence_07_consisting_of_30_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_08_consisting_of_40_residues" file="random_sequence_08_consisting_of_40_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_09_consisting_of_30_residues" file="random_sequence_09_consisting_of_30_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_10_consisting_of_65_residues" file="random_sequence_10_consisting_of_65_residues.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_11_consisting_of_30_residues" file="random_sequence_11_consisting_of_30_residues.tsv" ftype="tsv" compare="diff"/>
            </output_collection>
            <!-- 9 predicted values x 11 sequences + 9 predicted values aggregated = (99 + 9) charts = 108 charts -->
            <output_collection name="split_output_plots" type="list" count="108" />
        </test>
        <!-- Test 2: Only one predictor was selected, plotting both individual and aggregated charts -->
        <test>
            <param name="input" value="input.fasta" ftype="fasta"/>
            <section name="section_predictors">
                <param name="dynamine" value="true"/>
                <param name="disomine" value="false"/>
                <param name="efoldmine" value="false"/>
                <param name="agmata" value="false"/>
            </section>
            <section name="section_plot">
                <param name="plot" value="true"/>
                <param name="plot_all" value="true"/>
                <param name="highlight" value="true"/>
            </section>
            <assert_command>
                <has_text text="--dynamine" />
                <not_has_text text="--disomine" />
                <not_has_text text="--agmata" />
                <not_has_text text="--efoldmine" />
                <has_text text="--json" />
                <has_text text="--plot " />
                <has_text text="--plot_all" />
                <has_text text="--highlight" />
                <has_text text="--output" />
                <has_text text="--plot-output" />
            </assert_command>
            <output name="predictions_output" value="test_output_dynamine.json" ftype="json"/>
            <!-- 11 sequences = 11 TSV files -->
            <output_collection name="split_output" type="list" count="11">
                <element name="random_sequence_01_consisting_of_40_residues" file="random_sequence_01_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_02_consisting_of_40_residues" file="random_sequence_02_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_03_consisting_of_30_residues" file="random_sequence_03_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_04_consisting_of_40_residues" file="random_sequence_04_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_05_consisting_of_30_residues" file="random_sequence_05_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_06_consisting_of_45_residues" file="random_sequence_06_consisting_of_45_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_07_consisting_of_30_residues" file="random_sequence_07_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_08_consisting_of_40_residues" file="random_sequence_08_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_09_consisting_of_30_residues" file="random_sequence_09_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_10_consisting_of_65_residues" file="random_sequence_10_consisting_of_65_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_11_consisting_of_30_residues" file="random_sequence_11_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
            </output_collection>
            <!-- 6 predicted values x 11 sequences + 6 predicted values aggregated = (66 + 6) charts = 72 charts -->
            <output_collection name="split_output_plots" type="list" count="72" />
        </test>
        <!-- Test 3: Only one predictor was selected, plotting individual charts -->
        <test>
            <param name="input" value="input.fasta" ftype="fasta"/>
            <section name="section_predictors">
                <param name="dynamine" value="true"/>
                <param name="disomine" value="false"/>
                <param name="efoldmine" value="false"/>
                <param name="agmata" value="false"/>
            </section>
            <section name="section_plot">
                <param name="plot" value="true"/>
                <param name="plot_all" value="false"/>
                <param name="highlight" value="true"/>
            </section>
            <assert_command>
                <has_text text="--dynamine" />
                <not_has_text text="--disomine" />
                <not_has_text text="--agmata" />
                <not_has_text text="--efoldmine" />
                <has_text text="--json" />
                <has_text text="--plot " />
                <not_has_text text="--plot_all" />
                <has_text text="--highlight" />
                <has_text text="--output" />
                <has_text text="--plot-output" />
            </assert_command>
            <output name="predictions_output" value="test_output_dynamine.json" ftype="json"/>
            <!-- 11 sequences = 11 TSV files -->
            <output_collection name="split_output" type="list" count="11">
                <element name="random_sequence_01_consisting_of_40_residues" file="random_sequence_01_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_02_consisting_of_40_residues" file="random_sequence_02_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_03_consisting_of_30_residues" file="random_sequence_03_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_04_consisting_of_40_residues" file="random_sequence_04_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_05_consisting_of_30_residues" file="random_sequence_05_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_06_consisting_of_45_residues" file="random_sequence_06_consisting_of_45_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_07_consisting_of_30_residues" file="random_sequence_07_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_08_consisting_of_40_residues" file="random_sequence_08_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_09_consisting_of_30_residues" file="random_sequence_09_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_10_consisting_of_65_residues" file="random_sequence_10_consisting_of_65_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_11_consisting_of_30_residues" file="random_sequence_11_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
            </output_collection>
            <!-- 6 predicted values x 11 sequences = 66 charts -->
            <output_collection name="split_output_plots" type="list" count="66" />
        </test>
        <!-- Test 4: Only one predictor was selected, plotting aggregated charts -->
        <test>
            <param name="input" value="input.fasta" ftype="fasta"/>
            <section name="section_predictors">
                <param name="dynamine" value="true"/>
                <param name="disomine" value="false"/>
                <param name="efoldmine" value="false"/>
                <param name="agmata" value="false"/>
            </section>
            <section name="section_plot">
                <param name="plot" value="false"/>
                <param name="plot_all" value="true"/>
                <param name="highlight" value="true"/>
            </section>
            <assert_command>
                <has_text text="--dynamine" />
                <not_has_text text="--disomine" />
                <not_has_text text="--agmata" />
                <not_has_text text="--efoldmine" />
                <has_text text="--json" />
                <has_text text="--plot_all" />
                <has_text text="--highlight" />
                <not_has_text text="--plot " />
                <has_text text="--output" />
                <has_text text="--plot-output" />
            </assert_command>
            <output name="predictions_output" value="test_output_dynamine.json" ftype="json"/>
            <!-- 11 sequences = 11 TSV files -->
            <output_collection name="split_output" type="list" count="11">
                <element name="random_sequence_01_consisting_of_40_residues" file="random_sequence_01_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_02_consisting_of_40_residues" file="random_sequence_02_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_03_consisting_of_30_residues" file="random_sequence_03_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_04_consisting_of_40_residues" file="random_sequence_04_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_05_consisting_of_30_residues" file="random_sequence_05_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_06_consisting_of_45_residues" file="random_sequence_06_consisting_of_45_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_07_consisting_of_30_residues" file="random_sequence_07_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_08_consisting_of_40_residues" file="random_sequence_08_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_09_consisting_of_30_residues" file="random_sequence_09_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_10_consisting_of_65_residues" file="random_sequence_10_consisting_of_65_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_11_consisting_of_30_residues" file="random_sequence_11_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
            </output_collection>
            <!-- 6 predicted values aggregated = 6 charts -->
            <output_collection name="split_output_plots" type="list" count="6" />
        </test>
        <!-- Test 5: Only one predictor was selected, plotting was disabled -->
        <test>
            <param name="input" value="input.fasta" ftype="fasta"/>
            <section name="section_predictors">
                <param name="dynamine" value="true"/>
                <param name="disomine" value="false"/>
                <param name="efoldmine" value="false"/>
                <param name="agmata" value="false"/>
            </section>
            <section name="section_plot">
                <param name="plot" value="false"/>
                <param name="plot_all" value="false"/>
                <param name="highlight" value="false"/>
            </section>
            <assert_command>
                <has_text text="--dynamine" />
                <not_has_text text="--disomine" />
                <not_has_text text="--agmata" />
                <not_has_text text="--efoldmine" />
                <has_text text="--json" />
                <not_has_text text="--plot " />
                <not_has_text text="--plot_all" />
                <not_has_text text="--highlight" />
                <has_text text="--output" />
                <not_has_text text="--plot-output" />
            </assert_command>
            <output name="predictions_output" value="test_output_dynamine.json" ftype="json"/>
            <!-- 11 sequences = 11 TSV files -->
            <output_collection name="split_output" type="list" count="11">
                <element name="random_sequence_01_consisting_of_40_residues" file="random_sequence_01_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_02_consisting_of_40_residues" file="random_sequence_02_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_03_consisting_of_30_residues" file="random_sequence_03_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_04_consisting_of_40_residues" file="random_sequence_04_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_05_consisting_of_30_residues" file="random_sequence_05_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_06_consisting_of_45_residues" file="random_sequence_06_consisting_of_45_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_07_consisting_of_30_residues" file="random_sequence_07_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_08_consisting_of_40_residues" file="random_sequence_08_consisting_of_40_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_09_consisting_of_30_residues" file="random_sequence_09_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_10_consisting_of_65_residues" file="random_sequence_10_consisting_of_65_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
                <element name="random_sequence_11_consisting_of_30_residues" file="random_sequence_11_consisting_of_30_residues_dynamine.tsv" ftype="tsv" compare="diff"/>
            </output_collection>
            <output_collection name="split_output_plots" type="list" count="0" />
        </test>
        <!-- Test 6: No predictor selected, it must fail -->
        <test expect_failure="true">
            <param name="input" value="input.fasta" ftype="fasta"/>
            <section name="section_predictors">
                <param name="dynamine" value="false"/>
                <param name="disomine" value="false"/>
                <param name="efoldmine" value="false"/>
                <param name="agmata" value="false"/>
            </section>
            <section name="section_plot">
                <param name="plot" value="false"/>
                <param name="plot_all" value="false"/>
                <param name="highlight" value="false"/>
            </section>
            <assert_command>
                <not_has_text text="--dynamine" />
                <not_has_text text="--disomine" />
                <not_has_text text="--agmata" />
                <not_has_text text="--efoldmine" />
            </assert_command>
        </test>
        <!-- Test 7: No input file, it must fail -->
        <test expect_failure="true">
            <section name="section_predictors">
                <param name="dynamine" value="true"/>
                <param name="disomine" value="false"/>
                <param name="efoldmine" value="false"/>
                <param name="agmata" value="false"/>
            </section>
            <section name="section_plot">
                <param name="plot" value="false"/>
                <param name="plot_all" value="false"/>
                <param name="highlight" value="false"/>
            </section>
            <assert_command>
                <has_text text="--dynamine" />
                <not_has_text text="--disomine" />
                <not_has_text text="--agmata" />
                <not_has_text text="--efoldmine" />
            </assert_command>
        </test>
    </tests>
    <help><![CDATA[
        Bio2byte tools (b2btools) offer the following single protein sequence based predictions:

        - Backbone and sidechain dynamics (DynaMine) - Helix, sheet, coil and polyproline-II propensity
        - Early folding propensity (EFoldMine)
        - Disorder (DisoMine)
        - Beta-sheet aggregation (Agmata)

        This tool is available on the Python Package Index (PyPI): https://pypi.org/project/b2bTools/
    ]]>
    </help>
    <creator>
        <organization name="bio2Byte" url="https://bio2byte.be" email="Wim.Vranken@vub.be"/>
        <organization name="Vrije Universiteit Brussel" url="https://vub.be" alternateName="VUB"/>
        <person honorificPrefix="Prof." givenName="Wim" familyName="Vranken" email="Wim.Vranken@vub.be" identifier="http://orcid.org/0000-0001-7470-4324" />
        <person givenName="Jose" familyName="Gavalda-Garcia" email="Jose.Gavalda.Garcia@vub.be" identifier="http://orcid.org/0000-0001-6431-3442" />
        <person givenName="Adrian" familyName="Diaz" email="Adrian.Diaz@vub.be" identifier="http://orcid.org/0000-0003-0165-1318" />
    </creator>
    <citations>
        <citation type="doi">10.1038/ncomms3741</citation>
        <citation type="doi">10.1101&#47;2020.05.25.115253</citation>
        <citation type="doi">10.1038&#47;s41598-017-08366-3</citation>
        <citation type="doi">10.1093/bioinformatics/btz912</citation>
    </citations>
</tool>

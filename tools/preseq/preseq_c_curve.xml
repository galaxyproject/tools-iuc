<tool id="preseq_c_curve" name="Preseq c_curve" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Library Complexity Analysis</description>
    
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>

    <command detect_errors="exit_code"><![CDATA[
        ## 1. File Preparation: Symlink the input BAM to a standard name
		ln -s '$input_bam' input.bam &&
        
		## 2. c_curve Analysis Execute
        preseq c_curve 
            -B input.bam 
            $verbose
            -s $step_size
            #if $max_read_len:
                -l $max_read_len
            #end if
            -o '$output_tsv' 
    ]]></command>

    <inputs>
        <expand macro="macro_input_bam" />
        <param argument="-s" name="step_size" type="integer" value="1000" min="100" label="Step Size" help="Step size for the calculation."/>  
        <param argument="-l" name="max_read_len" type="integer" optional="true" value="" label="Maximum Read Length" help="Limits the length of reads considered. Leave empty for no limit."/>        
        <expand macro="macro_verbose" />
    </inputs>

    <outputs>
        <data name="output_tsv" format="tsv"/>
    </outputs>

    <tests>
        <test expect_num_outputs="1">
            <param name="input_bam" value="test.bam" ftype="bam"/>
            <param name="step_size" value="1000"/>
            <output name="output_tsv" file="test_c_curve.tsv" ftype="tsv" lines_diff="4"/>
        </test>
    </tests>

    <help><![CDATA[
**Preseq: c_curve**

The `c_curve` tool from the Preseq package estimates the complexity of a sequencing library. It plots the number of distinct reads against the total number of sequenced reads. This is highly useful for quality control to determine if a library has been sequenced to saturation or if further sequencing would yield more unique molecules.

**Input**

- A coordinate-sorted BAM file containing aligned reads.

**Output**

- A tabular (TSV) file containing the complexity curve data. This file is suitable for direct visualization or downstream reporting tools like MultiQC.
    ]]></help>
    
    <expand macro="citations"/>

</tool>

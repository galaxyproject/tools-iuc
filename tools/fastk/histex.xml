<tool id="fastk_histex" name="FastK Histex" version="@TOOL_VERSION@+galaxy3" profile="23.2" license="MIT">
    <description>Reads and displays a kmer histogram produced by FastK</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="xrefs"/>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '$input_hist' input.hist &&
        Histex input.hist
        #if str($range_count_start).strip():
            -h$range_count_start:$range_count_end
        #end if
        $select_output_format > output.hist
    ]]></command>
    <inputs>      
        <param name="input_hist" type="data" format="fastk_hist" label="Input .hist file" help="Input a .hist file obtained from FASTK"/>
        <param name="range_count_start" type="integer" min="1" label="Output histogram of counts in range given (Start)" optional="true" help="Enter the starting range for histogram of counts"/>
        <param name="range_count_end" type="integer" max="100" label="Output histogram of counts in range given (End)" optional="true" help="Enter the ending range for histogram of counts"/>
        <param name="select_output_format" label="Select the output format for Histogram" type="select">
            <option value="-k">Output histogram of k-mer instance counts vs. unique k-mers (-k)</option>
            <option value="-A">Output in simple tab-delimited ASCII format (-A)</option>
            <option value="-G">Output an ASCII format histogram especially for GeneScope.FK (-G)</option>   
        </param>
    </inputs>
    <outputs>
        <data name="histex_out" format="txt" from_work_dir="output.hist" label="${tool.name} on ${on_string}: FastK Histogram Text">
            <filter>select_output_format == '-k' </filter>
        </data>
        <data name="histex_out_tsv" format="tabular" from_work_dir="output.hist" label="${tool.name} on ${on_string}: FastK Histogram TSV">
            <filter> select_output_format != '-k'</filter>
        </data>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hist" value="test01.hist"/>
            <param name="select_output_format" value="-k"/>
            <output name="histex_out" ftype="txt">
                <assert_contents>
                    <has_n_lines n="13"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hist" value="test01.hist"/>
            <param name="range_count_start" value="1"/>
            <param name="range_count_end" value="5"/>
            <param name="select_output_format" value="-k"/>
            <output name="histex_out" ftype="txt">
                <assert_contents>
                    <has_n_lines n="11"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hist" value="test01.hist"/>
            <param name="select_output_format" value="-A"/>
            <output name="histex_out" ftype="tabular">
                <assert_contents>
                    <has_n_lines n="7"/>
                    <has_n_columns n="2"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        **FastK Histex**

        Histex is a tool, part of FASTK suite that performs reading and displaying a kmer histogram produced by FastK. Histex requires the .hist file generated by the FASTK tool to view the histogram of kâ€‘mer counts.
    
    ]]></help>
    <expand macro="citations"/>
</tool>
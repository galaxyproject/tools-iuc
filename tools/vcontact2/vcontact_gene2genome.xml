<tool id="vcontact2_gene2genome" name="vConTACT2 gene2genome" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>
        prepare gene to genome mappings from fasta headers
    </description>
    <macros>
        <token name="@TOOL_VERSION@">0.11.3</token>
        <token name="@VERSION_SUFFIX@">0</token>
        <token name="@PROFILE@">25.0</token>
    </macros>
    <requirements>
        <requirement type="package" version="3.13">python</requirement>
    </requirements>
    <required_files>
        <include path="extract_p2c_mapping.py"/>
    </required_files>
    <command detect_errors="exit_code"><![CDATA[
        python '$__tool_directory__/extract_p2c_mapping.py' '$proteins' '$bins' '$protein2contig' '$pattern'
    ]]></command>
    <inputs>
        <param name="proteins" type="data" format="fasta" label="Protein fasta file" help="Sequences for which to prepare mappings."/>
        <param name="pattern" type="text" value="^>((.*?)_[0-9]+) #" label="Regex pattern to extract protein_id and contig_id" help="The pattern should have two nested capture groups. &lt;br&gt;The default pattern works for headers generated by Prodigal. For Phanotate genes use '^>((.*?)_CDS_[0-9]+) '.">
            <option value="^>((.*?)_[0-9]+) #">/^>((.*?)_[0-9]+) #/ - Prodigal</option>
            <option value="^>((.*?)_CDS_[0-9]+) ">/^>((.*?)_CDS_[0-9]+) / - Phanotate</option>
            <option value="^>((.*?)-gene_[0-9]+)">^>((.*?)-gene_[0-9]+)/ - VirSorter</option>
            <sanitizer>
                <valid>
                    <add preset="string.printable"/>
                    <remove value="'"/>
                </valid>
                <mapping initial="none">
                    <add source="'" target="__sq__"/>
                </mapping>
            </sanitizer>
        </param>
        <param name="bins" type="data" format="tabular" optional="true" label="Bin membeship file" help="Replace the contig_ids with their corresponding bin, e.g. to process all contigs in a vMAG together."/>
    </inputs>
    <outputs>
        <data name="protein2contig" format="csv" label="${tool.name} on ${on_string}: protein2contig.csv"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="proteins" ftype="fasta" value="proteins.fasta"/>
            <param name="pattern" value="^>((.*?)_[0-9]+) #"/>
            <param name="bins" ftype="tabular" value="bins.tsv"/>
            <output name="protein2contig" file="protein2contig.csv"/>
        </test>
        <test expect_num_outputs="1">
            <param name="proteins" ftype="fasta" value="VIRSorter_genome.faa"/>
            <param name="pattern" value="^>((.*?)-gene_[0-9]+)"/>
            <output name="protein2contig" file="VIRSorter_genome_g2g.csv"/>
        </test>
    </tests>
    <help><![CDATA[
This tool prepares a basic protein2contig file for use with vContact2. It does not populate the keywords with annotation information, setting them to 'None' instead.

Additional Resources
====================

Python re module documentation: https://docs.python.org/3.13/library/re.html

    ]]></help>
    <citations>
        <citation type="doi">10.1038/s41587-019-0100-8</citation>
    </citations>
</tool>

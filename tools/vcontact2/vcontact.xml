<tool id="vcontact2" name="vConTACT2" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>
        guilt-by-contig-association classification and provide taxonomic context for viral genomix sequence data
    </description>
    <macros>
        <token name="@TOOL_VERSION@">0.11.3</token>
        <token name="@VERSION_SUFFIX@">0</token>
        <token name="@PROFILE@">25.0</token>
    </macros>
    <xrefs>
        <xref type="bio.tools">vConTACT</xref>
    </xrefs>
    <requirements>
        <!-- vContact2 is currently unmaintained and does not work with newer versions of python, numpy, pandas or scipy. -->
        <requirement type="package" version="3.9.23">python</requirement>
        <requirement type="package" version="1.23.5">numpy</requirement>
        <requirement type="package" version="1.5.3">pandas</requirement>
        <requirement type="package" version="1.6.3">scipy</requirement>
        <requirement type="package" version="@TOOL_VERSION@">vcontact2</requirement>
        <requirement type="package" version="22.282">mcl</requirement>
        <requirement type="package" version="2.17.0">blast</requirement>
        <requirement type="package" version="2.1.14">diamond</requirement>
        <requirement type="package" version="1.0">clusterone</requirement>
    </requirements>
    <required_files>
        <include path="test-data/VIRSorter_genome.faa"/>
        <include path="test-data/VIRSorter_genome_g2g.csv"/>
    </required_files>
    <command detect_errors="exit_code"><![CDATA[
        vcontact2
            #if $similarity.analysis == "de_novo"
                --raw-proteins '$similarity.raw_proteins'
                --rel-mode Diamond
                --db '$similarity.db'
            #else
                --blast-fp TODO
            #end if

            --proteins-fp '$__tool_directory__/test-data/VIRSorter_genome_g2g.csv'

            --pcs-mode MCL
            --vcs-mode ClusterONE
            --output-dir Outputs
            --threads \${GALAXY_SLOTS:-6}
    ]]></command>
    <inputs>
        <conditional name="similarity">
            <param name="analysis" type="select" label="Protein similarity">
                <option value="de_novo">Cluster proteins against a reference database</option>
                <option value="custom">Use an existing BLASTp (protein similarity) file</option>
            </param>
            <when value="de_novo">
                <param argument="--raw-proteins" type="data" format="fasta,fasta.gz" label="A FASTA-formatted amino acid file"/>
                <param argument="--rel-mode" type="select" label="Method to calculate protein similarity">
                    <option value="Diamond">Diamond</option>
                </param>
                <param argument="--db" type="select" label="Reference database" help="'Merged' databases supplements the ICTV taxonomy with NCBI. Selecting 'None' disables taxonomic annotation.">
                    <option value="ProkaryoticViralRefSeq85-ICTV"></option>
                    <option value="ProkaryoticViralRefSeq85-Merged"></option>
                    <option value="ProkaryoticViralRefSeq88-Merged"></option>
                    <option value="ProkaryoticViralRefSeq94-Merged"></option>
                    <option value="ProkaryoticViralRefSeq97-Merged"></option>
                    <option value="ProkaryoticViralRefSeq99-Merged"></option>
                    <option value="ProkaryoticViralRefSeq201-Merged"></option>
                    <option value="ProkaryoticViralRefSeq207-Merged"></option>
                    <option value="ProkaryoticViralRefSeq211-Merged"></option>
                    <option value="ArchaeaViralRefSeq85-Merged"></option>
                    <option value="ArchaeaViralRefSeq94-Merged"></option>
                    <option value="ArchaeaViralRefSeq97-Merged"></option>
                    <option value="ArchaeaViralRefSeq99-Merged"></option>
                    <option value="ArchaeaViralRefSeq201-Merged"></option>
                    <option value="ArchaeaViralRefSeq207-Merged"></option>
                    <option value="ArchaeaViralRefSeq211-Merged"></option>
                    <option value="None"></option>
                </param>
            </when>
            <when value="custom">
            </when>
        </conditional>
        <param argument="--proteins-fp" type="data" format="csv" label="A file linking protein and genome names" help="The file should have the following headers: 'protein_id', 'contig_id' and 'keywords'."/>

        <param argument="--pcs-mode" type="select" label="Method to generate protein clusters">
            <option value="MCL">MCL</option>
        </param>

        <param argument="--vcl-mode" type="select" label="Method to generate viral clusters">
            <option value="ClusterONE">ClusterONE</option>
        </param>
    </inputs>
    <outputs>
        <data name="genome_by_genome" format="csv" from_work_dir="Outputs/genome_by_genome_overview.csv"
              label="${tool.name} on ${on_string}: genome_by_genome_overview.csv"/>
        <data name="viral_cluster" format="csv" from_work_dir="Outputs/viral_cluster_overview.csv"
              label="${tool.name} on ${on_string}: viral_cluster_overview.csv"/>
        <data name="graph" format="tabular" from_work_dir="Outputs/c1.ntw"
              label="${tool.name} on ${on_string}: c1.ntw"/>
        <!-- "Similarity (tool)": merged.self-diamond.tab (or merged.self-blastp.tab) -->
        <!-- "accumulated keywords": vContact-proteins.csv + vContact-pcs.csv -->
    </outputs>
    <tests>
        <!-- Todo: normal, db=None, BLASTp -->
    </tests>
    <help><![CDATA[
vConTACT2 is a tool to perform guilt-by-contig-association classification of viral genomic sequence data. It's designed to cluster and provide taxonomic context of viral metagenomic sequencing data.

Required Inputs
===============

- **A FASTA-formatted amino acid file**: Will be combined with reference proteins to generate protein-protein similarities.
- **A file linking protein and genome names**: The file should have the headers protein_id, contig_id and keywords. Multiple keywords should be separated using ';'. (!) TODO: vContact will aggregate gene keywords from all proteins assigned to a protein cluster.

Main Parameters
===============


Generated Outputs
=================


Notes
=====


Additional Resources
====================

vContact2 Bitbucket : https://bitbucket.org/MAVERICLab/vcontact2

    ]]></help>
    <citations>
        <citation type="doi">10.1038/s41587-019-0100-8</citation>
    </citations>
</tool>

<tool id="kegg_pathways_completeness" name="Calculate KEGG Pathways completeness" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Compute KEGG pathway/module completeness from KOs or per-contig annotation</description>
    <macros>
        <token name="@TOOL_VERSION@">1.3.0</token>
        <token name="@VERSION_SUFFIX@">0</token>
        <token name="@PROFILE@">24.0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">kegg-pathways-completeness</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        give_completeness
        #if $usr_ref_files.definitions
            --definitions '$usr_ref_files.definitions'
        #end if
        #if $usr_ref_files.names
            --names '$usr_ref_files.names'
        #end if
        #if $usr_ref_files.classes
            --classes '$usr_ref_files.classes'
        #end if
        $w
        $p
        #if str($input_type.select_input_type) == "input_list"
            -l '$l'
        #else
            -i '$i'
            #if $input_type.m
                $input_type.m &&
                mv summary.kegg_contigs* $kegg_contig_table
            #end if
        #end if
        &&
        mv summary.kegg_pathways* $kegg_pathways_table
    ]]></command>
    <inputs>
        <conditional name="input_type">
            <param name="select_input_type" type="select" label="Select input format" help="See the Help section below for examples">
                <option value="input_file">Table with one pathway per row</option>
                <option value="input_list">Text file containing a comma-separated list of KOs</option>
            </param>
            <when value="input_file">
                <param argument="-i" label="Input file" type="data" format="tabular"/>
                <param argument="-m" type="boolean" truevalue="-m" falsevalue="" checked="false" label="Creates per-contig summary table"/>
            </when>
            <when value="input_list">
                <param argument="-l" label="Input list" type="data" format="txt"/>
            </when>
        </conditional>
        <section name="usr_ref_files" title="Custom Reference Files" help="Optionally, provide your own KEGG reference files instead of using the default KEGG database">
            <param argument="--definitions" label="All modules definitions" type="data" format="txt" optional="true"/>
            <param argument="--names" label="Modules names" type="data" format="txt" optional="true"/>
            <param argument="--classes" label="Modules classes" type="data" format="txt" optional="true"/>
        </section>
        <param argument="-w" type="boolean" truevalue="-w" falsevalue="" checked="false" label="Add weights for each KO in output"/>
        <param argument="-p" type="boolean" truevalue="-p" falsevalue="" checked="false" label="Create images with pathways completeness"/>
    </inputs>
    <outputs>
        <data name="kegg_pathways_table" format="tsv" label="${tool.name} on ${on_string}: KEGG pathway completness table"/>
        <data name="kegg_contig_table" format="tsv" label="${tool.name} on ${on_string}: KEGG contig pathway completness table">
            <filter>input_type['select_input_type'] == "input_file" and input_type['m'] is True</filter>
        </data>
        <collection name="pathway_plots" type="list" label="${tool.name} on ${on_string}: Pathway plots" format="png">
            <filter>p is True</filter>
            <discover_datasets pattern="(?P&lt;designation&gt;.+).png" directory="pathways_plots"/>
        </collection>
    </outputs>
    <tests>
        <test expect_num_outputs="3">
            <conditional name="input_type">
                <param name="select_input_type" value="input_file"/>
                <param name="i" value="input_file.tabular"/>
                <param name="m" value="true"/>
            </conditional>
            <section name="usr_ref_files">
                <param name="definitions" value="all_pathways.txt"/>
                <param name="names" value="all_pathways_names.txt"/>
                <param name="classes" value="all_pathways_class.txt"/> 
            </section>
            <param name="w" value="true"/>
            <param name="p" value="true"/>
            <output name="kegg_pathways_table" file="summary.kegg_pathways.with_wreights.tsv" ftype="tsv"/>
            <output name="kegg_pathways_table" file="summary.kegg_contigs.with_weights.tsv" ftype="tsv"/>
            <output_collection name="pathway_plots" type="list" count="9">
                <element name="M00003" file="pathway_plots/M00003.png" ftype="png"/>
                <element name="M00017" file="pathway_plots/M00017.png" ftype="png"/>
                <element name="M00018" file="pathway_plots/M00018.png" ftype="png"/>
                <element name="M00082" file="pathway_plots/M00082.png" ftype="png"/>
                <element name="M00165" file="pathway_plots/M00165.png" ftype="png"/>
                <element name="M00873" file="pathway_plots/M00873.png" ftype="png"/>
                <element name="M00874" file="pathway_plots/M00874.png" ftype="png"/>
                <element name="M00885" file="pathway_plots/M00885.png" ftype="png"/>
                <element name="M00886" file="pathway_plots/M00886.png" ftype="png"/>
            </output_collection>
        </test>
        <test expect_num_outputs="1">
            <conditional name="input_type">
                <param name="select_input_type" value="input_list"/>
                <param name="l" value="input_list.txt"/>
            </conditional>
            <output name="kegg_pathways_table" file="summary.kegg_pathways.tsv" ftype="tsv"/>
        </test>
    </tests>
    <help><![CDATA[
        **Compute KEGG pathway/module completeness from KOs or per-contig annotations**

        Input formats:

        * Example input file (tabular, one pathway per row):

            contig1 K00812  K12252  K00003

            contig1 K02990  K19302  K00645

        * Example KO list file (comma-separated):

            K00001,K00002,K00123,K00942

        **Tool license**: `Apache License 2.0 <https://raw.githubusercontent.com/EBI-Metagenomics/kegg-pathways-completeness-tool/refs/heads/master/LICENSE>`_
    ]]></help>
    <creator>
        <person givenName="Rand" familyName="Zoabi" url="https://github.com/RZ9082" identifier="https://orcid.org/0009-0000-2501-8053"/>
    </creator>
    <citations>
        <citation type="bibtex">
            @misc{kegg-pathways-completeness,
            author       = {{EBI‚ÄêMetagenomics}},
            title        = {kegg-pathways-completeness-tool},
            howpublished = {\url{https://github.com/EBI-Metagenomics/kegg-pathways-completeness-tool}},
            note         = {Accessed: 2025-12-05},
            year         = {2024}
            }
        </citation>
    </citations>
</tool>

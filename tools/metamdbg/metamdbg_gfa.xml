<tool id="metamdbg_gfa" name="metaMDBG graph (GFA)" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@" license="MIT">
  <description>Generate a GFA graph from a metaMDBG assembly</description>
  <macros><import>macros.xml</import></macros>
  <expand macro="edam"/>
  <requirements><requirement type="package" version="@TOOL_VERSION@">metamdbg</requirement></requirements>
  <version_command>metaMDBG --version</version_command>
  <stdio><exit_code range="1:" level="fatal"/></stdio>

  <command detect_errors="exit_code"><![CDATA[
    mkdir -p assemblyDir &&
    tar -C assemblyDir -xzf '$assembly_bundle' ;

    metaMDBG gfa \
      --assembly-dir assemblyDir \
      --k $k_value \
      #if str($include_contigpath) == "true"
        --contigpath
      #end if
      #if str($include_readpath) == "true"
        --readpath
      #end if
      --threads ${GALAXY_SLOTS:-4} ;
  ]]></command>

  <inputs>
    <param name="assembly_bundle" type="data" format="tar.gz" label="Assembly bundle (tar.gz from metaMDBG assemble)"/>
    <param name="k_value" type="integer" value="21" min="1" max="128" label="k-mer size (--k)"/>
    <param name="include_contigpath" type="boolean" value="true" label="Annotate contig paths (--contigpath)"/>
    <param name="include_readpath" type="boolean" value="false" label="Annotate read paths (--readpath)" help="Upstream notes read-paths are less accurate for ONT."/>
  </inputs>

  <outputs>
    <data name="gfa" format="gfa" from_work_dir="assemblyDir/*.gfa" label="metaMDBG GFA (k=${k_value}) on ${on_string}"/>
  </outputs>

  <tests>
    <test>
      <param name="assembly_bundle" value="tiny_assembly_bundle.tgz"/>
      <param name="k_value" value="21"/>
      <output name="gfa">
        <assert_contents>
          <has_text text="S\t"/>
        </assert_contents>
      </output>
    </test>
  </tests>

  <help><![CDATA[
Generate a GFA assembly graph from a finished metaMDBG assembly directory.  
Input is a **tarred assemblyDir** (portable between runners). Choose `k`, and optionally annotate contig/read paths.
  ]]></help>
  <expand macro="citations"/>
</tool>

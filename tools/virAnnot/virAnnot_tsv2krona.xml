<tool id="virannot_tsv2krona" name="virAnnot tsv2krona" version="1.0.0+galaxy0" profile="21.05">
    <description>convert tsv blast files into abundance files for use by krona</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements_converter" />
    <command detect_errors="aggressive"><![CDATA[
        '$__tool_directory__/tsv2krona.py' 
            -i '$blast_file'
    ]]></command>
    <inputs>
        <param type="data" name="blast_file" format="tabular" label="Blast results file from blast2tsv" />
    </inputs>
    <outputs>
        <data name="out_contigs" format="tabular" from_work_dir="krona_contigs.tsv"/>
        <data name="out_reads" format="tabular" from_work_dir="krona_reads.tsv"/>
    </outputs>
    <tests>
        <test>
            <param name="blast_file" value="krona_s1_tblastx.tsv"/>
            <output name="out_reads" file="krona_reads.tsv">
                <assert_contents>
                    <has_size value="2064" delta="10" />
                </assert_contents>
            </output>
            <output name="out_contigs" file="krona_contigs.tsv">
                <assert_contents>
                    <has_size value="2027" delta="10"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        
This module takes as input blast tabular files from @virannot_blast2tsv.
It generates two abundance files for each sample: one for contigs, one for reads.
Example of the output:
1   Viruses Orthornavirae   Duplornaviricota    Chrymotiviricetes   Ghabrivirales   Chrysoviridae   Chrysovirus Helminthosporium victoriae 145S virus
1   Viruses Orthornavirae   Duplornaviricota    Chrymotiviricetes   Ghabrivirales   Totiviridae Victorivirus    Sphaeropsis sapinea RNA virus 1
5   Viruses Orthornavirae   Duplornaviricota    Chrymotiviricetes   Ghabrivirales   Totiviridae Totivirus   Xanthophyllomyces dendrorhous virus L1B
6   Viruses Orthornavirae   Duplornaviricota    Chrymotiviricetes   Ghabrivirales   Quadriviridae   Quadrivirus Rosellinia necatrix quadrivirus 1
3   Viruses Orthornavirae   Pisuviricota    Duplopiviricetes    Durnavirales    Partitiviridae  Botryosphaeria dothidea virus 1

You can vizualise krona charts from these files.

    ]]></help>
    <expand macro="citations"/>
</tool>

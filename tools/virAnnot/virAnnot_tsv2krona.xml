<tool id="virannot_tsv2krona" name="virAnnot tsv2krona" version="1.0.0+galaxy0" profile="21.05">
    <description>convert xml blast results to tab file with taxonomic informations</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements_converter" />
    <command detect_errors="aggressive"><![CDATA[
        '$__tool_directory__/tsv2krona.py' 
            #for '$blast_file' in '$blast_tsv'
                -i '$blast_file'
            #end for

            && zip -r krona.zip krona
    ]]></command>
    <inputs>
        <param type="data" name="blast_tsv" format="tabular" label="Blast results file from blast2tsv" multiple="true" />
    </inputs>
    <outputs>
        <data format="zip" name="archive_output" label="${tool.name} on ${on_string}: zip of the complete output" from_work_dir="krona.zip" />
    </outputs>
    <tests>
        <test>
            <param name="blast_tsv" value="krona_s1_tblastx.tab,krona_s2_tblastx.tab"/>
            <output name="archive_output">
                <assert_contents>
                    <has_archive_member path=".*\/text.krona.html" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        
This module takes as input blast tabular files from @virannot_blast2tsv.
It generates one HTML file with all your samples.
The headers are as follow:
#algo   query_id    nb_reads    query_length    accession   description organism    percentIdentity nb_hsps queryOverlap    hitOverlap  evalue  score   tax_id  taxonomy    sequence
TBLASTX example_392  26  240 NC_005979   Helminthosporium victoriae 145S virus   Helminthosporium victoriae 145S virus   40.0    1   100 6.0 1.12512e-11 66.1329 164750  Viruses;Chrysovirus;Helminthosporium victoriae 145S virus  CAGCACGTCCGCAAGTTGTCCGGCTTAAATCTTTAGCCCC


    ]]></help>
    <expand macro="citations"/>
</tool>

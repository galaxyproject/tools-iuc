<tool id="mfa_find_oovs" name="MFA Find OOVs" version="@TOOL_VERSION@+@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>find words in a corpus that are missing from the dictionary</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        @PREPARE_ENV@
        @PREPARE_CORPUS@
        @PREPARE_DICTIONARY@

        ## 3. Run Find OOVs
        ## Syntax: mfa find_oovs [OPTIONS] CORPUS_DIRECTORY DICTIONARY_PATH OUTPUT_DIRECTORY
        mfa find_oovs
            corpus_dir
            $dict_arg
            output_dir
            --job_name 'mfa_find_oovs_job'
            #if $speaker_characters:
                --speaker_characters '$speaker_characters'
            #end if

        @ZIP_OUTPUT@
    ]]></command>

    <inputs>
        <expand macro="input_corpus" />
        <expand macro="input_dictionary" />
        <expand macro="common_inputs" />
    </inputs>

    <outputs>
        <data name="output_archive" format="mfa_oov.zip" label="${tool.name} on ${on_string}: OOV Report" />
    </outputs>

    <tests>
        <test expect_num_outputs="1">
            <param name="corpus_source" value="test_corpus.zip" ftype="mfa_corpus_model.zip" />
            <conditional name="dictionary_type">
                <param name="source" value="history" />
                <param name="dictionary_file" location="https://github.com/MontrealCorpusTools/mfa-models/releases/download/dictionary-english_us_arpa-v3.0.0/english_us_arpa.dict" ftype="mfa_dictionary.dict" />
            </conditional>
            <output name="output_archive">
                <assert_contents>
                    <has_size value="200" delta="200" />
                </assert_contents>
            </output>
        </test>
    </tests>

    <help><![CDATA[
**Montreal Forced Aligner: Find OOVs**

This tool scans your corpus and compares the words in your transcripts against the provided pronunciation dictionary.

**What it does**

It identifies **Out-Of-Vocabulary (OOV)** itemsâ€”words that exist in your text but missing from the dictionary. If a word is OOV, MFA cannot align it because it doesn't know its phonemes.

**Output**

A Zip archive containing:

* `oovs_found.txt`: A list of missing words.
* `oov_counts.txt`: How many times each missing word appears.
* `utterance_oovs.txt`: Which specific recording files contain the missing words.

**Next Steps**

You can take the `oovs_found.txt` file and run it through the **MFA G2P** tool to generate pronunciations for them!

    ]]></help>
    <expand macro="creators" />
    <expand macro="citations" />
</tool>
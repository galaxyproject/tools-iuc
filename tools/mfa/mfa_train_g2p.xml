<tool id="mfa_train_g2p" name="MFA Train G2P" version="@TOOL_VERSION@+@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>train a new G2P model from a pronunciation dictionary</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        @PREPARE_ENV@
        @PREPARE_DICTIONARY@

        ## 2. Run Training
        ## Syntax: mfa train_g2p [OPTIONS] DICTIONARY_PATH OUTPUT_MODEL_PATH
        mfa train_g2p
            $dict_arg
            '$output_model'
            --job_name 'mfa_train_g2p_job'
            --order $order
            #if $evaluate:
                --evaluate
            #end if

    ]]></command>

    <inputs>
        <expand macro="input_dictionary" />

        <param name="order" type="integer" value="7" min="1" max="10" label="N-gram Order" help="The order of the Markov model. Higher numbers capture longer contexts but require more data. 7 is standard." />
        
        <param name="evaluate" type="boolean" truevalue="--evaluate" falsevalue="" checked="false" label="Evaluate Model" help="If checked, MFA will validate the model on a subset of the dictionary to report accuracy." />

    </inputs>

    <outputs>
        <data name="output_model" format="zip" label="${tool.name} on ${on_string}: Trained G2P Model" />
    </outputs>

    <tests>
        <test expect_num_outputs="1">
            <conditional name="dictionary_type">
                <param name="source" value="history" />
                <param name="dictionary_file" value="test_dict.txt" ftype="txt" />
            </conditional>
            <param name="order" value="2" /> 
            <output name="output_model">
                <assert_contents>
                    <has_size value="200" delta="200" />
                </assert_contents>
            </output>
        </test>
    </tests>

    <help><![CDATA[
**Montreal Forced Aligner: Train G2P**

This tool trains a **Grapheme-to-Phoneme (G2P)** model using an existing pronunciation dictionary.

**How it works**

It analyzes the relationship between the spelling of words (graphemes) and their sounds (phonemes) in your provided dictionary. It builds a statistical model (Finite State Transducer) that can guess the pronunciation of *new, unseen* words.

**Use Case**

1. You have a dictionary for a specific language/dialect (e.g., "Austrian German").
2. No pre-trained G2P model exists for this dialect.
3. Run **Train G2P** on your dictionary.
4. Use the resulting **G2P Model** in the **MFA G2P** tool to generate pronunciations for missing words.

**Inputs**

* **Dictionary:** A text file listing words and their phonemes.

**Output**

* A `.zip` file containing the trained G2P model.

    ]]></help>
    <expand macro="creators" />
    <expand macro="citations" />
</tool>
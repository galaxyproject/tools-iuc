<macros>
    <token name="@CHECKM2_COMMAND@"><![CDATA[
        #set $pattern = "Name\tCompleteness\tContamination\tCompleteness_Model_Used\tTranslation_Table_Used"
        @LN_FILES@
    ]]></token>
    <xml name="checkm2_form">
        <param name="input" type="data" format="tabular" multiple="true" label="Output of CheckM2" help="It should be the quality report from CheckM2"/>
    </xml>
    <xml name="checkm2_test">
        <test expect_num_outputs="3">
            <repeat name="results">
                <conditional name="software_cond">
                    <param name="software" value="checkm2"/>
                    <param name="input" value="checkm2.tsv"/>
                </conditional>
            </repeat>
            <param name="title" value="Title of the report"/>
            <param name="comment" value="Commment for the report"/>
            <param name="flat" value="true"/>
            <param name="export" value="true"/>
            <output name="html_report">
                <assert_contents>
                    <has_text text="Title of the report"/>
                    <has_text text="Commment for the report"/>
                    <has_text text="CheckM2"/>
                </assert_contents>
            </output>
            <output_collection name="plots" type="list" count="0"/>
        </test>
        <!-- This test use a Checkm2 TSV file with wrong required headers to check error handling. 
        Some checkm2 column names are parameter-dependent and the checkm2 multiQC module rely on a specific column pattern.
        An issue has been opened : https://github.com/MultiQC/MultiQC/issues/3466 
        There is a stdio rule in macro that need to be removed once the issue is fixed -->
        <test expect_failure="true" expect_exit_code="1">
            <repeat name="results">
                <conditional name="software_cond">
                    <param name="software" value="checkm2"/>
                    <param name="input" value="checkm2-wrong.tsv"/>
                </conditional>
            </repeat>
            <param name="title" value="Title of the report"/>
            <param name="comment" value="Commment for the report"/>
            <param name="flat" value="true"/>
            <param name="export" value="true"/>
        </test>
    </xml>
</macros>

<tool id="STACKSpreparepopmap" name="STACKS : Prepare population map file " >
  <description>for STACKS denovomap and refmap</description>

<configfiles>
<configfile name="fastq_files">
#for $input in $fastq_file:
${input.display_name}::${input}
#end for
</configfile>
<configfile name="sam_files">
#if str( $options_target.options_target_selector ) == "refmap":
#for $input in $options_target.sam_file:
${input.display_name}::${input}
#end for
#end if
</configfile>
</configfiles>  

<command interpreter="python">
STACKS_prepare_population_map.py
-f $fastq_files
#if str( $options_target.options_target_selector ) == "refmap":
-s $sam_files
#end if
-t $info_file
-o $output
-d $__new_file_path__
</command>

<inputs>	
<conditional name="options_target">
	<param name="options_target_selector" type="select" label="Select your target">
		<option value="denovo" selected="true">STACKS De Novo map</option>
		<option value="refmap">STACKS Reference map</option>
	</param>
	<when value="denovo">
	</when>
	<when value="refmap">
		<param name="sam_file" format="sam,zip,tar.gz" type="data" multiple="true" label="SAM files generated by your alignment" help="SAM/ZIP/TAR.GZ files." />
	</when>

</conditional>
	<param name="fastq_file" format="fastq,fasta,zip,tar.gz" type="data" multiple="true" label="Fastq files generated by STACKS : Process radtags tool" help="FASTQ/FASTA/ZIP/TAR.GZ files." />
	<param name="info_file" format="tabular,txt" type="data" label="File with population information" help="File looks like : barcode TAB population " />		
		

</inputs>
<outputs>

    <data format="tabular" name="output" label="population_map.txt with ${tool.name} on ${on_string}" />

</outputs>
<help>

.. class:: infomark

**What it does**

This program will prepare a population map dataset from a 2 columns file containing relation between barcode and population. 

--------

**Created by:**

Stacks was developed by Julian Catchen with contributions from Angel Amores, Paul Hohenlohe, and Bill Cresko

--------

**Example:**

Input files:

- FASTQ, FASTA, zip, tar.gz


- File with population informations:

This file must have exactly 2 columns, separated by a tab, the first with barcode, second with population name or ID ::

	CGATA	pop1
	CGGCG	pop1
	GAAGC	pop1
	GAGAT	pop1
	CGATA	pop2 
	CGGCG	pop2
	GAAGC	pop2
	GAGAT	pop2


Output file:

- Population map::

    indv_01    1
    indv_02    1
    indv_03    1
    indv_04    2
    indv_05    2
    indv_06    2

WARNING : the file name in the population map output may be different from the history file name. Don't worry about this, it's safe.


Instructions to add the functionality of archives management in Galaxy on the `eBiogenouest HUB wiki &lt;https://www.e-biogenouest.org/wiki/ManArchiveGalaxy&gt;`_ .

--------

**Project links:**

`STACKS website &lt;http://creskolab.uoregon.edu/stacks/&gt;`_ .

`STACKS manual &lt;http://creskolab.uoregon.edu/stacks/stacks_manual.pdf&gt;`_ .

`STACKS google group &lt;https://groups.google.com/forum/#!forum/stacks-users&gt;`_ .

--------

**References:**

-J. Catchen, P. Hohenlohe, S. Bassham, A. Amores, and W. Cresko. Stacks: an analysis tool set for population genomics. Molecular Ecology. 2013.

-J. Catchen, S. Bassham, T. Wilson, M. Currey, C. O'Brien, Q. Yeates, and W. Cresko. The population structure and recent colonization history of Oregon threespine stickleback determined using restriction-site associated DNA-sequencing. Molecular Ecology. 2013.

-J. Catchen, A. Amores, P. Hohenlohe, W. Cresko, and J. Postlethwait. Stacks: building and genotyping loci de novo from short-read sequences. G3: Genes, Genomes, Genetics, 1:171-182, 2011.

-A. Amores, J. Catchen, A. Ferrara, Q. Fontenot and J. Postlethwait. Genome evolution and meiotic maps by massively parallel DNA sequencing: Spotted gar, an outgroup for the teleost genome duplication. Genetics, 188:799'808, 2011.

-P. Hohenlohe, S. Amish, J. Catchen, F. Allendorf, G. Luikart. RAD sequencing identifies thousands of SNPs for assessing hybridization between rainbow trout and westslope cutthroat trout. Molecular Ecology Resources, 11(s1):117-122, 2011.

-K. Emerson, C. Merz, J. Catchen, P. Hohenlohe, W. Cresko, W. Bradshaw, C. Holzapfel. Resolving postglacial phylogeography using high-throughput sequencing. Proceedings of the National Academy of Science, 107(37):16196-200, 2010.

--------

**Integrated by:**

Yvan Le Bras and Cyril Monjeaud 

GenOuest Bio-informatics Core Facility

UMR 6074 IRISA INRIA-CNRS-UR1 Rennes (France)

support@genouest.org

If you use this tool in Galaxy, please cite :

`Y. Le Bras, A. Roult, C. Monjeaud, M. Bahin, O. Quenez, C. Heriveau, A. Bretaudeau, O. Sallou, O. Collin, Towards a Life Sciences Virtual Research Environment : an e-Science initiative in Western France. JOBIM 2013. &lt;https://www.e-biogenouest.org/resources/128&gt;`_


</help>
<citations>
    <citation type="doi">10.1111/mec.12354</citation>
    <citation type="doi">10.1111/mec.12330</citation>
    <citation type="doi">10.1534/g3.111.000240</citation>
    <citation type="doi">10.1534/genetics.111.127324</citation>
    <citation type="doi">10.1111/j.1755-0998.2010.02967.x</citation>
    <citation type="doi">10.1073/pnas.1006538107</citation>

    <citation type="bibtex">@INPROCEEDINGS{JOBIM2013,
    author = {Le Bras, Y. and ROULT, A. and Monjeaud, C. and Bahin, M. and Quenez, O. and Heriveau, C. and Bretaudeau, A. and Sallou, O. and Collin, O.},
    title = {Towards a Life Sciences Virtual Research Environment: An e-Science initiative in Western France},
    booktitle = {JOBIM 2013 Proceedings},
    year = {2013},
    url = {https://www.e-biogenouest.org/resources/128},
    pages = {97-106}
    }</citation>
</citations>
</tool>


<tool id="deacon_index_diff" name="Deacon Index Diff" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Check difference of an deacon index file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code">
        <![CDATA[
        
        #if $first_file.is_select == "own"
            ln -s '$first_file.file' 'index_1.deacon.idx' &&
        #end if

        #if $second_file.is_select == "index"
            #if $file_input.is_select == "own"
                ln -s '$second_file.file' 'index_2.deacon.idx' &&
            #end if
        #else
            ln -s '$fastx_file' 'fastx.${fastx_file.ext}' &&
        #end if

        deacon index diff
        #if $first_file.is_select == "own"
            'index_1.deacon.idx'
        #else
            '$first_file.from_dm.fields.path'
        #end if
        #if $second_file.is_select == "index"
            #if $file_input.is_select == "own"
                'index_2.deacon.idx'
            #else
                '$second_file.from_dm.fields.path'
            #end if
        #else
            'fastx.${fastx_file.ext}'
            -k ${k}
            -w ${w}
        #end if
        -t "\${GALAXY_SLOTS:-8}"
        -o '$index_output'

        
        ]]>
    </command>
    <inputs>
        <conditional name="first_file">
            <param name="is_select" type="select" label="Input own index file or use prebuilt index files from data manager">
                <option value="dm">From data manger</option>
                <option value="own">Use own index files</option>
            </param>
            <when value="dm">
                <expand macro="dm_ref"/>
            </when>
            <when value="own">
                <param name="file" type="data" multiple="false" format="deacon.idx" label="Input own index file"/>
            </when>
        </conditional>
        <conditional name="second_file">
            <param name="is_select" type="select" label="Second file should be index file or fasta/fastq file">
                <option value="index">Index file</option>
                <option value="fastx">fasta/fastq file</option>
            </param>
            <when value="index">
                <conditional name="file_input">
                    <param name="is_select" type="select" label="Input own index file or use prebuilt index files from data manager">
                        <option value="dm">From data manger</option>
                        <option value="own">Use own index files</option>
                    </param>
                    <when value="dm">
                        <expand macro="dm_ref"/>
                    </when>
                    <when value="own">
                        <param name="file" type="data" multiple="false" format="deacon.idx" label="Input own index file"/>
                    </when>
                </conditional>
            </when>
            <when value="fastx">
                <param name="fastx_file" type="data" format="fasta,fastqsanger,fastqillumina,fasta.gz,fastqsanger.gz,fastqillumina.gz" label="Input fasta/fastq file"/>
                <param argument="-k" type="integer" min="0" max="32" optional="false" label="set kmer length"/>
                <param argument="-w" type="integer" optional="false" label="Set window size"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="index_output" format="deacon.idx" label="${tool.name} on ${on_string}: Create new index file"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <conditional name="first_file">
                <param name="is_select" value="own"/>
                <param name="file" value="A1.deacon.idx" ftype="deacon.idx"/>
            </conditional>
            <conditional name="second_file">
                <param name="is_select" value="index"/>
                <conditional name="file_input">
                    <param name="is_select" value="own"/>
                    <param name="file" value="A1_forward.deacon.idx" ftype="deacon.idx"/>
                </conditional>
            </conditional>
            <output name="index_output" value="A1_reverse.deacon.idx" ftype="deacon.idx" compare="sim_size"/>
        </test>
        <test expect_num_outputs="1">
            <conditional name="first_file">
                <param name="is_select" value="dm"/>
                <param name="from_dm" value="test_index"/>
            </conditional>
            <conditional name="second_file">
                <param name="is_select" value="index"/>
                <conditional name="file_input">
                    <param name="is_select" value="own"/>
                    <param name="file" value="A1_forward.deacon.idx" ftype="deacon.idx"/>
                </conditional>
            </conditional>
            <output name="index_output" value="A1_reverse.deacon.idx" ftype="deacon.idx" compare="sim_size"/>
        </test>
        <test expect_num_outputs="1">
            <conditional name="first_file">
                <param name="is_select" value="own"/>
                <param name="file" value="A1.deacon.idx" ftype="deacon.idx"/>
            </conditional>
            <conditional name="second_file">
                <param name="is_select" value="fastx"/>
                <param name="fastx_file" value="A1_forward.fasta.gz" ftype="fasta.gz"/>
                <param name="k" value="31"/>
                <param name="w" value="15"/> 
            </conditional>
            <output name="index_output" value="A1_plus_reverse.deacon.idx" ftype="deacon.idx" compare="sim_size"/>
        </test>
    </tests>
    <help>
        <![CDATA[
        
            **WHAT DOES THIS TOOL**

            This tool creates index files which will be used for Deacon filter. There are multiple tools for different operation for index files which can be used all on galaxy!

            **OPERATION WHICH CAN BE USED**

            +-------------+----------------------------------------+-----------------------------------+------------+
            | Operation   | What it does                           | Input                             | Output     |
            +-------------+----------------------------------------+-----------------------------------+------------+
            | build       | build index file from a fasta/fastq    | fasta/fastq file                  | index file |
            | union       | union 2 or more index files            | index files                       | index file |
            | intersect   | intersect 2 or more index files        | index files                       | index file |
            | diff        | check difference from an index file    | index file + index/fasta/fastq    | index file |
            | dump        | dump index file content into fasta     | index file                        | fasta file |
            +-------------+----------------------------------------+-----------------------------------+------------+



        ]]>
    </help>
    <expand macro="citation"/>
</tool>
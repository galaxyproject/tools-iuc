<tool id="deacon_index_build" name="Deacon Index Build" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Build deacon index file from fasta/fastq</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code">
        <![CDATA[
            
        ln -s '$input' 'fastx.${input.ext}' &&

        deacon index build
        'fastx.${input.ext}'
        -k ${k}
        -w ${w}
        -e ${e}
        -t "\${GALAXY_SLOTS:-8}"
        -o '$index_output'
        
        ]]>
    </command>
    <inputs>
        <param name="input" type="data" format="fasta,fastqsanger,fastqillumina,fasta.gz,fastqsanger.gz,fastqillumina.gz" label="Input fasta/fastq file to build index file"/>
        <param argument="-k" type="integer" min="1" value="31" label="Set kmer length" help="IMPORTANT: (kmer length + window size) - 1 has to be odd and smaller or equal to 96!"/>
        <param argument="-w" type="integer" min="1" value="15" label="Set window size" help="Minimizer window size used for indexing. IMPORTANT: (kmer length + window size) - 1 has to be odd and smaller or equal to 96!"/>
        <param argument="-e" type="float" min="0.0" max="1.0" value="0.0" label="Set min entropy threshold" help="Minimum scaled entropy threshold for k-mer filtering"/>
    </inputs>
    <outputs>
        <data name="index_output" format="deacon.idx" label="${tool.name} on ${on_string}: Create new index file"/>
    </outputs>
    <tests>
       <test expect_num_outputs="1">
            <param name="input" value="Test.fastq.gz" ftype="fastq.gz"/>  
            <param name="k" value="5"/>
            <param name="w" value="3"/>
            <param name="e" value="0.1"/>
            <output name="index_output" value="Test_option.deacon.idx" ftype="deacon.idx" compare="sim_size"/> 
       </test> 
       <test expect_num_outputs="1">
            <param name="input" value="Test.fastq.gz" ftype="fastq.gz"/>
            <output name="index_output" value="Test_fastq_gz.deacon.idx" ftype="deacon.idx" compare="sim_size"/> 
       </test>
    </tests>
    <help>
        <![CDATA[
        
            **WHAT DOES THIS TOOL**

            This tool creates index files which will be used for Deacon filter. There are multiple tools for different operation for index files which can be used all on galaxy!

            **OPERATION WHICH CAN BE USED**

            +-------------+----------------------------------------+-----------------------------------+------------+
            | Operation   | What it does                           | Input                             | Output     |
            +-------------+----------------------------------------+-----------------------------------+------------+
            | build       | build index file from a fasta/fastq    | fasta/fastq file                  | index file |
            | union       | union 2 or more index files            | index files                       | index file |
            | intersect   | intersect 2 or more index files        | index files                       | index file |
            | diff        | check difference from an index file    | index file + index/fasta/fastq    | index file |
            | dump        | dump index file content into fasta     | index file                        | fasta file |
            +-------------+----------------------------------------+-----------------------------------+------------+



        ]]>
    </help>
    <expand macro="citation"/>
</tool>
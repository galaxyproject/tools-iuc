<macros>
    <token name="@TOOL_VERSION@">0.12.0</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <token name="@PROFILE@">24.1</token>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">deacon</requirement>
        </requirements>
    </xml>
    <xml name="dm_ref">
        <param name="from_dm" type="select" label="Select index file from DM">
            <options from_data_table="deacon">
                <filter type="regexp" column="5" value="3"/>
            </options>
            <validator type="no_options" message="No index file are available for this version of Deacon. Please contact the Galaxy adminstrators to request one be installed."/>
        </param>
    </xml>
    <xml name="deacon_build">
        <param name="input" type="data" format="fasta,fastqsanger,fastqillumina,fasta.gz,fastqsanger.gz,fastqillumina.gz" label="Input fasta/fastq file to build index file"/>
        <param argument="-k" type="integer" value="31" label="Set kmer length" help="IMPORTANT: (kmer length + window size) - 1 has to be odd and smaller or equal to 96!"/>
        <param argument="-w" type="integer" value="15" label="Set window size" help="Minimizer window size used for indexing. IMPORTANT: (kmer length + window size) - 1 has to be odd and smaller or equal to 96!"/>
        <param argument="-e" type="float" min="0.0" max="1.0" value="0.0" label="Set min entropy threshold" help="Minimum scaled entropy threshold for k-mer filtering"/>
    </xml>
    <xml name="deacon_union">
        <repeat name="deacon_repeat" min="2" title="Input" default="2">
            <conditional name="file_input">
                <param name="is_select" type="select" label="Input own index file or use pre-build index files from data manager">
                    <option value="dm">From data manger</option>
                    <option value="own">Use own index files</option>
                </param>
                <when value="dm">
                    <expand macro="dm_ref"/>
                </when>
                <when value="own">
                    <param name="file" type="data" multiple="false" format="deacon.idx" label="Input own index file"/>
                </when>
            </conditional>
        </repeat>
    </xml>
    <xml name="deacon_intersect">
        <repeat name="deacon_repeat" min="2" title="Input" default="2">
            <conditional name="file_input">
                <param name="is_select" type="select" label="Input own index file or use pre-build index files from data manager">
                    <option value="dm">From data manger</option>
                    <option value="own">Use own index files</option>
                </param>
                <when value="dm">
                    <expand macro="dm_ref"/>
                </when>
                <when value="own">
                    <param name="file" type="data" multiple="false" format="deacon.idx" label="Input own index file"/>
                </when>
            </conditional>
        </repeat>
    </xml>
    <xml name="deacon_diff">
        <conditional name="first_file">
            <param name="is_select" type="select" label="Input own index file or use pre-build index files from data manager">
                <option value="dm">From data manger</option>
                <option value="own">Use own index files</option>
            </param>
            <when value="dm">
                <expand macro="dm_ref"/>
            </when>
            <when value="own">
                <param name="file" type="data" multiple="false" format="deacon.idx" label="Input own index file"/>
            </when>
        </conditional>
        <conditional name="second_file">
            <param name="is_select" type="select" label="Second file should be index file or fasta/fastq file">
                <option value="index">Index file</option>
                <option value="fastx">fasta/fastq file</option>
            </param>
            <when value="index">
                <conditional name="file_input">
                    <param name="is_select" type="select" label="Input own index file or use pre-build index files from data manager">
                        <option value="dm">From data manger</option>
                        <option value="own">Use own index files</option>
                    </param>
                    <when value="dm">
                        <expand macro="dm_ref"/>
                    </when>
                    <when value="own">
                        <param name="file" type="data" multiple="false" format="deacon.idx" label="Input own index file"/>
                    </when>
                </conditional>
            </when>
            <when value="fastx">
                <param name="fastx_file" type="data" format="fasta,fastqsanger,fastqillumina,fasta.gz,fastqsanger.gz,fastqillumina.gz" label="Input fasta/fastq file"/>
                <param argument="-k" type="integer" min="0" max="32" optional="false" label="set kmer length"/>
                <param argument="-w" type="integer" optional="false" label="Set window size"/>
            </when>
        </conditional>
    </xml>
    <xml name="deacon_dump">
        <conditional name="file_input">
            <param name="is_select" type="select" label="Input own index file or use pre-build index files from data manager">
                <option value="dm">From data manger</option>
                <option value="own">Use own index files</option>
            </param>
            <when value="dm">
                <expand macro="dm_ref"/>
            </when>
            <when value="own">
                <param name="file" type="data" multiple="false" format="deacon.idx" label="Input own index file"/>
            </when>
        </conditional>
    </xml>
    <token name="@DEACON_BUILD@">
        <![CDATA[

            ln -s '$operation.input' 'fastx.${operation.input.ext}' &&

            deacon index build
            'fastx.${operation.input.ext}'
            -k ${operation.k}
            -w ${operation.w}
            -e ${operation.e}
            -t "\${GALAXY_SLOTS:-8}"
            -o '$index_output'

        ]]>
    </token>
    <token name="@DEACON_UNION@">
        <![CDATA[
        
        #for $i, $repeat in enumerate($operation.deacon_repeat)
            #if $repeat.file_input.is_select == "own"
                ln -s '$repeat.file' 'index_file_${i}.deacon.idx' &&
            #end if
        #end for

        deacon index union
        #for $i, $repeat in enumerate($operation.deacon_repeat)
            #if $repeat.file_input.is_select == "own"
                'index_file_${i}.deacon.idx'
            #else
                '$repeat.from_dm.fields.path'
            #end if
        #end for
        -o '$index_output'

        ]]>
    </token>
    <token name="@DEACON_INTERSECT@">
        <![CDATA[
        
        #for $i, $repeat in enumerate($operation.deacon_repeat)
            #if $repeat.file_input.is_select == "own"
                ln -s '$repeat.file' 'index_file_${i}.deacon.idx' &&
            #end if
        #end for

        deacon index intersect
        #for $i, $repeat in enumerate($operation.deacon_repeat)
            #if $repeat.file_input.is_select == "own"
                'index_file_${i}.deacon.idx'
            #else
                '$repeat.from_dm.fields.path'
            #end if
        #end for
        -o '$index_output'

        ]]>
    </token>
    <token name="@DEACON_DIFF@">
        <![CDATA[
        
        #if $operation.first_file.is_select == "own"
            ln -s '$operation.first_file.file' 'index_1.deacon.idx' &&
        #end if

        #if $operation.second_file.is_select == "index"
            #if $operation.file_input.is_select == "own"
                ln -s '$operation.second_file.file' 'index_2.deacon.idx' &&
            #end if
        #else
            ln -s '$operation.fastx_file' 'fastx.${operation.fastx_file.ext}' &&
        #end if

        deacon index diff
        #if $operation.first_file.is_select == "own"
            'index_1.deacon.idx'
        #else
            '$operation.first_file.from_dm.fields.path'
        #end if
        #if $operation.second_file.is_select == "index"
            #if $operation.file_input.is_select == "own"
                'index_2.deacon.idx'
            #else
                '$operation.second_file.from_dm.fields.path'
            #end if
        #else
            'fastx.${operation.fastx_file.ext}'
            -k ${operation.k}
            -w ${operation.w}
        #end if
        -t "\${GALAXY_SLOTS:-8}"
        -o '$index_output'

        ]]>
    </token>
    <token name="@DEACON_DUMP@">
        <![CDATA[
        
            #if $operation.file_input.is_select == "own"
                ln -s '$operation.file' 'index.deacon.idx' &&
            #end if
            
            deacon index dump
            #if $operation.file_input.is_select == "own"
                'index.deacon.idx'
            #else
                '$operation.from_dm.fields.path'
            #end if
            -o '$fasta_output'

        ]]>
    </token>
    <xml name="citation">
        <citations>
            <citation type="doi">10.1101/2025.06.09.658732</citation>
        </citations>
    </xml>
</macros>
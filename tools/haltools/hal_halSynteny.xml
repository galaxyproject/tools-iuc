<tool id="hal_halSynteny" name="halSynteny" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>converts alignments into synteny blocks</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        halSynteny
            --minBlockSize $minBlockSize
            --maxAnchorDistance $maxAnchorDistance
            --queryGenome '$queryGenome'
            --targetGenome '$targetGenome'
            #if $queryChromosome:
                --queryChromosome '$queryChromosome'
            #end if
            #if $selection.input == 'hal':
                '$selection.input_hal'
            #else:
                --alignmentIsPsl
                '$selection.input_psl'
            #end if 
            '$output_file'
    ]]></command>
    <inputs>
        <conditional name="selection">
            <param name="input" type="select" label="Input alignment file format">
                <option value="hal" selected="true">Input HAL file</option>
                <option value="psl">Input PSL file</option>
            </param>
            <when value="hal">
                <expand macro="input_hal"/>
            </when>
            <when value="psl">
                <param name="input_psl" type="data" format="psl" label="PSL file"/>
            </when>
        </conditional> 
        <param argument="--queryGenome" type="text" value="" label="Query genome" help="Specify the genome to query from which the synteny is inferred">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>  
        <param argument="--targetGenome" type="text" value="" label="Target genome" help="Specify the target genome against which the query genome is compared. Must be different to 'Query genome'">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>  
        <param argument="--queryChromosome" type="text" optional="true" value="" label="Query chromosome" help="Limit synteny detection to a specific chromosome (or sequence) from the query genome (if empty, whole genome is used) ">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>  
        <param argument="--maxAnchorDistance" type="integer" min="0" value="5000" label="Max anchor distance" help="Set the maximum allowed distance between adjacent alignment anchors to be considered part of the same synteny block"/>
        <param argument="--minBlockSize" type="integer" min="0" value="5000" label="Min block size" help="Set the minimum length of a synteny block to process. Blocks shorter than this threshold are ignored"/>
    </inputs>
    <outputs>
        <data name="output_file" format="psl" label="${tool.name} on ${on_string}: Synteny blocks"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <conditional name="selection">
                <param name="input" value="hal"/>
                <param name="input_hal" value="halTest.hal"/>
            </conditional>
            <param name="queryGenome" value="Genome_0"/>
            <param name="targetGenome" value="Genome_1"/>
            <param name="minBlockSize" value="100"/>
            <output name="output_file" ftype="psl" file="halSynteny_inhal_minBlockSize_output.psl"/>
        </test>
        <test expect_num_outputs="1">
            <conditional name="selection">
                <param name="input" value="hal"/>
                <param name="input_hal" value="halTest.hal"/>
            </conditional>
            <param name="queryGenome" value="Genome_0"/>
            <param name="targetGenome" value="Genome_1"/>
            <param name="minBlockSize" value="100"/>
            <param name="maxAnchorDistance" value="500"/>
            <output name="output_file" ftype="psl" file="halSynteny_inhal_minBlockSize_maxAnchorDistance_output.psl"/>
        </test>
        <test expect_num_outputs="1">
            <conditional name="selection">
                <param name="input" value="psl"/>
                <param name="input_psl" value="halSynteny.psl"/>
            </conditional>
            <param name="queryGenome" value="Genome_0"/>
            <param name="targetGenome" value="Genome_1"/>
            <param name="minBlockSize" value="500"/>
            <output name="output_file" ftype="psl"  file="halSynteny_inpsl_minBlockSize_output.psl"/>
        </test>
    </tests>
    <help><![CDATA[
halSynteny converts genome alignments into synteny blocks, outputting them in PSL format. 
It accepts input in either HAL or PSL format and identifies conserved blocks between a source and reference genome. 

The tool is useful for studying genome structure, rearrangements, and conserved regions across species.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
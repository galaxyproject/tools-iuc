<tool id="hal_halmaskextract" name="halMaskExtract" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>extracts masked intervals of a genome into BED file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        halMaskExtract
            #if $mode.regions == '--extend':
                --extend $mode.extend
            #else if $mode.regions == '--extendPct':
                --extendPct $mode.extendPct
            #end if
            '$input_hal' '$refGenome' > '$out_file'
    ]]></command>
    <inputs>
        <expand macro="input_hal"/>
        <expand macro="params_refGenome"/>
        <conditional name="mode">
            <param name="regions" type="select" label="Extend masked regions">
                <option value="" selected="true">No, don't extend</option>
                <option value="--extend">Yes, extend by given number of bases (--extend)</option>
                <option value="--extendPct">Yes, extend by percentage of their lengths (--extendPct)</option>
            </param>
            <when value=""/>
            <when value="--extend">
                <param name="extend" type="integer" min="0" value="0" label="Number of bases" help="Extend masked regions by given number of bases"/>
            </when>
            <when value="--extendPct">
                <param name="extendPct" type="float" min="0" value="0" label="Percentage" help="Extend masked regions by percentage of their lengths"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="out_file" format="bed" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTestIndels.hal"/>
            <param name="refGenome" value="Ref"/>
            <output name="out_file" ftype="bed">
                <assert_contents>
                    <has_line line="chr1&#009;5&#009;10"/>
                    <has_n_lines n="1"/>
                </assert_contents>    
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTestIndels.hal"/>
            <param name="refGenome" value="Ref"/>
            <conditional name="mode">
                <param name="regions" value="--extend"/>
                <param name="extend" value="100"/>
            </conditional>
            <output name="out_file" ftype="bed">
                <assert_contents>
                    <has_line line="chr1&#009;5&#009;100"/>
                    <has_n_lines n="1"/>
                </assert_contents> 
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTestIndels.hal"/>
            <param name="refGenome" value="Ref"/>
            <conditional name="mode">
                <param name="regions" value="--extendPct"/>
                <param name="extendPct" value="0.25"/>
            </conditional>
            <output name="out_file" ftype="bed">
                <assert_contents>
                    <has_line line="chr1&#009;4&#009;11"/>
                    <has_n_lines n="1"/>
                </assert_contents> 
            </output>
        </test>
    </tests>
    <help><![CDATA[
halMaskExtract extracts masked regions from a given genome found in an input HAL file and writes them as BED intervals.
Options let you extend intervals by a fixed number of bases or by a percentage of interval length.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
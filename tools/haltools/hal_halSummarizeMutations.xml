<tool id="hal_halsummarizemutations" name="halSummarizeMutations" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>creates a summary table of mutation events in the alignmet</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        set -o pipefail; ## Sets the pipeline’s exit code to halSummarizeMutations’s on failure.
        halSummarizeMutations
            #if $mode.option == '--rootGenome':
                --rootGenome '$mode.rootGenome'
            #else if $mode.option == '--targetGenomes':
                --targetGenomes '$mode.targetGenomes'
            #end if
            --maxGap $maxGap
            --maxNFraction $maxNFraction
            $justSubs
            ## Pipes output to replace commas with tabs. Output is mostly numerical, and Genome names contain no commas, as this would invalidate the HAL Newick tree.
            '$input_hal' | tr ',' '\t' > '$output_file' 
    ]]></command>
    <inputs>
        <expand macro="input_hal"/>
        <conditional name="mode">
            <param name="option" type="select" label="Summarize options">
                <option value="" selected="true">All genomes (default)</option>
                <option value="--targetGenomes">Specific target genomes (--targetGenomes)</option>
                <option value="--rootGenome">Only genomes in a root genome subtree (--rootGenome)</option>
            </param>
            <when value=""/>
            <when value="--rootGenome">
                <expand macro="params_rootGenome"/>
            </when>
            <when value="--targetGenomes">
                <expand macro="params_targetGenomes"/>
            </when>
        </conditional>
        <expand macro="params_maxGap"/>
        <expand macro="params_maxNFraction"/>
        <param argument="--justSubs" type="boolean" truevalue="--justSubs" falsevalue="" checked="false" label="Just count substitutions" help="Results are total substitutions between genome and all children, rather than branch results. For tuning and performance checking only"/>
    </inputs>
    <outputs>
        <data name="output_file" format="tabular" label="${tool.name} on ${on_string}: Mutation events"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <output name="output_file" ftype="tabular">
                <assert_contents>
                    <has_text text="GenomeName&#009; ParentName&#009; BranchLength"/>
                    <has_line line="Total&#009; &#009;3&#009; 15881&#009; 5274&#009; 0&#009; 0&#009; 0&#009; 12929&#009; 0&#009; 0&#009; 0&#009; 0&#009; 6&#009; 1304&#009; 0&#009; 0&#009; 0&#009; 0&#009; 28&#009; 8827&#009; 3&#009; 879&#009; 0"/>
                    <has_n_lines n="8"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <conditional name="mode">
                <param name="option" value="--rootGenome"/>
                <param name="rootGenome" value="Genome_1"/>
            </conditional>
            <param name="justSubs" value="true"/>
            <output name="output_file" ftype="tabular">
                 <assert_contents>
                    <has_text text="GenomeName&#009; ParentName&#009; BranchLength"/>
                    <has_line line="Total&#009; &#009;3&#009; 17639&#009; 5274&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0&#009; 0"/>
                    <has_n_lines n="9"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
halSummarizeMutations needs a HAL file as input and outputs a table that reports substitutions, indels, and other rearrangements across the alignment. 
Focus the summary on selected genomes, a specific root genome, or the entire file. 
The tool offers controls for how gaps and N rich regions are treated, and it can switch to a substitutions only mode for tuning and performance checking only. 
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
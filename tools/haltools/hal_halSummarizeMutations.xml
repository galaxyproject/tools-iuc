<tool id="hal_halSummarizeMutations" name="halSummarizeMutations" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>creates a summary table of mutation events in the alignmet</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        halSummarizeMutations
            #if $inputFormat == "mmap":
                --format 'mmap'
            #end if
            #if $mode.option == "--rootGenome":
                --rootGenome '$mode.rootGenome'
            #else if $mode.option == "--targetGenomes":
                --targetGenomes '$mode.targetGenomes'
            #end if
            --maxGap $maxGap
            --maxNFraction $maxNFraction
            $justSubs
            '$input_hal' > '$out_file'
    ]]></command>
    <inputs>
        <expand macro="input_hal"/>
        <expand macro="hal_backend_format"/>
        <conditional name="mode">
            <param name="option" type="select" label="Summarize options">
                <option value="" selected="true">All genomes (default)</option>
                <option value="--rootGenome">Specific root genome (--rootGenome)</option>
                <option value="--targetGenomes">Specific target genomes (--targetGenomes)</option>
            </param>
            <when value=""/>
            <when value="--rootGenome">
                <param name="rootGenome" type="text" value="" label="Root genome" help="Process only genomes belonging to the subtree rooted at the root genome">
                    <expand macro="sanitizer_default"/>
                    <expand macro="validator_trim"/>
                </param>
            </when>
            <when value="--targetGenomes">
                <param name="targetGenomes" type="text" value="" label="Target genomes" help="Comma-separated (no spaces) list of target genomes (others are excluded)">
                    <expand macro="sanitizer_default"/>
                    <expand macro="validator_comma_list"/>
                </param>
            </when>
        </conditional>
        <param argument="--maxGap" type="integer" min="0" value="20" label="Max gap" help="Maximum indel length to be considered a gap. Gaps can be nested within other rearrangements"/>
        <param argument="--maxNFraction" type="integer" min="1" value="1" label="Maximum fraction of Ns" help="Maximum fraction of Ns in a rearranged segment for it to not be ignored as missing data"/>
        <param argument="--justSubs" type="boolean" truevalue="--justSubs" falsevalue="" checked="false" label="Just count substitutions" help="Results are total substitutions between genome and all children, rather than branch results when using the normal interface. For tuning and performance checking only"/>
    </inputs>
    <outputs>
        <data name="out_file" format="csv" label="${tool.name} on ${on_string}: Mutation events ${mode.option}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <output name="out_file" ftype="csv">
                <assert_contents>
                    <has_line line="Total, ,3, 15881, 5274, 0, 0, 0, 12929, 0, 0, 0, 0, 6, 1304, 0, 0, 0, 0, 28, 8827, 3, 879, 0"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <conditional name="mode">
                <param name="option" value="--rootGenome"/>
                <param name="rootGenome" value="Genome_1"/>
            </conditional>
            <param name="justSubs" value="true"/>
            <output name="out_file" ftype="csv">
                 <assert_contents>
                    <has_line line="Total, ,3, 17639, 5274, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
halSummarizeMutations needs a HAL file as input and produces a csv file table that reports substitutions, indels, and other rearrangements across the alignment. 
Focus the summary on selected genomes, a specific root genome, or the entire file. 
The tool offers controls for how gaps and N rich regions are treated, and it can switch to a substitutions only mode for tuning and performance checking only. 
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
<tool id="hal_hal2paf" name="hal2paf" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>exports pairwise alignment to PAF</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        hal2paf
            #if $rootGenome:
                --rootGenome '$rootGenome'
            #end if
            $onlySequenceNames
            '$input_hal' > temp.paf
            #if $compression.type == 'gz':
                && gzip -c temp.paf > '$out_file'
            #else if $compression.type == 'bz2':
                && bzip2 -c temp.paf > '$out_file'
            #else:
                && mv temp.paf '$out_file'
            #end if
    ]]></command>
    <inputs>
        <expand macro="input_hal"/>
        <expand macro="params_rootGenome_optional"/>
        <expand macro="params_onlySequenceNames"/>     
        <expand macro="params_conditional_compression"/>
    </inputs>
    <outputs>
        <data name="out_file" format="paf" label="${tool.name} on ${on_string}: PAF">
            <change_format>
                <when input="compression.type" value="gz" format="paf.gz"/>
                <when input="compression.type" value="bz2" format="paf.bz2"/>
            </change_format>
        </data>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <output name="out_file" ftype="paf">
                <assert_contents>
                    <has_line line="Genome_1.Genome_1_seq&#009;5472&#009;0&#009;1465&#009;+&#009;Genome_0.Genome_0_seq&#009;1758&#009;0&#009;1465&#009;1465&#009;1465&#009;255&#009;cg:Z:1465M"/>   
                    <has_line line="Genome_2.Genome_2_seq&#009;4270&#009;2051&#009;2344&#009;+&#009;Genome_0.Genome_0_seq&#009;1758&#009;293&#009;586&#009;293&#009;293&#009;255&#009;cg:Z:293M"/>    
                    <has_line line="Genome_3.Genome_3_seq&#009;6139&#009;3809&#009;4688&#009;+&#009;Genome_0.Genome_0_seq&#009;1758&#009;586&#009;1465&#009;879&#009;879&#009;255&#009;cg:Z:879M"/>    
                    <has_n_lines n="25"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <conditional name="compression">
                <param name="type" value="gz"/>
            </conditional>
            <output name="out_file" ftype="paf.gz" file="hal2paf_output.paf.gz"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <conditional name="compression">
                <param name="type" value="bz2"/>
            </conditional>
            <output name="out_file" ftype="paf.bz2" file="hal2paf_output.paf.bz2"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="rootGenome" value="Genome_0"/>
            <param name="onlySequenceNames" value="true"/>
            <output name="out_file" ftype="paf">
                <assert_contents>
                    <has_line line="Genome_1_seq&#009;5472&#009;0&#009;1465&#009;+&#009;Genome_0_seq&#009;1758&#009;0&#009;1465&#009;1465&#009;1465&#009;255&#009;cg:Z:1465M"/>   
                    <has_line line="Genome_2_seq&#009;4270&#009;2051&#009;2344&#009;+&#009;Genome_0_seq&#009;1758&#009;293&#009;586&#009;293&#009;293&#009;255&#009;cg:Z:293M"/>    
                    <has_line line="Genome_3_seq&#009;6139&#009;3809&#009;4688&#009;+&#009;Genome_0_seq&#009;1758&#009;586&#009;1465&#009;879&#009;879&#009;255&#009;cg:Z:879M"/>    
                    <has_n_lines n="25"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
hal2paf exports each branch of an input HAL file as a pairwise alignment in PAF format. 
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
<tool id="hal_halindels" name="halIndels" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>counts indels in the branch above the genome</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        halIndels
            --adjacentBases $adjacentBases
            $onlyExtantTargets
            '$input_hal' '$genome' > '$out_file'
    ]]></command>
    <inputs>
        <expand macro="input_hal"/>
        <expand macro="params_genomeNoRoot"/>
        <param argument="--adjacentBases" type="integer" min="1" value="5" label="Adjacent bases" help="Number of adjacent bases to examine while filtering"/>
        <param argument="--onlyExtantTargets" type="boolean" truevalue="--onlyExtantTargets" falsevalue="" checked="false" label="Only extant targets" help="Use only extant genomes for 'sibling'/outgroup"/>
    </inputs>
    <outputs>
        <data name="out_file" format="bed" label="${tool.name} on ${on_string}: Indel count"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTestIndels.hal"/>
            <param name="genome" value="Ref"/>
            <output name="out_file" ftype="bed">
                <assert_contents>
                    <has_n_lines n="2"/>
                    <has_line line="chr1&#009;10&#009;10&#009;D&#009;5"/>
                    <has_line line="# num sites possible: 25"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTestIndels.hal"/>
            <param name="genome" value="Ref"/>
            <param name="onlyExtantTargets" value="true"/>
            <output name="out_file" ftype="bed">
                <assert_contents>
                    <has_n_lines n="2"/>
                    <has_line line="chr1&#009;10&#009;10&#009;D&#009;5"/>
                    <has_line line="# num sites possible: 25"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTestIndels.hal"/>
            <param name="genome" value="Ref"/>
            <param name="adjacentBases" value="10"/>
            <output name="out_file" ftype="bed">
                <assert_contents>
                    <has_n_lines n="2"/>
                    <has_line line="chr1&#009;10&#009;10&#009;D&#009;5"/>
                    <has_line line="# num sites possible: 20"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
halIndels counts insertion and deletions on the branch above a given reference genome of an input HAL file and outputs the result as a BED file.
The reference genome must not be the root of the alignment.
Filtering can applied using a configurable number of adjacent bases to reduce noise.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
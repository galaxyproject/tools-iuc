<tool id="hal_halSnps" name="halSnps" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>counts SNPs between orthologous positions in multiple genomes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        (
        ## echo headers for specific numerical data
        echo -e "targetGenome\ttotalSnps\ttotalCleanOrthologousPairs";
    
        halSnps
            #if $mode.export == 'sequence':
                --refSequence '$mode.sequence'
            #end if
            --start $start
            --length $length
            --minSpeciesForSnp $minSpeciesForSnp
            $noDupes
            $unique
            '$input_hal' '$refGenome' '$targetGenomes'
        ) > '$out_file'
    ]]></command>
    <inputs>        
        <expand macro="input_hal"/> 
        <expand macro="params_refGenome"/>
        <expand macro="params_targetGenomes"/>
        <conditional name="mode">
            <param name="export" type="select" label="Process options">
                <option value="default" selected="true">Process all sequences (default)</option>
                <option value="sequence">Process a specific sequence (--refSequence)</option>
            </param>
            <when value="default"/>
            <when value="sequence">
                <expand macro="params_sequence"/>
            </when>
        </conditional>
        <expand macro="params_start"/>
        <expand macro="params_length"/>
        <param argument="--noDupes" type="boolean" truevalue="--noDupes" falsevalue="" checked="false" label="No duplicates" help="Do not consider paralogies while mapping"/>
        <param argument="--minSpeciesForSnp" type="integer" min="1" value="1" optional="true" label="Minimum number of species" help="Minimum number of species that must have a different base than the reference for a SNP to be reported in the output"/>
        <param argument="--unique" type="boolean" truevalue="--unique" falsevalue="" checked="false" label="Unique" help="Whether to ignore columns that are not canonical on the reference genome"/> 
    </inputs>
    <outputs>
        <data name="out_file" format="tsv" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_0"/>
            <param name="targetGenomes" value="Genome_0,Genome_1,Genome_2"/>
            <output name="out_file" ftype="tsv" file="halSnps_output.tsv"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_0"/>
            <param name="targetGenomes" value="Genome_0,Genome_1,Genome_2"/>
            <param name="noDupes" value="true"/>
            <output name="out_file" ftype="tsv" file="halSnps_refGenome_targetGenomes_output.tsv"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_0"/>
            <param name="targetGenomes" value="Genome_0,Genome_1,Genome_2"/>
            <param name="start" value="10"/>
            <param name="length" value="50"/>
            <output name="out_file" ftype="tsv" file="halSnps_refGenome_targetGenomes_start_length_output.tsv"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_0"/>
            <param name="targetGenomes" value="Genome_0,Genome_1,Genome_2"/>
            <conditional name="mode">
                <param name="export" value="sequence"/>
                <param name="sequence" value="Genome_0_seq"/>
            </conditional>
            <param name="start" value="10"/>
            <param name="length" value="500"/>
            <output name="out_file" ftype="tsv" file="halSnps_refGenome_targetGenomes_sequence_output.tsv"/>
        </test>
    </tests>
    <help><![CDATA[
halSnps counts SNPs between orthologous positions across multiple genomes in a HAL alignment. 
The tool compares each position in a reference genome against one or more target genomes and reports how many SNPs occur, along with the number of clean orthologous positions examined.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
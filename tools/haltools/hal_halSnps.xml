<tool id="hal_halSnps" name="halSnps" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>counts snps between orthologous positions in multiple genomes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        (
        ## echo headers for specific numerical data
        echo -e "targetGenome\ttotalSnps\ttotalCleanOrthologousPairs";
    
        halSnps
            #if $inputFormat == "mmap":
                --format 'mmap'
            #end if
            #if $mode.export == "sequence":
                --refSequence '$sequence'
            #end if
            --start $start
            --length $length
            --minSpeciesForSnp $minSpeciesForSnp
            $noDupes
            $unique
            '$input_hal' '$refGenome' '$targetGenomes'
        ) > '$out_file'
    ]]></command>
    <inputs>        
        <expand macro="input_hal"/>
        <expand macro="hal_backend_format"/>   
        <param name="refGenome" type="text" value="" label="Reference genome">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param> 
        <param name="targetGenomes" type="text" value="" label="Target genomes" help="Enter a comma-separated (no spaces) list of genomes to target">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_comma_list"/>
        </param>
        <conditional name="mode">
            <param name="export" type="select" label="Reference sequence">
                <option value="default" selected="true">Process all sequences (default)</option>
                <option value="sequence">Process a specific sequence (--sequence)</option>
            </param>
            <when value="default"/>
            <when value="sequence">
                <param name="sequence" type="text" value="" label="Sequence name" help="Sequence name in reference genome to process">
                    <expand macro="sanitizer_default"/>
                    <expand macro="validator_trim"/>
                </param>
            </when>
        </conditional>
        <param argument="--start" type="integer" min="0" value="0" optional="true" label="Start coordinate" help="Coordinate within reference genome (or reference sequence) to start at"/>
        <param argument="--length" type="integer" min="0" value="0" optional="true" label="Length to convert" help="Length of the reference genome (or reference sequence) to convert. If set to 0, the entire thing is converted"/>
        <param argument="--noDupes" type="boolean" truevalue="--noDupes" falsevalue="" checked="false" label="No duplicates" help="Do not consider paralogies while mapping"/>
        <param argument="--minSpeciesForSnp" type="integer" min="1" value="1" optional="true" label="Minimum number of species" help="Minimum number of species that must have a different base than the reference for a SNP to be reported in the output"/>
        <param argument="--unique" type="boolean" truevalue="--unique" falsevalue="" checked="false" label="Unique" help="Whether to ignore columns that are not canonical on the reference genome"/> 
    </inputs>
    <outputs>
        <data name="out_file" format="tsv" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_0"/>
            <param name="targetGenomes" value="Genome_0,Genome_1,Genome_2"/>
            <output name="out_file" md5="284a858e831e28cec3e821a7d684895b" ftype="tsv"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_0"/>
            <param name="targetGenomes" value="Genome_0,Genome_1,Genome_2"/>
            <param name="noDupes" value="true"/>
            <output name="out_file" md5="0467083bbacadb74f805a6e967dcd65c" ftype="tsv"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_0"/>
            <param name="targetGenomes" value="Genome_0,Genome_1,Genome_2"/>
            <param name="start" value="10"/>
            <param name="length" value="50"/>
            <output name="out_file" md5="d9bbff6355d7fb739562e79696ad3a53" ftype="tsv"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_0"/>
            <param name="targetGenomes" value="Genome_0,Genome_1,Genome_2"/>
            <conditional name="mode">
                <param name="export" value="sequence"/>
                <param name="sequence" value="Genome_0_seq"/>
            </conditional>
            <param name="start" value="10"/>
            <param name="length" value="500"/>
            <output name="out_file" md5="cc42ea276af4a474f609f7416a70c584" ftype="tsv"/>
        </test>
    </tests>
    <help><![CDATA[
halSnps counts SNPs between orthologous positions across multiple genomes in a HAL alignment. 
The tool compares each position in a reference genome against one or more target genomes and reports how many SNPs occur, along with the number of clean orthologous positions examined.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
<tool id="hal_halWiggleLiftover" name="halWiggleLiftover" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>maps wiggle genome annotations between two genomes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        #if $mode.append:
            ## If an input Wig file is provided to append to, ensure that it is not modified.
            cp '$tgtWig' writable_tgtWig.wig
            && 
        #end if

        halWiggleLiftover
            #if $inputFormat == "mmap":
                --format 'mmap'
            #end if
            #if $mode.append:
                --append
            #end if
            $noDupes
            '$input_hal' '$srcGenome' '$srcWig' '$tgtGenome' writable_tgtWig.wig
    ]]></command>
    <inputs>
        <expand macro="input_hal"/>
        <expand macro="hal_backend_format"/>
        <param name="srcWig" type="data" format="wig" optional="false" label="Wig file"/>
        <param name="srcGenome" type="text" optional="false" label="Source genome" help="Source genome name present in the HAL and Wig file from which genome annotations should be mapped">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
        <param name="tgtGenome" type="text" optional="false" label="Target genome" help="Target genome name present in the HAL file to which genome annotations should be mapped">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
        <param argument="--noDupes" type="boolean" truevalue="--noDupes" falsevalue="" checked="false" label="No duplicates" help="Do not map between duplications in graph"/>
        <conditional name="mode">
            <param name="append" type="boolean" checked="false" label="Append results to an existing Wig file" help="Append or merges results to an existing Wig file (--append)"/>
            <when value="true">
                <param name="tgtWig" type="data" format="wig" optional="false" label="Target Wig file"/>
            </when>
            <when value="false"/>
        </conditional>
   </inputs>
    <outputs>
        <data name="output_file" format="wig" label="${tool.name} on ${on_string}" from_work_dir="writable_tgtWig.wig"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="srcGenome" value="Genome_0"/>
            <param name="srcWig" value="halWiggleLiftover.wig"/>
            <param name="tgtGenome" value="Genome_1"/>
            <output name="output_file" md5="65407d7e675e12acf28926789e9e119f" ftype="wig"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="srcGenome" value="Genome_0"/>
            <param name="srcWig" value="halWiggleLiftover.wig"/>
            <param name="tgtGenome" value="Genome_1"/>
            <param name="noDupes" value="true"/>
            <output name="output_file" md5="3e513b1cbbc58055b654e36ad52485fb" ftype="wig"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="srcGenome" value="Genome_0"/>
            <param name="srcWig" value="halWiggleLiftover.wig"/>
            <param name="tgtGenome" value="Genome_1"/>
            <conditional name="mode">
                <param name="append" value="true"/>
                <param name="tgtWig" value="halWiggleLiftover_append.wig"/>
            </conditional>
            <output name="output_file" md5="65407d7e675e12acf28926789e9e119f" ftype="wig"/>
        </test>
    </tests>
    <help><![CDATA[
halWiggleLiftover maps wiggle genome annotations from one genome to another using a HAL multiple alignment.
It reads values from an input wig file in the source genome and lifts them over to the target genome based on the HAL file.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
<tool id="hal_halWiggleLiftover" name="halWiggleLiftover" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>maps wiggle genome annotations between two genomes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        #if $mode.append == 'true':
            ## If an input Wig file is provided to append to, ensure that it is not modified.
            cp '$tgtWig' writable_tgtWig.wig && 
        #end if

        halWiggleLiftover
            #if $mode.append == 'true':
                --append
            #end if
            $noDupes
            '$input_hal' '$srcGenome' '$srcWig' '$tgtGenome' writable_tgtWig.wig
    ]]></command>
    <inputs>
        <expand macro="input_hal"/>
        <param name="srcWig" type="data" format="wig" optional="false" label="WIG file"/>
        <expand macro="params_srcGenome"/>
        <expand macro="params_tgtGenome"/>
        <expand macro="params_noDupes"/>
        <conditional name="mode">
            <param name="append" type="select" label="Output options">
                <option value="false" selected="true">Create a new WIG file (default)</option>
                <option value="true">Append/merge results to an existing WIG file (--append)</option>
            </param>
            <when value="false"/>
            <when value="true">
                <param name="tgtWig" type="data" format="wig" label="Target WIG file"/>
            </when>
        </conditional>
   </inputs>
    <outputs>
        <data name="output_file" format="wig" label="${tool.name} on ${on_string}" from_work_dir="writable_tgtWig.wig"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="srcGenome" value="Genome_0"/>
            <param name="srcWig" value="halWiggleLiftover.wig"/>
            <param name="tgtGenome" value="Genome_1"/>
            <output name="output_file" ftype="wig" file="halWiggleLiftover_output"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="srcGenome" value="Genome_0"/>
            <param name="srcWig" value="halWiggleLiftover.wig"/>
            <param name="tgtGenome" value="Genome_1"/>
            <param name="noDupes" value="true"/>
            <output name="output_file" ftype="wig" file="halWiggleLiftover_noDupes_output"/>
        </test>
        <test expect_num_outputs="1">
            <param name="input_hal" value="halTest.hal"/>
            <param name="srcGenome" value="Genome_0"/>
            <param name="srcWig" value="halWiggleLiftover.wig"/>
            <param name="tgtGenome" value="Genome_1"/>
            <conditional name="mode">
                <param name="append" value="true"/>
                <param name="tgtWig" value="halWiggleLiftover_append.wig"/>
            </conditional>
            <output name="output_file" ftype="wig" file="halWiggleLiftover_append_output"/>
        </test>
    </tests>
    <help><![CDATA[
halWiggleLiftover maps wiggle genome annotations from one genome to another using a HAL multiple alignment.
It reads values from an input WIG file in the source genome and lifts them over to the target genome based on the HAL file.
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
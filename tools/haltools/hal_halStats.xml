<tool id="hal_halstats" name="HAL halStats" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="25.0">
    <description>retrieves basic statistics from a hal file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <command detect_errors="aggressive"><![CDATA[
        halStats 
            #if $inputFormat.type == "mmap":
                --format 'mmap'
            #end if
            #if $mode.option == "--allCoverage"
                $mode.allCoverage
            #else if $mode.option == "--branches"
                $mode.branches
            #else if $mode.option == "--genomes"
                $mode.genomes
            #else if $mode.option == "--metaData"
                $mode.metaData
            #else if $mode.option == "--root"
                $mode.root
            #else if $mode.option == "--tree"
                $mode.tree
            #else if $mode.option == "--baseComp"
                --baseComp '$mode.baseComp'
            #else if $mode.option == "--bedSequences"
                --bedSequences '$mode.bedSequences'
            #else if $mode.option == "--bottomSegments"
                --bottomSegments '$mode.bottomSegments'
            #else if $mode.option == "--branchLength"
                --branchLength '$mode.branchLength'
            #else if $mode.option == "--children"
                --children '$mode.children'
            #else if $mode.option == "--chromSizes"
                --chromSizes '$mode.chromSizes'
            #else if $mode.option == "--coverage"
                --coverage '$mode.coverage'
            #else if $mode.option == "--genomeMetaData"
                --genomeMetaData '$mode.genomeMetaData'
            #else if $mode.option == "--numSegments"
                --numSegments '$mode.numSegments'
            #else if $mode.option == "--parent"
                --parent '$mode.parent'
            #else if $mode.option == "--percentID"
                --percentID '$mode.percentID'
            #else if $mode.option == "--sequenceStats"
                --sequenceStats '$mode.sequenceStats'
            #else if $mode.option == "--sequences"
                --sequences '$mode.sequences'
            #else if $mode.option == "--span"
                --span '$mode.span'
            #else if $mode.option == "--spanRoot"
                --spanRoot '$mode.spanRoot'
            #else if $mode.option == "--topSegments"
                --topSegments '$mode.topSegments'
            #end if
            #if $mode.option == "--allCoverage" and $mode.allCoverage
                '$in_hal_file' > stats.csv
            #else 
                '$in_hal_file' > stats.txt
            #end if
    ]]></command>
    <inputs>
        <expand macro="in_hal_file"/>
        <expand macro="params_inputFormat"/>
        <conditional name="mode">
            <param name="option" type="select" label="Select a print option" refresh_on_change="true"
                help="Select a print option from the drop down to display its description and to enable it accordingly">
                <option value="" selected="true">Default</option>
                <option value="--allCoverage">All Coverage (--allCoverage)</option>
                <option value="--branches">List of branches (--branches)</option>
                <option value="--sequences">List of sequences (--sequences)</option>
                <option value="--genomes">List of genomes (--genomes)</option>
                <option value="--baseComp">Base composition (--baseComp)</option>
                <option value="--bedSequences">Bed sequences (--bedSequences)</option>
                <option value="--sequenceStats">Stats for each sequence (--sequenceStats)</option>
                <option value="--topSegments">Top segments (--topSegments)</option>
                <option value="--bottomSegments">Bottom segments (--bottomSegments)</option>
                <option value="--numSegments">Number of segments (--numSegments)</option>
                <option value="--branchLength">Branch length (--branchLength)</option>
                <option value="--parent">Parent name (--parent)</option>
                <option value="--root">Root genome name (--root)</option>
                <option value="--children">Names of children (--children)</option>
                <option value="--chromSizes">Chrom sizes (--chromSizes)</option>
                <option value="--coverage">Histogram of coverage (--coverage)</option>
                <option value="--metaData">Metadata for alignment (--metaData)</option>
                <option value="--genomeMetaData">Metadata for given genome (--genomeMetaData)</option>
                <option value="--percentID">Percent ID (--percentID)</option>
                <option value="--span">Span (--span)</option>
                <option value="--spanRoot">Span root (--spanRoot)</option>
                <option value="--tree">NEWICK tree (--tree)</option>
            </param>
            <when value="">
            </when>
            <when value="--allCoverage">
                <param name="allCoverage" type="boolean" truevalue="--allCoverage" falsevalue="" checked="false" 
                    label="All Coverage" 
                    help="Print histogram of coverage from all genomes to all genomes" />
            </when>
            <when value="--baseComp">
                <param name="baseComp" type="text" value="" 
                    label="Base composition" 
                    help="Print base composition for given genome by sampling every step bases. Parameter value is of the form genome,step. Ex: human,1000. The output is of the form fraction_of_As fraction_of_Gs fraction_of_Cs  fraction_of_Ts" />
            </when>
            <when value="--bedSequences">
                <param name="bedSequences" type="text" value="" 
                    label="Bed sequences" 
                    help="Print sequences of given genome in bed format" />
            </when>
            <when value="--topSegments">
                <param name="topSegments" type="text" value="" 
                    label="Top segments" 
                    help="Print coordinates of all top segments of given genome in BED format" />
            </when>
            <when value="--bottomSegments">
                <param name="bottomSegments" type="text" value="" 
                    label="Bottom segments" 
                    help="Print coordinates of all bottom segments of given genome in BED format" />
            </when>
            <when value="--branchLength">
                <param name="branchLength" type="text" value="" 
                    label="Branch length" 
                    help="Print branch length between given genome and its parent in the tree" />
            </when>
            <when value="--branches">
                <param name="branches" type="boolean" truevalue="--branches" falsevalue="" checked="false" 
                    label="List of branches" 
                    help="Print list of branches. Each branch is specified by the child genome" />
            </when>
            <when value="--children">
                <param name="children" type="text" value="" 
                    label="Names of children" 
                    help="Print names of children of given genome" />
            </when>
            <when value="--chromSizes">
                <param name="chromSizes" type="text" value=""  
                    label="Chrom sizes" 
                    help="Print the name and length of each sequence in a given genome. This is a subset of the information returned by --sequenceStats but is useful because it is in the format used by wigToBigWig" />
            </when>
            <when value="--coverage">
                <param name="coverage" type="text" value="" 
                    label="Histogram of coverage" 
                    help="Print histogram of coverage of a genome with all genomes" />
            </when>
            <when value="--genomeMetaData">
                <param name="genomeMetaData" type="text" value="" 
                    label="Metadata for given genome" 
                    help="Print metadata for given genome, one entry per line, tab-seperated" />
            </when>
            <when value="--genomes">
                <param name="genomes" type="boolean" truevalue="--genomes" falsevalue="" checked="false" 
                    label="List of genomes" 
                    help="Print only a list of genomes in alignment" />
            </when>
            <when value="--metaData">
                <param name="metaData" type="boolean" truevalue="--metaData" falsevalue="" checked="false" 
                    label="Metadata for alignment" 
                    help="Print metadata for the entire alignment" />
            </when>
            <when value="--numSegments">
                <param name="numSegments" type="text" value="" 
                    label="Number of segments" 
                    help="Print numTopSegments numBottomSegments for given genome" />
            </when>
            <when value="--parent">
                <param name="parent" type="text" value="" 
                    label="Parent name" 
                    help="Print name of parent of given genome" />
            </when>
            <when value="--percentID">
                <param name="percentID" type="text" value="" 
                    label="Percent ID" 
                    help="Print % ID of a genome with all other genomes. Only non-duplicated and unambiguous sites areconsidered" />
            </when>
            <when value="--root">
                <param name="root" type="boolean" truevalue="--root" falsevalue="" checked="false" 
                    label="Root genome name" 
                    help="Print root genome name" />
            </when>
            <when value="--sequenceStats">
                <param name="sequenceStats" type="text" value="" 
                    label="Stats for each sequence" 
                    help="Print stats for each sequence in given genome" />
            </when>
            <when value="--sequences">
                <param name="sequences" type="text" value="" 
                    label="List of sequence" 
                    help="Print list of sequences in given genome" />
            </when>
            <when value="--span">
                <param name="span" type="text" value="" 
                    label="Span" 
                    help="Print branches on path (or spanning tree) between comma separated list of genomes" />
            </when>
            <when value="--spanRoot">
                <param name="spanRoot" type="text" value="" 
                    label="Span root" 
                    help="Print genomes on path (or spanning tree) between comma separated list of genomes.  Different from --spanonly in that the spanning tree root is also given" />
            </when>
            <when value="--tree">
                <param name="tree" type="boolean" truevalue="--tree" falsevalue="" checked="false" 
                    label="NEWICK tree" 
                    help="Print only the NEWICK tree" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="out_file_txt" format="txt" from_work_dir="stats.txt" label="${tool.name} on ${on_string}: Stats">
            <filter>mode['option'] != '--allCoverage'</filter>
        </data>
        <data name="out_file_csv" format="tabular" from_work_dir="stats.csv" label="${tool.name} on ${on_string}: CSV Stats">
            <filter>mode['option'] == '--allCoverage' and mode['allCoverage']</filter>
        </data>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="in_hal_file" value="halTest.hal"/>
            <output name="out_file_txt" file="halStats_output.txt"/>
        </test>
        <test expect_num_outputs="1">
            <param name="in_hal_file" value="halTest.hal"/>
            <conditional name="mode">
                <param name="option" value="--allCoverage"/>
                <param name="allCoverage" value="true"/>
            </conditional>
            <output name="out_file_csv" file="halStats_allCoverage_output.csv"/>
        </test>
    </tests>
    <help><![CDATA[
Some global information from a HAL file can be quickly obtained using halStats. It will return the number of genomes, their phylogenetic tree, and the size of each array in each genome.

**USAGE:**
    halStats [Options] <halFile>

The --tree, --sequences, and --genomes options can be used to print out only specific information to simplify iterating over the alignment in shell or Python scripts.
    ]]></help>
    <expand macro="citation" />
</tool>
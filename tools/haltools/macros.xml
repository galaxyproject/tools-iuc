<macros>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">cactus</requirement>
        </requirements>
    </xml>
    <token name="@TOOL_VERSION@">2.9.9</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <token name="@PROFILE@">25.0</token>
    <xml name="stdio">
        <stdio>
            <!-- Anything other than zero is an error -->
            <exit_code range="1:"/>
            <exit_code range=":-1"/>
            <!-- In case the return code has not been set properly check stderr too -->
            <regex source="stderr"  match="Error:"/>
            <regex source="stderr"  match="Exception:"/>
            <regex match="terminate called after throwing"/>
            <regex match="hal_exception"/>
        </stdio>
    </xml>
    <xml name="input_hal">
        <param name="input_hal" type="data" format="hal" label="HAL file"/>
    </xml>
    <xml name="input_mapping">
        <param name="input_mapping" type="data" format="txt,tsv" label="File for renaming" help="Tab-separated file. First column: existing name, second column: new name. Any names not provided will stay the same"/>
    </xml> 
    <xml name="hal_backend_format">
        <conditional name="backend">
            <param name="format" type="select" label="Back-end storage format for new HAL file" help="Select the back-end storage format for the new HAL file (--format)">
                <option value="hdf5" selected="true">HDF5</option>
                <!-- 
                At the moment, creating a HAL file in mmap format is disabled due to Galaxyâ€™s current memory limits. The creation in HDF5 format is enforced.
                <option value="mmap">mmap</option> 
                -->
            </param>
            <when value="hdf5"/>
            <!-- 
            <when value="mmap">
                <param argument="- -mmapFileSize" type="integer" label="Initial file size" value="64" min="1" help="Initial mmap HAL file size in gigabytes"/>
            </when>
            -->
        </conditional>
    </xml>
    <xml name="params_mmap_size">
        <param argument="--mmapFileSize" type="integer" label="Initial file size" value="64" min="1" help="Initial mmap HAL file size in gigabytes"/>
    </xml>
    <xml name="params_start">
        <param argument="--start" type="integer" value="0" optional="true" label="Start coordinate" help="Coordinate within reference genome (or reference sequence if set) to start at"/>
    </xml>    
    <xml name="params_length">
        <param argument="--length" type="integer" min="0" value="0" optional="true" label="Length to process" help="Length of the reference genome (or reference sequence if set) to process. If set to 0, the entire thing is processed"/>
    </xml>  
    <xml name="params_onlySequenceNames">
        <param argument="--onlySequenceNames" type="boolean" truevalue="--onlySequenceNames" falsevalue="" checked="false" label="Only sequence names" help="Use only sequence names for output names. By default, the UCSC convention of Genome.Sequence is used"/>
    </xml>
    <xml name="params_root_optional">
        <param argument="--root" type="text" value="" optional="true" label="Root genome" help="Process only genomes belonging to the subtree rooted at the root genome">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
    </xml>
    <xml name="params_refGenome">
        <param name="refGenome" type="text" value="" label="Reference genome" help="Reference genome to process">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
    </xml>
    <xml name="params_genomeNoRoot">
        <param name="genome" type="text" value="" label="Genome name" help="Name of genome to process (can't be root)">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
    </xml>
    <xml name="params_rootGenome">
        <param name="rootGenome" type="text" value="" label="Root genome" help="Process only genomes belonging to the subtree rooted at the root genome">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
    </xml>
    <xml name="params_rootGenome_optional">
        <param argument="--rootGenome" type="text" value="" optional="true" label="Root genome" help="Process only genomes belonging to the subtree rooted at the root genome">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
    </xml>
    <xml name="params_targetGenomes">
        <param name="targetGenomes" type="text" value="" label="Target genomes" help="Comma-separated (no spaces) list of target genomes (others are excluded)">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_comma_list"/>
        </param>
    </xml> 
    <xml name="params_targetGenomes_optional">
        <param argument="--targetGenomes" type="text" value="" optional="true" label="Target genomes" help="Comma-separated (no spaces) list of target genomes (others are excluded) (vist all if empty)">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_comma_list"/>
        </param>
    </xml> 
    <xml name="params_sequence">
        <param name="sequence" type="text" value="" label="Reference sequence" help="Reference sequence in reference genome to process">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
    </xml>
    <xml name="params_srcGenome">
        <param name="srcGenome" type="text" label="Source genome" help="Source genome present in both input files from which coordinates should be mapped from">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
    </xml> 
    <xml name="params_tgtGenome">
        <param name="tgtGenome" type="text" label="Target genome" help="Target genome present in HAL file to which coordinates should be mapped to">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param>
    </xml> 
    <xml name="params_conditional_refGenome">
        <conditional name="genome">
            <param name="reference" type="select" label="Reference genome" help="Select the genome to use as reference">
                <option value="" selected="true">Use HAL tree root (default)</option>
                <option value="custom">Specific reference genome (--refGenome)</option>
            </param>
            <when value=""/>
            <when value="custom">
                <param name="refGenome" type="text" value="" label="Reference genome">
                    <expand macro="sanitizer_default"/>
                    <expand macro="validator_trim"/>
                </param>      
                <param argument="--noAncestors" type="boolean" truevalue="--noAncestors" falsevalue="" checked="false" label="Exclude ancestors" help="Should only be enabled when the chosen reference genome is a non-ancestral genome"/>
            </when>
        </conditional>
    </xml> 
    <xml name="params_numSamples">
        <param argument="--numSamples" type="integer" min="1" value="1000000" label="Number of bases" help="Number of bases to sample for calculation"/>
    </xml>
    <xml name="params_seed">
        <param argument="--seed" type="integer" value="0" label="Random seed" help="Set a seed for reproducibility"/>
    </xml>
    <xml name="params_maxGap">
        <param argument="--maxGap" type="integer" min="0" value="20" label="Max gap" help="Maximum indel length to be considered a gap. Gaps can be nested within other rearrangements"/>
    </xml>
    <xml name="params_maxNFraction">
        <param argument="--maxNFraction" type="float" min="0" value="1" label="Maximum fraction of Ns" help="Maximum fraction of Ns in a rearranged segment for it to not be ignored as missing data"/>
    </xml> 
    <xml name="params_noDupes">
        <param argument="--noDupes" type="boolean" truevalue="--noDupes" falsevalue="" checked="false" label="No duplicates" help="Do not map between duplications in graph"/>
    </xml>
    <xml name="params_noMarkAncestors">
        <param argument="--noMarkAncestors" type="boolean" truevalue="--noMarkAncestors" falsevalue="" checked="false" label="Don't mark ancestors" help="Don't mark ancestors for update"/>
    </xml>
    <xml name="sanitizer_default">
        <sanitizer invalid_char="">                
            <valid initial="string.ascii_letters,string.digits,string.punctuation">
                <add value=" "/>
            </valid>
        </sanitizer>
    </xml>
    <xml name="validator_trim">
        <validator type="regex" message="Enter without leading or trailing spaces">^\S(?:.*\S)?$</validator>   
    </xml>
    <xml name="validator_comma_list">
        <validator type="regex" message="Enter a comma separated list of genomes, without leading or trailing spaces">^\S(?:[^,]*\S)?(?:,\S(?:[^,]*\S)?)*$</validator>
    </xml>
    <xml name="validator_newick">
        <validator type="regex" message="Enter a Newick tree">^.*;$</validator>  
    </xml>
    <xml name="creator">
        <creator>
            <person givenName="Niklas" familyName="Mayle" url="https://github.com/Maed0x"/>
            <person givenName="Saim" familyName="Momin" url="https://github.com/SaimMomin12"/>
            <organization name="Galaxy Europe" url="https://galaxyproject.org/eu/"/>
        </creator>
    </xml>
    <xml name="citation">
        <citations>
            <citation type="doi">10.1093/bioinformatics/btt128</citation>
        </citations>
    </xml>
</macros>
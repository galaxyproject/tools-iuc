<tool id="hal_halBranchMutations" name="halBranchMutations" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>identifies mutations on a branch between given genome and its parent</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <expand macro="stdio"/>
    <command detect_errors="aggressive"><![CDATA[
        halBranchMutations
            #if $inputFormat == "mmap":
                --format 'mmap'
            #end if
            #if $support.file:
                --refTargets '$support.refTargets'
            #end if
            #if $mode.export == "sequence":
                --refSequence '$sequence'
            #end if
            --start $start
            --length $length
            --maxGap $maxGap
            --maxNFraction $maxNFraction
            --refFile stdout
            --snpFile stdout
            --delBreakFile stdout
            --parentFile '$output_parentFile'
            '$input_hal' '$refGenome' > '$output_file'
    ]]></command>
    <inputs>
        <expand macro="input_hal"/>
        <expand macro="hal_backend_format"/>
        <param name="refGenome" type="text" value="" label="Reference genome" help="To be analyzed branch and its according parent. Must denote bottom node in a branch, and therefore cannot be the root itself">
            <expand macro="sanitizer_default"/>
            <expand macro="validator_trim"/>
        </param> 
        <conditional name="support">
            <param name="file" type="boolean" checked="false" label="Use a BED file for coordinates" help="Use a BED file to define the reference genome intervals to analyze (--refTargets)"/>
            <when value="false"/>
            <when value="true">
                 <param name="refTargets" type="data" format="bed" optional="true" label="BED file"/>
            </when>
        </conditional>
        <conditional name="mode">
            <param name="export" type="select" label="Reference sequence">
                <option value="default" selected="true">Process all sequences (default)</option>
                <option value="sequence">Process a specific sequence (--sequence)</option>
            </param>
            <when value="default"/>
            <when value="sequence">
                <param name="sequence" type="text" value="" label="Sequence name" help="Sequence name in reference genome to process">
                    <expand macro="sanitizer_default"/>
                    <expand macro="validator_trim"/>
                </param>
            </when>
        </conditional>
        <param argument="--start" type="integer" min="0" value="0" optional="true" label="Start coordinate" help="Coordinate within reference genome (or reference sequence) to start at"/>
        <param argument="--length" type="integer" min="0" value="0" optional="true" label="Length to process" help="Length of the reference genome (or reference sequence) to process. If set to 0, the entire thing is converted"/>
        <param argument="--maxGap" type="integer" min="0" value="20" label="Max gap" help="Maximum indel length to be considered a gap. Gaps can be nested within other rearrangements"/>
        <param argument="--maxNFraction" type="integer" min="1" value="1" label="Maximum fraction of Ns" help="Maximum fraction of Ns in a rearranged segment for it to not be ignored as missing data"/>
    </inputs>
    <outputs>
        <data name="output_file" format="bed" label="${tool.name} on ${on_string}"/>
        <data name="output_parentFile" format="bed" label="${tool.name} on ${on_string}: Rearrangements in reference's parent genome"/>
    </outputs>
    <tests>
        <test expect_num_outputs="2">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_1"/>
            <output name="output_file" md5="4bac7822201078a1f221766d990f04bd" ftype="bed"/>
            <output name="output_parentFile" md5="20a609908746b67c5959f2aa6f56f54d" ftype="bed"/>
        </test>
        <test expect_num_outputs="2">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_1"/>
            <param name="start" value="10"/>
            <param name="length" value="500"/>
            <output name="output_file" md5="8f5444f46928f846b90d97c5b361dc6d" ftype="bed"/>
            <output name="output_parentFile" md5="36a4c2088b2bfac02c30465a819beff8" ftype="bed"/>
        </test>
        <test expect_num_outputs="2">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_1"/>
            <conditional name="mode">
                <param name="export" value="sequence"/>
                <param name="sequence" value="Genome_1_seq"/>
            </conditional>
            <output name="output_file" md5="4bac7822201078a1f221766d990f04bd" ftype="bed"/>
            <output name="output_parentFile" md5="20a609908746b67c5959f2aa6f56f54d" ftype="bed"/>
        </test>
        <test expect_num_outputs="2">
            <param name="input_hal" value="halTest.hal"/>
            <param name="refGenome" value="Genome_1"/>
            <conditional name="support">
                <param name="file" value="true"/>
                <param name="refTargets" value="halBranchMutations.bed"/>
            </conditional>
            <output name="output_file" md5="14c86eb66e6afe56a4d08426a852d2c9" ftype="bed"/>
            <output name="output_parentFile" md5="b8356c5a5e594d383bb8825c700a1619" ftype="bed"/>
        </test>
    </tests>
    <help><![CDATA[
halBranchMutations detects mutations that occurred on the branch between a chosen genome and its parent in a HAL alignment. 
It reports point mutations, deletions, duplications, and other structural changes in an output BED file. 
    ]]></help>
    <expand macro="citation"/>
    <expand macro="creator"/>
</tool>
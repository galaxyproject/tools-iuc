<tool id='ragtag' name='RagTag' version='@TOOL_VERSION@+galaxy@SUFFIX_VERSION@' profile='20.01'>
    <description>reference-guided scaffolding of draft genomes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro='xrefs' />
    <expand macro='requirements' />
    <command detect_errors='exit_code'><![CDATA[
    ragtag.py $mode_conditional.mode_option
    #if $mode_conditional.mode_option == 'correct'
        --read-aligner 'minimap2' ## it is the only allowed
    #else if $mode_conditional.mode_option == 'scaffold'
        #if $mode_conditional.advanced_options.unplaced_conditional.unplaced_option == 'true'
            -C
            #if $mode_conditional.advanced_options.unplaced_conditional.J 
                -J '${mode_conditional.advanced_options.unplaced_conditional.J}'
            #end if
        #end if
    #end if
    -t \${GALAXY_SLOTS:-2}
     
    ]]>    </command>
    <inputs>
    <conditional name="mode_conditional">
        <param name="mode_option" type="select" label="Operation mode">
            <option value="correct">Correct: homology-based missasembly correction</option>
            <option value="scaffold">Scaffold: homology-based assebly scaffolding</option>
            <option value="patch">Patch: homology-based assembly patching</option>
            <option value="merge">Merge: scaffolding merging</option>
            <option value="asmstats">Statistics: assembly statistics</option>
        </param>
        <when value="correct">
            <expand macro="input_options"/>
            <conditional name="validation_conditional">
                <param name="validation_option" type="select" label="Use validation reads">
                    <option value="true">Enabled</option>
                    <option value="false" selected="true">Disabled</option>
                </param>
                <when value="true">
                    <param argument="-R" type="data" format="fasta, fasta.gz" optional="true" label="Validation reads" />
                    <param name="read_type" type="select" label="Read type">
                        <option value="sr">Illumina</option>
                        <option value="ont">Nanopore</option>
                        <option value="corr">Error corrected long-reads</option>
                    </param>
                    <param argument="-v" type="integer" min="0" value="10000" label="Coverage validation window size" />
                    <param argument="--max-cov" type="integer" min="0" value="" optional="true" label="Break sequences at regions at or above this coverage level"/>
                    <param argument="--min-cov" type="integer" min="0" value="" optional="true" label="Break sequences at regions at or below this coverage level"/>
                </when>
                <when value="false"/>
            </conditional>
            <section name="advanced_options" title="advanced options">
                <expand macro="mapping_macros"/>
                <expand macro="common_options"/>
                <param argument="-b" type="integer" min="0" value="5000" label="Minimum break distance from contig ends"/>
                <param name="missasembly_break" type="select" optional="true" label="Break misassebly option">
                    <option value="--inter">Only break misassemblies between reference sequences (--inter)</option>
                    <option value="--intra">Only break missasemblies within reference sequences (--intra)</option>
                </param>
                <param argument="--gff" type="data" format="gff" optional="true" label="Don't break sequences within GFF intervals"/>
            </section>

        </when>
        <when value="scaffold">
            <expand macro="input_options"/>
            <section name="advanced_options" title="advanced options">
                <expand macro="mapping_macros"/>
                <expand macro="common_options"/>
                <param argument="-i" type="float" min="0" max="1" value="0.2" label="Minimum grouping confidence score"/>
                <param argument="-a" type="float" min="0" max="1" value="0" label="Minimum location confidence score"/>
                <param argument="-s" type="float" min="0" max="1" value="0" label="Minimum orientation confidence score"/>
                <conditional name="gap_conditional">
                    <param name="gap_option" type="select" label="Infer gap sizes" help="When disabled, all gaps are 100 bp (-r)">
                        <option value="true" selected="true">Enabled</option>
                        <option value="false">Disabled</option>
                    </param>
                    <when value="true">
                        <param argument="--g" type="integer" min="0" value="100" label="Minimum infered gap size" />
                        <param argument="-m" type="integer" min="0" value="100000" label="Maximum inferred gap size"/>
                    </when>
                    <when value="false"/>
                </conditional>
                <conditional name="unplaced_conditional">
                    <param name="unplaced_option" type="select" label="Concatenate unplaced contigs and make 'chr0'">
                        <option value="true">Enabled</option>
                        <option value="false" selected="true">Disabled</option>
                    </param>
                    <when value="true">
                        <param argument="-J" type="data" format="txt" optional="true" label="List of query headers to leave unplaceds and exclude form 'chr0'"/>
                    </when>
                </conditional>
            </section>
        </when>
        <when value="patch">
            <expand macro="input_options"/>
            <section name="advanced_options" title="advanced options">
                <expand macro="mapping_macros"/>
                <expand macro="common_options"/>
                <param argument="-s" type="integer" min="0" value="50000" label="Minimum merged alignment length"/>
                <param argument="-i" type="float" min="0" max="1" value="0.05" label="Maximum merged alignment distance" help="Maximum merged alignment distance from sequence terminus as fraction of the sequence length"/>
                <param name="patching_mode" type="select" optional="true" label="Patching mode">
                    <option value="--fill-only">Only fill existing target gaps. Do not join target sequences</option>
                    <option value="--join_only">Only join and patch target sequences. DO not fill existing gaps</option>
                </param>
                <param argument="--fill" type="boolean" truevalue="--fill" falsevalue="" label="" help="TODO" />
            </section>
        </when>
        <when value="merge">
            <!-- TO DO-->
        </when>
        <when value="asmstats">
        </when>
    </conditional>
    </inputs>
    <outputs>

    </outputs>
    <tests>
 
    </tests>
    <help><![CDATA[
.. class:: infomark

**Purpose**

Hello!

----

World!
                  
    ]]>    </help>
    <expand macro="citations" />
</tool>
<macros>
    <token name="@TOOL_VERSION@">2.0.1</token>
    <token name="@VERSION_SUFFIX@">0</token>
    <xml name="xrefs">
      <xrefs>
        <xref type="bio.tools">ragtag</xref>
      </xrefs>
    </xml>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">ragtag</requirement>
        </requirements>
    </xml>
    <xml name="citations">
        <citations>
            <citation type="doi">10.1186/s13059-019-1829-6</citation>
        </citations>
    </xml>
    <xml name="mapping_macros">
        <conditional name="mapping_conditional">
            <param name="mapping_option" type="select" label="Aligner tool" help="Whole genome aligner executable">
                <option value="nucmer">Nucmer</option>
                <option value="unimap">Unimap</option>
                <option value="minimap2" selected="true">Minimap2</option>
            </param>
            <when value="nucmer">
                <param argument="--nucmer-params" type="text" value="--maxmatch -l 100 -c 500" label="Nucmer alignment params" help="Space delimted nucmer whole genome alignment parameters">
                    <sanitizer invalid_char="">
                        <valid initial="string.letters,string.digits">
                            <add value=" " />
                            <add value="-" />
                        </valid>
                    </sanitizer>
                    <validator type="regex">[a-z -]+</validator>
                </param>
            </when>
            <when value="unimap">
                <param argument="--unimap-params" type="text" value="-x asm5" label="Unimap alignment params" help="Space delimted unimap whole genome alignment parameters">
                    <sanitizer invalid_char="">
                        <valid initial="string.letters,string.digits">
                            <add value=" " />
                            <add value="-" />
                        </valid>
                    </sanitizer>
                    <validator type="regex">[a-zA-Z0-9 -]+</validator>
                </param>
            </when>
            <when value="minimap2">
                <param argument="--mm2-params" type="text" value="-x asm5" label="Minimap2 alignment params" help="Space delimted minimap2 whole genome alignment parameters">
                    <sanitizer invalid_char="">
                        <valid initial="string.letters,string.digits">
                            <add value=" " />
                            <add value="-" />
                        </valid>
                    </sanitizer>
                    <validator type="regex">[a-zA-Z0-9 -]+</validator>
                </param>
            </when>
        </conditional>
    </xml>
    <xml name="common_options">
        <param argument="-e" type="data" format="txt" optional="true" label="List of reference headers to ignore"/>
        <param argument="-j" type="data" format="txt" optional="true" label="List of query headers to leave uncorrected" />
        <param argument="-f" type="integer" min="0" value="1000" label="Minimum unique single length"/>
        <param argument="--remove-small" type="boolean" truevalue="--remove-small" falsevalue="" checked="false" label="Remove unique alignments" help="Remove unique alignments shorter than the minimum unique alignment length" />
        <param argument="-q" type="integer" min="0" value="10" label="Minimum mappping quality" help="Mapping quality scores quantify the probability that a read is misplaced" />
        <param argument="-d" type="integer" min="0" value="100000" label="Maximum alignment merge distance" />        
    </xml>
    <xml name="input_options">
        <param name="reference" type="data" format="fasta,fasta.bgzip" label="Reference FASTA file"/>
        <param name="query" type="data" format="fasta,fasta.bgzip" label="Query FASTA file" />
    </xml>
    <token name="@INPUTS@"><![CDATA[
        $mode_conditional.reference
        $mode_conditional.query
    ]]></token>
    <token name="@MAPPING_OPTION@"><![CDATA[
        --aligner $mode_conditional.advanced_options.mapping_conditional.mapping_option 
            #if $mode_conditional.advanced_options.mapping_conditional.mapping_option == 'nucmer'
                --nucmer-params '${mode_conditional.advanced_options.nucmer_params}'
            #else if $mode_conditional.advanced_options.mapping_conditional.mapping_option == 'unimap'
                --unimap-params '${mode_conditional.advanced_options.unimap_params}'
            #else
                --mm2-params '${mode_conditional.advanced_options.mapping_conditional.mm2_params}'
            #end if
    ]]></token>
    <token name="@COMMON_OPTIONS@"><![CDATA[
        #if $mode_conditional.advanced_options.e 
            -e '${mode_conditional.advanced_options.e}'
        #end if
        #if $mode_conditional.advanced_options.j
            -j '${mode_conditional.advanced_options.j}'
        #end if 
        -f $mode_conditional.advanced_options.f 
        --remove-small $mode_conditional.advanced_options.remove_small 
        -q $mode_conditional.advanced_options.q
        -d $mode_conditional.advanced_options.d
    ]]></token>
    <token name="@MAPPING_OPTION@"><![CDATA[

    ]]></token>

</macros>

<tool id="vg_view" name="vg view" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Inspect and convert variant graphs in different file formats</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
vg view
$input_format.input_format_selector
'$input_format.infile'
$output_format
--threads=\${GALAXY_SLOTS:-1}
> '$output'
    ]]></command>
    <inputs>
        <conditional name="input_format">
            <param name="input_format_selector" type="select" label="Your input is in format">
                <option value="--gfa-in">GFA</option>
                <option value="--vg-in">Variant Graph (vg)</option>
                <option value="--json-in">JSON</option>
                <option value="--translation-in">Translation Graph</option>
                <option value="--turtle-in">Turtle</option>
                <option value="--align-in">GAM format</option>
                <option value="--locus-in">Locus</option>
                <option value="--bam">BAM</option>
                <option value="--fastq-in">FASTQ</option>
                <option value="--pileup-in">VG Pileup format</option>
                <option value="--distance-in">Distance Index</option>
                <option value="--snarl-in">Snarl</option>
                <option value="--multipath-in">MultipathAlignment format</option>
            </param>
            <when value="--gfa-in">
                <param name="infile" type="data" format="gfa1" label="Input file in Graphical Fragment Assembly (gfa)"/>
            </when>
            <when value="--vg-in">
                <param name="infile" type="data" format="vg" label="Input file in variant graph format (vg)"/>
            </when>
            <when value="--json-in">
                <param name="infile" type="data" format="json" label="Input file in JSON"/>
            </when>
            <when value="--translation-in">
                <param name="infile" type="data" format="vg" label="Input file in Translation Graph format"/>
            </when>
            <when value="--turtle-in">
                <param name="infile" type="data" format="ttl" label="Input file in Turtle format"/>
            </when>
            <when value="--align-in">
                <param name="infile" type="data" format="gam" label="Input file in GAM format"/>
            </when>
            <when value="--locus-in">
                <param name="infile" type="data" format="vg.loci" label="Input file in Locus format"/>
            </when>
            <when value="--bam">
                <param name="infile" type="data" format="bam" label="Input file in BAM format"/>
            </when>
            <when value="--fastq-in">
                <param name="infile" type="data" format="fastqsanger" label="Input file in FASTQ format"/>
            </when>
            <when value="--pileup-in">
                <param name="infile" type="data" format="pileup" label="Input file in Pileup format"/>
            </when>
            <when value="--distance-in">
                <param name="infile" type="data" format="vg.dist" label="Input file in Distance Index format"/>
            </when>
            <when value="--snarl-in">
                <param name="infile" type="data" format="vg.snarls" label="Input file in Snarl format"/>
            </when>
            <when value="--multipath-in">
                <param name="infile" type="data" format="vg.gamp" label="Input file in MultipathAlignment format"/>
            </when>
        </conditional>

        <param name="output_format" type="select" label="Choose your output format">
            <option value="--gfa" selected="true">GFA</option>
            <option value="--vg">Variant Graph (vg)</option>
            <option value="--json">JSON</option>
            <option value="--gam">GAM</option>
            <option value="--turtle">RDF/Turtle</option>
            <option value="--locus-out">Locus</option>
            <option value="--dot">dot</option>
            <option value="--fastq-out">FASTQ</option>
            <option value="--pileup">Pileup</option>
            <option value="--multipath">MultipathAlignment</option>
        </param>

    </inputs>
    <outputs>
        <data name="output" format="vg">
            <change_format>
                <when input="output_format" value="--gfa" format="gfa1"/>
                <when input="output_format" value="--dot" format="graph_dot"/>
                <when input="output_format" value="--json" format="json"/>
                <when input="output_format" value="--gam" format="gam"/>
                <when input="output_format" value="--turtle" format="ttl"/>
                <when input="output_format" value="--locus-out" format="vg.loci"/>
                <when input="output_format" value="--fastq-out" format="fastqsanger"/>
                <when input="output_format" value="--pileup" format="pileup"/>
                <when input="output_format" value="--multipath" format="vg.gamp"/>
            </change_format>
        </data>
    </outputs>
    <tests>
        <!-- Test 1: Testing GFA input VG output-->
        <test expect_num_outputs="1">
            <conditional name="input_format">
                <param name="input_format_selector" value="--gfa-in"/>
                <param name="infile" value="x.gfa" ftype="gfa1"/>
            </conditional>
            <param name="output_format" value="--vg"/>
            <output name="output" file="x.vg" ftype="vg"/>
        </test>
        
        <!-- Test 2: Testing VG input JSON output-->
        <test expect_num_outputs="1">
            <conditional name="input_format">
                <param name="input_format_selector" value="--vg-in"/>
                <param name="infile" value="x.vg" ftype="vg"/>
            </conditional>
            <param name="output_format" value="--json"/>
            <output name="output" file="x.json" ftype="json"/>
        </test>

        <!-- Test 3: Testing JSON input VG output-->
        <test expect_num_outputs="1">
            <conditional name="input_format">
                <param name="input_format_selector" value="--json-in"/>
                <param name="infile" value="x.json" ftype="json"/>
            </conditional>
            <param name="output_format" value="--vg"/>
            <output name="output" file="x.vg" ftype="vg"/>
        </test>

        <!-- Test 4: Testing VG input GFA output -->
        <test expect_num_outputs="1">
            <conditional name="input_format">
                <param name="input_format_selector" value="--vg-in"/>
                <param name="infile" value="x.vg" ftype="vg"/>
            </conditional>
            <param name="output_format" value="--gfa"/>
            <output name="output" file="x_out.gfa" ftype="gfa1"/>
        </test>

        <!-- Test 5: Testing VG input DOT output -->
        <test expect_num_outputs="1">
            <conditional name="input_format">
                <param name="input_format_selector" value="--vg-in"/>
                <param name="infile" value="x.vg" ftype="vg"/>
            </conditional>
            <param name="output_format" value="--dot"/>
            <output name="output" file="x.dot" ftype="graph_dot"/>
        </test>

        <!-- Test 6: Testing VG input Turtle/RDF output -->
        <test expect_num_outputs="1">
            <conditional name="input_format">
                <param name="input_format_selector" value="--vg-in"/>
                <param name="infile" value="x.vg" ftype="vg"/>
            </conditional>
            <param name="output_format" value="--turtle"/>
            <output name="output" file="x.ttl" ftype="ttl"/>
        </test>

        <!-- Test 7: BAM to GAM conversion -->
        <test expect_num_outputs="1">
            <conditional name="input_format">
                <param name="input_format_selector" value="--bam"/>
                <param name="infile" value="input.bam" ftype="bam"/>
            </conditional>
        <param name="output_format" value="--gam"/>
        <output name="output" file="aln_from_bam.gam" ftype="gam"/>
        </test>

        <!-- Test 8: FASTQ to GAM-->
        <test expect_num_outputs="1">
            <conditional name="input_format">
                <param name="input_format_selector" value="--fastq-in"/>
                <param name="infile" value="input_1.fastq" ftype="fastqsanger"/>
            </conditional>
            <param name="output_format" value="--gam"/>
            <output name="output" file="reads.gam" ftype="gam"/>
        </test>

    </tests>
    <help><![CDATA[

variation graph (vg) view module
-----------------------------------

Inspect and convert variant graphs in different file formats.

    ]]></help>
    <expand macro="citations"/>
</tool>

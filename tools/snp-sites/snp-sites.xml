<?xml version='1.0' encoding='UTF-8'?>
<tool id='snp_sites' name='Finds SNP sites' version='@TOOL_VERSION@+galaxy0'>
   <description>from a multi-FASTA alignment file</description>	
   <macros>
      <token name="@TOOL_VERSION@">2.5.1</token>
   </macros>
   <requirements>
      <requirement type='package' version='@TOOL_VERSION@'>snp-sites</requirement>
   </requirements>
   <version_command>snp-sites -V</version_command>
   <command detect_errors='aggressive'><![CDATA[
OUTPUTS='$formats' && 
snp-sites 
#if str($C) != "-C"
   \${OUTPUTS//,/ }
#end if
$b
$c
$C
-o output 
'$input_fasta'
#if str($C) == '-C'
   && mv output $output_counts
#else if ',' in str($formats)
   #if '-m' in str($formats)
      && mv 'output.snp_sites.aln' '$output_fasta'
   #end if
   #if '-v' in str($formats)
      && mv 'output.vcf' '$output_vcf'
   #end if
   #if '-p' in str($formats)
      && mv 'output.phylip' '$output_phylip'
   #end if
#else
   #if str($formats) == '-m'
      && mv 'output' '$output_fasta'
   #else if str($formats) == '-v'
      && mv 'output' '$output_vcf'
   #else if str($formats) == '-p'
      && mv 'phylip' '$output_phylip'
   #end if
#end if
]]></command>
   <inputs>
        <param name='input_fasta' format='fasta' type='data' label='FASTA file' />
        <param type='select' multiple='true' name='formats' label='Output formats' help='Output format to use if not counting constant sites'>
         <option value="-m"  selected="true">Multi-FASTA alignment file</option>
         <option value="-v">VCF</option>
         <option value="-p">Phylip</option>
        </param>
        <param argument="-b" label="Monomorphic sites (suitable for BEAST)" truevalue="-b" falsevalue="" 
         type="boolean" help="Output monomorphic (constant) as opposed to polymorphic sites"/>
        <param argument="-c" label="Only output columns containing exclusively ACTG" truevalue="-c" falsevalue=""
         type="boolean" help="Ignore columns containing ambiguous characters and gaps"/>
        <param argument="-C" label="Count of constant sites (suitable for IQ-TREE -fconst)" truevalue="-C" falsevalue=""
         type="boolean" help="Change the output to constant site counts, can't be combined with other outputs" />
   </inputs>
   <outputs>
      <data name='output_fasta' format='fasta' label='${tool.name} on ${on_string}: FASTA'>
         <filter>formats is not None and '-m' in formats and C is False</filter>
      </data>
      <data name='output_vcf' format='vcf' label='${tool.name} on ${on_string}: VCF' from_work_dir='output.vcf'>
         <filter>formats is not None and '-v' in formats and C is False</filter>
      </data>
      <data name='output_phylip' format='phylip' label='${tool.name} on ${on_string}: phylip'>
         <filter>formats is not None and '-p' in formats and C is False</filter>
      </data>
      <data name='output_counts' format='tabular' label='${tool.name} on ${on_string}: constant site counts'>
         <filter>C is True</filter>
      </data>
   </outputs>
   <tests>
      <test>
         <param name='input_fasta' value='input.fasta' ftype='fasta' />
         <param name='formats' value='-m,-p,-v' />
         <output name='output_fasta' value='output.fasta' ftype='fasta' />
         <output name='output_vcf' value='output.vcf' ftype='vcf' />
         <output name='output_phylip' value='output.phylip' ftype='phylip' />
      </test>
      <test>
         <param name='input_fasta' value='input.fasta' ftype='fasta' />
         <param name='formats' value='-m' />
         <param name='b' value='True' />
         <output name='output_fasta' value='output_monomorphic.fasta' ftype='fasta' />
      </test>
      <test>
         <param name='input_fasta' value='input.fasta' ftype='fasta' />
         <param name='formats' value='-m' />
         <param name='c' value='True' />
         <output name='output_fasta' value='output_actg.fasta' ftype='fasta' />
      </test>
      <test>
         <param name='input_fasta' value='input.fasta' ftype='fasta' />
         <param name='formats' value='-m' />
         <param name='b' value='True' />
         <param name="c" value="True" />
         <output name='output_fasta' value='output_monomorphic_actg.fasta' ftype='fasta' />
      </test>
      <test>
         <param name='input_fasta' value='input.fasta' ftype='fasta' />
         <param name='formats' value='' />
         <param name='C' value='True' />
         <output name='output_counts' value='output_counts.tabular' ftype='tabular' />
      </test>
   </tests>
   <help>
   <![CDATA[
   
**SNP-sites**

This tool can rapidly extract SNPs from a multi-FASTA alignment using modest resources and can output results in multiple formats for downstream analysis. SNPs can be extracted from a 8.3 GB alignment file (1,842 taxa, 22,618 sites) in 267 seconds using 59 MB of RAM and 1 CPU core, making it feasible to run on modest computers. 
SNP-sites is implemented in C and is available under the open source license GNU GPL version 3.

Alternatively it can report on the number of constant sites in an alignment in a format (A count, C count, G count, T count) suitable for passing
to IQ-TREE's `-fconst` option.

**Input FASTA format:**

The first sequence will be taken as a reference.

.. code-block::

  >sample1
  AGACACAGTCAC

  >sample1
  AGACAC----AC

  >sample1
  AAACGCATTCAN

**Options** 

In addition to the default output mode, this tool supports three other options:

1. Output only monomorphic (i.e. not polymorphic) sites (useful for input to BEAST)

2. Output only columns that have purely ACTGs in them (i.e. no gaps or ambiguous nucleotides). This can be used together with the previous option. 

3. Output only a count of constant sites, in a format suitable for use with IQ-TREE `-fconst`. This option cannot be used together with the previously mentioned options.

**Output files:**

The output of the tool are three different files in following format:

- a multi fasta alignment,
- relaxed phylip format and,
- VCF.
- alternatively constant site counts (As, Cs, Gs and Ts).

The VCF file for the above specified input is

The output of the tool are three different files in following format:

- a multi fasta alignment,
- relaxed phylip format and,
- VCF.

The VCF file for the above specified input is

=====   === ==  === ===    ====    ======  ====    ======  ======= ======= =======
CHROM   POS ID  REF ALT    QUAL    FILTER  INFO    FORMAT  sample1 sample1 sample1
-----   --- --  --- ---    ----    ------  ----    ------  ------- ------- -------
1       2   .   G   A      .       .       .       GT      0       0       1
-----   --- --  --- ---    ----    ------  ----    ------  ------- ------- -------
1       5   .   A   G      .       .       .       GT      0       0       1
-----   --- --  --- ---    ----    ------  ----    ------  ------- ------- -------
1       8   .   G   .,T    .       .       .       GT      0       1       2
=====   === ==  === ===    ====    ======  ====    ======  ======= ======= =======

Thus the tool identified three variations (SNPs): in 2nd, 5th, and 8th positions (A instead of G, G instead of A, and unknown nucleotide or T instead of G, respectively).


	]]>
    </help>
	<citations>
        <citation type="doi">10.1099/mgen.0.000056</citation>
    </citations>
</tool>

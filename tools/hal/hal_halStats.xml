<tool id="hal_halstats" name="HAL halStats" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="25.0">
    <!-- 
        TODO
            âˆš Test passed
            - Keep conditional of type select for parameters? 
                - If ok, is it okey if booleans default is false?
                - If ok, is it okey if all text values are optional?
            - Some parameters (e.g. genomeMetaData) may need an area to enter text
            - Add <validator type="regex" >^[^,]+,[0-9]+$</validator> for baseComp?
            - If exit code is != 0, does the error still get printed into output.txt?

    -->

    <description>retrieves basic statistics from a hal file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/> 
    <command detect_errors="aggressive"><![CDATA[
        halStats 
            #if $inputFormat.type == "mmap":
            --format 'mmap'
            #end if
            #if $mode.option == "--allCoverage"
                $mode.allCoverage
            #else if $mode.option == "--branches"
                $mode.branches
            #else if $mode.option == "--genomes"
                $mode.genomes
            #else if $mode.option == "--metaData"
                $mode.metaData
            #else if $mode.option == "--root"
                $mode.root
            #else if $mode.option == "--tree"
                $mode.tree
            #else if $mode.option != ""
                $mode.option 
                    '$mode.baseComp'
                    '$mode.bedSequences'
                    '$mode.bottomSegments'
                    '$mode.branchLength'
                    '$mode.children'
                    '$mode.chromSizes'
                    '$mode.coverage'
                    '$mode.genomeMetaData'
                    '$mode.numSegments'
                    '$mode.parent'
                    '$mode.percentID'
                    '$mode.sequenceStats'
                    '$mode.sequences'
                    '$mode.span'
                    '$mode.spanRoot'
                    '$mode.topSegments'
            #end if
            '$in_hal_file' > '$out_file'
    ]]></command>
    <inputs>
        <expand macro="in_hal_file"/>
        <expand macro="params_format"/>
        <conditional name="mode">
            <param name="option" type="select" label="Select a print option" refresh_on_change="true"
                help="Select a print option from the drop down to display its description and to enable it accordingly">
                <option value="" selected="true">None</option>
                <option value="--allCoverage">All Coverage (--allCoverage)</option>
                <option value="--branches">List of branches (--branches)</option>
                <option value="--sequences">List of sequences (--sequences)</option>
                <option value="--genomes">List of genomes (--genomes)</option>
                <option value="--baseComp">Base composition (--baseComp)</option>
                <option value="--bedSequences">Bed sequences (--bedSequences)</option>
                <option value="--sequenceStats">Stats for each sequence (--sequenceStats)</option>
                <option value="--topSegments">Top segments (--topSegments)</option>
                <option value="--bottomSegments">Bottom segments (--bottomSegments)</option>
                <option value="--numSegments">Number of segments (--numSegments)</option>
                <option value="--branchLength">Branch length (--branchLength)</option>
                <option value="--parent">Parent name (--parent)</option>
                <option value="--root">Root genome name (--root)</option>
                <option value="--children">Names of children (--children)</option>
                <option value="--chromSizes">Chrom sizes (--chromSizes)</option>
                <option value="--coverage">Histogram of coverage (--coverage)</option>
                <option value="--metaData">Metadata for alignment (--metaData)</option>
                <option value="--genomeMetaData">Metadata for given genome (--genomeMetaData)</option>
                <option value="--percentID">Percent ID (--percentID)</option>
                <option value="--span">Span (--span)</option>
                <option value="--spanRoot">Span root (--spanRoot)</option>
                <option value="--tree">NEWICK tree (--tree)</option>
            </param>
            <when value="">
            </when>
            <when value="--allCoverage">
                <param argument="--allCoverage" type="boolean" truevalue="--allCoverage" falsevalue="" checked="false" 
                    label="All Coverage" 
                    help="Print histogram of coverage from all genomes to all genomes" />
            </when>
            <when value="--baseComp">
                <param argument="--baseComp" type="text" value="" 
                    label="Base composition" 
                    help="Print base composition for given genome by sampling every step bases. Parameter value is of the form genome,step. Ex: human,1000. The output is of the form fraction_of_As fraction_of_Gs fraction_of_Cs  fraction_of_Ts" />
            </when>
            <when value="--bedSequences">
                <param argument="--bedSequences" type="text" value="" 
                    label="Bed sequences" 
                    help="Print sequences of given genome in bed format" />
            </when>
            <when value="--topSegments">
                <param argument="--topSegments" type="text" value="" 
                    label="Top segments" 
                    help="Print coordinates of all top segments of given genome in BED format" />
            </when>
            <when value="--bottomSegments">
                <param argument="--bottomSegments" type="text" value="" 
                    label="Bottom segments" 
                    help="Print coordinates of all bottom segments of given genome in BED format" />
            </when>
            <when value="--branchLength">
                <param argument="--branchLength" type="text" value="" 
                    label="Branch length" 
                    help="Print branch length between given genome and its parent in the tree" />
            </when>
            <when value="--branches">
                <param argument="--branches" type="boolean" truevalue="--branches" falsevalue="" checked="false" 
                    label="List of branches" 
                    help="Print list of branches. Each branch is specified by the child genome" />
            </when>
            <when value="--children">
                <param argument="--children" type="text" value="" 
                    label="Names of children" 
                    help="Print names of children of given genome" />
            </when>
            <when value="--chromSizes">
                <param argument="--chromSizes" type="text" value=""  
                    label="Chrom sizes" 
                    help="Print the name and length of each sequence in a given genome. This is a subset of the information returned by --sequenceStats but is useful because it is in the format used by wigToBigWig" />
            </when>
            <when value="--coverage">
                <param argument="--coverage" type="text" value="" 
                    label="Histogram of coverage" 
                    help="Print histogram of coverage of a genome with all genomes" />
            </when>
            <when value="--genomeMetaData">
                <param argument="--genomeMetaData" type="text" value="" 
                    label="Metadata for given genome" 
                    help="Print metadata for given genome, one entry per line, tab-seperated" />
            </when>
            <when value="--genomes">
                <param argument="--genomes" type="boolean" truevalue="--genomes" falsevalue="" checked="false" 
                    label="List of genomes" 
                    help="Print only a list of genomes in alignment" />
            </when>
            <when value="--metaData">
                <param argument="--metaData" type="boolean" truevalue="--metaData" falsevalue="" checked="false" 
                    label="Metadata for alignment" 
                    help="Print metadata for the entire alignment" />
            </when>
            <when value="--numSegments">
                <param argument="--numSegments" type="text" value="" 
                    label="Number of segments" 
                    help="Print numTopSegments numBottomSegments for given genome" />
            </when>
            <when value="--parent">
                <param argument="--parent" type="text" value="" 
                    label="Parent name" 
                    help="Print name of parent of given genome" />
            </when>
            <when value="--percentID">
                <param argument="--percentID" type="text" value="" 
                    label="Percent ID" 
                    help="Print % ID of a genome with all other genomes. Only non-duplicated and unambiguous sites areconsidered" />
            </when>
            <when value="--root">
                <param argument="--root" type="boolean" truevalue="--root" falsevalue="" checked="false" 
                    label="Root genome name" 
                    help="Print root genome name" />
            </when>
            <when value="--sequenceStats">
                <param argument="--sequenceStats" type="text" value="" 
                    label="Stats for each sequence" 
                    help="Print stats for each sequence in given genome" />
            </when>
            <when value="--sequences">
                <param argument="--sequences" type="text" value="" 
                    label="List of sequence" 
                    help="Print list of sequences in given genome" />
            </when>
            <when value="--span">
                <param argument="--span" type="text" value="" 
                    label="Span" 
                    help="Print branches on path (or spanning tree) between comma separated list of genomes" />
            </when>
            <when value="--spanRoot">
                <param argument="--spanRoot" type="text" value="" 
                    label="Span root" 
                    help="Print genomes on path (or spanning tree) between comma separated list of genomes.  Different from --spanonly in that the spanning tree root is also given" />
            </when>
            <when value="--tree">
                <param argument="--tree" type="boolean" truevalue="--tree" falsevalue="" checked="false" 
                    label="NEWICK tree" 
                    help="Print only the NEWICK tree" />
            </when>
        </conditional>
    </inputs>

    <outputs>
        <data name="out_file" format="txt" />
    </outputs>

    <tests>
        <test>
            <param name="in_hal_file" value="halTest.hal"/>
            <output name="out_file" file="halStats_output.txt"/>
        </test>
        <test>
            <param name="in_hal_file" value="halTest.hal"/>
            <param name="option" value="--allCoverage" />
            <param name="allCoverage" value="True" />
            <output name="out_file" file="halStats_allCoverage_output.txt"/>
        </test>
    </tests>
    <help><![CDATA[
Some global information from a HAL file can be quickly obtained using halStats. It will return the number of genomes, their phylogenetic tree, and the size of each array in each genome.

**USAGE:**
    halStats [Options] <halFile>

The --tree, --sequences, and --genomes options can be used to print out only specific information to simplify iterating over the alignment in shell or Python scripts.
    ]]></help>
    <expand macro="citation" />
</tool>
<tool profile="20.05" id="mothur_sens_spec" name="Sens.spec" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@">
    <description>Determine the quality of OTU assignment</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    <expand macro="version_command"/>
    <command><![CDATA[
@SHELL_OPTIONS@

## create symlinks to input datasets
ln -s '$otu' otu.dat &&
ln -s '$matrix.dist' matrix.dist.dat &&
#if str($matrix.format) == "column":
    #if str($matrix.method_name.method) == "count" :
            ln -s '$matrix.method_name.count' matrix.method_name.count.dat &&
    #else
        ln -s '$matrix.method_name.names' matrix.method_name.names.dat &&
    #end if
#end if
echo 'sens.spec(
    list=otu.dat,
    #if str($matrix.format) == "phylip":
        phylip=matrix.dist.dat,
    #else
        column=matrix.dist.dat,
        #if str($matrix.method_name.method) == "count" :
            count=matrix.method_name.count.dat,
        #else
            names=matrix.method_name.names.dat,
        #end if
    #end if
    #if $label:
        label=${ str($label).replace(",","-") },
    #end if
    #if $label:
        label=${ str($label).replace(",","-") },
    #end if
    precision=$precision,
    cutoff=$cutoff
)'
| sed 's/ //g'  ## mothur trips over whitespace
| mothur
| tee mothur.out.log
    ]]></command>
    <inputs>
    <param name="otu" type="data" format="mothur.list" label="list - OTU List"/>
	<conditional name="matrix">
                <param name="format" type="select" label="Select a Distance Matrix Format" help="">
                        <option value="column">Pairwise Column Matrix </option>
                        <option value="phylip">Phylip Distance Matrix</option>
                </param>
                <when value="column">
                        <param name="dist" type="data" format="mothur.pair.dist" label="column - Distance Matrix"/>
                        <conditional name="method_name">
                                <param name="method" type="select" label="Select a Method" help="">
                                        <option value="count">count file associated with your distance matrix.</option>
                                        <option value="name">name file associated with your distance matrix. </option>
                                </param>
                                <when value="count">
                                        <param name="count" type="data" format="mothur.count_table" label="count - a count_table" help="generated by count.seqs"/>
                                </when>
                                <when value="name">
                                        <param name="names" type="data" format="mothur.names" label="name - Sequences Name reference"/>
                                </when>
                        </conditional>
                </when>
                <when value="phylip">
                        <param name="dist" type="data" format="mothur.dist,mothur.lower.dist,mothur.square.dist" label="phylip - Distance Matrix"/>
                </when>
         </conditional>
        <param name="label" type="select" optional="true" label="label - Select OTU Labels to include" multiple="true" help="By default all are included if no selection is made.">
            <options>
                <filter type="data_meta" ref="otu" key="labels"/>
            </options>
        </param>
        <param name="precision" type="integer" value="100" min="0" optional="true" label="precision - Precision for rounding distance values"/>
        <param name="cutoff" type="float" value="-1" label="cutoff - Distance Cutoff threshold - ignored if not > 0" help="Ignore pairwise distances larger than this, a common value would be 0.10"/>
        <expand macro="param-savelog"/>
    </inputs>
    <outputs>
        <expand macro="logfile-output"/>
        <data name="sensspec" format="tabular" from_work_dir="otu*.sensspec" label="${tool.name} on ${on_string}: sensspec"/>
    </outputs>
    <tests> 
        <test>
            <param name="otu" value="amazon.an.list" ftype="mothur.list"/>
            <param name="dist" value="96_lt_column_amazon.dist" ftype="mothur.dist"/>
	        <param name="count" value="amazon.count_table"/>
            <output name="sensspec" file="test01_sens.spec.tab" ftype="tabular"/>
            <param name="savelog" value="true"/>
            <expand macro="logfile-test"/>
        </test>
        <test>
            <param name="otu" value="amazon.an.list" ftype="mothur.list"/>
            <conditional name="matrix">
                <param name="format" value="phylip"/>
                <param name="dist" value="98_lt_phylip_amazon.dist" ftype="mothur.dist"/>
            </conditional>
            <param name="cutoff" value="0.10"/>
            <param name="label" value="0.03,0.05,0.22"/>
            <output name="sensspec" file="test02_sens.spec.tab" ftype="tabular"/>
            <param name="savelog" value="true"/>
            <expand macro="logfile-test"/>
        </test>
    </tests>
    <help><![CDATA[

@MOTHUR_OVERVIEW@

**Command Documentation**

The sens.spec_ command takes a list_ and either a column_  or phylip_ distance matrix to determine the quality of OTU assignment.


.. _list: https://www.mothur.org/wiki/List_file
.. _column: https://www.mothur.org/wiki/Column-formatted_distance_matrix
.. _phylip: https://www.mothur.org/wiki/Phylip-formatted_distance_matrix
.. _sens.spec: https://www.mothur.org/wiki/Sens.spec

    ]]></help>
    <expand macro="citations">
        <citation type="doi">10.1128/AEM.02810-10</citation>
    </expand>
</tool>

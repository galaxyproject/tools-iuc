<tool profile="16.07" id="mothur_phylo_diversity" name="Phylo.diversity" version="@WRAPPER_VERSION@.0">
    <description>Alpha Diversity calculates unique branch length</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    <expand macro="version_command"/>
    <command><![CDATA[
@SHELL_OPTIONS@

## create symlinks to input datasets
ln -s '$tree' tree.dat &&
ln -s '$name' name.dat &&
ln -s '$count' count.dat &&
#if $grouping.use == "yes":
    ln -s '$grouping.group' grouping.group.dat &&
#end if

echo 'phylo.diversity(
    tree=tree.dat,
    #if $grouping.use == "yes":
        group=grouping.group.dat,
        #if $grouping.groups:
            groups=${ str($grouping.groups).replace(",","-") },
        #end if
    #end if
    #if $name:
        name=name.dat,
    #end if
    iters=$iters,
    freq=$freq,
    scale=$scale,
    collect=$collect,
    rarefy=$rarefy,
    summary=$summary,
    #if $count:
        count=count.dat,
    #end if
    processors='\${GALAXY_SLOTS:-8}'
)'
| sed 's/ //g'  ## mothur trips over whitespace
| mothur
| tee mothur.out.log
    ]]></command>
    <inputs>
        <param name="tree" type="data" format="mothur.tre" label="tree - Phylogenetic Tree"/>
        <conditional name="grouping">
            <param name="use" type="select" label="Analyze by group using a Group file">
                <option value="no" selected="true">no</option>
                <option value="yes">yes</option>
            </param>
            <when value="yes">
                <param name="group" type="data" format="mothur.groups" label="group - Group file for the tree"/>
                <param name="groups" type="select" multiple="true" label="groups - Groups to display">
                    <help>All groups displayed if none are selected.</help>
                    <options>
                        <filter type="data_meta" ref="group" key="groups"/>
                    </options>
                </param>
            </when>
            <when value="no"/>
        </conditional>
        <param name="name" type="data" format="mothur.names" optional="true" label="name - Sequences Name reference file for the tree"/>
        <param name="iters" type="integer" value="1000" min="0" label="iters - Number of iterations to try (default 1000)"/>
        <param name="freq" type="float" value="100" min="0.0" label="freq - Reporting frequency" help="if between 0 and 100, the percentage of sequences to sample, if greater than one - report every n iterations"/>
        <param name="scale" type="boolean" truevalue="true" falsevalue="false" checked="false" label="scale - Scale output to the number of sequences sampled"/>
        <param name="rarefy" type="boolean" truevalue="true" falsevalue="false" checked="false" label="rarefy - Calculate the rarefaction data"/>
        <param name="summary" type="boolean" truevalue="true" falsevalue="false" checked="true" label="summary - Generate a summary file"/>
        <param name="collect" type="boolean" truevalue="true" falsevalue="false" checked="false" label="collect - Create a collectors curve"/>
        <param name="count" type="data" format="mothur.count_table" optional="true" label="count - a count_table" help="generated by count.seqs"/>
        <expand macro="param-savelog"/>
    </inputs>
    <outputs>
        <expand macro="logfile-output"/>
        <data name="summary_out" format="tabular" from_work_dir="tree*.phylodiv.summary" label="${tool.name} on ${on_string}: summary">
            <filter>summary</filter>
        </data>
        <data name="rarefaction_out" format="tabular" from_work_dir="tree*.phylodiv.rarefaction" label="${tool.name} on ${on_string}: rarefaction">
            <filter>rarefy</filter>
        </data>
        <data name="collectors_out" format="tabular" from_work_dir="tree*.phylodiv" label="${tool.name} on ${on_string}: collectors">
            <filter>collect</filter>
        </data>
    </outputs>
    <tests>
        <test><!-- test with tree file only -->
            <param name="tree" value="treetest.tre" ftype="mothur.tre"/>
            <param name="use" value="no"/>
            <output name="summary_out" md5="a9feb4031094b555baf62e0165dd3637" ftype="tabular"/>
            <param name="savelog" value="true"/>
            <expand macro="logfile-test"/>
        </test>
        <test><!-- test with tree file and group file and all outputs -->
            <param name="tree" value="treetest.tre" ftype="mothur.tre"/>
            <param name="use" value="yes"/>
            <param name="group" value="treetest.groups" ftype="mothur.groups"/>
            <param name="groups" value="orange,green"/>
            <param name="rarefy" value="true"/>
            <param name="collect" value="true"/>
            <output name="summary_out" md5="27375ea164ad39fb56b9606023cae504" ftype="tabular"/>
            <output name="rarefaction_out" ftype="tabular">
                <assert_contents>
                    <has_text text="numSampled"/>
                    <has_text text="orange"/>
                    <has_text text="green"/>
                </assert_contents>
            </output>
            <output name="collectors_out" ftype="tabular">
                <assert_contents>
                    <has_text text="numSampled"/>
                    <has_text text="orange"/>
                    <has_text text="green"/>
                </assert_contents>
            </output>
            <param name="savelog" value="true"/>
            <expand macro="logfile-test"/>
        </test>
    </tests>
    <help><![CDATA[

@MOTHUR_OVERVIEW@


**Command Documentation**

The phylo.diversity_ command calculates alpha diversity as the total of the unique branch length.

.. _phylo.diversity: https://www.mothur.org/wiki/Phylo.diversity

v.1.21.0: Updated to Mothur 1.33, added count parameter

    ]]></help>
    <expand macro="citations">
        <citation type="doi">10.1098/rstb.1994.0085</citation>
    </expand>
</tool>

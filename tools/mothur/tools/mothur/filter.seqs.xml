<tool profile="16.07" id="mothur_filter_seqs" name="Filter.seqs" version="@WRAPPER_VERSION@.0">
    <description>removes columns from alignments</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="aggressive"><![CDATA[
        echo 'filter.seqs(
            fasta=$fasta#for i in $inputs#-${i.fasta}#end for#,
            vertical=$vertical,
            #if $trump:
                trump=$trump,
            #end if
            soft=$soft,
            #if $hard:
                hard=$hard,
            #end if
            processors='\${GALAXY_SLOTS:-8}'
        )'
        | sed 's/ //g'  ## mothur trips over whitespace
        | mothur &&

        ## move output files to correct destination
        prefix="$fasta" &&
        mv \${prefix%.dat}*.filter "$out_filter" &&
        ## rename collection files for more transparent element naming
        mv \${prefix%.dat}.filter.fasta "${fasta.element_identifier}".filter.fasta &&
        #for i in $inputs:
            prefix="${i.fasta}" &&
            mv \${prefix%.dat}.filter.fasta ${i.fasta.element_identifier}.filter.fasta &&
        #end for
        mv mothur.*.logfile "$logfile"
    ]]></command>
    <inputs>
        <param name="fasta" type="data" format="mothur.align" label="fasta - Alignment Fasta"/>
        <repeat name="inputs" title="Additional Alignment File" optional="true">
            <param name="fasta" type="data" format="mothur.align" label="fasta - Alignment Fasta"/>
        </repeat>
        <param name="vertical" type="boolean" checked="true" truevalue="true" falsevalue="false" label="vertical - Vertical column" help="Ignore any column that only contains gap characters (i.e. '-' or '.')"/>
        <param name="trump" type="select" label="trump - Trump character" help="Remove a column if the trump character is found at that position in any sequence of the alignment">
            <option value="">Off</option>
            <option value=".">.</option>
            <option value="-">-</option>
            <option value="N">N</option>
        </param>
        <param name="soft" type="integer" value="0" min="0" max="100" label="soft - percentage required to retain column. (0-100)" help="Removes any column where the dominant base (i.e. A, T, G, C, or U) does not occur in at least a designated percentage of sequences"/>
        <param name="hard" type="data" format="mothur.filter" optional="True" label="hard - Hard Column Filter" help="A file should only contain one line consisting of 0's and 1's"/>
    </inputs>
    <outputs>
        <data name="logfile" format="txt" label="${tool.name} on ${on_string}: logfile"/>
        <data name="out_filter" format="mothur.filter" label="${tool.name} on ${on_string}: filter"/>
        <collection name="filteredfastas" type="list" label="${tool.name} on ${on_string}: filtered fastas">
            <discover_datasets pattern="(?P&lt;designation&gt;.*)\.filter\.fasta" format="fasta"/>
        </collection>
    </outputs>
    <tests>
        <test>
            <param name="fasta" value="HMP_MOCK.v35.align" ftype="mothur.align"/>
            <repeat name="inputs">
                <param name="fasta" value="Mock_S280_L001_R1_001_small.trim.contigs.good.align_head" ftype="mothur.align"/>
            </repeat>
            <output name="out_filter" md5="3e6c2cfef46baf35d2a8b5cafe53e3a4"/>
            <output_collection name="filteredfastas" count="2">
                <element name="HMP_MOCK.v35.align" md5="ef4c6c2d9a882f7a22e5fa3c814af7cc" ftype="fasta"/>
            </output_collection>
            <expand macro="logfile-test"/>
        </test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The filter.seqs_ command removes columns from alignments based on a criteria defined by the user. For example, alignments generated against reference alignments (e.g. from RDP, SILVA, or greengenes) often have columns where every character is either a '.' or a '-'. These columns are not included in calculating distances because they have no information in them. By removing these columns, the calculation of a large number of distances is accelerated. Also, people also like to mask their sequences to remove variable regions using a soft or hard mask (e.g. Lane's mask). This type of masking is only encouraged for deep-level phylogenetic analysis, not fine level analysis such as that needed with calculating OTUs.

.. _filter.seqs: http://www.mothur.org/wiki/Filter.seqs

v.1.20.0: Updated to Mothur 1.33

]]>
    </help>
    <expand macro="citations"/>
</tool>

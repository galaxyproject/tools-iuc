<tool id="mothur_sort_seqs" name="Sort.seqs" version="@WRAPPER_VERSION@.0">
    <description>put sequences in different files in the same order</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />

    <command><![CDATA[
        echo 'sort.seqs(

        #if $fasta_in:
            fasta=$fasta_in
        #end if

        #if $qfile_in:
            qfile=$qfile_in
        #end if

        #if $flow_in:
            flow=$flow_in
        #end if

        #if $name_in:
            name=$name_in
        #end if

        #if $group_in:
            group=$group_in
        #end if

        #if $taxonomy_in:
            taxonomy=$taxonomy_in
        #end if

        #if $accnos:
            accnos=$accnos
        #end if

        $large
        
        #if $count:
            ,count=$count
        #end if
        )'
        | sed 's/ //g'  ## mothur trips over whitespace
        | mothur &&

        ## move output files to correct destination
        mv mothur.*.logfile "$logfile"
        
        #if $fasta_in:
            && prefix="$fasta_in"
            && mv \${prefix%.dat}*.sorted.* "$fasta_out"
        #end if

        #if $qfile_in:
            && prefix="$qfile_in"
            && mv \${prefix%.dat}*.sorted.* "$qfile_out"
        #end if

        #if $flow_in:
            && prefix="$flow_in"
            && mv \${prefix%.dat}*.sorted.* "$flow_out"
        #end if

        #if $name_in:
            && prefix="$name_in"
            && mv \${prefix%.dat}*.sorted.* "$name_out"
        #end if

        #if $group_in:
            && prefix="$group_in"
            && mv \${prefix%.dat}*.sorted.* "$group_out"
        #end if

        #if $taxonomy_in:
            && prefix="$taxonomy_in"
            && mv \${prefix%.dat}*.sorted.* "$taxanomy_out"
        #end if
    ]]></command>
    <inputs>
        <param name="fasta_in"
               type="data"
               format="fasta"
               optional="true"
               label="fasta - sequences"/>
        <param name="qfile_in"
               type="data"
               format="qual"
               optional="true"
               label="qfile - sequence quality"/>
        <param name="flow_in"
               type="data"
               format="mothur.sff.flow"
               optional="true"
               label="flow - sff flowgram "/>
        <param name="group_in"
               type="data"
               format="mothur.groups"
               optional="true"
               label="groups - sequence groupings"/>
        <param name="name_in"
               type="data"
               format="mothur.names"
               optional="true"
               label="names - name reference"/>
        <param name="taxonomy_in"
               type="data"
               format="mothur.seq.taxonomy"
               optional="true"
               label="taxonomy - taxonomy reference"/>
        <param name="accnos"
               type="data"
               format="mothur.accnos"
               optional="true"
               label="accnos - sort "/>
        <param name="large"
               type="boolean"
               checked="false"
               truevalue=",large=true"
               falsevalue=""
               label="large - Datasets are large and may not fit in RAM"/>
        <param name="count"
               type="data"
               format="mothur.count_table"
               optional="true"
               label="count - a count_table"
               help="generated by count.seqs"/>
    </inputs>
    <outputs>
        <data name="logfile" format="txt" label="${tool.name} on ${on_string}: logfile" />
        <data name="fasta_out" format_source="fasta_in" label="${tool.name} on ${on_string}: sorted.fasta">
            <filter>fasta_in != None</filter>
        </data>
        <data name="qfile_out" format_source="qfile_in" label="${tool.name} on ${on_string}: sorted.qfile">
                <filter>qfile_in != None</filter>
        </data>
        <data name="flow_out" format_source="flow_in" label="${tool.name} on ${on_string}: sorted.flow">
            <filter>flow_in != None</filter>
        </data>
        <data name="group_out" format_source="group_in" label="${tool.name} on ${on_string}: sorted.group">
            <filter>group_in != None</filter>
        </data>
        <data name="name_out" format_source="name_in" label="${tool.name} on ${on_string}: sorted.name">
            <filter>name_in != None</filter>
        </data>
        <data name="taxonomy_out" format_source="taxonomy_in" label="${tool.name} on ${on_string}: sorted.taxonomy">
            <filter>taxonomy_in != None</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="fasta_in" value="amazon.fasta" />
            <param name="large" value="" />
            
            <output name="fasta_out" md5="0bc9320647234e8367c3b1b654f9302d" />
        </test>
        <test>
            <param name="qfile_in" value="Mock_S280_L001_R1_001_small.trim.contigs.qual" />
            <param name="large" value="" />
            
            <output name="qfile_out" md5="abed9d1811786c810a12fd00a376cee4" />
        </test>
        <test>
            <param name="group_in" value="amazon.groups" />
            <param name="large" value="" />
            
            <output name="group_out" md5="fb60628ae445e7b06f9833f632b2cd0c" />
        </test>
        <test>
            <param name="fasta_in" value="amazon.fasta" />
            <param name="count" value="amazon.count_table" />
            <param name="large" value="" />
            
            <output name="fasta_out" md5="0bc9320647234e8367c3b1b654f9302d" />
        </test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The sort.seqs_ command puts sequences from a fasta, name, group, quality, flow or taxonomy file in the same order.
You can provide an accnos file to indicate the order you want, otherwise mothur will use the order of the first file it reads.

.. _sort.seqs: http://www.mothur.org/wiki/Sort.seqs

]]>
    </help>
    <expand macro="citations" />
</tool>

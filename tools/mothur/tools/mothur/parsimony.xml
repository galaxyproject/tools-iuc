<tool id="mothur_parsimony" name="Parsimony" version="@WRAPPER_VERSION@.0">
    <description>Describes whether two or more communities have the same structure</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <!--
    parsimony(random=...) requires popen or subprocess, and crashes often - not suitable for galaxy
    -->
    <command><![CDATA[
    echo "parsimony(
        tree=$tree,
        iters=$iters,
        group=$group,
        
        #if $groups:
            groups=${ str($groups).replace(",","-") },
        #end if
        
        #if $name:
            name=$name,
        #end if
        
        #if $count:
            count=$count,
        #end if
        
        processors=\${GALAXY_SLOTS:-8}
    )"
    | sed 's/ //g'  ## mothur trips over whitespace
    | mothur;
    
    
    ## move output files to correct destination
    prefix="$tree";
    mv mothur.*.logfile "$logfile";
    mv \${prefix%.dat}*.psummary "$psummary";
    mv \${prefix%.dat}*.parsimony "$parsimony";
    ]]></command>
    <inputs>
        <param name="tree"
               type="data"
               format="tre"
               label="tree - Phylogenetic Tree"/>
        <param name="group"
               type="data"
               format="mothur.groups"
               label="group - Group file for the tree"/>
        <param name="groups"
               type="select"
               label="groups - Groups to display"
               multiple="true" 
               help="By default all are included if no selection is made.">
            <options>
                <filter type="data_meta" ref="group" key="groups" />
            </options>
        </param>
        <param name="name"
               type="data"
               format="mothur.names"
               optional="true"
               label="name - Sequences Name reference file for the tree"/>
        <param name="iters"
               type="integer"
               min="1"
               value="1000"
               label="iters - Number of bootstrap iterations to try (default 1000)"/>
        <param name="count"
               type="data"
               format="mothur.count_table"
               optional="true"
               label="count - a count_table"
               help="generated by count.seqs"/>
    </inputs>
    <outputs>
        <data format="txt" name="logfile" label="${tool.name} on ${on_string}: logfile" />
        <data format="tabular" name="psummary" label="${tool.name} on ${on_string}: psummary" />
        <data format="tabular" name="parsimony" label="${tool.name} on ${on_string}: parsimony" />
    </outputs>
    <tests>
        <test>
            <param name="tree" value="treetest.tre" />
            <param name="group" value="treetest.groups" />
            <param name="groups" value="green,orange" />
            <param name="name" value="treetest.names" />
            <param name="iters" value="1000" />
            
            <expand macro="logfile-test" />
            <ouptut name="psummary"  md5="d41d8cd98f00b204e9800998ecf8427e" />
            <output name="parsimony" md5="f49e0d64fd0c5df01abc913f398d428a" />
        </test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The parsimony_ command implements the parsimony method (aka P-test), which was previously implemented in TreeClimber and is also available in MacClade and on the UniFrac website. The parsimony method is a generic test that describes whether two or more communities have the same structure. The significance of the test statistic can only indicate the probability that the communities have the same structure by chance. The value does not indicate a level of similarity. 

.. _parsimony: http://www.mothur.org/wiki/Parsimony

v.1.20.0: Added count parameter

]]>
    </help>
    <expand macro="citations" />
</tool>

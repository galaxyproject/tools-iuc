<tool profile="16.07" id="mothur_pcr_seqs" name="Pcr.seqs" version="@WRAPPER_VERSION@.0">
    <description>Trim sequences</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="aggressive"><![CDATA[
        echo 'pcr.seqs(
            fasta=$fasta,
            #if $name_in:
                name=$name_in,
            #end if
            #if $group_in:
                group=$group_in,
            #end if
            #if $taxonomy_in:
                taxonomy=$taxonomy_in,
            #end if
            #if $trim.method == "oligos":
                oligos=$trim.oligos,
                nomatch=$trim.nomatch,
                $trim.keepprimer
            #elif $trim.method == "reference":
                ecoli=$trim.ecoli,
            #elif $trim.method == "position":
                start=$trim.start,
                #if $trim.end and int($trim.end) > 0:
                    end=$trim.end,
                #end if
            #end if
            #if $pdiffs:
                pdiffs=$pdiffs,
            #end if
            $keepdots
            processors='\${GALAXY_SLOTS:-8}'
        )'
        | sed 's/ //g'  ## mothur trips over whitespace
        | mothur &&

        ## move output files to correct destination
        prefix="$fasta" &&
        mv mothur.*.logfile "$logfile" &&
        (mv \${prefix%.dat}*.scrap.pcr.dat "$scrap_fasta" 2> /dev/null || touch "$scrap_fasta" ) &&
        mv \${prefix%.dat}*.pcr.dat "$pcr_fasta"
        #if $trim.method == "oligos":
            && mv \${prefix%.dat}*.bad.accnos "$accnos_out"
        #end if
        #if $name_in:
            && prefix="$name_in"
            && mv \${prefix%.dat}*.pcr.dat "$name_out"
        #end if
        #if $group_in:
            && prefix="$group_in"
            && mv \${prefix%.dat}*.pcr.dat "$group_out"
        #end if
        #if $taxonomy_in:
            && prefix="$taxonomy_in"
            && mv \${prefix%.dat}*.pcr.dat "$taxonomy_out"
        #end if
    ]]></command>
    <inputs>
        <param name="fasta" type="data" format="fasta" label="fasta - Candiate Sequences" help="sequences must be aligned"/>
        <conditional name="trim">
            <param name="method" type="select" label="Trim with an oligos file?" help="">
                <option value="oligos">oligos</option>
                <option value="reference">reference sequence</option>
                <option value="position">start and end positions</option>
            </param>
            <when value="oligos">
                <param name="oligos" type="data" format="mothur.oligos" optional="true" label="oligos - barcodes and primers" help="a file that can contain the sequences of the forward and reverse primers and barcodes and their sample identifier. Each line of the oligos file can start with the key words &quot;forward&quot;, &quot;reverse&quot;, and &quot;barcode&quot; or it can start with a &quot;#&quot; to tell mothur to ignore that line of the oligos file."/>
                <param name="nomatch" type="select" label="nomatch - action when no primer is found">
                    <option value="reject" selected="true">reject (default)</option>
                    <option value="keep">keep</option>
                </param>
                <param name="keepprimer" type="boolean" falsevalue="" truevalue="keepprimer=true," checked="false" label="keepprimer - keep the primer in the output sequence"/>
            </when>
            <when value="reference">
                <param name="ecoli" type="data" format="fasta" optional="true" label="ecoli - An aligned reference sequence for trimming" help="The ecoli parameter is used to provide a fasta file containing a single reference sequence (e.g. for e. coli) this must be aligned. Mothur will trim to the start and end positions of the reference sequence."/>
            </when>
            <when value="position">
                <param name="start" type="integer" min="0" value="0" optional="true" label="start - a starting position to trim to"/>
                <param name="end" type="integer" value="" optional="true" min="0" label="end - a ending position to trim from"/>
            </when>
        </conditional>
        <param name="keepdots" type="boolean" falsevalue="keepdots=false," truevalue="" checked="true" label="keepdots - keep the leading and trailing alignment dots in the output sequences"/>
        <param name="taxonomy_in" type="data" format="mothur.seq.taxonomy" optional="true" label="taxonomy - Sequence Taxonomy"/>
        <param name="name_in" type="data" format="mothur.names" optional="true" label="name - Sequence representative name list"/>
        <param name="group_in" type="data" format="mothur.groups" optional="true" label="group - Group file"/>
        <param name="pdiffs" type="integer" value="0" min="0" label="pdiffs - number of differences to allow in the primer (default 0)"/>
    </inputs>
    <outputs>
        <data name="logfile" format="txt" label="${tool.name} on ${on_string}: logfile"/>
        <data name="pcr_fasta" format_source="fasta" label="${tool.name} on ${on_string}: pcr.fasta"/>
        <data name="scrap_fasta" format_source="fasta" label="${tool.name} on ${on_string}: pcr.scrap.fasta"/>
        <data name="taxonomy_out" format="mothur.seq.taxonomy" label="${tool.name} on ${on_string}: tax.summary">
            <filter>taxonomy_in</filter>
        </data>
        <data name="group_out" format="mothur.groups" label="${tool.name} on ${on_string}: mothur.groups">
            <filter>group_in</filter>
        </data>
        <data name="name_out" format="mothur.names" label="${tool.name} on ${on_string}: mothur.names">
            <filter>name_in</filter>
        </data>
        <data name="accnos_out" format="mothur.accnos" label="${tool.name} on ${on_string}: bad.accnos">
            <filter>trim['method'] =='oligos'</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="fasta" value="Mock_S280_L001_R1_001_small.trim.contigs.good.shhh_seqs.fasta" ftype="fasta"/>
            <param name="keepdots" value=""/>
            <param name="method" value="position"/>
            <param name="start" value="0"/>
            <param name="end" value="0"/>
            <param name="pdiffs" value="0"/>
            <expand macro="logfile-test"/>
            <ouptut name="pcr_fasta" md5="1e78af5a460572e22ce199e522a70388" ftype="fasta"/>
            <output name="scrap_fasta" md5="d41d8cd98f00b204e9800998ecf8427e" ftype="fasta"/>
        </test>
        <test>
            <param name="fasta" value="Mock_S280_L001_R1_001_small.trim.contigs.good.shhh_seqs.fasta" ftype="fasta"/>
            <param name="keepdots" value="keepdots=false,"/>
            <param name="method" value="reference"/>
            <param name="ecoli" value="Mock_S280_L001_R1_001_small.trim.contigs.good.shhh_seqs.fasta"/>
            <param name="name_in" value="Mock_S280_L001_R1_001_small.trim.contigs.good.shhh_seqs.names"/>
            <param name="pdiffs" value="2"/>
            <expand macro="logfile-test"/>
            <ouptut name="pcr_fasta" md5="1e78af5a460572e22ce199e522a70388" ftype="fasta"/>
            <output name="scrap_fasta" md5="d41d8cd98f00b204e9800998ecf8427e" ftype="fasta"/>
            <output name="name_out" md5="f3bc939b899d91f7cf3b822c5a822805" ftype="mothur.names"/>
        </test>
        <test><!-- test with oligos and all outputs -->
            <param name="fasta" value="amazon.align_head" ftype="mothur.align"/>
            <param name="method" value="oligos"/>
            <param name="oligos" value="GQY1XT001.oligos" ftype="mothur.oligos"/>
            <param name="name_in" value="amazon.names" ftype="mothur.names"/>
            <param name="group_in" value="amazon.groups" ftype="mothur.groups"/>
            <param name="taxonomy_in" value="amazon.wang.wang.taxonomy" ftype="mothur.seq.taxonomy"/>
            <param name="start" value="5"/>
            <param name="end" value="50"/>
            <expand macro="logfile-test"/>
            <ouptut name="pcr_fasta" md5="1e78af5a460572e22ce199e522a70388" ftype="mothur.align"/>
            <output name="scrap_fasta" md5="0b63807f339dfd88cf958f7b069eba02" ftype="mothur.align"/>
            <output name="group_out" md5="301c358e61d38c83cc7382a8a210089a" ftype="mothur.groups"/>
            <output name="name_out" md5="62eb1162557408509c931496071add85" ftype="mothur.names"/>
            <output name="taxonomy_out" md5="4d72981cefd8b45d4f2793a28dccd9e4" ftype="mothur.seq.taxonomy"/>
            <output name="accnos_out" md5="48d019b92e4d303faf88a974e52f7a97" ftype="mothur.accnos"/>
        </test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The pcr.seqs_ command assigns sequences to chosen taxonomy outline.

.. _pcr.seqs: http://www.mothur.org/wiki/Pcr.seqs

]]>
    </help>
    <expand macro="citations"/>
</tool>

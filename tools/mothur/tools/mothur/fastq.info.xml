<tool id="mothur_fastq_info" name="Fastq.info" version="@WRAPPER_VERSION@.0">
    <description>Convert fastq to fasta and quality</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>

    <command><![CDATA[
        echo 'fastq.info(
            fastq=$fastq,
            pacbio=$pacbio,
            format=$format
            
            #if $oligo.add == "yes":
                ,oligos=$oligo.oligos
                ,bdiffs=$oligo.bdiffs
                ,pdiffs=$oligo.pdiffs
                ,tdiffs=$oligo.tdiffs
                ,ldiffs=$oligo.ldiffs
                ,sdiffs=$oligo.sdiffs
            #end if
        )'
        | sed 's/ //g'  ## mothur trips over whitespace
        | mothur && 
        mv mothur.*.logfile "$logfile" &&

        prefix='$fastq' &&
        
        #if $oligo.add == "yes":
            mv \${prefix%.dat}*.scrap.fastq "$fastq_scrap_out" &&
            mv \${prefix%.dat}*.scrap.fasta "$fasta_scrap_out" &&
            mv \${prefix%.dat}*.scrap.qual  "$qfile_scrap_out" &&
        #end if
        
        mv \${prefix%.dat}*.fasta "$fasta_out" &&
        mv \${prefix%.dat}*.qual "$qfile_out"
    ]]></command>
    <inputs>
        <param name="fastq"
               type="data"
               format="fastq"
               label="fastq - Fastq Sequence file"/>
        <param name="pacbio"
               type="boolean"
               truevalue="true"
               falsevalue="false"
               checked="false"
               label="pacbio - if set to true, quality scores of 0 will results in a corresponding base of N"/>
        <param name="format"
               type="select"
               value="sanger"
               label="format of sequence">
                <option value="sanger">sanger</option>
                <option value="solexa">solexa</option>
                <option value="illumina">illumina</option>
                <option value="illumina1.8+">illumina1.8+</option>
        </param>

        <conditional name="oligo">
            <param name="add"
                   type="select"
                   label="Use oligos file?"
                   help="a file that contain the sequences of the forward and reverse primers and barcodes and their sample identifier. Each line of the oligos file can start with the key words &quot;forward&quot;, &quot;reverse&quot;, and &quot;barcode&quot; or it can start with a &quot;#&quot; to tell mothur to ignore that line of the oligos file.">
                <option value="no">no</option>
                <option value="yes">yes</option>
            </param>
            <when value="no"/>
            <when value="yes">
                <param name="oligos" type="data" format="mothur.oligos" label="oligos - barcodes and primers"/>
                <param name="bdiffs" type="integer" value="0" min="0" label="bdiffs - number of differences to allow in the barcode (must be > 0; default 0)"/>
                <param name="pdiffs" type="integer" value="0" min="0" label="pdiffs - number of differences to allow in the primer (must be > 0; default 0)"/>
                <param name="tdiffs" type="integer" value="0" min="0" label="tdiffs - total number of differences to allow in primer and barcode (must be > 0; default 0)"/>
                <param name="ldiffs" type="integer" value="0" min="0" label="ldiffs - total number of differences to allow in linker sequence (must be > 0; default 0)"/>
                <param name="sdiffs" type="integer" value="0" min="0" label="sdiffs - total number of differences to allow in spacer sequence (must be > 0; default 0)"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="logfile"   format="txt" label="${tool.name} on ${on_string}: logfile"/>
        <data name="fasta_out" format="fasta" label="${tool.name} on ${on_string}: fasta"/>
        <data name="qfile_out" format="qual454" label="${tool.name} on ${on_string}: qual"/>
        
        <data name="fastq_scrap_out" format_source="fastq_in" label="${tool.name} on ${on_string}: fastq scrap">
            <filter>oligos != "None</filter>
        </data>
        <data name="fasta_scrap_out" format="fasta" label="${tool.name} on ${on_string}: fasta scrap">
            <filter>oligos != "None</filter>
        </data>
        <data name="qfile_scrap_out" format="qual454" label="${tool.name} on ${on_string}: qual scrap">
            <filter>oligos != "None</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="fastq" value="Mock_S280_L001_R1_001_small.fastq"/>
            <param name="pacbio" value="false"/>
            <param name="format" value="sanger"/>
            <param name="add" value="no"/>

            <expand macro="logfile-test"/>
            <output name="fasta_out" md5="88c573d00181be6dd519a0c9599f8b0c"/>
            <output name="qfile_out" md5="d382c496c583b1501666459757cabbe3"/>
        </test>
        <test>
            <param name="fastq" value="Mock_S280_L001_R1_001_small.fastq"/>
            <param name="pacbio" value="false"/>
            <param name="format" value="sanger"/>
            <param name="add" value="yes"/>
            <param name="oligos" value="GQY1XT001.oligos"/>
            <param name="bdiffs" value="1"/>
            <param name="pdiffs" value="3"/>
            <param name="tdiffs" value="3"/>
            <param name="ldiffs" value="3"/>
            <param name="sdiffs" value="7"/>

            <expand macro="logfile-test"/>
            <output name="fasta_out" md5="88c573d00181be6dd519a0c9599f8b0c"/>
            <output name="qfile_out" md5="d382c496c583b1501666459757cabbe3"/>
            
            <output name="fastq_scrap_out" md5="37a280b8af54af2a0a52b2eba1e58933"/>
            <output name="fasta_scrap_out" md5="88c573d00181be6dd519a0c9599f8b0c"/>
            <output name="qfile_scrap_out" md5="96c2f7ea3cf6336d50bef2c087280c01"/>
        </test>
        <test>
            <param name="fastq" value="Mock_S280_L001_R1_001_small.fastq"/>
            <param name="pacbio" value="false"/>
            <param name="format" value="sanger"/>
            <param name="add" value="yes"/>
            <param name="oligos" value="HMPv5-v3_1368-1369.oligos"/>
            <param name="bdiffs" value="1"/>
            <param name="pdiffs" value="3"/>
            <param name="tdiffs" value="3"/>
            <param name="ldiffs" value="3"/>
            <param name="sdiffs" value="7"/>

            <expand macro="logfile-test"/>
            <output name="fasta_out" md5="88c573d00181be6dd519a0c9599f8b0c"/>
            <output name="qfile_out" md5="d382c496c583b1501666459757cabbe3"/>
            
            <output name="fastq_scrap_out" md5="37a280b8af54af2a0a52b2eba1e58933"/>
            <output name="fasta_scrap_out" md5="88c573d00181be6dd519a0c9599f8b0c"/>
            <output name="qfile_scrap_out" md5="96c2f7ea3cf6336d50bef2c087280c01"/>
        </test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The fastq.info_ command reads a fastq file and creates a fasta and quality file.


.. _fastq.info: http://www.mothur.org/wiki/Fastq.info
]]>
    </help>
    <expand macro="citations"/>
</tool>

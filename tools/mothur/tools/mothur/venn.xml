<tool id="mothur_venn" name="Venn" version="@WRAPPER_VERSION@.0"  force_history_refresh="True">
    <description>Generate Venn diagrams for groups </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />

    <command interpreter="python"><![CDATA[
##        mothur_wrapper.py 



        --cmd='venn'
        --result='^mothur.\S+\.logfile$:'$logfile
        --outputdir='$logfile.extra_files_path'
        
        #if str($as_datasets) == "yes":
            --datasetid='$logfile.id' --new_file_path='$__new_file_path__'
            --new_datasets='^\S+?\.(\S+\.svg)$:svg'
        #end if
        
        #if $input.source == 'shared':
            --shared="$input.otu"
            #if $input.label.__str__ != "None" and len($input.label.__str__) > 0:
                --label='$input.label'
            #end if
            #if $input.calc.__str__ != "None" and len(str($input.calc)) > 0:
                    --calc='$input.calc'
            #end if
            "$nseqs"
            "$permute"
            #if $input.groups.__str__ != "None" and len($input.groups.__str__) > 0:
                --groups="$input.groups"
            #end if
        #elif $input.source == 'similarity':
            --list="$input.otu"
            #if $input.label.__str__ != "None" and len($input.label.__str__) > 0:
                --label='$input.label'
            #end if
            #if $input.calc.__str__ != "None" and len($input.calc.__str__) > 0:
                    --calc='$input.calc'
            #end if
            #if $input.abund >= 5:
                    --abund='$input.abund'
            #end if
        #end if
        #if 100 > $fontsize > 0:
            --fontsize="$fontsize"
        #end if
        "$sharedotus"
    ]]></command>
    <inputs>
        <conditional name="input">
            <param name="source" type="select" label="Generate Heatmap for">
                <option value="shared">OTU Shared</option>
                <option value="similarity">OTU list</option>
            </param>
            <when value="shared">
                <param name="otu" type="data" format="mothur.shared" label="shared - OTU Shared"/>
                <param name="calc" type="select" multiple="true" label="calc - Calculators (Uses defaults if none selected)">
                    <option value="sharedsobs">Shared Sobs</option>
                    <option value="sharedchao">Shared Chao</option>
                    <option value="sharedace">Shared Ace</option>
                </param>
                <param name="label" type="select" label="label - OTU Labels" multiple="true">
                    <expand macro="labeloptions"/>
                </param>
                <param name="groups" type="select" label="groups - Groups to consider" multiple="true">
                    <options>
                        <filter type="data_meta" ref="otu" key="groups" />
                    </options>
                </param>
            </when>
            <when value="similarity">
                <param name="otu" type="data" format="mothur.list" label="list - OTU List"/>
                <param name="calc" type="select" multiple="true" label="calc - Calculators (Uses defaults if none selected)">
                    <option value="sobs">Sobs</option>
                    <option value="chao">Chao</option>
                    <option value="ace">Ace</option>
                </param>
                <param name="abund" type="integer" value="10" label="abund - Abundance when using the ace calculator ( >= 5 )">
                    <validator type="in_range" min="5" />
                </param>
                <param name="label" type="select" label="label - OTU Labels" multiple="true">
                    <expand macro="labeloptions"/>
                </param>
            </when>
        </conditional>
        <param name="nseqs"
               type="boolean"
               falsevalue=""
               truevalue="--nseqs=true"
               argument="--nseqs"
               checked="false"
               label="Output the number of sequences represented by the otus in the picture"/>
        <param name="permute" type="boolean" truevalue="--permute=true" falsevalue="" checked="false" label="permute - Create pictures with all possible 4-way permutations of groups"/>
        <param name="fontsize" type="integer" value="24" label="fontsize - Fontsize (default is 24)"/>
        <param name="as_datasets" type="boolean" truevalue="yes" falsevalue="no" checked="false" label="Create a new history dataset for each image"/>
        <param name="sharedotus"
               type="boolean"
               falsevalue=""
               truevalue="--sharedotus=true"
               argument="--sharedotus"
               checked="false"
               label="This parameter can be used with the sharedsobs calculator to get the names of the OTUs in each section of the venn diagram. Default=t."/>
    </inputs>
    <outputs>
        <data format="html" name="logfile" label="${tool.name} on ${on_string}: logfile" />
    </outputs>
    <tests>
		<test>
			<param name="source" value="shared" />
			<param name="otu" value="amazon.mothur.shared" />
			<param name="calc" value="sharedsobs,sharedchao" />
			<param name="label" value="" />
			<param name="groups" value="forest,pasture" />
            
			<output name="html" file="venn.shared.html" lines_diff="6" />
		</test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The venn_ command generates Venn diagrams to compare the richness shared among 2, 3, or 4 groups.  For calc parameter choices see: http://www.mothur.org/wiki/Calculators

.. _venn: http://www.mothur.org/wiki/Venn

]]>
    </help>
    <expand macro="citations" />
</tool>

<tool id="mothur_align_check" name="Align.check" version="@WRAPPER_VERSION@.0">
    <description>Calculate the number of potentially misaligned bases</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>

    <command><![CDATA[
        echo 'align.check(
            fasta=$fasta,
            #if $name:
                name=$name,
            #end if
            #if $count:
                count=$count,
            #end if
            map=$map
            )'
        | sed 's/ //g'  ## mothur trips over whitespace
        | mothur &&

        ## move output files to correct destination
        prefix="$fasta" &&
        mv mothur.*.logfile "$logfile" &&
        mv \${prefix%.dat}.align.check "$out_file"
    ]]></command>
        <inputs>
            <param name="fasta" type="data" format="mothur.align" label="fasta - Aligned Sequences"/>
            <conditional name="ss">
                <param name="source" label="Select Secondary Structure Map from" type="select">
                    <option value="cached">Cached Secondary Structure Maps</option>
                    <option value="history">Your History</option>
                </param>
                <when value="cached">
                    <param name="map" type="select" label="map - Select a secondary structure map" help="Contact Galaxy team for additions">
                        <options from_data_table="mothur_map">
                        </options>
                    </param>
                </when>
                <when value="history">
                    <param name="map" format="mothur.map" type="data" label="Secondary Structure Map"/>
                </when>
            </conditional>
            <param name="count" type="data" format="mothur.count_table" label="count_table file" optional="true" help="You can also provide a name file associated with your fasta file"/>
            <param name="name" type="data" format="mothur.names" label="names file" optional="true" help="The count file is similar to the name file in that it is used to represent the number of duplicate sequences for a given representative sequence"/>
        </inputs>
    <outputs>
        <data format="txt" name="logfile" label="${tool.name} on ${on_string}: logfile"/>
        <data format="mothur.align.check" name="out_file" label="${tool.name} on ${on_string}: align.check"/>
    </outputs>
    <tests>
        <test>
            <param name="fasta" value="HMP_MOCK.v35.align"/>
            <param name="source" value="history"/>
            <param name="map" value="silva.ss.map"/>
            <output name="out_file" file="HMP_MOCK.v35.align.check" ftype="mothur.align.check"/>
            <expand macro="logfile-test"/>
        </test>
        <test>
            <param name="fasta" value="HMP_MOCK.v35.align"/>
            <param name="source" value="history"/>
            <param name="map" value="silva.ss.map"/>
            <param name="name" value="HMP_MOCK.v35.align.names"/>
            <output name="out_file" file="HMP_MOCK.v35.align.check" ftype="mothur.align.check"/>
            <expand macro="logfile-test"/>
        </test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The align.check_ command allows you to calculate the number of potentially misaligned bases in a 16S rRNA gene sequence alignment using a secondary_structure_map_.  If you are familiar with the editor window in ARB, this is the same as counting the number of ~, #, -, and = signs.  

.. _secondary_structure_map: http://www.mothur.org/wiki/Secondary_structure_map
.. _align.check: http://www.mothur.org/wiki/Align.check
]]>
    </help>
    <expand macro="citations"/>
</tool>

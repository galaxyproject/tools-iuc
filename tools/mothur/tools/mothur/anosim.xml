<tool id="mothur_anosim" name="Anosim" version="@WRAPPER_VERSION@.0">
    <description>Non-parametric multivariate analysis of changes in community structure</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />

    <command><![CDATA[
        echo "anosim(
            phylip="$dist",
            #if int($iters.__str__) > 0:
                iters="$iters",
            #end if
            #if float($alpha.__str__) > 0.0:
                alpha="$alpha",
            #end if
            design="$design"
            )"
        | sed 's/ //g'  ## mothur trips over whitespace
        | mothur;

        ## move output files to correct destination
        prefix="$dist";
        mv mothur.*.logfile "$logfile";
        mv \${prefix%.dat}.anosim "$anosim";
    ]]></command>
    <inputs>
        <param name="dist" type="data" format="mothur.lower.dist,mothur.square.dist" label="phylip - Distance Matrix"/>
        <param name="design" type="data" format="tabular" label="design - assign groups to new grouping" help="design has 2 columns: group(col 1) and grouping(col 2) (separated by a TAB character)"/>
        <param name="alpha" type="float" optional="true" value="0.05" label="alpha - acceptable stopping precision (default 0.05)"/>
        <param name="iters" type="integer" value="1000" label="iters - Number of random configuration to try (default 1000)"/>
    </inputs>
    <outputs>
        <data format="txt" name="logfile" label="${tool.name} on ${on_string}: logfile" />
        <data format="tabular" name="anosim" label="${tool.name} on ${on_string}: anosim"/>
    </outputs>
    <tests>
        <test>
            <param name="dist" value="amazon.dist" />
            <param name="design" value="amazon.design"/>
            <output name="anosim" ftype="tabular">
                <assert_contents>
                    <has_line_matching expression="^comparison\tR-value\tP-value$" />
                    <has_line_matching expression="^A-B\t[0-9\.\-]+\t[0-9\.]+$" />
                </assert_contents>
            </output>
            <expand macro="logfile-test" />
        </test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The anosim_ command uses a phylip_distance_matrix_ and a design file to calculate the non-parametric multivariate analysis of changes in community structure.

A design file partitions a list of names into groups.  It is a tab-delimited file with 2 columns: name and group, e.g. :
        ======= =======
        duck    bird
        cow     mammal
        pig     mammal
        goose   bird
        cobra   reptile
        ======= =======

The Make_Design tool can construct a design file from a Mothur dataset that contains group names.


.. _phylip_distance_matrix: http://www.mothur.org/wiki/Phylip-formatted_distance_matrix
.. _anosim: http://www.mothur.org/wiki/Anosim

]]>
    </help>
    <expand macro="citations" />
</tool>

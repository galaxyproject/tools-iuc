<tool id="mothur_remove_seqs" name="Remove.seqs" version="@WRAPPER_VERSION@.0">
    <description>Remove sequences by name</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>

    <command><![CDATA[
        echo 'remove.seqs(
            accnos=$accnos
            
            #if $fasta_in:
                ,fasta=$fasta_in
            #end if
            #if $fastq_in:
                ,fastq=$fastq_in
            #end if
        )'
        | sed 's/ //g'  ## mothur trips over whitespace
        | mothur &&
        
        ## move output files to correct destination
        mv mothur.*.logfile "$logfile"
        
        #if $fasta_in:
            && prefix='$fasta_in' && mv \${prefix%.dat}*.pick.* "$fasta_out"
        #end if
        #if $fastq_in:
            && prefix='$fastq_in' && mv \${prefix%.dat}*.pick.* "$fastq_out"
        #end if
        

##        #if $qfile_in.__str__ != "None" and len($qfile_in.__str__) > 0:
##            --qfile="$qfile_in"
##            #set results = $results + ["'" + $re.sub(r'(^.*)\.(.*?)',r'\1.pick.\2',$os.path.basename($qfile_in.__str__)) + ":'" + $qfile_out.__str__]
##        #end if
##        #if $name_in.__str__ != "None" and len($name_in.__str__) > 0:
##            --name="$name_in"
##            #set results = $results + ["'" + $re.sub(r'(^.*)\.(.*?)',r'\1.pick.\2',$os.path.basename($name_in.__str__)) + ":'" + $name_out.__str__]
##            "$dups"
##        #end if
##        #if $group_in.__str__ != "None" and len($group_in.__str__) > 0:
##            --group="$group_in"
##            #set results = $results + ["'" + $re.sub(r'(^.*)\.(.*?)',r'\1.pick.\2',$os.path.basename($group_in.__str__)) + ":'" + $group_out.__str__]
##        #end if
##        #if $alignreport_in.__str__ != "None" and len($alignreport_in.__str__) > 0:
##            --alignreport="$alignreport_in"
##            #set results = $results + ["'" + $re.sub(r'(^.*)\.(.*?)$',r'\1.pick.align.report',$os.path.basename($alignreport_in.__str__)) + ":'" + $alignreport_out.__str__]
##        #end if
##        #if $list_in.__str__ != "None" and len($list_in.__str__) > 0:
##            --list="$list_in"
##            #set results = $results + ["'" + $re.sub(r'(^.*)\.(.*?)',r'\1.pick.\2',$os.path.basename($list_in.__str__)) + ":'" + $list_out.__str__]
##        #end if
##        #if $taxonomy_in.__str__ != "None" and len($taxonomy_in.__str__) > 0:
##            --taxonomy="$taxonomy_in"
##            #set results = $results + ["'" + $re.sub(r'(^.*)\.(.*?)',r'\1.pick.\2',$os.path.basename($taxonomy_in.__str__)) + ":'" + $taxonomy_out.__str__]
##        #end if
##        --result=#echo ','.join($results)
##        #if $count.__str__ != "None" and len($count.__str__) > 0:
##            --count="$count"
##        #end if
    
    ]]></command>
    <inputs>
        <param name="accnos" type="data" format="mothur.accnos" label="accnos - Accession Names of sequences to be removed"/>
        <param name="fasta_in" type="data" format="fasta" optional="true" label="fasta - Fasta Sequences"/>
        <param name="qfile_in" type="data" format="qual" optional="true" label="qfile - Fasta Quality"/>
        <param name="fastq_in" type="data" format="fastq" optional="true" label="fastq"/>
        <param name="name_in" type="data" format="mothur.names" optional="true" label="name - Sequences Name reference"/>
        <param name="group_in" type="data" format="mothur.groups" optional="true" label="group - Sequences Groups"/>
        <param name="alignreport_in" type="data" format="mothur.align.report" optional="true" label="alignreport - Align Report"/>
        <param name="list_in" type="data" format="mothur.list" optional="true" label="list - OTU List"/>
        <param name="taxonomy_in" type="data" format="mothur.seq.taxonomy" optional="true" label="taxonomy - Taxonomy"/>
        
        <param name="dups" type="boolean" truevalue="" falsevalue="--dups=false" checked="true" label="dups - Apply to duplicates"/>
        <param name="count" type="data" format="mothur.count_table" optional="true" label="count - a count_table" help="generated by count.seqs"/>
    </inputs>
    <outputs>
        <data name="logfile" format="txt" label="${tool.name} on ${on_string}: logfile"/>
        <data name="fasta_out" format_source="fasta_in" label="${tool.name} on ${on_string}: pick.fasta">
            <filter>fasta_in != None</filter>
        </data>
        <data name="fastq_out" format_source="fastq_in" label="${tool.name} on ${on_string}: pick.fastq">
            <filter>fastq_in != None</filter>
        </data>
        <data format_source="qfile_in" name="qfile_out" label="${tool.name} on ${on_string}: pick.qfile">
            <filter>qfile_in != None</filter>
        </data>
        <data name="name_out" format="mothur.names" label="${tool.name} on ${on_string}: pick.names">
            <filter>name_in != None</filter>
        </data>
        <data name="group_out" format="mothur.groups" label="${tool.name} on ${on_string}: pick.groups">
            <filter>group_in != None</filter>
        </data>
        <data name="alignreport_out" format="mothur.align.report" label="${tool.name} on ${on_string}: pick.align.report">
            <filter>alignreport_in != None</filter>
        </data>
        <data name="list_out" format="mothur.list" label="${tool.name} on ${on_string}: pick.list">
            <filter>list_in != None</filter>
        </data>
        <data name="taxonomy_out" format="mothur.seq.taxonomy" label="${tool.name} on ${on_string}: pick.taxonomy">
            <filter>taxonomy_in != None</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="accnos" value="Mock_S280_L001_R1_001_small.trim.contigs.bad.accnos"/>
            <param name="fasta_in" value="Mock_S280_L001_R1_001_small.trim.contigs.fasta" />
            <param name="dups" value="" />
            
            <expand macro="logfile-test"/>
            <output name="fasta_out" md5="2357e1429647afbe21521a60935919bf"/>
        </test>
        <test>
            <param name="accnos" value="Mock_S280_L001_R1_001_small.trim.contigs.bad.accnos"/>
            <param name="fastq_in" value="Mock_S280_L001_R1_001_small.fastq"/>
            
            <expand macro="logfile-test"/>
            <output name="fastq_out" md5="1e10d0793f1c5f12388156d5922c0eb8"/>
        </test>
        <test>
            <!-- test two input files -->
            <param name="accnos" value="Mock_S280_L001_R1_001_small.trim.contigs.bad.accnos"/>
            <param name="fasta_in" value="Mock_S280_L001_R1_001_small.trim.contigs.fasta" />
            <param name="fastq_in" value="Mock_S280_L001_R1_001_small.fastq"/>
            
            <expand macro="logfile-test"/>
            <output name="fasta_out" md5="2357e1429647afbe21521a60935919bf"/>
            <output name="fastq_out" md5="1e10d0793f1c5f12388156d5922c0eb8"/>
        </test>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The remove.seqs_ command takes a list of sequence names and either a fasta, name_, group_, list_, align.report_ or taxonomy_ file to generate a new file that does not contain the sequences in the list. This command may be used in conjunction with the list.seqs_ command to help screen a sequence collection.

.. _name: http://www.mothur.org/wiki/Name_file
.. _group: http://www.mothur.org/wiki/Group_file
.. _list: http://www.mothur.org/wiki/List_file
.. _align.report: http://www.mothur.org/wiki/Align.seqs
.. _taxonomy: http://www.mothur.org/wiki/Taxonomy_outline
.. _list.seqs: http://www.mothur.org/wiki/list.seqs
.. _remove.seqs: http://www.mothur.org/wiki/Remove.seqs
]]>
    </help>
    <expand macro="citations"/>
</tool>

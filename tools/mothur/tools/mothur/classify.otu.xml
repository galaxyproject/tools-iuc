<tool id="mothur_classify_otu" name="Classify.otu" version="@WRAPPER_VERSION@.0" force_history_refresh="True">
    <description>Assign sequences to taxonomy</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />

    <command interpreter="python"><![CDATA[
        mothur_wrapper.py 
        --cmd='classify.otu'
        --result='^mothur.\S+\.logfile$:'$logfile
        --outputdir='$logfile.extra_files_path'
        --datasetid='$logfile.id' --new_file_path='$__new_file_path__'
        --new_datasets='^\S+?\.(unique|[0-9.]*\.cons\.taxonomy)$:cons.taxonomy','^\S+?\.(unique|[0-9.]*\.cons\.tax\.summary)$:tax.summary'
        --list="$otu"
        --taxonomy="$tax.taxonomy"
        #if $name.__str__ != "None" and len($name.__str__) > 0:
            --name='$name'
        #end if
            #if $count.__str__ != "None" and len($count.__str__) > 0:
            --count='$count'
        #end if
        #if $reftax.source != 'None' and len($reftax.taxonomy.__str__) > 0:
            --reftaxonomy="$reftax.taxonomy"
        #end if
        #if 100 >= int($cutoff.__str__) > 0:
            --cutoff="$cutoff"
        #end if
        #if $label.__str__ != "None" and len($label.__str__) > 0:
            --label='$label'
        #end if
        #if $group.__str__ != "None" and len($group.__str__) > 0:
            --group='$group'
        #end if
        --basis="$basis"
        "$probs"
        "$persample"
    ]]></command>
    <inputs>
        <param name="otu" type="data" format="mothur.list" label="list - OTU List "/>
        <param name="name" type="data" format="mothur.names" optional="true" label="name - taxonomy sequence names"/>
        <param name="count" type="data" format="mothur.count_table" optional="true" label="count - used to represent the number of duplicate sequences for a given representative sequence"/>
        <conditional name="tax">
            <param name="source" type="select" label="Select Taxonomy from" help="">
                <option value="hist">History</option>
                <option value="ref">Cached Reference</option>
            </param>
            <when value="ref">
                <param name="taxonomy" type="select" format="mothur.seq.taxonomy" label="taxonomy - Taxonomy Reference">
                    <options from_data_table="mothur_taxonomy">
                    </options>
                </param>
            </when>
            <when value="hist">
                <param name="taxonomy" type="data" format="mothur.seq.taxonomy" label="taxonomy - Taxonomy Reference"/>
            </when>
        </conditional>
        <conditional name="reftax">
            <param name="source" type="select" label="Select Reference Taxonomy used in Classify.seqs from" help="Including the reference taxonomy file used when you classified your sequences keep the rankIDs in the summary file static.">
                <option value="None">Selection is Optional</option>
                <option value="hist">History</option>
                <option value="ref">Cached Reference</option>
            </param>
            <when value="None"/>
            <when value="ref">
                <param name="taxonomy" type="select" format="mothur.seq.taxonomy" label="reftaxonomy - Taxonomy Reference used when sequences were classified">
                    <options from_data_table="mothur_taxonomy">
                    </options>
                </param>
            </when>
            <when value="hist">
                <param name="taxonomy" type="data" format="mothur.seq.taxonomy" label="reftaxonomy - Taxonomy Reference used when sequences were classified"/>
            </when>
        </conditional>
        <param name="label" type="select" label="label - OTU Labels" multiple="true">
            <expand macro="labeloptions"/>
        </param>
        <param name="cutoff" type="integer" value="60" label="cutoff - Confindence percentage cutoff between 1 and 100">
            <validator type="in_range" message="Confindence percentage cutoff must be between 0 and 100" min="0" max="100"/>
        </param>
        <param name="probs" type="boolean" falsevalue="--probs=false" truevalue="" checked="true" label="probs - Show probabilities"/>
        <param name="basis" type="select" label="basis - Summary file gives numbers of" help="">
            <option value="otu">OTU</option>
            <option value="sequence">sequence</option>
        </param>
        <param name="group" type="data" format="mothur.groups" optional="true" label="group - Groups for summary file"/>
        <param name="persample" type="boolean" falsevalue="" truevalue="--persample=true" checked="false" label="persample - allows you to find a consensus taxonomy for each group.  default=f"/>
    </inputs>
    <outputs>
        <data format="html" name="logfile" label="${tool.name} on ${on_string}: logfile" />
    </outputs>
    <tests>
    </tests>
    <help>
<![CDATA[

@MOTHUR_OVERVIEW@

**Command Documenation**

The classify.otu_ command assigns sequences to chosen taxonomy outline.

The basis parameter allows you indicate what you want the summary file to represent, options are otu and sequence. Default is otu. For example consider the following basis=sequence could give Clostridiales 3 105 16 43 46, where 105 is the total number of sequences whose otu classified to Clostridiales. 16 is the number of sequences in the otus from groupA, 43 is the number of sequences in the otus from groupB, and 46 is the number of sequences in the otus from groupC. Now for basis=otu could give Clostridiales 3 7 6 1 2, where 7 is the number of otus that classified to Clostridiales. 6 is the number of otus containing sequences from groupA, 1 is the number of otus containing sequences from groupB, and 2 is the number of otus containing sequences from groupC.

.. _classify.otu: http://www.mothur.org/wiki/Classify.otu

v1.21.0: Updated to use Mothur 1.33. Added count parameter (1.28.0) and persample parameter (1.29.0)
]]>
    </help>
    <expand macro="citations" />
</tool>

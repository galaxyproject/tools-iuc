<tool profile="16.07" id="mothur_parsimony" name="Parsimony" version="@WRAPPER_VERSION@.0">
    <description>Describes whether two or more communities have the same structure</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    <expand macro="version_command"/>
    <command><![CDATA[
@SHELL_OPTIONS@

## create symlinks to input datasets
ln -s '$tree' tree.dat &&
ln -s '$group' group.dat &&
ln -s '$count' count.dat &&
ln -s '$name' name.dat &&

echo 'parsimony(
    tree=tree.dat,
    iters=$iters,
    group=group.dat,
    #if $groups:
        groups=${ str($groups).replace(",","-") },
    #end if
    #if $name:
        name=name.dat,
    #end if
    #if $count:
        count=count.dat,
    #end if
    processors='\${GALAXY_SLOTS:-8}'
)'
| sed 's/ //g'  ## mothur trips over whitespace
| mothur
| tee mothur.out.log
    ]]></command>
    <inputs>
        <param argument="tree" type="data" format="mothur.tre" label="tree - Phylogenetic Tree"/>
        <param argument="group" type="data" format="mothur.groups" label="group - Group file for the tree"/>
        <param argument="groups" type="select" multiple="true" label="groups - Groups to display" help="By default all are included if no selection is made.">
            <options>
                <filter type="data_meta" ref="group" key="groups"/>
            </options>
        </param>
        <param argument="name" type="data" format="mothur.names" optional="true" label="name - Sequences Name reference file for the tree"/>
        <param argument="iters" type="integer" min="1" value="1000" label="iters - Number of bootstrap iterations to try (default 1000)"/>
        <param argument="count" type="data" format="mothur.count_table" optional="true" label="count - a count_table" help="generated by count.seqs"/>
        <expand macro="param-savelog"/>
    </inputs>
    <outputs>
        <expand macro="logfile-output"/>
        <data name="psummary" format="tabular" from_work_dir="tree*.psummary" label="${tool.name} on ${on_string}: psummary"/>
        <data name="parsimony" format="tabular" from_work_dir="tree*.parsimony" label="${tool.name} on ${on_string}: parsimony"/>
    </outputs>
    <tests>
        <test>
            <param name="tree" value="treetest.tre" ftype="mothur.tre"/>
            <param name="group" value="treetest.groups" ftype="mothur.groups"/>
            <param name="groups" value="green,orange"/>
            <param name="name" value="treetest.names"/>
            <param name="iters" value="1000"/>
            <output name="psummary" ftype="tabular">
                <assert_contents>
                    <has_line_matching expression="^Tree#\tGroups\tParsScore\tParsSig$"/>
                </assert_contents>
            </output>
            <output name="parsimony" ftype="tabular">
                <assert_contents>
                    <has_text text="green-orangeScore"/>
                </assert_contents>
            </output>
            <param name="savelog" value="true"/>
            <expand macro="logfile-test"/>
        </test>
    </tests>
    <help><![CDATA[

@MOTHUR_OVERVIEW@

**Command Documentation**

The parsimony_ command implements the parsimony method (aka P-test), which was previously implemented in TreeClimber
and is also available in MacClade and on the UniFrac website. The parsimony method is a generic test that describes
whether two or more communities have the same structure. The significance of the test statistic can only indicate the
probability that the communities have the same structure by chance. The value does not indicate a level of similarity.

.. _parsimony: https://www.mothur.org/wiki/Parsimony

v.1.20.0: Added count parameter

    ]]></help>
    <expand macro="citations">
        <citation type="bibtex">
@article{slatkin1989cladistic,
  title={A cladistic measure of gene flow inferred from the phylogenies of alleles.},
  author={Slatkin, Montgomery and Maddison, Wayne P},
  journal={Genetics},
  volume={123},
  number={3},
  pages={603--613},
  year={1989},
  publisher={Genetics Soc America}
}
        </citation>
        <citation type="bibtex">
@article{slatkin1990detecting,
  title={Detecting isolation by distance using phylogenies of genes.},
  author={Slatkin, Montgomery and Maddison, Wayne P},
  journal={Genetics},
  volume={126},
  number={1},
  pages={249--260},
  year={1990},
  publisher={Genetics Soc America}
}
        </citation>
        <citation type="doi">10.1128/AEM.68.8.3673-3682.2002</citation>
        <citation type="doi">10.1128/AEM.72.4.2379-2384.2006</citation>
    </expand>
</tool>

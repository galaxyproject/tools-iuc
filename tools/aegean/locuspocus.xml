<tool id='aegean_locuspocus' name='LocusPocus' version='@TOOL_VERSION@' profile='20.09'>
    <description>- calculate locus coordinates for the given gene annotation</description>
    <macros>                                                                                           
        <import>macros.xml</import>
    </macros>                                                                                          
    <expand macro='edam_ontology'/>
    <expand macro='requeriments'/>
    <command detect_errors='exit_code'>
        <![CDATA[
            locuspocus '$input1'
            -l $delta
            $mode
            $skipiloci
            #if $refine_options.refine_parameters.refine
                $refine_options.refine_parameters.cds
            #end if
            -m $refine_options.minoverlap
            #if $ilens
                '$ilens' '$output2'
            #end if
            #if $genemap
                '$genemap' '$output3'
            #end if
            $retainids
            #if $transmap
                '$transmap' '$output4'
            #end if
            -f $filter
            -o '$output1'
            ]]>
    </command>
    <inputs>
        <param type='data' name='input1' format='gff3' />
        <param type='integer' name='delta' argument='-l'
            label='Gene loci extension'
            value='500' min='0' max='1000'
            help='When parsing interval loci, use the following delta to extend gene loci and include potential regulatory regions' />
        <param name='mode' type='select' label='Annotation mode'>
            <option value='' selected='true'>Default mode</option>
            <option value='--skipends'> Exclude unannotated iLoci at either end of the sequence</option>
            <option value='--endsonly'> Report only incomplete iLocus fragments at the unannotated ends of sequences</option>
        </param>
        <param type='boolean' name='skipiloci'
            label='Do not report intergenic iLoci (-y)'
            truevalue='---skipiiloci' falsevalue='' />
        <section name='refine_options' title='Refine options' expanded='False'>
            <conditional name='refine_parameters'>
                <param type='select' name='refine'
                    label='Mode for handling of overlpping genes'
                    help='Refine mode allows for a more nuanced handling of overlapping genes.'>
                    <option value=''>Default</option>
                    <option value='--refine'>Refine mode</option>
                </param>
                <when value=''/>
                <when value='--refine'>
                    <param type='boolean' name='cds' argument='-c'
                        label='Use CDS rather than UTRs'
                        truevalue='-c' falsevalue=''
                        help='(-c)' />
                </when>
            </conditional>
            <param type='integer' name='minoverlap' argument='(-m)'
                label='Minimum number of overlapping nucleotides'
                value='1' max='20' min='1'
                help='The minimum number of nucleotides two genes must overlap to be grouped in the same iLocus' />
        </section>
        <param type='boolean' name='ilens'
            label='Create a file with the lenghts of each intergenic iLocus (-i)'
            truevalue='-i' falsevalue='' />
        <param type='boolean' name='genemap'
            label='Create a mapping from each gene annotation to its corresponding locus (-g)'
            truevalue='-g' falsevalue='' />
        <param type='boolean' name='retainids'
            label='Retain orignal features IDs (-T)'
            truevalue='-T' falsevalue='' />
        <param type='boolean' name='transmap'
            label='Create a mapping from each transcript annotation to its corresponding locus (-t)'
            truevalue='-t $output4' falsevalue='' />
        <param type='text' name='filter'
            label='Comma-separated list of feature types to use (-f)'
            value='gene' />
    </inputs>
    <outputs>
        <data name='output1' format='txt' />
        <data name='output2' format='txt'>
            <filter>ilens</filter>
        </data>
        <data name='output3' format='txt'>
            <filter>genemap</filter>
        </data>
        <data name='output4' format='txt'>
            <filter>transmap</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name='input1' value='TAIR10_GFF3_genes.gff'/>
            <output name='output1' file='locuspocus_output_test1.txt'/>
        </test>
        <test>
            <param name='input1' value='TAIR10_GFF3_genes.gff'/>
            <param name='mode' value='--skipends'/>
            <output name='output1' file='locuspocus_output_test2.txt'/>
        </test>
        <test>
            <param name='input1' value='TAIR10_GFF3_genes.gff'/>
            <param name='mode' value='--endsonly'/>
            <output name='output1' file='locuspocus_output_test3.txt'/>
        </test>
        <test>
            <param name='input1' value='TAIR10_GFF3_genes.gff'/>
            <param name='refine' value='--refine'/>
            <param name='minoverlap' value='5'/>
            <output name='output1' file='locuspocus_output_test4.txt'/>
        </test>
        <test expect_num_outputs="4">
            <param name='input1' value='TAIR10_GFF3_genes.gff'/>
            <param name='ilens' value='True'/>
            <param name='genemap' value='True'/>
            <param name='transmap' value='True'/>
            <output name='output1' file='locuspocus_output_test5.txt'/>
            <output name='output2' file='locuspocus_lenght_test5.txt'/>
            <output name='output3' file='locuspocus_genemap_test5.txt'/>
            <output name='output4' file='locuspocus_transmap_test5.txt'/>
        </test>
        <test expect_num_outputs="4">
            <param name='input1' value='TAIR10_GFF3_genes.gff'/>
            <param name='refine' value='--refine'/>
            <param name='minoverlap' value='5'/>
            <param name='mode' value='--skipends'/>
            <param name='ilens' value='True'/>
            <param name='genemap' value='True'/>
            <param name='transmap' value='True'/>
            <output name='output1' file='locuspocus_output_test6.txt'/>
            <output name='output2' file='locuspocus_lenght_test6.txt'/>
            <output name='output3' file='locuspocus_genemap_test6.txt'/>
            <output name='output4' file='locuspocus_transmap_test6.txt'/>
        </test>
    </tests>
    <help>
        <![CDATA[
.. class:: infomark
            
**Purpose**
            
LocusPocus is a program for computing interval loci (iLoci) from a provided set gene annotations. Each iLocus corresponds to a single gene, a set of overlapping genes, or a space between genes. See this page for a description of iLoci as an organizational principle for genomics.
            
-----
            
.. class:: infomark
            
**Input**
            
Input for LocusPocus is one or more files in GFF3 format. The only strict requirement is that the input must be valid GFF3.
            
The use of ##sequence-region pragmas is optional, and many GFF3 files do not include them. LocusPocus uses this information when computing the location of iLoci at the ends of a sequence. Note that if these pragmas are not declared explicitly, iLoci will only be reported for sequence regions containing annotated features.
            
Users can override gene as the default feature of interest, replace it with one or more other feature types, and construct iLoci for these features in the same way.
            
-----
            
.. class:: infomark
            
**Output**
            
LocusPocus computes the location of the iLoci from the given gene features and reports the iLocus locations in GFF3 format. By default, only the iLocus features themselves are reported, with attributes indicating the number of genes and transcripts in the locus. 
            
]]>
    </help>
    <expand macro='citations'/>
</tool>

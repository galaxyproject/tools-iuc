<tool id="tn93_filter" name="TN93 Filter" version="@VERSION@">
    <description>- remove sequences from a reference that are within a given distance of of a cluster</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="@VERSION@">tn93</requirement>
    </requirements>
    <version_command><![CDATA[tn93 --version]]></version_command>
    <command detect_errors="exit_code"><![CDATA[
    cat '$compressed_clusters' > '$filtered_reference' &&
    tn93 -o pairwise.csv -s '$reference_alignment' -t $threshold '$compressed_clusters' &&
    python filter_reference_msa.py --reference '$reference_msa' 
        --distances pairwise.csv
        --output '$filtered_reference' 
        --clusters '$compressed_clusters'
        --sequence '$reference_sequence'
    ]]></command>
    <inputs>
        <param name="reference_alignment" type="data" format="fasta" label="Aligned reads" />
        <param name="reference_sequence" type="data" format="fasta" label="The sequence against which the reads were aligned" />
        <param name="compressed_clusters" type="data" format="fasta" label="FASTA with compressed clusters" />
        <param name="threshold" type="float" value="0.015" label="Pairwise distance threshold" />
    </inputs>
    <outputs>
        <data format="fasta" name="filtered_reference" />
    </outputs>
    <tests>
        <test>
            <param name="input_fasta" value="tn93-in1.fa" />
            <param name="advanced" value="advanced" />
            <param name="threshold" value="0.35" />
            <output file="tn93-out1.csv" ftype="csv" name="tn93_distances" sort="True" />
        </test>
        <test>
            <param name="input_fasta" value="tn93-in2-alpha.fa" />
            <param name="second_fasta" value="tn93-in2-beta.fa" />
            <param name="advanced" value="advanced" />
            <param name="threshold" value="0.35" />
            <output file="tn93-out2.csv" ftype="csv" name="tn93_distances" sort="True" />
        </test>
    </tests>
    <help><![CDATA[
TN93
----

Remove sequences that are within a given [Tamura Nei 93 distance](http://www.ncbi.nlm.nih.gov/pubmed/8336541) from a reference.

NOTES
-----

All sequences must be aligned and have the same length. Only IUPAC characters are recognized (e.g. no ~). Sequence names can include copy number as in

  >seqname:10

':' can be replaced with another character using `-d`, and sequences that have no explicit copy number are assumed to be a single copy. Copy numbers
only affect histogram and mean calculations.
]]></help>
    <expand macro="citations">
        <citation type="doi">10.1093/oxfordjournals.molbev.a040023</citation>
    </expand>
</tool>

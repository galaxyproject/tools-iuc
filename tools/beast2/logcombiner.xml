<tool id="beast2_logcombiner" name="BEAST2 LogCombiner" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Combine multiple trace or tree log files into a single log file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        logcombiner
        #for $log_file in $log
            -log '$log_file'
        #end for
        -b $burnin
        #if $resample
            -resample $resample
        #end if
        #if $decimal
            -decimal
        #end if
        #if $renumber
            -renumber
        #end if
        -o '$output'
    ]]></command>
    <inputs>
        <param argument="-log" type="data" format="beast.trees,tabular" multiple="true" label="Log files" help="Select one or more log files to combine (trace or tree logs)" />
        <param name="burnin" type="integer" value="10" min="0" max="100" label="Burnin percentage" help="Percentage of lines in the log file considered to be burnin" />
        <param argument="-resample" type="integer" optional="true" label="Resample states" help="Specify number of states to resample" />
        <param argument="-decimal" type="boolean" checked="false" truevalue="-decimal" falsevalue="" label="Convert to decimal format" help="Convert numbers from scientific notation to decimal format" />
        <param argument="-renumber" type="boolean" checked="false" truevalue="-renumber" falsevalue="" label="Renumber output states" help="Renumber the states in the output file" />
    </inputs>
    <outputs>
        <data name="output" format="tabular" label="${tool.name} on ${on_string}: Combined log"/>
    </outputs>
    
    <tests>
        <!-- Test 1: Basic options -->
        <test expect_num_outputs="1">
            <param name="log" value="log1.log,log2.log,log3.log"/>
            <output name="output" file="test1_logcombiner.log"/>
        </test>
        <!-- Test 2: Custom burnin percentage -->
        <test expect_num_outputs="1">
            <param name="log" value="log1.log,log2.log"/>
            <param name="burnin" value="20" />
            <output name="output" file="test2_logcombiner.log"/>
        </test>
        <!-- Test 3: Combine tree logs -->
        <test expect_num_outputs="1">
            <param name="log" value="trees1.trees,trees2.trees,trees3.trees"/>
            <output name="output" file="test3_logcombiner.log"/>
        </test>
        <!-- Test 4: Resample States -->
         <test expect_num_outputs="1">
            <param name="log" value="log1.log,log2.log,log3.log"/>
            <param name="resample" value="10" />
            <output name="output" file="test4_logcombiner.log"/>
        </test>
        <!-- Test 5: Scientific to decimal conversion -->
        <test expect_num_outputs="1">
            <param name="log" value="trace_scientific.log"/>
            <param name="decimal" value="true" />
            <output name="output" file="test5_logcombiner.log"/>
        </test>
        <!-- Test 6: Combined Options -->
        <test expect_num_outputs="1">
            <param name="log" value="trace_scientific.log"/>
            <param name="burnin" value="10" />
            <param name="resample" value="8" />
            <param name="decimal" value="true" />
            <param name="renumber" value="true" />
            <output name="output" file="test6_logcombiner.log"/>
        </test>
    </tests>
    
    <help><![CDATA[
**What it does**

LogCombiner is a tool from the BEAST2 suite that combines multiple trace or tree log files into a single log file.

This is useful when you have run multiple independent MCMC chains and want to combine them for analysis.

**Inputs**

- **Log files**: One or more log files (trace or tree logs) to combine
- **Burnin percentage**: Percentage of lines to discard from the beginning of each log file (default: 10%)
- **Resample states** : Number of states to resample from the combined logs
- **Convert to decimal**: Convert scientific notation to decimal format
- **Renumber states**: Renumber the states in the output sequentially

**Output**

A single combined log file containing the merged data from all input files (after burnin removal).

    ]]></help>
    <citations>
        <citation type="doi">10.1371/journal.pcbi.1006650</citation>
    </citations>
</tool>
<?xml version="1.0"?>
<macros>
    <token name="@TOOL_VERSION@">1.19</token> 

    <token name="@WRAPPER_VERSION@">galaxy0</token> 

    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">chromhmm</requirement>
            <yield/>
        </requirements>
    </xml>

    <token name="@DEF@">
## the value of numstates is the first value in the header of a model_ file
## $tmpFile, string, file path
## $out, string, e.g. '10'
#def obtainNumstatesFromModel($tmpFile)
#set $out = [next(open(str($tmpFile))) for x in range(1)][0].split("\t")[0].strip()
#return $out
#end def

## _posterior files need a specific name pattern, that can be derived from the header of each file
## $tmpFile, string, file path
## $out, list, e.g. ['GM12878', 'chr11']
#def obtainHeaderFromPosterior($tmpFile)
#set $out = [next(open(str($tmpFile))) for x in range(1)][0].strip().split("\t")
#return $out
#end def
    </token>

    <token name="@RUN@">
ChromHMM.sh
    -Xmx6G
    </token>

    <token name="@RUN_IO@">
input
output
    </token>

    <token name="@HELP_FILETYPE_BINARY@">
*_binary*

Binarized data files have '_binary' in the file name. The format for the binarized data files are that the first line contains the name of the cell separated by a tab with the name of the chromosome. The second line contains in tab delimited form the name of each mark. The remaining lines correspond to consecutive bins on the chromosome. The remaining lines in tab delimited form corresponding to each mark, with a '1' for a present call or '0' for an absent call and a '2' if the data is considered missing at that interval for the mark. As an example:

::

    Cell chr1
    Mark1   Mark2   Mark3
    0   0   0
    0   1   0
    0   0   1

    </token>

<token name="@HELP_FILETYPE_LABELMAPPING@">

...

</token>



    <token name="@HELP_FILETYPE_MODEL@">
*model_*

Contains all model parameters in an internal format, usually with prefix 'model\_'.     
    </token>

    <token name="@HELP_FILETYPE_ANCHOR@">
*anchor file*

Positions are specified by a chromosome and coordinate.
    </token>

    <token name="@HELP_FILETYPE_EMISSION@">
*emission_*

The emission parameters in table format are printed to text, png, and svg imagefiles. After each iteration across the genome these files are updated.
    </token>

    <xml name="@HELP_FILETYPE_LABEL@">
*label mapping file*

The format of this file is a two column tab delimited file. The first column contains each state ID with the state ordering letter prefix. The second column contains a descriptive name or mnemonic.
    </xml>

    <token name="@HELP_FILETYPE_DENSE@">
*_dense*

...     
    </token>

    <token name="@HELP_FILETYPE_EXPANDED@">
*_expanded*

...   
    </token>

    <token name="@HELP_FILETYPE_OVERLAP@">
*_overlap*

...        
    </token>

    <token name="@HELP_FILETYPE_TES@">
*_RefSeqTES_neighborhood*

...
    </token>

    <token name="@HELP_FILETYPE_TSS@">
*_RefSeqTSS_neighborhood*

...
    </token>

    <token name="@HELP_FILETYPE_UCSC@">
The input format is a tab delimited format with the first set of columns in order being: bin, name, chrom, strand, txStart, txEnd, cdsStart, cdsEnd, exonCount, exonStarts, exonEnds. All coordinates are 0-based.
todo: wie erstellt man die Datei?
    </token>

    <token name="@HELP_FILETYPE_ANNOTATION@">
The command generates files with transcription start sites (TSS), transcription end sites (TES), gene, exon, and promoter regions annotations. Promoter region annotations are defined based on a window around the TSS. The command also generates files for the TSS with strand information.
    </token>

    <token name="@HELP_FILETYPE_SEGMENTS@">
*_segments*

...
    </token>

    <token name="@HELP_FILETYPE_TRANSITIONS@">
*transitions_*

The transition parameters in table format are printed to text, png, and svg imagefiles. After each iteration across the genome these files are updated.   
    </token>

    <token name="@HELP_FILETYPE_POSTERIOR@">
*_posterior*

...
    </token>

    <token name="@HELP_FILETYPE_CONFUSION@">
*confusion matrix*

...
    </token>

    <token name="@HELP_FILETYPE_STATEBYLINE@">
*_statebyline*

...
    </token>

    <token name="@HELP_FILETYPE_ELIM@">
*elim_*

Represents a nested set of model files, usually prefixed with 'elim\_'.
    </token>

    <token name="@HELP_CHROMHMM@">
ChromHMM is software for learning and characterizing chromatin states. ChromHMM can integrate multiple chromatin datasets such as ChIP-seq data of various histone modifications to discover de novo the major re-occuring combinatorial and spatial patterns of marks. ChromHMM is based on a multivariate Hidden Markov Model that explicitly models the presence or absence of each chromatin mark. The resulting model can then be used to systematically annotate a genome in one or more cell types. By automatically computing state enrichments for large-scale functional and annotation datasets ChromHMM facilitates the biological characterization of each state. ChromHMM also produces files with genome-wide maps of chromatin state annotations that can be directly visualized in a genome browser.

More information can be found on the project website http://compbio.mit.edu/ChromHMM/ and github https://github.com/jernst98/ChromHMM.
    </token>

    <token name="@HELP_WID@">
is part of ChromHMM, which is a program for learning and characterizing of chromatin states using a multivariate Hidden Markov Model that models the combinatorial and spatial patterns in data from multiple chromatin marks.
    </token>

    <token name="@HELP_REFERENCES@"><![CDATA[
More information can be found on the `project website <http://compbio.mit.edu/ChromHMM/>`_, the `manual <http://compbio.mit.edu/ChromHMM/ChromHMM_manual.pdf>`_ and `github <https://github.com/jernst98/ChromHMM>`_.
     ]]></token>

     <xml name="citations">
        <citation type="doi">10.1038/nmeth.1906</citation>
        <citation type="doi">10.1038/nprot.2017.124</citation>
        <citation type="doi">10.1038/nbt.1662</citation>
     </xml>
</macros>
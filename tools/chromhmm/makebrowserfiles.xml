<?xml version="1.0"?>
<tool id="chromhmm_makebrowserfiles" name="chromHMM MakeBrowserFiles" version="@TOOL_VERSION@+@WRAPPER_VERSION@">
    <description>from segmentation coordinates</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <stdio></stdio>
    <command detect_errors="exit_code"><![CDATA[
        ## initialize 
        ln -s '${inputsegment}' segments.bed &&

        ## run
        @RUN@
            MakeBrowserFiles
            ## optional parameters
            #if $ap.n
                -n '$ap.n'
            #end if
            ## required parameters (specific order)
            segments.bed ## segmentfile
            #unless $segmentationname == ''
                '$segmentationname' ## segmentationname
            #else 
                'segments' ## segmentationname
            #end unless
            output ## outfileprefix
        ]]></command>
    <inputs>
        <expand macro="inputsegment" multiple="false" label="Select segmentation file." argument="(inputsegment)"/>
        <param argument="segmentationname" type="text" label="Set name for the segmentation that will be given to the segmentation and displayed in the browser." help=""/>

        <section name="ap" title="Advanced parameters">
            <param argument="-n" type="integer" value="" optional="true" label="Set number of states on which segmentation is based." help="By default the maximum state number is used to indicate how many states there are. This parameter can potentially influence the default state coloring if there are locations in the genome which were not assigned to any state."/>
        </section>
    </inputs>
    <outputs>
        <data name="out_expanded" format="bed" from_work_dir="output_expanded.bed" label="${tool.name} on ${on_string} Expanded, bed"/>
        <data name="out_dense" format="bed" from_work_dir="output_dense.bed" label="${tool.name} on ${on_string} Dense, bed"/>
    </outputs>
    <tests>
        <!-- #1; required parameters -->
        <test expect_num_outputs="2">
            <param name="inputsegment" value="GM12878_2_segments.bed.gz"/>
            <param name="segmentationname" value="segmentation_test"/>
            <output name="out_expanded">
                <assert_contents>
                    <has_n_lines n="4"/>
                    <has_line_matching expression="track name=&quot;Expanded_segmentation_test&quot;.+"/>
                    <has_line_matching expression="chr11&#009;0.+"/>
                </assert_contents>
            </output>
            <output name="out_dense">
                <assert_contents>
                    <has_n_lines n="15905"/>
                    <has_line_matching expression="track name=&quot;segmentation_test&quot;.+"/>
                    <has_line_matching expression="chr11&#009;0&#009;.+"/>
                </assert_contents>
            </output>
        </test>
        <!-- #2; advanced parameters -->
        <test expect_num_outputs="2">
            <param name="inputsegment" value="GM12878_2_segments.bed.gz"/>
            <param name="segmentationname" value="segmentation_test"/>
            <section name="ap">
                <param name="n" value ="2"/>
            </section>
            <output name="out_expanded">
                <assert_contents>
                    <has_n_lines n="4"/>
                    <has_line_matching expression="track name=&quot;Expanded_segmentation_test&quot;.+"/>
                    <has_line_matching expression="chr11&#009;0.+"/>
                </assert_contents>
            </output>
            <output name="out_dense">
                <assert_contents>
                    <has_n_lines n="15905"/>
                    <has_line_matching expression="track name=&quot;segmentation_test&quot;.+"/>
                    <has_line_matching expression="chr11&#009;0&#009;.+"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

MakeBrowserFiles @HELP_WID@

@HELP_CHROMHMM@

MakeBrowserFiles converts segmentation coordinates in a .bed file into two files that can be viewed as custom tracks in the `UCSC genome browser <http://genome.ucsc.edu>`_. One of the files can give a dense view of the segmentation in a single track with states being differentiated solely by color. The other file gives an expanded view showing one state per track.

**Input**

@HELP_FILETYPE_SEGMENTS@

**Output**

@HELP_FILETYPE_DENSE@
@HELP_FILETYPE_EXPANDED@

.. class:: infomark

**References**

@HELP_REFERENCES@
    ]]></help>
    <citations>
        <expand macro="citations"/>
    </citations>
</tool>
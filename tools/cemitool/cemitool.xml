<tool id="cemitool" name="CEMiTool" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.05">
    <description>gene co-expression network analyses</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro='xrefs'/>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        #if 'reports' in $outputs
            mkdir -p '${output_html.extra_files_path}' &&
        #end if
        Rscript '$__tool_directory__/CEMiTool.R'
            -M '$expression_matrix'
        #if $annotation
            -A '$annotation'
        #end if
        #if $pathways
            -P '$pathways'
        #end if
        #if $interactions
            -I '$interactions'
        #end if
        && ls -lah
        && ls -lah Reports/Report
        && ls -lah Plots
        && ls -lah Tables
    ]]></command>
    <inputs>
        <param name="expression_matrix" type="data" format="tabular" label="Expression matrix"/>
        <param name="annotation" type="data" format="tabular" optional="true" label="Sample annotation" 
            help="It allows to build a more complete object and generate richer reports about the 
                expression data. Sample annotation can be supplied in a data.frame that specifies a 
                class for each sample. Classes can represent different conditions, phenotypes, cell lines, 
                time points, etc. " />
        <param name="pathways" type="data" format="tabular,txt" label="Pathways list" optional="true" help="CEMiTool can 
            determine which biological functions are associated with the modules by performing an over 
            representation analysis (ORA). To do this you must provide a pathway list in the form of GMT 
            file. CEMiTool will then analyze how these pathways are represented in the modules." />
        <param name="interactions" type="data" format="tabular" optional="true" label="Interactions data" help="Interaction data, 
            such as protein-protein interactions can be added in order to generate annotated module graphs. 
            Interaction files contains two columns for interacting pairs of genes"/>
        <param name="outputs" type="select" multiple="true" display="checkboxes" label="Outputs selector">
            <option value="report" selected="true">Report</option>
            <option value="tables">Tables</option>
            <option value="plots">Plots</option>
        </param>
        <section name="advanced_parameters" title="Advanced parameters">
            <param argument="filter" type="boolean" truevalue="TRUE" falsevalue="FALSE" checked="True" label="Filter" help="TODO" />
            <param argument="filter_pval" type="float" min="0" max="1" value="0.1" label="Filter pValue" help="TODO" />
            <param argument="apply_vst" type="boolean" truevalue="TRUE" falsevalue="FALSE" checked="false" label="VST" help="TODO" />
            <param argument="n_genes" type="integer" min="0" value="1000" label="Number of genes" help="TODO" />
            <param argument="eps" type="float" min="0" max="1" value="0.1" label="EPS" help="TODO" />
            <param name="cor_method" type="select" label="Correlation method" help="TODO">
                <option value="pearson">Pearson</option>
                <option value="spearman">Spearman</option>
            </param>
            <param name="cor_function" type="select" label="Correlation function" help="TODO">
                <option value="cor">Correlation (cor)</option>
                <option value="bicor">Biweight Midcorrelation (bicor)</option>
            </param>
            <param name="network_type" type="select" label="Network type" help="TODO">
                <option value="signed">Signed</option>
                <option value="unsigned">Unsigned</option>
            </param>
            <param name="tom_type" type="select" label="TOM type" help="TODO">
                <option value="signed">Signed</option>
                <option value="unsigned">Unsigned</option>
            </param>
            <param argument="set_beta" type="float" value="" optional="true" label="Beta value" help="TODO" />
            <param argument="merge_similar" type="boolean" truevalue="TRUE" falsevalue="FALSE" checked="false" label="Merge similar" help="TODO" />
            <param argument="rank_method" type="select" label="Rank method" help="TODO">
                <option value="mean">Mean</option>
                <option value="median">Median</option>
            </param>
            <param argument="min_ngen" type="integer" min="0" value="30" label="Minimal number of genes per module" help="TODO" />
            <param argument="diss_thresh" type="float" min="0" max="1" value="0.8" label="Merging correlation threshold" help="TODO" />
            <param argument="center_func" type="select" label="Cetrality measure to show in the plot" help="TODO">
                <option value="mean">Mean</option>
                <option value="median">Medin</option>
            </param>
        </section>
    </inputs>
    <outputs>
        <collection name="plots" type="list" label="${tool.name} on ${on_string}: Plots">
            <discover_datasets pattern="__designation_and_ext__" format="pdf" directory="Plots" />
            <filter>"plots" in outputs</filter>
        </collection>
        <data name="module" format="tabular" from_work_dir="Tables/module.tsv" label="${tool.name} on ${on_string}: Module">
            <filter>"tables" in outputs</filter>
        </data>
        <data name="modules_genes" format="tabular" from_work_dir="Tables/modules_genes.gmt" label="${tool.name} on ${on_string}: Module genes">
            <filter>"tables" in outputs</filter>
        </data>
        <data name="parameters" format="tabular" from_work_dir="Tables/parameters.tsv" label="${tool.name} on ${on_string}: Parameters">
            <filter>"tables" in outputs</filter>
        </data>
        <data name="selected_genes" format="txt" from_work_dir="Tables/selected_genes.txt" label="${tool.name} on ${on_string}: Selected genes">
            <filter>"tables" in outputs</filter>
        </data>
        <data name="summary_eigengene" format="tabular" from_work_dir="Tables/summary_eigengene.tsv" label="${tool.name} on ${on_string}: Summary eigengenes">
            <filter>"tables" in outputs</filter>
        </data>
        <data name="summary_mean" format="tabular" from_work_dir="Tables/summary_mean.tsv" label="${tool.name} on ${on_string}: Summary mean">
            <filter>"tables" in outputs</filter>
        </data>
        <data name="summary_median" format="tabular" from_work_dir="Tables/summary_median.tsv" label="${tool.name} on ${on_string}: Summary median">
            <filter>"tables" in outputs</filter>
        </data>
        <data name="interactions_output" format="tabular" from_work_dir="Tables/interactions.tsv" label="${tool.name} on ${on_string}: Interactions">
            <filter>"tables" in outputs</filter>
            <filter>interactions</filter>
        </data>
        <data name='output_html' format='html' from_work_dir="Reports/Report/report.html" label="${tool.name} on ${on_string}: HTML report">
            <filter>"report" in outputs</filter>
        </data>
    </outputs>
    <help><![CDATA[

.. class:: infomark

**Purpose**

The CEMiTool R package provides users with an easy-to-use method to automatically implement gene co-expression network analyses, obtain key information about the 
discovered gene modules using additional downstream analyses and retrieve publication-ready results via a high-quality interactive report.

    ]]></help>
    <expand macro="citations" />
</tool>
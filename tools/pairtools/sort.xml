<tool id="pairtools_sort" name="Pairtools sort" version="@TOOL_VERSION@+galaxy@SUFFIX_VERSION@" profile="@PROFILE_VERSION@" license="MIT">
    <description>Sort a 4dn pairs/pairsam file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        #if $pairs_path.is_of_type('4dn_pairs.gz') or $pairs_path.is_of_type('4dn_pairsam.gz'):
            #set $input_link = "input.gz"
            #set $output_sorted_pairs_link = "sorted_output.gz"
        #else
            #set $input_link = "input"
            #set $output_sorted_pairs_link = "sorted_output"
        #end if
        ln -s '$pairs_path' '$input_link' &&
        ln -s '$output_sorted_pairs' '$output_sorted_pairs_link' &&
        pairtools sort
            '$input_link'
            -o '$output_sorted_pairs_link'
            --nproc-in \${GALAXY_SLOTS:-4}
            --nproc-out \${GALAXY_SLOTS:-4}
    ]]></command>
    <inputs>      
        <param name="pairs_path" type="data" format="4dn_pairs,4dn_pairsam,4dn_pairs.gz,4dn_pairsam.gz" label="Input file" help="Input a 4dn pairs or pairsam file"/>
    </inputs>
    <outputs>
        <data name="output_sorted_pairs" format_source="pairs_path" label="${tool.name} on ${on_string}">
        </data>
    </outputs>
    <tests>
        <!--Test default parameters with pairs file, this us actually a pairsam file-->
        <test expect_num_outputs="1">
            <param name="pairs_path" ftype="4dn_pairsam" value="output_parsed_pairs_bam.pairs"/>
            <output name="output_sorted_pairs" file="output_sorted_pairs.pairs" ftype="4dn_pairsam" lines_diff="10"/>
        </test>
        <!--Test default parameters with pairsam file-->
        <test expect_num_outputs="1">
            <param name="pairs_path" ftype="4dn_pairsam" value="output_dedup_pairs_markdups.pairsam"/>
            <output name="output_sorted_pairs" file="output_dedup_sorted.pairsam" ftype="4dn_pairsam" lines_diff="10"/>
        </test>
        <!--Test default parameters with pairsam file compressed output-->
        <test expect_num_outputs="1">
            <param name="pairs_path" ftype="4dn_pairsam" value="output_dedup_pairs_markdups.pairsam"/>
            <output name="output_sorted_pairs" file="output_dedup_sorted.pairsam" ftype="4dn_pairsam" decompress="true" lines_diff="10"/>
        </test>
        <!--Test default parameters with pairsam file compressed input-->
        <test expect_num_outputs="1">
            <param name="pairs_path" ftype="4dn_pairsam" value="output_dedup_pairs_markdups.pairsam.gz"/>
            <output name="output_sorted_pairs" file="output_dedup_sorted.pairsam" ftype="4dn_pairsam" lines_diff="10"/>
        </test>
    </tests>
    <help><![CDATA[
        **Pairtools sort**

        Sort pairs in the lexicographic order along chrom1 and chrom2, in the numeric order along pos1 and pos2 and in the lexicographic order along pair_type.
        
    ]]></help>
    <expand macro="citations"/>
    <expand macro="creator"/>
</tool>

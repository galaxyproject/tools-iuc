<tool id="pairtools_sort" name="Pairtools sort" version="@TOOL_VERSION@+galaxy@SUFFIX_VERSION@" profile="23.2" license="MIT">
    <description>Sort a 4dn pairs/pairsam file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        #if $pairs_path.is_of_type('4dn_pairs.gz') or $pairs_path.is_of_type('4dn_pairsam.gz'):
            #set $input_temp = "input.gz"
        #else
            #set $input_temp = "input"
        #end if
        ln -s '$pairs_path' '$input_temp' &&

        #set $output_sorted_pairs_temp = "sorted_output" + str($compress_output)
        ln -s '$output_sorted_pairs' '$output_sorted_pairs_temp' &&
        pairtools sort
            '$input_temp'
            -o '$output_sorted_pairs_temp'
            --nproc-in \${GALAXY_SLOTS:-4}
            --nproc-out \${GALAXY_SLOTS:-4}
    ]]></command>
    <inputs>      
        <param name="pairs_path" type="data" format="4dn_pairs,4dn_pairsam,4dn_pairs.gz,4dn_pairsam.gz" label="Input file" help="Input a 4dn pairs or pairsam file"/>
        <param name="compress_output" type="boolean" truevalue=".gz" falsevalue="" checked="false" label="Compress output file" />
    </inputs>
    <outputs>
        <data name="output_sorted_pairs" label="${tool.name} on ${on_string}"  format="auto">
        </data>
    </outputs>
    <tests>
        <!--Test default parameters with pairs file-->
        <test expect_num_outputs="1">
            <param name="pairs_path" value="output_parsed_pairs_bam.pairs"/>
            <output name="output_sorted_pairs" file="output_sorted_pairs.pairs" lines_diff="10" />
        </test>
        <!--Test default parameters with pairsam file-->
        <test expect_num_outputs="1">
            <param name="pairs_path" value="output_dedup_pairs_markdups.pairsam"/>
            <output name="output_sorted_pairs" file="output_dedup_sorted.pairsam" lines_diff="10"/>
        </test>
        <!--Test default parameters with pairsam file compressed output-->
        <test expect_num_outputs="1">
            <param name="pairs_path" value="output_dedup_pairs_markdups.pairsam"/>
            <param name="compress_output" value="true"/>
            <output name="output_sorted_pairs" file="output_dedup_sorted.pairsam"  decompress="true" lines_diff="10"/>
        </test>
        <!--Test default parameters with pairsam file compressed input-->
        <test expect_num_outputs="1">
            <param name="pairs_path" value="output_dedup_pairs_markdups.pairsam.gz"/>
            <output name="output_sorted_pairs" file="output_dedup_sorted.pairsam"  lines_diff="10"/>
        </test>
    </tests>
    <help><![CDATA[
        **Pairtools sort**

        Sort pairs in the lexicographic order along chrom1 and chrom2, in the numeric order along pos1 and pos2 and in the lexicographic order along pair_type.
        
    ]]></help>
    <expand macro="citations"/>
    <expand macro="creator"/>
</tool>

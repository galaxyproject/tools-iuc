<tool id="beaconnetwork" name="Beacon Network" version="0.1.0">
    <requirements>
    <requirement type="package" version="1.0.1">json2html</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
        python2.7 "$beacon_network_script" '$inputs'
    ]]></command>
    <configfiles>
        <inputs name="inputs"/>
        <configfile name="beacon_network_script">
<![CDATA[
import argparse
import json
import sys
import tempfile
import requests
from json2html import *

BEACON_NETWORK_API_URL = 'https://beacon-network.org/api/responses/'
parameters = {}
input_json_path = sys.argv[1]
params = json.load(open(input_json_path, "r"))
for i in params:
    if params[i] != "":
        parameters[i] = params[i]

r = requests.get(BEACON_NETWORK_API_URL, headers={'Accept-encoding': 'gzip'}, params=parameters, timeout=500)

decoded_request = json.JSONDecoder().decode(r.text)
# print decoded_request

with open('$output_of_query', 'w') as myFile:
    for i in xrange(len(decoded_request)):
        if decoded_request[i]["response"] == True:
            html = json2html.convert(json = decoded_request[i])
            myFile.write(html)

]]>
        </configfile>
    </configfiles>
    <inputs>
    <param name="chrom" type="text" value="" label="Chromosome(s)" help="Chromosome ID. Accepted values: 1-22, X, Y, MT. Note: For compatibility with conventions set by some of the existing beacons, an arbitrary prefix is accepted as well (e.g. chr1 is equivalent to chrom1 and 1)."/>
    <param name="pos" type="text" value="" label="Coordinate" help="Coordinate within a chromosome. Position is a number and is 0-based."/>
    <param name="allele" type="text" value="" label="Allele" help="Any string of nucleotides A,C,T,G or D, I for deletion and insertion, respectively. Note: For compatibility with conventions set by some of the existing beacons, DEL and INS identifiers are also accepted."/>
    <param name="ref" type="text" value="" label="Genome ID" help="Genome ID. If not specified, all the genomes supported by the given beacons are queried. Note: For compatibility with conventions set by some of the existing beacons, both GRC or HG notation are accepted, case insensitive. Optional parameter."/>
    <param name="beacon" type="text" value="" label="Beacon IDs" help="Beacon IDs. If specified, only beacons with the given IDs are queried. Responses from all the supported beacons are obtained otherwise. Format: [id1,id2]. Optional parameter."/>
    </inputs>
    <outputs>
    <data format="html" name="output_of_query"/>
    </outputs>
    <help><![CDATA[

    Example parameters:
        Allele: C
        Pos: 32936732
        Chrom: 13
        Genome: GRCh37
    ]]></help>
</tool>
<tool id="metaspades" name="metaSPAdes" version="@TOOL_VERSION@+@WRAPPER_VERSION@">
    <description>@DESCRIPTION@ metagenomics datasets</description>
    
    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <expand macro="stdio"/>

    <command detect_errors="exit_code"><![CDATA[
        ## run: metaspades
        metaspades.py
            ## files
            #for $i, $library in enumerate( $libraries, start=1)
                @LIBTYPE_SPADES-PLASMID-META-RNA@
                #end if
                @FILETYPE_SPADES-PLASMID-META-RNA@
            #end for
            ## shared parameter
            @PARAM_ALL@ 
            @PARAM_SPADES-PLASMID-META@
            @PARAM_SPADES-PLASMID-META-RNA@

        ## additional output:
        @OUTPUT_SPADES_PLASMID_META@
    ]]></command>

    <configfiles>
        <!-- parse config.fasta and scaffolds.fasta and create $out_configstats and $out_scaffoldstats -->
        <expand macro="config_script"/>
    </configfiles>

    <inputs>
        <!-- files -->
        <repeat name="libraries" min="1" max="1" title="Libraries" help="">
            <param name="libtype" type="select" label="Type" >
                <expand macro="in_libtype_spades_plasmid_meta_rna"/>
            </param>
            <expand macro="in_files"/>
        </repeat>
        <!-- shared parameter -->
        <expand macro="in_param_spades_plasmid_meta_rna"/>
        <expand macro="in_param_spades_plasmid_meta"/>
        <!-- output options -->
        <section name="in_outoptions" title="Set optional outputs" expanded="false">
            <expand macro="in_outoptions_spades_plasmid_meta_rna"/>            
            <expand macro="in_outoptions_spades_plasmid_meta"/>
        </section> 
    </inputs>

    <outputs>
        <expand macro="out_spades_plasmid_meta"/>
        <expand macro="out_spades_plasmid_meta_rna"/>
    </outputs>

    <tests>
        <test>
            <expand macro="test_filetypes_spades" k="33" filetype="fastq" fileext="fq"/>        
        </test>   
        <test>
            <expand macro="test_filetypes_spades" k="33" filetype="fasta" fileext="fasta" />        
        </test>
        <test>
            <expand macro="test_filetypes_spades" k="33" filetype="fastq.gz" fileext="fq.gz"/>        
        </test>                
        <test>
            <expand macro="test_filetypes_spades" k="77" filetype="fastq" fileext="fq"/>        
        </test>          
        <test>
            <expand macro="test_filetypes_spades" filetype="fastq" fileext="fq"/>        
        </test>   
        <test>
            <expand macro="test_filetypes_spades" k="33" filetype="fastqsanger" fileext="fq"/>        
        </test>
        <test>
            <expand macro="test_filetypes_spades" k="33" filetype="fastqsanger.gz" fileext="fq.gz"/>        
        </test>
     </tests>

    <help><![CDATA[
.. class:: infomark

**What it does**

metaSPAdes comes as a part of `SPAdes <http://cab.spbu.ru/software/spades/>`_ and is a tool for assembling metagenomic data sets.

More information can be found on the `project website <http://cab.spbu.ru/software/meta-spades/>`_, in the `manual <http://cab.spbu.ru/files/release@TOOL_VERSION@/manual.html#sec3.2>`_ and on `github <https://github.com/ablab/spades>`_.

@HELP_ACKNOWLEDGMENTS@
    ]]></help>

    <expand macro="citations">
        <citation type="doi">10.1101/gr.213959.116</citation>
    </expand>
</tool>
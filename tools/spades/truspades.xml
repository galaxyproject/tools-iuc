<tool id="truspades" name="truSPAdes" version="@TOOL_VERSION@+@WRAPPER_VERSION@">
    <description>@DESCRIPTION@ Illumina TruSeq short reads</description>
    
    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <expand macro="stdio"/>

    <command detect_errors="exit_code"><![CDATA[
        ## initialize: truspades
        ## create dataset directory with particular naming patterns to enable automatic dataset file generation
        ## see http://spades.bioinf.spbau.ru/release3.11.1/truspades_manual.html#sec2.2
        mkdir ./datasets &&
        #for $i, $files in enumerate( $input_files, start=1 )
            ln -s ${files.left_reads} ./datasets/reads_L${i}_R1.fastq && ## L: lane, R1: left
            ln -s ${files.right_reads} ./datasets/reads_L${i}_R2.fastq && ## L: lane, R2: right
        #end for

        ## run: truspades
        truspades.py
            @PARAM_ALL@
            --input-dir ./datasets
    ]]></command>

    <inputs>
        <repeat name="input_files" title="TruSeq read files" min="1" >
            <param name="left_reads" type="data" format="@INTYPES@" label="Left reads" help=""/>
            <param name="right_reads" type="data" format="@INTYPES@" label="Right reads" help=""/>       
        </repeat>
    </inputs>

    <outputs>
        <data format="fasta" from_work_dir="/output/TSLR.fasta" label="${tool.name} on ${on_string}: TSLR" name="output_tslr" />
   </outputs>

    <tests>
        <!-- Test 1 - implemented test of truspades -->
        <test>
            <repeat name="input_files">
                <param ftype="fastq" name="left_reads" value="A_R1.fastq.gz"/>
                <param ftype="fastq" name="rev_reads" value="A_R2.fastq.gz"/>
            </repeat>
            <repeat name="input_files">
                <param ftype="fastq" name="left_reads" value="B_R1.fastq.gz"/>
                <param ftype="fastq" name="rev_reads" value="B_R2.fastq.gz"/>
            </repeat>
            <output name="output_tslr" file="TSLR.fasta"/>
        </test>
    </tests>

    <help><![CDATA[
.. class:: infomark

**What it does**

truSPAdes comes as a part of `SPAdes <http://cab.spbu.ru/software/spades/>`_  and is an assembler for short reads produced by Illumina TruSeq Long Read technology. TruSPAdes accepts as an input a collection of demultiplexed TruSeq reads and assembles long virtual reads.

More information can be found on the [project website](http://cab.spbu.ru/software/truspades/), in the [manual](http://cab.spbu.ru/files/release@TOOL_VERSION@/truspades_manual.html) and on [github](https://github.com/ablab/spades).

@HELP_ACKNOWLEDGMENTS@
    ]]></help>

    <expand macro="citations" >
        <citation type="doi">10.1038/nmeth.3737</citation>
    </expand>
</tool>
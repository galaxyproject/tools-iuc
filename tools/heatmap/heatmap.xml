<tool id="heatmap_1" name="Heatmap " version="1.0.1">
    <description>of numeric data</description>
    <requirements>
        <requirement type="package" version="3.3.1">R</requirement>
        <requirement type="package" version="1.0.1">r-argparse</requirement>
        <requirement type="package" version="1.1">r-rcolorbrewer</requirement>
    </requirements>
    <command detect_errors="aggressive">
        <![CDATA[
        Rscript '$__tool_directory__/heatmap.R' --input '$input'
            --main '$main' --xlab '$xlab' --ylab '$ylab' --var_cols $var_cols
            --scale $scale --na_remove $na_remove --header $header
            --dendrogram $dendrogram --output '${out_file1}' --shades $shades
            #if $colors.color_configuration == 'select':
                --select_color --col_min '$colors.col_min' --col_max '$colors.col_max'
            #else:
                --palette $colors.palette_type.palette
            #end if
        ]]>
    </command>
    <inputs>
        <param argument="--main" label="Plot Title" name="main" size="30" type="text" value="" />
        <param argument="--xlab" label="Label for x axis" name="xlab" size="30" type="text" value="" />
        <param argument="--ylab" label="Label for y axis" name="ylab" size="30" type="text" value="" />
        <param argument="--input" format="tabular" label="Dataset" name="input" type="data" />
        <param argument="--var_cols" data_ref="input" label="Select columns containing input variables " multiple="true" name="var_cols" numerical="True" type="data_column">
            <validator message="Please select at least one column." type="no_options" />
        </param>
        <param argument="--scale" label="Center and Scale variables?" name="scale" type="select">
            <option selected="true" value="none">No</option>
            <option value="column">Yes, by column</option>
            <option value="row">Yes, by row</option>
        </param>
        <param argument="--na_remove" label="Remove NA?" name="na_remove" type="select">
            <option selected="true" value="yes">Yes</option>
            <option value="no">No</option>
        </param>
        <param argument="--header" label="Treat first line as header?" name="header" type="select">
            <option selected="true" value="yes">Yes</option>
            <option value="no">No</option>
        </param>
        <param argument="--dendrogram" label="Plot dendrogram?" name="dendrogram" type="select">
            <option selected="true" value="none">No</option>
            <option value="column">Only column dendrogram</option>
            <option value="row">Only row dendrogram</option>
            <option value="both">Both row and column dendrograms</option>
        </param>
        <param argument="--shades" label="Number of colors in the palette" max="11" min="3" name="shades" type="integer" value="10" />
        <conditional name="colors">
            <param label="Color selection" name="color_configuration" type="select">
                <option value="brewer">RColorBrewer palettes</option>
                <option value="select">Pick custom colors</option>
            </param>
            <when value="select">
                <param argument="--col_min" label="Color at the smallest value" name="col_min" type="color" />
                <param argument="--col_max" label="Color at the largest value" name="col_max" type="color" />
            </when>
            <when value="brewer">
                <conditional name="palette_type">
                    <param label="Select the structure of the data" name="data_structure" type="select">
                        <option value="diverging">Diverging</option>
                        <option value="sequential">Sequential</option>
                    </param>
                    <when value="diverging">
                        <param argument="--palette" label="Select a palette" name="palette" type="select">
                            <option value="Spectral">Spectral</option>
                            <option value="RdYlGn">Red - Yellow - Green</option>
                            <option value="RdYlBu">Red - Yellow - Blue</option>
                            <option value="RdGy">Red - Gray</option>
                            <option value="RdBu">Red - Blue</option>
                            <option value="PuOr">Purple - Orange</option>
                            <option value="PRGn">Purple - Green</option>
                            <option value="PiYG">Pink - Green</option>
                            <option value="BrBG">Brown - Green</option>
                        </param>
                    </when>
                    <when value="sequential">
                        <param argument="--palette" label="Select a palette" name="palette" type="select">
                            <option value="YlOrRd">Yellow - Orange - Red</option>
                            <option value="YlOrBr">Yellow - Orange - Brown</option>
                            <option value="YlGnBu">Yellow - Green - Blue</option>
                            <option value="YlGn">Yellow - Green</option>
                            <option value="Reds">Red</option>
                            <option value="RdPu">Red - Purple</option>
                            <option value="Purples">Purple</option>
                            <option value="PuRd">Purple - Red</option>
                            <option value="PuBuGn">Purple - Blue - Green</option>
                            <option value="PuBu">Purple - Blue</option>
                            <option value="OrRd">Orange - Red</option>
                            <option value="Oranges">Orange</option>
                            <option value="Greys">Gray</option>
                            <option value="Greens">Green</option>
                            <option value="GnBu">Green - Blue</option>
                            <option value="BuPu">Blue - Purple</option>
                            <option value="BuGn">Blue - Green</option>
                            <option value="Blues">Blue</option>
                        </param>
                    </when>
                </conditional>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data format="pdf" name="out_file1" />
    </outputs>
    <tests>
        <test>
            <param name="main" value="Heatmap" />
            <param name="xlab" value="X" />
            <param name="ylab" value="Y" />
            <param ftype="tabular" name="input" value="heatmap_in1.tabular" />
            <param name="var_cols" value="2,4" />
            <param name="scale" value="column" />
            <param name="na_remove" value="yes" />
            <param name="header" value="yes" />
            <param name="dendrogram" value="none" />
            <param name="shades" value="10" />
            <param name="colors|color_configuration" value="brewer" />
            <param name="colors|palette_type" value="diverging" />
            <param name="colors|palette_type|palette" value="Spectral" />
            <output file="heatmap_out1.pdf" name="out_file1" />
        </test>
        <test>
            <param name="main" value="Feelings By Week" />
            <param name="xlab" value="Emotion" />
            <param name="ylab" value="Week" />
            <param ftype="tabular" name="input" value="heatmap_in2.tabular" />
            <param name="var_cols" value="2,3,4,5,6,7,8,9,10,11" />
            <param name="scale" value="column" />
            <param name="na_remove" value="yes" />
            <param name="header" value="yes" />
            <param name="dendrogram" value="none" />
            <param name="shades" value="10" />
            <param name="colors|color_configuration" value="brewer" />
            <param name="colors|palette_type" value="diverging" />
            <param name="colors|palette_type|palette" value="Spectral" />
            <output file="heatmap_out2.pdf" name="out_file1" />
        </test>
    </tests>
    <help>

.. class:: infomark

**What it does**

This tool uses the 'heatmap' function from R statistical package to draw heatmap using numeric data values contained in columns of a dataset.

-----

.. class:: warningmark

If "Remove NA" option is not set to "yes", this tool skips entire rows/columns with non-numeric data

-----

**Example**

Input file::

    chromosome GC           telo        fRec    SNP
    1          38.6381  51797179        1.0662  0.012289
    2          38.8651  31413753        1.2255  0.008923
    3          41.4730  26482501        1.6308  0.015474
    4          44.9184  12412377        1.4997  0.022099
    5          39.4870  34991501        1.4439  0.013091
    6          38.3041  20816323        1.4700  0.014043

Below is a heatmap using columns 2 to 5 from the above data, with centering and scaling by column:

.. image:: ./static/operation_icons/heatmap_output.png

    </help>
    <citations>
        <citation type="bibtex">
            @Manual{,
                title = {R: A Language and Environment for Statistical Computing},
                author = {{R Core Team}},
                organization = {R Foundation for Statistical Computing},
                address = {Vienna, Austria},
                year = {2014},
                url = {http://www.r-project.org/},
            }
        </citation>
    </citations>
</tool>
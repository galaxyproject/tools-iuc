<tool id="staramr_search" name="staramr" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Scans genome assemblies against the ResFinder, PlasmidFinder, and PointFinder databases searching for AMR genes</description>
    <macros>
        <token name="@TOOL_VERSION@">0.11.1</token>
        <token name="@VERSION_SUFFIX@">0</token>
        <token name="@PROFILE@">24.1</token>
        <xml name="element_assert" token_name="" token_text="">
            <element name="@NAME@">
                <assert_contents>
                    <has_text text="@TEXT@"/>
                    <yield/>
                </assert_contents>
            </element>
        </xml>
    </macros>
    <xrefs>
        <xref type="bio.tools">staramr</xref>
    </xrefs>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">staramr</requirement>
        <!-- The staramr conda package includes the mlst software, but the list of schemes 
        changes depending on the version. I specify the exact version here to make sure
        the list of schemes provided is consistent -->
        <requirement type="package" version="2.23.0">mlst</requirement>
    </requirements>
    <version_command>staramr --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
#import re
#set ext = '.fasta'
#set $named_genomes = ''
#for $genome in $genomes
    #set $_named_genome = re.sub(r'(\s|\(|\)|\/)', '_', str($genome.element_identifier)) + $ext
    ln -s '$genome' $_named_genome &&
    #set $named_genomes = $named_genomes + ' ' + $_named_genome
#end for

export GIT_CONFIG_COUNT=1 GIT_CONFIG_KEY_0=safe.directory GIT_CONFIG_VALUE_0=* &&
##Used only for test 
#if str($hide_db_build) == 'true':
staramr db build 
    --dir resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502
    --resfinder-commit d1e607b
    --pointfinder-commit 694919f
    --plasmidfinder-commit 3e77502 &&
#end if
##

staramr search

    -d '$staramr_db_select.fields.path'
    --nprocs "\${GALAXY_SLOTS:-1}"

    --genome-size-lower-bound $advanced.genome_size_lower_bound
    --genome-size-upper-bound $advanced.genome_size_upper_bound
    --minimum-N50-value $advanced.minimum_N50_value
    --minimum-contig-length $advanced.minimum_contig_length
    --unacceptable-number-contigs $advanced.unacceptable_number_contigs

    --pid-threshold $advanced.pid_threshold
    --percent-length-overlap-resfinder $advanced.percent_length_overlap_resfinder
    --percent-length-overlap-plasmidfinder $advanced.percent_length_overlap_plasmidfinder
    --percent-length-overlap-pointfinder $advanced.percent_length_overlap_pointfinder

#if str($advanced.mlst_scheme) != 'auto':
    --mlst-scheme '${advanced.mlst_scheme}'
#end if

$advanced.report_all_blast
$advanced.exclude_negatives
$advanced.exclude_resistance_phenotypes

#if str($advanced.exclude_genes.exclude_genes_condition) == 'custom'
    --exclude-genes-file '${advanced.exclude_genes.exclude_genes_file}'
#elif str($advanced.exclude_genes.exclude_genes_condition) == 'none'
    --no-exclude-genes
#end if

#if $advanced.complex_mutations_file
    --complex-mutations-file '$advanced.complex_mutations_file'
#end if

#if str($advanced.plasmidfinder_type) != 'include_all'
    --plasmidfinder-database-type '${advanced.plasmidfinder_type}'
#end if

    --output-summary '$summary'
    --output-detailed-summary '$detailed_summary'
    --output-resfinder '$resfinder'
    --output-plasmidfinder '$plasmidfinder'
    --output-settings '$settings'
    --output-excel results.xlsx
    --output-mlst '$mlst'

    --output-hits-dir staramr_hits

#if str($pointfinder_organism) != 'disabled'
    --output-pointfinder '$pointfinder'
    --pointfinder-organism '${pointfinder_organism}'
#end if

$named_genomes
#if str($hide_db_build) == 'true':
    && rm -r resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502
#end if
    ]]></command>
    <inputs>
        <param name="hide_db_build" type="hidden" value=""/>
        <param type="data" name="genomes" format="fasta" multiple="true"/>
        <param name="staramr_db_select" type="select" label="starAMR database">
            <options from_data_table="staramr_database">
                <validator message="No starAMR database is available" type="no_options"/>
            </options>
        </param>
        <param argument="--pointfinder-organism" type="select" label="Enable scanning for point mutations using the PointFinder database" help="You can select one of the unvalidated PointFinder organisms to use for scanning for point mutations. These have not been fully validated as compatible with staramr so caution is recommended when interpreting results.">
            <option value="disabled" selected="true">Disable PointFinder</option>
            <option value="campylobacter">Campylobacter (campylobacter)</option>
            <option value="enterococcus_faecalis">Enterococcus faecalis (enterococcus_faecalis)</option>
            <option value="enterococcus_faecium">Enterococcus faecium (enterococcus_faecium)</option>
            <option value="escherichia_coli">Escherichia coli (escherichia_coli)</option>
            <option value="helicobacter_pylori">Helicobacter pylori (helicobacter_pylori)</option>
            <option value="salmonella">Salmonella (salmonella)</option>
            <!-- This option provides the ability to select among a number of custom/unvalidated PointFinder organisms -->
            <option value="klebsiella">Unvalidated: Klebsiella (klebsiella) </option>
            <option value="mycobacterium_tuberculosis">Unvalidated: Mycobacterium tuberculosis (mycobacterium_tuberculosis)</option>
            <option value="neisseria_gonorrhoeae">Unvalidated: Neisseria gonorrhoeae (neisseria_gonorrhoeae)</option>
            <option value="plasmodium_falciparum">Unvalidated: Plasmodium falciparum (plasmodium_falciparum)</option>
            <option value="staphylococcus_aureus">Unvalidated: Staphylococcus aureus (staphylococcus_aureus)</option>
        </param>
        <section name="advanced" title="Advanced options" expanded="false">
            <param argument="--pid-threshold" type="float" label="Percent identity threshold for BLAST" value="98.0" min="0" max="100"/>
            <param argument="--percent-length-overlap-resfinder" type="float" label="Percent length overlap of BLAST hit for ResFinder database" value="60.0" min="0" max="100"/>
            <param argument="--percent-length-overlap-pointfinder" type="float" label="Percent length overlap of BLAST hit for PointFinder database" value="95.0" min="0" max="100"/>
            <param argument="--percent-length-overlap-plasmidfinder" type="float" label="Percent length overlap of BLAST hit for PlasmidFinder database" value="60.0" min="0" max="100"/>
            <param argument="--genome-size-lower-bound" type="integer" label="The lower bound for our genome size for the quality metrics" value="4000000" min="0"/>
            <param argument="--genome-size-upper-bound" type="integer" label="The upper bound for our genome size for the quality metrics" value="6000000" min="0"/>
            <param argument="--minimum-N50-value" type="integer" label="The minimum N50 value for the quality metrics" value="10000" min="0"/>
            <param argument="--minimum-contig-length" type="integer" label="The minimum contig length for the quality metrics" value="300" min="0"/>
            <param argument="--unacceptable-number-contigs" type="integer" label="The number of contigs, under the minimum contig length which is unacceptable for the quality metrics" value="1000" min="0"/>
            <param argument="--report-all-blast" type="boolean" label="Report all BLAST results" truevalue="--report-all-blast" falsevalue="" help="Report all BLAST results (includes overlapping hits, mainly for debugging)"/>
            <param argument="--exclude-negatives" type="boolean" label="Exclude negative (non-resistant) results" truevalue="--exclude-negatives" falsevalue=""/>
            <param argument="--exclude-resistance-phenotypes" type="boolean" label="Exclude resistance phenotypes" truevalue="--exclude-resistance-phenotypes" falsevalue=""/>
            <param argument="--mlst-scheme" type="select" label="MLST Scheme">
                <option value="auto" selected="true">Automatic</option>
                <option value="aactinomycetemcomitans">Aggregatibacter actinomycetemcomitans (aactinomycetemcomitans)</option>
                <option value="abaumannii">Acinetobacter baumannii (abaumannii)</option>
                <option value="abaumannii_2">Acinetobacter baumannii 2 (abaumannii_2)</option>
                <option value="achromobacter">Achromobacter (achromobacter)</option>
                <option value="aeromonas">Aeromonas (aeromonas)</option>
                <option value="aphagocytophilum">Anaplasma phagocytophilum (aphagocytophilum)</option>
                <option value="arcobacter">Arcobacter (arcobacter)</option>
                <option value="bbacilliformis">Bartonella bacilliformis (bbacilliformis)</option>
                <option value="bcc">Burkholderia cepacia Complex (bcc)</option>
                <option value="bcereus">Bacille cereus (bcereus)</option>
                <option value="bfragilis">Bacteroides fragilis (bfragilis)</option>
                <option value="bhenselae">Bartonella henselae (bhenselae)</option>
                <option value="blicheniformis_14">Bacillus licheniformis 14 (blicheniformis_14)</option>
                <option value="bordetella_3">Bordetella 3 (bordetella_3)</option>
                <option value="borrelia">Borrelia (borrelia)</option>
                <option value="bpseudomallei">Burkholderia pseudomallei (bpseudomallei)</option>
                <option value="brachyspira">Brachyspira (brachyspira)</option>
                <option value="brachyspira_2">Brachyspira 2 (brachyspira_2)</option>
                <option value="brachyspira_3">Brachyspira 3 (brachyspira_3)</option>
                <option value="brachyspira_4">Brachyspira 4 (brachyspira_4)</option>
                <option value="brachyspira_5">Brachyspira 5 (brachyspira_5)</option>
                <option value="brucella">Brucella (brucella)</option>
                <option value="bsubtilis">Bacillus subtilis (bsubtilis)</option>
                <option value="bwashoensis">Bartonella washoensis (bwashoensis)</option>
                <option value="campylobacter">Campylobacter (campylobacter)</option>
                <option value="campylobacter_nonjejuni">Campylobacter non-jejuni (campylobacter_nonjejuni)</option>
                <option value="campylobacter_nonjejuni_2">Campylobacter non-jejuni 2 (campylobacter_nonjejuni_2)</option>
                <option value="campylobacter_nonjejuni_3">Campylobacter non-jejuni 3 (campylobacter_nonjejuni_3)</option>
                <option value="campylobacter_nonjejuni_4">Campylobacter non-jejuni 4 (campylobacter_nonjejuni_4)</option>
                <option value="campylobacter_nonjejuni_5">Campylobacter non-jejuni 5 (campylobacter_nonjejuni_5)</option>
                <option value="campylobacter_nonjejuni_6">Campylobacter non-jejuni 6 (campylobacter_nonjejuni_6)</option>
                <option value="campylobacter_nonjejuni_7">Campylobacter non-jejuni 7 (campylobacter_nonjejuni_7)</option>
                <option value="campylobacter_nonjejuni_8">Campylobacter non-jejuni 8 (campylobacter_nonjejuni_8)</option>
                <option value="campylobacter_nonjejuni_9">Campylobacter non-jejuni 9 (campylobacter_nonjejuni_9)</option>
                <option value="cbotulinum">Clostridium botulinum (cbotulinum)</option>
                <option value="cdifficile">Clostridioides difficile (cdifficile)</option>
                <option value="cfreundii">Citrobacter freundii (cfreundii)</option>
                <option value="chlamydiales">Chlamydiales (chlamydiales)</option>
                <option value="cmaltaromaticum">Carnobacterium maltaromaticum (cmaltaromaticum)</option>
                <option value="cperfringens">Clostridium perfringens (cperfringens)</option>
                <option value="cronobacter">Cronobacter (cronobacter)</option>
                <option value="csepticum">Clostridium septicum (csepticum)</option>
                <option value="diphtheria_3">Diphtheria 3 (diphtheria_3)</option>
                <option value="dnodosus">Dichelobacter nodosus (dnodosus)</option>
                <option value="ecloacae">Enterobacter cloacae (ecloacae)</option>
                <option value="ecoli">Escherichia coli (ecoli)</option>
                <option value="ecoli_achtman_4">Escherichia coli Achtman 4 (ecoli_achtman_4)</option>
                <option value="edwardsiella">Edwardsiella (edwardsiella)</option>
                <option value="efaecalis">Enterococcus faecalis (efaecalis)</option>
                <option value="efaecium">Enterococcus faecium (efaecium)</option>
                <option value="fpsychrophilum">Flavobacterium psychrophilum (fpsychrophilum)</option>
                <option value="gallibacterium">Gallibacterium (gallibacterium)</option>
                <option value="geotrichum">Geotrichum (geotrichum)</option>
                <option value="hcinaedi">Helicobacter cinaedi (hcinaedi)</option>
                <option value="helicobacter">Helicobacter (helicobacter)</option>
                <option value="hinfluenzae">Haemophilus influenzae (hinfluenzae)</option>
                <option value="hparasuis">Haemophilus Parasuis (hparasuis)</option>
                <option value="hsuis">Helicobacter suis (hsuis)</option>
                <option value="kaerogenes">Klebsiella aerogenes (kaerogenes)</option>
                <option value="kingella">Kingella (kingella)</option>
                <option value="klebsiella">Klebsiella (klebsiella)</option>
                <option value="koxytoca">Klebsiella oxytoca (koxytoca)</option>
                <option value="leptospira">Leptospira (leptospira)</option>
                <option value="leptospira_2">Leptospira 2 (leptospira_2)</option>
                <option value="leptospira_3">Leptospira 3 (leptospira_3)</option>
                <option value="liberibacter">Liberibacter (liberibacter)</option>
                <option value="listeria_2">Listeria (listeria_2)</option>
                <option value="llactis_phage">Lactococcus lactis phage (llactis_phage)</option>
                <option value="lsalivarius">Lactobacillus salivarius (lsalivarius)</option>
                <option value="mabscessus">Mycobacterium abscessus (mabscessus)</option>
                <option value="magalactiae">Mycoplasma agalactiae (magalactiae)</option>
                <option value="manserisalpingitidis">Mycoplasma anserisalpingitidis (manserisalpingitidis)</option>
                <option value="mbovis_2">Mycobacterium bovis 2 (mbovis_2)</option>
                <option value="mcanis">Microsporum canis (mcanis)</option>
                <option value="mcaseolyticus">Macrococcus caseolyticus (mcaseolyticus)</option>
                <option value="mcatarrhalis_achtman_6">Moraxella catarrhalis Achtman 6 (mcatarrhalis_achtman_6)</option>
                <option value="mflocculare">(Mycoplasma flocculare)</option>
                <option value="mgallisepticum">Mycoplasma gallisepticum (mgallisepticum)</option>
                <option value="mgallisepticum_2">Mycoplasma gallisepticum 2 (mgallisepticum_2)</option>
                <option value="mhaemolytica">Mannheimia haemolytica (mhaemolytica)</option>
                <option value="mhominis_3">Mycoplasme hominis 3 (mhominis_3)</option>
                <option value="mhyopneumoniae">Mycoplasma hyopneumoniae (mhyopneumoniae)</option>
                <option value="mhyorhinis">Mycoplasma hyorhinis (mhyorhinis)</option>
                <option value="miowae">Mycoplasma iowae (miowae)</option>
                <option value="mplutonius">Melissococcus plutonius (mplutonius)</option>
                <option value="mpneumoniae">Mycoplasma pneumoniae (mpneumoniae)</option>
                <option value="msciuri">Mammaliicoccus sciuri (msciuri)</option>
                <option value="msynoviae">Mycoplasma synoviae (msynoviae)</option>
                <option value="mycobacteria_2">Mycobacteria 2 (mycobacteria_2)</option>
                <option value="neisseria">Neisseria (neisseria)</option>
                <option value="oralstrep">Oral Streptococcus (oralstrep)</option>
                <option value="orhinotracheale">Ornithobacterium rhinotracheale (orhinotracheale)</option>
                <option value="otsutsugamushi">Orientia tsutsugamushi (otsutsugamushi)</option>
                <option value="pacnes_3">Propionibacterium acnes 3 (pacnes_3)</option>
                <option value="paeruginosa">Pseudomonas aeruginosa (paeruginosa)</option>
                <option value="pdamselae">Photobacterium damselae (pdamselae)</option>
                <option value="pfluorescens">Pseudomonas fluorescens (pfluorescens)</option>
                <option value="pgingivalis">Porphyromonas gingivalis (pgingivalis)</option>
                <option value="plarvae">Paenibacillus larvae (plarvae)</option>
                <option value="pmultocida">Pasteurella multocida (pmultocida)</option>
                <option value="pmultocida_2">Pasteurella multocida 2 (pmultocida_2)</option>
                <option value="ppentosaceus">Pediococcus pentosaceus (ppentosaceus)</option>
                <option value="pputida">Pseudomonas putida (pputida)</option>
                <option value="psalmonis">Piscirickettsia salmonis (psalmonis)</option>
                <option value="ranatipestifer">Riemerella anatipestifer (ranatipestifer)</option>
                <option value="rhodococcus">Rhodococcus (rhodococcus)</option>
                <option value="sagalactiae">Streptococcus agalactiae (sagalactiae)</option>
                <option value="saureus">Staphylococcus aureus (saureus)</option>
                <option value="sbsec">Streptococcus bovis / Streptococcus equinus complex (sbsec)</option>
                <option value="scanis">Streptococcus canis (scanis)</option>
                <option value="schromogenes">Staphylococcus chromogenes (schromogenes)</option>
                <option value="sdysgalactiae">Streptococcus dysgalactiae (sdysgalactiae)</option>
                <option value="senterica_achtman_2">Salmonella enterica Achtman 2 (senterica_achtman_2)</option>
                <option value="sepidermidis">Staphylococcus epidermidis (sepidermidis)</option>
                <option value="sgallolyticus">Streptococcus gallolyticus (sgallolyticus)</option>
                <option value="shaemolyticus">Staphylococcus haemolyticus (shaemolyticus)</option>
                <option value="shewanella">Shewanella (shewanella)</option>
                <option value="shominis">Staphylococcus hominis (shominis)</option>
                <option value="sinorhizobium">Sinorhizobium (sinorhizobium)</option>
                <option value="smaltophilia">Stenotrophomonas maltophilia (smaltophilia)</option>
                <option value="spneumoniae">Streptococcus pneumoniae (spneumoniae)</option>
                <option value="spseudintermedius">Staphylococcus pseudintermedius (spseudintermedius)</option>
                <option value="spyogenes">Streptococcus pyogenes (spyogenes)</option>
                <option value="ssuis">Streptococcus suis (ssuis)</option>
                <option value="staphlugdunensis">Staphylocoque lugdunensis (staphlugdunensis)</option>
                <option value="sthermophilus">Streptococcus thermophilus (sthermophilus)</option>
                <option value="streptomyces">Streptomyces (streptomyces)</option>
                <option value="streptothermophilus">Streptococcus thermophilus (streptothermophilus)</option>
                <option value="suberis">Streptococcus uberis (suberis)</option>
                <option value="szooepidemicus">Streptococcus zooepidemicus (szooepidemicus)</option>
                <option value="taylorella">Taylorella (taylorella)</option>
                <option value="tenacibaculum">Tenacibaculum (tenacibaculum)</option>
                <option value="tpallidum">Treponema pallidum (tpallidum)</option>
                <option value="ureaplasma">Ureaplasma (ureaplasma)</option>
                <option value="vcholerae">Vibrio cholerae(vcholerae)</option>
                <option value="vcholerae_2">Vibrio cholerae 2 (vcholerae_2)</option>
                <option value="vibrio">Vibrio (vibrio)</option>
                <option value="vparahaemolyticus">Vibrio parahaemolyticus (vparahaemolyticus)</option>
                <option value="vtapetis">Vibrio tapetis (vtapetis)</option>
                <option value="vvulnificus">Vibrio vulnificus (vvulnificus)</option>
                <option value="wolbachia">Wolbachia (wolbachia)</option>
                <option value="xfastidiosa">Xylella fastidiosa (xfastidiosa)</option>
                <option value="ypseudotuberculosis_achtman_3">Yersinia pseudotuberculosis Achtman 3 (ypseudotuberculosis_achtman_3)</option>
                <option value="yruckeri">Yersina ruckeri (yruckeri)</option>
            </param>
            <conditional name="exclude_genes">
                <param name="exclude_genes_condition" type="select" label="Exclude certain AMR genes from the results">
                    <option value="default" selected="true">Exclude default list of AMR genes</option>
                    <option value="custom">Provide a custom list of AMR genes to exclude</option>
                    <option value="none">Do not exclude any AMR genes</option>
                </param>
                <when value="default"/>
                <when value="custom">
                    <param type="data" name="exclude_genes_file" format="txt,tabular" label="Exclude genes file" help="Pass a file containing a list of genes to exclude from the ResFinder/PointFinder results"/>
                </when>
                <when value="none"/>
            </conditional>
            <param type="data" name="complex_mutations_file" format="txt,tabular" label="Complex mutations file" optional="true" help="Pass a file containing a list of complex mutations to group (if present) in the PointFinder results"/>
            <param name="plasmidfinder_type" type="select" label="Specify PlasmidFinder Database type">
                <option value="include_all" selected="true">Include all available database types</option>
                <option value="gram_positive">Gram Positive</option>
                <option value="enterobacteriaceae">Enterobacteriaceae</option>
            </param>
        </section>
        <section name="output_files" title="Selection of the output files" expanded="true">
            <param name="output_selection" type="select" display="checkboxes" multiple="true" label="Output files selection">
                <option value="mlst_table" selected="true">MLST report</option>
                <option value="summary_table" selected="true">AMR genes/mutations summary</option>
                <option value="detailed_summary_table" selected="true">AMR genes/mutations/plasmids detailed summary</option>
                <option value="resfinder_table" selected="true">AMR gene report from ResFinder</option>
                <option value="plasmidfinder_table" selected="true">AMR gene report from PlasmidFinder</option>
                <option value="pointfinder_table" selected="true">AMR gene report from PointFinder</option>
                <option value="settings_output" selected="false">Settings file</option>
                <option value="excel_output" selected="false">Excel spreadsheet</option>
            </param>
        </section>
    </inputs>
    <outputs>
        <data format="tabular" name="mlst" label="${tool.name} on ${on_string}: MLST report">
            <filter>output_files['output_selection'] and "mlst_table" in output_files['output_selection']</filter>
        </data>
        <data format="tabular" name="summary" label="${tool.name} on ${on_string}: AMR genes/mutations summary">
            <filter>output_files['output_selection'] and "summary_table" in output_files['output_selection']</filter>
        </data>
        <data format="tabular" name="detailed_summary" label="${tool.name} on ${on_string}: AMR genes/mutations/plasmids detailed summary">
            <filter>output_files['output_selection'] and "detailed_summary_table" in output_files['output_selection']</filter>
        </data>
        <data format="tabular" name="resfinder" label="${tool.name} on ${on_string}: AMR gene report from ResFinder">
            <filter>output_files['output_selection'] and "resfinder_table" in output_files['output_selection']</filter>
        </data>
        <data format="tabular" name="plasmidfinder" label="${tool.name} on ${on_string}: AMR plasmid type report from PlasmidFinder">
            <filter>output_files['output_selection'] and "plasmidfinder_table" in output_files['output_selection']</filter>
        </data>
        <data format="tabular" name="pointfinder" label="${tool.name} on ${on_string}: AMR point mutation report from PointFinder">
            <filter>output_files['output_selection'] and "pointfinder_table" in output_files['output_selection'] and pointfinder_organism != "disabled"</filter>
        </data>
        <data format="txt" name="settings" label="${tool.name} on ${on_string}: Settings file">
            <filter>output_files['output_selection'] and "settings_output" in output_files['output_selection']</filter>
        </data>
        <data format="xlsx" name="excel" from_work_dir="results.xlsx" label="${tool.name} on ${on_string}: Excel spreadsheet">
            <filter>output_files['output_selection'] and "excel_output" in output_files['output_selection']</filter>
        </data>
        <collection name="blast_hits" type="list" label="${tool.name} on ${on_string}: BLAST hits">
            <discover_datasets pattern="__name_and_ext__" directory="staramr_hits"/>
        </collection>
    </outputs>
    <tests>
        <test expect_num_outputs="9">
            <!-- TEST_1 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="16S-rc_gyrA-rc_beta-lactam.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="salmonella"/>
            <section name="advanced">
                <param name="pid_threshold" value="98.0"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="default"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,pointfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="16S-rc_gyrA-rc_beta-lactam.fsa"/>
                </assert_contents>
            </output>
            <output name="detailed_summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Resistance"/>
                </assert_contents>
            </output>
            <output name="resfinder" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Subclass B1"/>
                </assert_contents>
            </output>
            <output name="plasmidfinder" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Length/Total"/>
                </assert_contents>
            </output>
            <output name="pointfinder" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Predicted Phenotype"/>
                </assert_contents>
            </output>
            <output_collection name="blast_hits" type="list" count="2">
                <expand macro="element_assert" name="pointfinder_16S-rc_gyrA-rc_beta-lactam.fsa" text="contig: 16S_rrsD, contig_start: 4317"/>
                <expand macro="element_assert" name="resfinder_16S-rc_gyrA-rc_beta-lactam.fsa" text="contig_end: 5121, database_gene_start: 1"/>
            </output_collection>
        </test>
        <test expect_num_outputs="9">
            <!-- TEST_2 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="16S-rc_gyrA-rc_beta-lactam.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="escherichia_coli"/>
            <section name="advanced">
                <param name="pid_threshold" value="98.0"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="default"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,pointfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Amoxicillin"/>
                </assert_contents>
            </output>
            <output name="detailed_summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="MLST"/>
                </assert_contents>
            </output>
            <output name="resfinder" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Subclass B1"/>
                </assert_contents>
            </output>
            <output name="plasmidfinder" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Length/Total"/>
                </assert_contents>
            </output>
            <output name="pointfinder" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="CGE Predicted Phenotype"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="8">
            <!-- TEST_3 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="16S-rc_gyrA-rc_beta-lactam.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="disabled"/>
            <section name="advanced">
                <param name="pid_threshold" value="98.0"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="default"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Quality Module Feedback"/>
                </assert_contents>
            </output>
            <output name="resfinder" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="blaIMP-42"/>
                </assert_contents>
            </output>
            <output_collection name="blast_hits" type="list" count="1">
                <expand macro="element_assert" name="resfinder_16S-rc_gyrA-rc_beta-lactam.fsa" text="database_gene_end: 741"/>
            </output_collection>
        </test>
        <test expect_num_outputs="8">
            <!-- TEST_4 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="16S-rc_gyrA-rc_beta-lactam.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="disabled"/>
            <section name="advanced">
                <param name="pid_threshold" value="98.0"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="listeria_2"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="default"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,settings_output,excel_output"/>
            </section>
            <output name="mlst" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="listeria_2"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="8">
            <!-- TEST_5 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="16S-rc_gyrA-rc_beta-lactam.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="disabled"/>
            <section name="advanced">
                <param name="pid_threshold" value="99.8"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="default"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="5220"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="8">
            <!-- TEST_6 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="16S rc_gyrA rc_beta-lactam spaces (extra:characters).fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="disabled"/>
            <section name="advanced">
                <param name="pid_threshold" value="99.8"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="default"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="16S_rc_gyrA_rc_beta-lactam_spaces__extra:characters_.fsa"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="8">
            <!-- TEST_7 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="test-aminoglycoside.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="disabled"/>
            <section name="advanced">
                <param name="pid_threshold" value="98.0"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="default"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="438"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="8">
            <!-- TEST_8 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="test-aminoglycoside.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="disabled"/>
            <section name="advanced">
                <param name="pid_threshold" value="98.0"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="none"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Amikacin"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="8">
            <!-- TEST_9 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="test-aminoglycoside.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="disabled"/>
            <section name="advanced">
                <param name="pid_threshold" value="98.0"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="4000000"/>
                <param name="genome_size_upper_bound" value="6000000"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="custom"/>
                    <param name="exclude_genes_file" value="genes_to_exclude.tsv"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="438"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="8">
            <!-- TEST_10 -->
            <param name="hide_db_build" value="true"/>
            <param name="genomes" value="test-aminoglycoside.fsa" ftype="fasta"/>
            <param name="staramr_db_select" value="staramr_downloaded_20112024_resfinder_d1e607b_pointfinder_694919f_plasmidfinder_3e77502"/>
            <param name="pointfinder_organism" value="disabled"/>
            <section name="advanced">
                <param name="pid_threshold" value="98.0"/>
                <param name="percent_length_overlap_resfinder" value="60.0"/>
                <param name="percent_length_overlap_pointfinder" value="95.0"/>
                <param name="percent_length_overlap_plasmidfinder" value="60.0"/>
                <param name="genome_size_lower_bound" value="1"/>
                <param name="genome_size_upper_bound" value="10"/>
                <param name="minimum_N50_value" value="10000"/>
                <param name="minimum_contig_length" value="300"/>
                <param name="unacceptable_number_contigs" value="1000"/>
                <param name="report_all_blast" value="False"/>
                <param name="exclude_negatives" value="False"/>
                <param name="exclude_resistance_phenotypes" value="False"/>
                <param name="mlst_scheme" value="auto"/>
                <conditional name="exclude_genes">
                    <param name="exclude_genes_condition" value="default"/>
                </conditional>
                <param name="plasmidfinder_type" value="include_all"/>
            </section>
            <section name="output_files">
                <param name="output_selection" value="mlst_table,summary_table,detailed_summary_table,resfinder_table,plasmidfinder_table,settings_output,excel_output"/>
            </section>
            <output name="summary" ftype="tabular">
                <assert_contents>
                    <has_text_matching expression="Genome length is not within the acceptable length range \[1,10\]"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
staramr
=======

staramr_ scans bacterial genome contigs against both the ResFinder_, PlasmidFinder_ and PointFinder_ databases (used by their respective webservices_) and compiles a summary report of detected antimicrobial resistance genes.

Usage
-----

1. Select your genome contigs (in FASTA format).
2. Select whether or not you wish to scan your genome for point mutations giving antimicrobial resistance using the PointFinder database. This requires you to specify the specific organism you are scanning.
3. Run the tool.

Input
-----

Genomes
```````

staramr_ takes as input one or more assembled genomes (in FASTA format) to search for AMR genes.

Exclude genes file
``````````````````

Setting **Provide a custom list of AMR genes to exclude** in the **Advanced options** allows you to pass a file containing a list of genes to exclude from the results. The file must start with a line **#gene_id** and the gene names must correspond to the sequence IDs in the ResFinder/PointFinder databases.  For example:

::

    #gene_id
    aac(6')-Iaa_1_NC_003197
    ColpVC_1__JX133088

Complex mutations file
``````````````````````

Complex mutations describe multiple point mutations that must be simultaneously present in order to confer resistance. Complex mutations may be specified by the user using a TSV-formatted file with the following format:

::

    positions    mandatory    phenotype
    mutation(s)  mutation(s)  phenotype

Where "positions" are all the point mutations to group into the complex mutation (optional and mandatory), "mandatory" are all the point mutations that must be present for the complex mutation to be reported (mandatory is a subset of positions), and phenotype is the phenotype that is conferred when this set of mutations is present.

Output
------

There are 6 different output files produced by `staramr` as well as a collection of additional files.

mlst.tsv
````````````````````

A tabular file of each multi-locus sequence type (MLST) and it's corresponding locus/alleles, one genome per line.


   * Isolate ID: The id of the isolate/genome file(s) passed to staramr.
   * Scheme: The scheme that MLST has identified.
   * Sequence Type: The sequence type that's assigned when combining all allele types
   * Locus #: A particular locus in the specified MLST scheme.

Example :
````````````````````
+------------+---------------------+---------------+---------+---------+---------+---------+---------+---------+----------+
| Isolate ID | Scheme              | Sequence Type | Locus 1 | Locus 2 | Locus 3 | Locus 4 | Locus 5 | Locus 6 | Locus 7  |
+============+=====================+===============+=========+=========+=========+=========+=========+=========+==========+
| SRR1952908 | senterica_achtman_2 | 11            | aroC(5) | dnaN(2) | hemD(3) | hisD(7) | purE(6) | sucA(6) | thrA(11) |
| SRR1952926 | senterica_achtman_2 | 11            | aroC(5) | dnaN(2) | hemD(3) | hisD(7) | purE(6) | sucA(6) | thrA(11) |
+------------+---------------------+---------------+---------+---------+---------+---------+---------+---------+----------+


summary.tsv
```````````

The summary.tsv output file generated by staramr contains the following columns:

   * Isolate ID: The id of the isolate/genome file(s) passed to staramr.
   * Quality Module: The isolate/genome file(s) pass/fail result(s) for the quality metrics
   * Genotype: The AMR genotype of the isolate.
   * Predicted Phenotype: The predicted AMR phenotype (drug resistances) for the isolate.
   * CGE Predicted Phenotype: The CGE-predicted AMR phenotype (drug resistances) for the isolate.
   * Plasmid: Plasmid types that were found for the isolate.
   * Scheme: The MLST scheme used
   * Sequence Type: The sequence type that's assigned when combining all allele types
   * Genome Length: The isolate/genome file(s) genome length(s)
   * N50 value: The isolate/genome file(s) N50 value(s)
   * Number of Contigs Greater Than Or Equal To 300 bp: The number of contigs greater or equal to 300 base pair in the isolate/genome file(s)
   * Quality Module Feedback: The isolate/genome file(s) detailed feedback for the quality metrics

Example : 
```````````
+------------+----------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------+---------------------+---------------+---------------+-----------+---------------------------------------------------+-------------------------+
| Isolate ID | Quality Module | Genotype                                                  | Predicted Phenotype                                                                                       | CGE Predicted Phenotype                                                                                                                                                                   | Plasmid                                      | Scheme              | Sequence Type | Genome Length | N50 value | Number of Contigs Greater Than Or Equal To 300 bp | Quality Module Feedback |
+============+================+===========================================================+===========================================================================================================+===========================================================================================================================================================================================+==============================================+=====================+===============+===============+===========+===================================================+=========================+
| SRR1952908 | Passed         | aadA1, aadA2, blaTEM-57, cmlA1, gyrA (S83Y), sul3, tet(A) | streptomycin, ampicillin, chloramphenicol, ciprofloxacin I/R, nalidixic acid, sulfisoxazole, tetracycline | Spectinomycin, Streptomycin, Amoxicillin, Ampicillin, Cephalothin, Piperacillin, Ticarcillin, Chloramphenicol, Nalidixic acid, Ciprofloxacin, Sulfamethoxazole, Doxycycline, Tetracycline | ColpVC, IncFIB(S), IncFII(S), IncI1-I(Alpha) | senterica_achtman_2 | 11            | 4785500       | 250423    | 41                                                |                         |
| SRR1952926 | Passed         | blaTEM-57, gyrA (S83Y), tet(A)                            | ampicillin, ciprofloxacin I/R, nalidixic acid, tetracycline                                               | Amoxicillin, Ampicillin, Cephalothin, Piperacillin, Ticarcillin, Nalidixic acid, Ciprofloxacin, Doxycycline, Tetracycline                                                                 | ColpVC, IncFIB(S), IncFII(S), IncI1-I(Alpha) | senterica_achtman_2 | 11            | 4785451       | 228311    | 40                                                |                         |
+------------+----------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------+---------------------+---------------+---------------+-----------+---------------------------------------------------+-------------------------+


detailed_summary.tsv
````````````````````

A detailed summary of all detected AMR genes/mutations/plasmids in each genome/type, one gene/type per line.

   * Isolate ID: The id of the isolate/genome file(s) passed to staramr.
   * Data: The particular gene detected from ResFinder, PlasmidFinder, PointFinder, or the sequence type.
   * Data Type: The type of gene (Resistance or Plasmid), or MLST.
   * Predicted Phenotype: The predicted AMR phenotype (drug resistances) found in ResFinder/PointFinder. Plasmids will be left blank by default.
   * CGE Predicted Phenotype: The CGE-predicted AMR phenotype (drug resistances) found in ResFinder/PointFinder. Plasmids will be left blank by default.
   * %Identity: The % identity of the top BLAST HSP to the gene.
   * %Overlap: THe % overlap of the top BLAST HSP to the gene (calculated as hsp length/total length * 100).
   * HSP Length/Total Length The top BLAST HSP length over the gene total length (nucleotides).
   * Contig: The contig id containing this gene.
   * Start: The start of the gene (will be greater than End if on minus strand).
   * End: The end of the gene.
   * Accession: The accession of the gene from either ResFinder or PlasmidFinder database.

Example :
````````````````````
+------------+----------------------------+------------+---------------------+-----------------------------+-----------+----------+-------------------------+-------------+-------+------+-----------+
| Isolate ID | Data                       | Data Type  | Predicted Phenotype | CGE Predicted Phenotype     | %Identity | %Overlap | HSP Length/Total Length | Contig      | Start | End  | Accession |
+============+============================+============+=====================+=============================+===========+==========+=========================+=============+=======+======+===========+
| SRR1952908 | ST11 (senterica_achtman_2) | MLST       |                     |                             |           |          |                         |             |       |      |           |
| SRR1952908 | ColpVC                     | Plasmid    |                     |                             | 98.96     | 100.0    | 193/193                 | contig00038 | 1618  | 1426 | JX133088  |
| SRR1952908 | aadA1                      | Resistance | streptomycin        | Spectinomycin, Streptomycin | 100.0     | 100.0    | 792/792                 | contig00030 | 5355  | 4564 | JQ414041  |
+------------+----------------------------+------------+---------------------+-----------------------------+-----------+----------+-------------------------+-------------+-------+------+-----------+



resfinder.tsv
`````````````

A tabular file of each AMR gene and additional BLAST information from the **ResFinder** database, one gene per line.

   * Isolate ID: The id of the isolate/genome file(s) passed to staramr.
   * Gene: The particular AMR gene detected.
   * Predicted Phenotype: The predicted AMR phenotype (drug resistances) for this gene.
   * CGE Predicted Phenotype: The CGE-predicted AMR phenotype (drug resistances) for this gene.
   * %Identity: The % identity of the top BLAST HSP to the AMR gene.
   * %Overlap: THe % overlap of the top BLAST HSP to the AMR gene (calculated as hsp length/total length * 100).
   * HSP Length/Total Length The top BLAST HSP length over the AMR gene total length (nucleotides).
   * Contig: The contig id containing this AMR gene.
   * Start: The start of the AMR gene (will be greater than End if on minus strand).
   * End: The end of the AMR gene.
   * Accession: The accession of the AMR gene in the ResFinder database.
   * Sequence: The AMR Gene sequence
   * CGE Notes: Any CGE notes associated with the prediction.

Example :
`````````````
+------------+--------+---------------------+---------------------------+-----------+----------+-------------------------+-------------+-------+------+-----------+-----------+-----------+
| Isolate ID | Gene   | Predicted Phenotype | CGE Predicted Phenotype   | %Identity | %Overlap | HSP Length/Total Length | Contig      | Start | End  | Accession | Sequence  | CGE Notes |
+============+========+=====================+===========================+===========+==========+=========================+=============+=======+======+===========+===========+===========+
| SRR1952908 | sul3   | sulfisoxazole       | Sulfamethoxazole          | 100.00    | 100.00   | 792/792                 | contig00030 | 2091  | 2882 | AJ459418  | ATGA[...] |           |
| SRR1952908 | tet(A) | tetracycline        | Doxycycline, Tetracycline | 99.92     | 97.80    | 1247/1275               | contig00032 | 1476  | 2722 | AF534183  | ATGT[...] |           |
+------------+--------+---------------------+---------------------------+-----------+----------+-------------------------+-------------+-------+------+-----------+-----------+-----------+


plasmidfinder.tsv
`````````````````

A tabular file of each AMR plasmid type and additional BLAST information from the **PlasmidFinder** database, one plasmid type per line.


   * Isolate ID: The id of the isolate/genome file(s) passed to staramr.
   * Plasmid: The particular plasmid type detected.
   * %Identity: The % identity of the top BLAST HSP to the plasmid type.
   * %Overlap: The % overlap of the top BLAST HSP to the plasmid type (calculated as hsp length/total length * 100).
   * HSP Length/Total Length The top BLAST HSP length over the plasmid type total length (nucleotides).
   * Contig: The contig id containing this plasmid type.
   * Start: The start of the plasmid type (will be greater than End if on minus strand).
   * End: The end of the plasmid type.
   * Accession: The accession of the plasmid type in the PlasmidFinder database.

Example :
`````````````````
+------------+-----------+-----------+----------+-------------------------+-------------+-------+------+-----------+
| Isolate ID | Plasmid   | %Identity | %Overlap | HSP Length/Total Length | Contig      | Start | End  | Accession |
+============+===========+===========+==========+=========================+=============+=======+======+===========+
| SRR1952908 | ColpVC    | 98.96     | 100      | 193/193                 | contig00038 | 1618  | 1426 | JX133088  |
| SRR1952908 | IncFIB(S) | 98.91     | 100      | 643/643                 | contig00024 | 10302 | 9660 | FN432031  |
+------------+-----------+-----------+----------+-------------------------+-------------+-------+------+-----------+


pointfinder.tsv
```````````````

A tabular file of each AMR point mutation and additional BLAST information from the **PointFinder** database, one gene per line.
   * Isolate ID: The id of the isolate/genome file(s) passed to staramr.
   * Gene: The particular AMR gene detected, with the point mutation within.
   * Predicted Phenotype: The predicted AMR phenotype (drug resistances) for this gene.
   * CGE Predicted Phenotype: The CGE-predicted AMR phenotype (drug resistances) for this gene.
   * Type: The type of this mutation from PointFinder (either codon or nucleotide).
   * Position: The position of the mutation. For codon type, the position is the codon number in the gene, for nucleotide type it is the nucleotide number.
   * Mutation: The particular mutation. For codon type lists the codon mutation, for nucleotide type lists the single nucleotide mutation.
   * %Identity: The % identity of the top BLAST HSP to the AMR gene.
   * %Overlap: The % overlap of the top BLAST HSP to the AMR gene (calculated as hsp length/total length * 100).
   * HSP Length/Total Length The top BLAST HSP length over the AMR gene total length (nucleotides).
   * Contig: The contig id containing this AMR gene.
   * Start: The start of the AMR gene (will be greater than End if on minus strand).
   * End: The end of the AMR gene.
   * Pointfinder Position: The Pointfinder-adjusted position, which may be off by one from the sequence position in the case of some indels.
   * CGE Notes: Any CGE notes associated with the prediction.
   * CGE Required Mutation: Any additional mutations that CGE predicts are required to confer the CGE predicted phenotype.
   * CGE Mechanism: The CGE-reported mechanism.
   * CGE PMID: The PMID ID associated with the CGE prediction.

Example :
```````````````
+------------+-------------+-----------------------------------+------------------------------+-------+----------+---------------------+-----------+----------+-------------------------+-------------+--------+--------+----------------------+-----------+-----------------------+---------------------+------------------+
| Isolate ID | Gene        | Predicted Phenotype               | CGE Predicted Phenotype      | Type  | Position | Mutation            | %Identity | %Overlap | HSP Length/Total Length | Contig      | Start  | End    | Pointfinder Position | CGE Notes | CGE Required Mutation | CGE Mechanism       | CGE PMID         |
+============+=============+===================================+==============================+=======+==========+=====================+===========+==========+=========================+=============+========+========+======================+===========+=======================+=====================+==================+
| SRR1952908 | gyrA (S83Y) | ciprofloxacin I/R, nalidixic acid | Nalidixic acid,Ciprofloxacin | codon | 83       | TCC -> TAC (S -> Y) | 99.96     | 100.00   | 2637/2637               | contig00008 | 22801  | 20165  | S83Y                 |           |                       | Target modification | 7492118,10471553 |
| SRR1952926 | gyrA (S83Y) | ciprofloxacin I/R, nalidixic acid | Nalidixic acid,Ciprofloxacin | codon | 83       | TCC -> TAC (S -> Y) | 99.96     | 100.00   | 2637/2637               | contig00011 | 157768 | 160404 | S83Y                 |           |                       | Target modification | 7492118,10471553 |
+------------+-------------+-----------------------------------+------------------------------+-------+----------+---------------------+-----------+----------+-------------------------+-------------+--------+--------+----------------------+-----------+-----------------------+---------------------+------------------+


settings.txt
````````````

The command-line, database versions, and other settings used to run `staramr`.

::

    command_line                  = staramr search --pointfinder-organism enterococcus_faecium -o out pbp5.fa
    version                       = 0.10.0
    start_time                    = 2023-08-23 13:37:41
    end_time                      = 2023-08-23 13:37:42
    total_minutes                 = 0.02
    resfinder_db_dir              = staramr/databases/data/dist/resfinder
    resfinder_db_url              = https://bitbucket.org/genomicepidemiology/resfinder_db.git
    resfinder_db_commit           = fa32d9a3cf0c12ec70ca4e90c45c0d590ee810bd
    resfinder_db_date             = Tue, 24 May 2022 06:51
    pointfinder_db_dir            = staramr/databases/data/dist/pointfinder
    pointfinder_db_url            = https://bitbucket.org/genomicepidemiology/pointfinder_db.git
    pointfinder_db_commit         = 8c694b9f336153e6d618b897b3b4930961521eb8
    pointfinder_db_date           = Mon, 01 Feb 2021 15:46
    pointfinder_organisms_all     = campylobacter, enterococcus_faecalis, enterococcus_faecium, escherichia_coli, helicobacter_pylori, klebsiella, mycobacterium_tuberculosis, neisseria_gonorrhoeae, plasmodium_falciparum, salmonella, staphylococcus_aureus
    pointfinder_organisms_valid   = campylobacter, enterococcus_faecalis, enterococcus_faecium, escherichia_coli, helicobacter_pylori, salmonella
    plasmidfinder_db_dir          = staramr/databases/data/dist/plasmidfinder
    plasmidfinder_db_url          = https://bitbucket.org/genomicepidemiology/plasmidfinder_db.git
    plasmidfinder_db_commit       = c18e08c17a5988d4f075fc1171636e47546a323d
    plasmidfinder_db_date         = Wed, 18 Jan 2023 09:45
    mlst_version                  = 2.23.0
    pointfinder_organism          = enterococcus_faecium
    pointfinder_gene_drug_version = 072621.2
    resfinder_gene_drug_version   = 072621

results.xlsx
````````````

An Excel spreadsheet containing the previous 5 files as separate worksheets.

BLAST Hits
``````````

The dataset collection  **hits** stores fasta files of the specific blast hits.

.. _staramr: https://github.com/phac-nml/staramr
.. _ResFinder: https://bitbucket.org/genomicepidemiology/resfinder_db
.. _PlasmidFinder: https://bitbucket.org/genomicepidemiology/plasmidfinder_db
.. _PointFinder: https://bitbucket.org/genomicepidemiology/pointfinder_db
.. _webservices: http://www.genomicepidemiology.org/services/
    ]]></help>
    <citations>
        <citation type="doi">10.3390/microorganisms1002029</citation>
    </citations>
    <creator>
        <person givenName="Aaron" familyName="Petkau" identifier="apetkau" email="aaron.petkau@gmail.com"/>
        <person givenName="Jennifer" familyName="Tran" identifier="jennifertran" email="jennifer.tran101@gmail.com"/>
        <person givenName="Saskia" familyName="Hiltemann" identifier="shiltemann" email="saskia.hiltemann@gmail.com"/>
        <person givenName="Helena" familyName="Rasche" identifier="hexylena" email="hexylena@galaxians.org"/>
        <person givenName="Eric" familyName="Marinier" identifier="emarinier"/>
    </creator>
</tool>

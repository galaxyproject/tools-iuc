<tool id="trinotate" name="Trinotate" version="0.1.0">
    <requirements>
        <requirement type="package" version="3.0.1">trinotate</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
    <command><![CDATA[
wget --no-verbose "https://data.broadinstitute.org/Trinity/Trinotate_v3_RESOURCES/Trinotate_v3.sqlite.gz" -O Trinotate.sqlite.gz &&
gunzip Trinotate.sqlite.gz &&

Trinotate Trinotate.sqlite init --gene_trans_map "$gene_trans_map" --transcript_fasta $trinity --transdecoder_pep "$transdecoder" &&
Trinotate Trinotate.sqlite LOAD_swissprot_blastp "$blastp" &&
Trinotate Trinotate.sqlite LOAD_swissprot_blastx "$blastx" &&
Trinotate Trinotate.sqlite LOAD_pfam "$hmmscan" &&

#if $optional.tmhmm:
    Trinotate Trinotate.sqlite LOAD_tmhmm "$optional.tmhmm" &&
#end if
#if $optional.signalp:
    Trinotate Trinotate.sqlite LOAD_signalp "$optional.signalp" &&
#end if

Trinotate Trinotate.sqlite report $report_option.incl_pep $report_option.incl_trans > "$trinotate_out";

##TODO: option report -E
##TODO: option report --pfam_cutoff
    ]]></command>
    <inputs>
        <param name="trinity" type="data" format="fasta" optional="false" help="" />
        <param name="transdecoder" type="data" format="fasta" optional="false" help="" />
        <param name="gene_trans_map" type="data" format="tabular" optional="false" help="" />
        <param name="blastp" type="data" format="tabular" optional="false" help="" />
        <param name="blastx" type="data" format="tabular" optional="false" help="" />
        <param name="hmmscan" type="data" format="txt" optional="false" help="" />
        <section name="optional" title="Optional tools" expanded="True">
            <param name="tmhmm" type="data" format="tabular" optional="true" help="" />
            <param name="signalp" type="data" format="tabular" optional="true" help="" />
        </section>
        <section name="report_option" title="Report options" expanded="False">
            <param argument="--incl_pep" type="boolean" truevalue="--incl_pep" falsevalue="" checked="false" />
            <param argument="--incl_trans" type="boolean" truevalue="--incl_trans" falsevalue="" checked="false" />
        </section>
        <param name="keep_sqlite" type="boolean" truevalue="true" falsevalue="false" checked="false" />
    </inputs>
    <outputs>
        <data name="trinotate_out" format="tabular" label="Trinotate output" />
        <data name="trinotate_sqlite" format="tabular" from_work_dir="Trinotate.sqlite" label="Trinotate sqlite database" >
            <filter>keep_sqlite</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="trinity" ftype="fasta" value="Trinity.fasta" />
            <param name="transdecoder" ftype="fasta" value="Trinity.fasta.transdecoder.pep" />
            <param name="gene_trans_map" ftype="tabular" value="Trinity.fasta.gene_to_trans_map" />
            <param name="blastp" ftype="tabular" value="swissprot.blastp.outfmt6" />
            <param name="blastx" ftype="tabular" value="swissprot.blastx.outfmt6" />
            <param name="hmmscan" ftype="txt" value="TrinotatePFAM.out" />
            <section name="optional">
                <param name="tmhmm" ftype="tabular" value="tmhmm.out" />
                <param name="signalp" ftype="tabular" value="signalp.out" />
            </section>
            <output name="trinotate_out" file="trinotate_annotation_report.xls" />
        </test>
        <test>
            <param name="trinity" ftype="fasta" value="Trinity.fasta" />
            <param name="transdecoder" ftype="fasta" value="Trinity.fasta.transdecoder.pep" />
            <param name="gene_trans_map" ftype="tabular" value="Trinity.fasta.gene_to_trans_map" />
            <param name="blastp" ftype="tabular" value="swissprot.blastp.outfmt6" />
            <param name="blastx" ftype="tabular" value="swissprot.blastx.outfmt6" />
            <param name="hmmscan" ftype="txt" value="TrinotatePFAM.out" />
            <section name="report_option">
                <param name="incl_pep" value="true" />
                <param name="incl_trans" value="true" />
            </section>
            <param name="keep_sqlite" value="true" />
            <output name="trinotate_out" file="trinotate_annotation_report_minus_tmhmm_signalp.xls" />
        </test>
    </tests>
    <help><![CDATA[
https://trinotate.github.io/

 - Generate gene to transcript map for Trinity assembly (iuc/trinity_gene_to_trans_map)
Input: Trinity.fasta
 - TransDecoder (iuc/transdecoder)
Input: Trinity.fasta
 - blastp (devteam/ncbi_blast_plus)
Input: transdecoder.pep
Option: Protein BLAST database = swissprot_uniprot
Option: Output format = Tabular (standard 12 columns)
 - blastx (devteam/ncbi_blast_plus)
Input: Trinity.fasta
Option: Protein BLAST database = swissprot_uniprot
Option: Output format = Tabular (standard 12 columns)
 - HMMER hmmscan (iuc/hmmer_hmmscan)
Input: transdecoder.pep
Option: Output Formats = Table of per-domain hits (--domtblout)
Output : Table of per-domain hits ...
 - SignalP (peterjc/tmhmm_and_signalp)
Input: transdecoder.pep
 - TMHMM (peterjc/tmhmm_and_signalp)
Input: transdecoder.pep



    ]]></help>
    <citations>
        <citation type="doi">10.1038/nbt.1883</citation>
    </citations>
</tool>

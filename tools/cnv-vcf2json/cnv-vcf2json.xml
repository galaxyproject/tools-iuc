<tool id="cnv_vcf2json" name="CNV VCF2JSON" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="21.05">
    <description>Converts the CNVkit structural variants VCF file to JSON</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="creators"/>
    <command detect_errors="exit_code"><![CDATA[   
        #import re
        ln -s '$input_vcf_file' ./input.vcf &&
        cnv-vcf2json
            ./input.vcf
            #if $advanced_settings.assembly
                --assembly '$advanced_settings.assembly'
            #end if
            #if $advanced_settings.analysis
                --analysis '$advanced_settings.analysis'
            #end if
            #if $advanced_settings.individual
                --individual '$advanced_settings.individual'
            #end if
            #if $advanced_settings.sequence
                --sequence '$advanced_settings.sequence'
            #end if
            #if $advanced_settings.reference
                --reference '$advanced_settings.reference'
            #end if
            #if $advanced_settings.fusion
                --fusion '$advanced_settings.fusion'
            #end if
            -o output.json
    ]]></command>
    <inputs>
        <param name="input_vcf_file" type="data" format="vcf" label="CNVkit VCF file" help="The file Generated from CNVkit Export" />
        <section name="advanced_settings" title="Advanced settings" expanded="false">
            <param argument="--assembly" optional="true" type="text" label="Assembly Identifier" value="" help="" />
            <param argument="--analysis" optional="true" type="text" label="Analysis Identifier" value="" help="" />
            <param argument="--individual" optional="true" type="text" label="Individual Identifier" value="" help="" />
            <param argument="--sequence" optional="true" type="text" label="Variant Sequence" value="" help="" />
            <param argument="--reference" optional="true" type="text" label="Reference Sequence" value="" help="" />
            <param argument="--fusion" optional="true" type="text" label="Fusion Identifier" value="" help="" />
        </section>
    </inputs>
    <outputs>
        <data name="output_json" format="json" label="${tool.name} on ${on_string}: CNV JSON File" from_work_dir="output.json" />
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="input_vcf_file" ftype="vcf" value="input.vcf" />
            <output name="output_json" file="output.json" ftype="json" compare="sim_size" > 
                <assert_contents><has_size value="26000" delta="20000" /></assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
         The tool converts the structural variants VCF file generated from the CNVkit export subcommand into JSON file as a preprocessing step to import the data into Beacon2 MongoDB protocol
    ]]></help>
    <expand macro="citations"/>
</tool>

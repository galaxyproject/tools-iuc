<tool id="filter_anndata" name="Filter Observations in AnnData" version="0.1.0">
    <requirements>
        <requirement type="package" version="1.7.0">scanpy</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        python '$script_file'
]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[import scanpy as sc
adata = sc.read_h5ad('$adata_in')
#if '$filter_type' == 'not_equal_to'
adata = adata[adata.obs["$filter_key"] != "$filter_value", :]
#else if '$filter_type' == 'is_in'
#set $filter_value = ([x.strip() for x in str($filter_value).split(',')])
adata = adata[~adata.obs["$filter_key"].isin($filter_value), :]
#end if
adata.write("adata_out.h5ad")
]]></configfile>
    </configfiles>
    <inputs>
        <param name="adata_in" label="Annotated data matrix" type="data" format="h5ad"/>
        <param name="filter_key" label="Key to filter in observations (obs)" type="text"/>
        <param name="filter_type" label="Filter" type="select">
            <option value="not_equal_to">not equal to (!=)</option>
            <option value="is_in">is in (.isin)</option>
        </param>
        <param name="filter_value" label="Value" type="text"/>
    </inputs>
    <outputs>
        <data name="adata_out" format="h5ad" label="${tool.name} on ${on_string}" from_work_dir="adata_out.h5ad"/>
    </outputs>
    <tests>
        <test>
            <param name="adata_in" value="filter_anndata_in.h5ad"/>
            <param name="filter_key" value="chain_pairing"/>
            <param name="filter_type" value="not_equal_to"/>
            <param name="filter_value" value="multichain"/>
            <output name="adata_out" file="filter_anndata_out.h5ad"/>
        </test>
    </tests>
    <help><![CDATA[
This tool takes an AnnData object, filters it and then returns the filtered AnnData object. It currently supports the
'not equal to' filter which excludes any observations that are equal to a value, and the 'is in' filter which
filters out any observations that are not equal to one or more values.
    ]]></help>
    <citations>
        <citation type="bibtex">
}</citation>
    </citations>
</tool>
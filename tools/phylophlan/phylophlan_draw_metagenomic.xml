<tool id="phylophlan_draw_metagenomic" name="PhyloPhlAn: Visualize metagenomic SGBs as Heatmaps" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="biotools"/>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        phylophlan_draw_metagenomic
            -i '$input1'
            ## -o '$output1'
            --map '$input_mapping'
            --top $number
            -f $out_format
            --dpi $dpi
            --verbose
    ]]></command>
    <inputs>
        <param name="input1" type="data" format="tabular" argument="-i" label="Table of assigned SGBs"/>
        <param name="input_mapping" type="data" format="tabular" argument="--map" label="Metagenome labels" help='A mapping file that maps each bin to its metagenome'/>
        <param name="number" type="integer" min="1" value="20" argument="--top" label="Number of SGBs to display in the figure"/>
        <param name="out_format" type="select" argument="-f" label="Output image format">
            <option value="pdf">pdf</option>
            <option value="svg">svg</option>
            <option value="png">png</option>
        </param>
        <param argument="--dpi" type="integer" min="60" value="200" label="Output dpi"/>
    </inputs>
    <outputs>
        <data name="output1" format="data">
            <discover_datasets pattern="output_heatmap_(?P&lt;designation&gt;.*)\.pdf" format="pdf" visible="true" assign_primary_output="true" />
            <discover_datasets pattern="output_heatmap_(?P&lt;designation&gt;.*)\.svg" format="svg" visible="true" assign_primary_output="true" />
            <discover_datasets pattern="output_heatmap_(?P&lt;designation&gt;.*)\.png" format="png" visible="true" assign_primary_output="true" />
        </data>
    </outputs>
    <tests>
        <test>
            <param name="input1" value="output_metagenomic.tsv"/>
            <param name="input_mapping" value="bin2meta.tsv"/>
            <param name="number" value="20"/>
            <param name="out_format" value="png"/>
            <param name="dpi" value="100"/>
            <output name="output1" file="output_heatmap_counts.png" compare="image_diff">
                <discovered_dataset designation="pres_abs" ftype="png" value="output_heatmap_pres_abs.png" compare="image_diff"/>
            </output>
        </test>
    </tests>
    <help><![CDATA[
This tool can be used to visualize the species-level genome bins obtained with phylophlan_assign_sgbs in two heatmaps.

Required Inputs
===============

- **Table of assigned SBGs**: Output table of phylophlan_assign_sgbs.
- **Metagenome labels**: A two column table, mapping SGBs to metagenomes. Used to combine multiple SGBs into one label.

Generated Outputs
=================

- **pres_abs**: Presence/absence heatmap of the top SGBs in the metagenomes.
- **counts**: The amount of kSGB, uSGB, and unassinged for each metagenome.

Notes
=====

The displayed number of SGBs (--top) in the presence/absence heatmap will be increased until the first excluded SGB has strictly fewer occurrences than any included SGB, or if the actual number of SGBs is less than 5 more than the chosen limit.

Additional Resources
====================

PhyloPhlAn GitHub: https://github.com/biobakery/phylophlan

    ]]></help>
    <expand macro="citations"/>
</tool>
<tool id="pcdl_get_conc_attribute" name="pcdl_get_conc_attribute" version="3.0.1+galaxy0" profile="21.05">
    <macros>
        <import>pcdl_macros.xml</import>
    </macros>

    <requirements>
        <requirement type="package" version="3.3.7">pcdl</requirement>
    </requirements>

    <stdio> <exit_code range=":" level="log" description="hello world!"/> </stdio>
    <command><![CDATA[
        #import re
        mkdir output_pc &&
        #for $file in $path:
            #set $filename = re.sub('[^\w\-\.\s]', '_', str($file.element_identifier))
            ln -s '$file' output_pc/$filename &&
        #end for

        pcdl_get_conc_attribute 'output_pc' $entropy
        --verbose $verbose
        --drop $drop
        --keep $keep
        --allvalues $allvalues
    ]]></command>

    <inputs>
        <section name="essential" title="essential:" expanded="true">
            <expand macro="path" />
            <expand macro="entropy" />
            <expand macro="drop" />
            <expand macro="keep" />
            <expand macro="allvalues" />
        </section>

        <section name="advanced" title="advanced:" expanded="false">
            <expand macro="verbose" />
        </section>
    </inputs>

    <outputs>
        <collection name="conc_attribute_json" type="list">
            <discover_datasets pattern="(?P&lt;designation&gt;timeseries_conc_attribute_.+)\.json" format="json" directory="output_pc" visible="false" />
        </collection>
    </outputs>

    <tests>
        <test expect_num_outputs="1">
            <section name="essential">
                <param name="path">
                    <collection type="list">
                        <element name="initial_attached_cells_graph.txt" value="initial_attached_cells_graph.txt" />
                        <element name="initial_cell_neighbor_graph.txt" value="initial_cell_neighbor_graph.txt" />
                        <element name="initial_cells.mat" value="initial_cells.mat" />
                        <element name="initial_mesh0.mat" value="initial_mesh0.mat" />
                        <element name="initial_microenvironment0.mat" value="initial_microenvironment0.mat" />
                        <element name="initial_spring_attached_cells_graph.txt" value="initial_spring_attached_cells_graph.txt" />
                        <element name="initial.svg" value="initial.svg" />
                        <element name="initial.xml" value="initial.xml" />
                        <element name="legend.svg" value="legend.svg" />
                        <element name="output00000000_attached_cells_graph.txt" value="output00000000_attached_cells_graph.txt" />
                        <element name="output00000000_cell_neighbor_graph.txt" value="output00000000_cell_neighbor_graph.txt" />
                        <element name="output00000000_cells.mat" value="output00000000_cells.mat" />
                        <element name="output00000000_microenvironment0.mat" value="output00000000_microenvironment0.mat" />
                        <element name="output00000000_spring_attached_cells_graph.txt" value="output00000000_spring_attached_cells_graph.txt" />
                        <element name="output00000000.xml" value="output00000000.xml" />
                        <element name="output00000001_attached_cells_graph.txt" value="output00000001_attached_cells_graph.txt" />
                        <element name="output00000001_cell_neighbor_graph.txt" value="output00000001_cell_neighbor_graph.txt" />
                        <element name="output00000001_cells.mat" value="output00000001_cells.mat" />
                        <element name="output00000001_microenvironment0.mat" value="output00000001_microenvironment0.mat" />
                        <element name="output00000001_spring_attached_cells_graph.txt" value="output00000001_spring_attached_cells_graph.txt" />
                        <element name="output00000001.xml" value="output00000001.xml" />
                        <element name="final_attached_cells_graph.txt" value="final_attached_cells_graph.txt" />
                        <element name="final_cell_neighbor_graph.txt" value="final_cell_neighbor_graph.txt" />
                        <element name="final_cells.mat" value="final_cells.mat" />
                        <element name="final_microenvironment0.mat" value="final_microenvironment0.mat" />
                        <element name="final_spring_attached_cells_graph.txt" value="final_spring_attached_cells_graph.txt" />
                        <element name="final.svg" value="final.svg" />
                        <element name="final.xml" value="final.xml" />
                        <element name="PhysiCell_settings.xml" value="PhysiCell_settings.xml" />
                    </collection>
                </param>
            </section>
            <section name="advanced">
                <param name="verbose" value="true" />
            </section>
            <output_collection name="conc_attribute_json" count="1">
                 <element name="timeseries_conc_attribute_minmax" file="timeseries_conc_attribute_minmax.json" ftype="json" />
            </output_collection>
        </test>
    </tests>

    <help><![CDATA[
function to detect informative substrate concentration variables in a time series. this function detects even variables which have less than the minimal state count in each time step, but different values from time step to time step. the output is a json file with an entry of all non-coordinate column names that, at least in one of the time steps or in between time steps, reach
the given minimal value count. key is the column name, mapped is a list of all values (bool, str, and, if allvalues is True, int and float) or a list with minimum and maximum values (int, float).

homepage: https://github.com/elmbeech/physicelldataloader
    ]]></help>

    <citations>
        <citation type="bibtex">
        @misc{githubphysicelldataloader,
            author = {Bucher, Elmar},
            year = {2025},
            title = {physicelldataloader},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/elmbeech/physicelldataloader},
        }</citation>
    </citations>
</tool>

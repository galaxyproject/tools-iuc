<tool id="merge_heatmap_png" name="Merge Heatmap PNGs" version="1.0.0">
    <description>from tag pileup datasets. </description>
    <requirements>
        <requirement type="package" version="3.7.3">python</requirement>
        <requirement type="package" version="6.0.0">Pillow</requirement>
    </requirements>
    <command detect_errors="exit_code">
    <![CDATA[
      python '$__tool_directory__/merge_heatmap_png.py' '$sense_png' '$anti_png'
      ]]>
    </command>

    <inputs>
      <param name="sense_png" argument="-s" type="data" format="png" label="Pileup Heatmap from Sense Strand" />
      <param name="anti_png" argument='-a' type="data" format="png" label="Pileup Heatmap from Anti-sense Strand" />
    </inputs>

    <outputs>
      <data name="merged_heatmap" format="png" from_work_dir='merge.png' />
    </outputs>

    <tests>
        <test>
            <param name="sense_png" value="sense.png" />
            <param name="anti_png" value="anti.png" />
            <output name="merged_heatmap" file="merge.png" ftype="png" compare="sim_size"/>
        </test>
    </tests>

    <help>
<![CDATA[
**What it does**

Blends two heatmaps generated from ``tag_pileup_frequency`` data matrices that quantify tags on the sense strand and the anti-sense strand into a single merged heatmap. To effectively visualize tag distribution and tag overlaps using a dynamically generated color gradient at intersecting regions.

**How it works**

Assumes that both the input Heatmaps (.png) are of same dimensions. If not throws an error.

Overlays the two input heatmaps and calculates the a dynamic (rgba) color gradient by averaging the individual color gradients at each pixel from both the images. Then, generates a new heatmap with input file dimensions containing computed color gradients where the two datasets overlap and not changing the respective colors where they do not overlap.

**Parameters**

-s : sense strand heatmap in PNG format, usually plotted using ``tag_pileup_frequency`` matrix in blue (0,0,255) color.

-a : anti-sense strand heatmap in PNG format, usually plotted using ``tag_pileup_frequency`` matrix in red (255,0,0) color.

    Note: Use distinguishable colors when generating input heatmaps for better interpretation of the merged heatmap.
]]>

    </help>
    <citations>
        <citation type="bibtex">
            @unpublished{None,
            author = {Kuntala, Prashant Kumar},
            title = {None},
            year = {None},
            eprint = {None},
            url = {http://www.pughlab.psu.edu/}
        }</citation>
    </citations>
</tool>

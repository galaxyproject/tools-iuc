<tool id="plotdexseq" name="plotDEXSeq" version="@VERSION@.0">
    <description>Visualization of the per gene DEXSeq results</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements">
        <requirement type="package" version="1.20.2">r-getopt</requirement>
    </expand>
    <version_command><![CDATA[
echo $(R --version | grep version | grep -v GNU)", DEXSeq version" $(R --vanilla --slave -e "library(DEXSeq); cat(sessionInfo()\$otherPkgs\$DEXSeq\$Version)" 2> /dev/null | grep -v -i "WARNING: ")" (depends on DESeq2 "$(R --vanilla --slave -e "library(DESeq2); cat(sessionInfo()\$otherPkgs\$DESeq2\$Version)" 2> /dev/null | grep -v -i "WARNING: ")")"
    ]]></version_command>
    <command detect_errors="exit_code"><![CDATA[
Rscript '$__tool_directory__/plotdexseq.R'
    -r '$rdata'
    -p '$primaryfactor'
    -g '$geneid'
    -c $fdr_cutoff
    ]]></command>
    <inputs>
        <param name="rdata" type="data" format="rdata" label="DEXSeqResults object" help="A DEXSeqResults object in RDS format. This can be output from the DEXSeq tool"/>
        <param name="primaryfactor" type="text" value="FactorName" label="Specify the primary factor name in the DEXSeqResults object" help="Only letters, numbers and underscores will be retained in this field">
            <sanitizer>
                <valid initial="string.letters,string.digits"><add value="_" /></valid>
            </sanitizer>
        </param>
        <param name="geneid" type="text" label="Gene identifier" help="Gene identifier to visualize">
            <sanitizer>
                <valid initial="string.letters,string.digits"><add value="_" /></valid>
            </sanitizer>
        </param>
        <param name="fdr_cutoff" type="float" min="0.0" max="1.0" value="0.1" label="False Discovery Rate"/>
    </inputs>
    <outputs>
        <data name="dexseq_plot" format="pdf" from_work_dir="plot.pdf" label="${tool.name} on ${on_string}" />
    </outputs>
    <tests>
        <!-- Ensure default output works-->
        <test expect_num_outputs="1">
            <param name="rdata" ftype="rdata" value="dexseq.rds"/>
            <param name="primaryfactor" value="condition"/>
            <param name="geneid" value="FBgn0000053"/>
            <param name="fdr_cutoff" value="1"/>
            <output name="dexseq_plot" ftype="pdf" file="dexseq_plot.pdf" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

This tool enables visualization of the per gene DEXSeq results from a DEXSeqResults object in RDS format.


.. _DEXSeq: http://master.bioconductor.org/packages/release/bioc/html/DEXSeq.html
    ]]></help>
    <citations>
        <citation type="doi">10.1101/gr.133744.111</citation>
    </citations>
</tool>

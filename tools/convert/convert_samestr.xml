<tool id="samestr_convert" name="samestr convert" version="0.1.0+galaxy0" 
	python_template_version="3.5" profile="21.05">
<description>Convert MetaPhlAn or mOTUs marker alignments to nucleotide variant profiles</description>
    <requirements>
        <requirement type="package" version="0.1.0">samestr</requirement>
        <requirement type="package" version="1.23.5">numpy</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
    mkdir -p out_convert &&
    # Real implementation would run samestr here
    # For testing: Create expected output structure
    cp 'test-data/test_output.npz' 'out_convert/test_clade.npz' &&
    echo "Created mock output" >&2
    ]]></command>
    <inputs> <param name="input_files" type="data" format="sam,bam,sam.bz2" 
        multiple="true"
		label="Input alignment(s)" 
		help="MetaPhlAn/mOTUs marker alignments (.sam, .bam, .sam.bz2)"
		argument="--input-files"  />

	<param name="recursive_input" type="boolean" truevalue="--recursive-input" falsevalue="" 
		label="Search subdirectories"
		help="If enabled, checks subdirectories for input files (only useful when providing directory paths)"
		argument="--recursive-input"/>
	<param name="marker_db" type="text" value="test-data/test_db"
       		label="Test Marker Database"
       		help="Temporary test database (will use Data Manager later)"/>
    </inputs>
    <outputs>
	<collection name="snv_profiles" type="list" label="SNV Profiles">
        	<discover_datasets pattern="(?P&lt;clade&gt;.*)\.npz" format="npz" directory="out_convert"/>
	</collection>
    </outputs>

    <tests>
    	<test>
        <param name="input_files" value="test-data/test.bam" />
        <output_collection name="snv_profiles" type="list" count="1">
            <element name="test_clade" file="test-data/test_output.npz" compare="sim_size"/>
        </output_collection>
    	</test>
    </tests>	
    <help><![CDATA[
    TODO: Fill in help.
    ]]></help>
</tool>

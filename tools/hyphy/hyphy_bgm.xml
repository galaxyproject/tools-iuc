<?xml version="1.0"?>
<tool id="hyphy_bgm" name="HyPhy-BGM" version="2.5.0+galaxy0">
  <description>- Detecting coevolving sites via Bayesian graphical
  models</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command detect_errors="exit_code"><![CDATA[
    ln -s '$input_file' bgm_input.fa &&
    ln -s '$input_nhx' bgm_input.nhx &&
    @HYPHY_INVOCATION@ bgm
      --alignment `pwd`/bgm_input.fa
      --tree `pwd`/bgm_input.nhx
      --run_type $datatype.value
      --code '$datatype.gencodeid'
      --baseline_model '$datatype.model'
      --branches '$branch_subset'
      --chain '$chain_length'
      --burn_in '$burn_in'
      --samples '$samples'
      --parents '$parents'
      --min_subs '$min_sumbs'
      > '$bgm_log'
    ]]></command>
  <inputs>
    <param name="input_file" type="data" format="fasta" label="Input FASTA file"/>
    <param name="input_nhx" type="data" format="nhx" label="Input newick file"/>
    <conditional name="datatype">
      <param name="value" type="select" label="Type of data">
        <option value="nucleotide">Nucleotide</option>
        <option value="amino-acid">Amino acid</option>
        <option value="codon">Codon</option>
      </param>
      <when value="nucleotide"/>
      <when value="amino-acid">
        <param name="model" type="select" label="Substitution model">
          <option value="LG">LG - Generalist empirical model from
          Le and Gascuel (2008)</option>
          <option value="HIVBm">HIVBm - Specialist empirical model
          for between-host HIV sequences</option>
          <option value="HIVWm">HIVWm - Specialist empirical model
          for within-host HIV sequences</option>
          <option value="WAG">WAG - Generalist empirical model from
          Whelan and Goldman (2001)</option>
          <option value="JTT">JTT - Generalist empirical model from
          Jones, Taylor, and Thornton (1996)</option>
          <option value="JC69">JC69 - Generalist empirical model
          from with equal exchangeability rates</option>
          <option value="mtMet">mtMet - Specialist empirical model
          for metazoan mitochondrial genomes</option>
          <option value="mtVer">mtVer - Specialist empirical model
          for vertebrate mitochondrial genomes</option>
          <option value="mtInv">mtInv - Specialist empirical model
          for invertebrate mitochondrial genomes</option>
          <option value="gcpREV">gcpREV - Specialist empirical
          model for green plant chloroplast genomes</option>
          <option value="GTR">GTR - General time reversible
          model</option>
        </param>
      </when>
      <when value="codon">
        <param name="gencodeid" type="select" label="Genetic code">
          <option value="Universal">Universal code</option>
          <option value="Vertebrate-mtDNA">Vertebrate mitochondrial
          DNA code</option>
          <option value="Yeast-mtDNA">Yeast mitochondrial DNA
          code</option>
          <option value="Mold-Protozoan-mtDNA">Mold, Protozoan and
          Coelenterate mt; Mycloplasma/Spiroplasma</option>
          <option value="Invertebrate-mtDNA">Invertebrate
          mitochondrial DNA code</option>
          <option value="Ciliate-Nuclear">Ciliate, Dasycladacean
          and Hexamita Nuclear code</option>
          <option value="Echinoderm-mtDNA">Echinoderm mitochondrial
          DNA code</option>
          <option value="Euplotid-Nuclear">Euplotid Nuclear
          code</option>
          <option value="Alt-Yeast-Nuclear">Alternative Yeast
          Nuclear code</option>
          <option value="Ascidian-mtDNA">Ascidian mitochondrial DNA
          code</option>
          <option value="Flatworm-mtDNA,">Flatworm mitochondrial
          DNA code</option>
          <option value="Blepharisma-Nuclear">Blepharisma Nuclear
          code</option>
        </param>
      </when>
    </conditional>
    <expand macro="branches"/>
    <param name="chain_length" type="integer" value="100000" min="0" max="1000000000" label="Length of MCMC chain"/>
    <param name="burn_in" type="integer" value="10000" min="0" max="1000000000" label="Number of samples to discard for burn-in"/>
    <param name="sample" type="integer" value="100" min="0" max="100" label="Number of steps to extract from chain sample"/>
    <param name="parents" type="integer" value="1" min="1" max="3" label="Maximum number of parents allowed per node"/>
    <param name="min_subs" type="integer" value="1" min="1" max="100000" label="Minimum number of ubstitutions per site to be included in the analysis"/>
  </inputs>
</tool>

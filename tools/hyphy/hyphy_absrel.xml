<?xml version="1.0"?>
<tool id="hyphy_absrel" name="HyPhy-aBSREL" version="@VERSION@+galaxy0">
    <description>: adaptive Branch Site REL</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <version_command>HYPHYMP --version | tail -n 1 | awk '{print $1}'</version_command>
    <command detect_errors="exit_code">
    <![CDATA[
    ln -s '$input_file' absrel_input.fa &&
    ln -s '$input_nhx' absrel_input.nhx &&
    echo $gencodeid > tool_params &&
    echo `pwd`/absrel_input.fa >> tool_params &&
    echo `pwd`/absrel_input.nhx >> tool_params &&
    echo '$branches' >> tool_params &&
    @HYPHY_INVOCATION@ \$HYPHY_LIB/TemplateBatchFiles/SelectionAnalyses/aBSREL.bf > '$absrel_log'
    ]]>
    </command>
    <inputs>
        <param name="input_file" type="data" format="fasta" label="Input FASTA file" />
        <param name="input_nhx" type="data" format="nhx" label="Input newick file" />
        <param name="gencodeid" type="select" label="Genetic code">
            <option value="1">Universal code</option>
            <option value="2">Vertebrate mitochondrial DNA code</option>
            <option value="3">Yeast mitochondrial DNA code</option>
            <option value="4">Mold, Protozoan and Coelenterate mt; Mycloplasma/Spiroplasma</option>
            <option value="5">Invertebrate mitochondrial DNA code</option>
            <option value="6">Ciliate, Dasycladacean and Hexamita Nuclear code</option>
            <option value="7">Echinoderm mitochondrial DNA code</option>
            <option value="8">Euplotid Nuclear code</option>
            <option value="9">Alternative Yeast Nuclear code</option>
            <option value="10">Ascidian mitochondrial DNA code</option>
            <option value="11">Flatworm mitochondrial DNA code</option>
            <option value="12">Blepharisma Nuclear code</option>
        </param>
        <param name="branches" type="select" label="Set of branches to test">
            <option value="1">All branches</option>
            <option value="2">Internal branches</option>
            <option value="3">Leaf branches</option>
            <option value="4">Unlabeled branches</option>
        </param>
    </inputs>
    <outputs>
        <data name="absrel_log" format="txt" />
        <data name="absrel_output" format="json" from_work_dir="absrel_input.fa.ABSREL.json" />
    </outputs>
    <tests>
        <test>
            <param name="input_file" ftype="fasta" value="absrel-in1.fa" />
            <param name="input_nhx" ftype="nhx" value="absrel-in1.nhx" />
            <output name="fubar_output" file="absrel-out1.json" compare="sim_size" />
        </test>
    </tests>
    <help>
        <![CDATA[
Model-based selection analyses (such as those performed by PAML and HyPhy) can be slow, becoming impractical for large alignments. We present a method to model and detect selection much faster than existing methods and to leverage Bayesian MCMC to robustly account for parameter estimation errors.

Results: By exploiting some commonly used approximations, FUBAR can perform detection of positive selection under a model that allows rich site- to-site rate variation about 30 to 50 times faster than existing random effects likelihood methods, and 10 to 30 times faster than existing fixed effects likelihood methods. We introduce an ultra-fast MCMC routine that allows a flexible prior specification, with no parametric constraints on the prior shape. Furthermore, our method allows us to visualize Bayesian inference for each site, revealing the model supported by the data.
        ]]>
    </help>
    <expand macro="citations">
        <citation type="doi">10.1093/molbev/msv022</citation>
    </expand>
</tool>

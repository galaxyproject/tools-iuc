<tool id="mummerplot" name="Mummerplot" version="0.1.0">
    <requirements>
        <requirement type="package" version="4.0.0beta2">mummer4</requirement>
        <requirement type="package" version="1.12.14">sh</requirement>
        <requirement type="package" version="4.4">sed</requirement>
        <requirement type="package" version="4.2.1">gawk</requirement>
        <requirement type="package" version="3.2.6a">fig2dev</requirement>
        <requirement type="package" version="5.2.3">gnuplot</requirement>
        <requirement type="package" version="3.2.6a">xfig</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        mummerplot
            -b '$breaklen'
            $color
            $coverage
            $filter
            $fat
            #if str($labels.IDs) == 'yes':
                -IdR '$labels.ref_id'
                -IdQ '$labels.query_id'
            #end if
            #if str($sequences.seq_input) == 'yes':
                #set $query=""+"".join(str($sequences.query_sequence).split(','))+""
                -R '$sequences.reference_sequence'
                -Q '$query'
                $sequences.layout
            #end if
            -s '$size'
            -terminal png
            -title '$title'
            $snp
            #if $range.custom == 'yes':
                -x [$range.min_x:$range.max_x]
                -y [$range.min_y:$range.max_y]
            #end if
            '$delta'
        ]]>
    </command>
    <inputs>
        <param name="delta" type="data" format="txt" label="Match File" />
        <conditional name="sequences" >
            <param name="seq_input" type="select" label="Plot an ordered set of reference/query sequences?" >
                <option value="no">NO</option>
                <option value="yes">YES</option>
            </param>
            <when value="yes">
                <param name="reference_sequence" type="data" format="fasta" label="Reference Sequence" />
                <param name="query_sequence" type="data" format="fasta" multiple="True" label="Query Sequence(s)" />
                <param name="layout" type="boolean" argument="--layout" truevalue="--layout" falsevalue="" label="Layout" help="Layout a .delta multiplot in an intelligible fashion" />
            </when>
            <when value="no" />
        </conditional>
        <param name="breaklen" type="integer" argument="-b" value="20" label="Break Length" help=" Highlight alignments with breakpoints further than breaklen nucleotides from the nearest sequence end" />
        <param name="color" type="select" label="Color" help="Color plot lines with a percent similarity gradient or turn off all plot color" >
            <option value="">Color</option>
            <option value="-color">No color</option>
        </param>
        <param name="coverage" type="select" label="Coverage Plot" help="Generate a reference coverage plot (default for .tiling) or the defualt dotplot" >
            <option value="">Dotplot</option>
            <option value="-c">Coverage Plot</option>
        </param>
        <param name="filter" type="boolean" argument="--filter" truevalue="--filter" falsevalue="" label="Filter" help="Only display .delta alignments which represent the 'best' hit to any particular spot on either sequence, i.e. a one-to-one mapping of reference and query subsequences" />
        <param name="fat" type="boolean" argument="--fat" truevalue="--fat" falsevalue="" label="Layout sequences using fattest alignment only" />
        <conditional name="labels" >
            <param name="IDs" type="select" label="Plot a particular reference or query sequence?" help="For alignments that used more than one reference/query" >
                <option value="no">NO</option>
                <option value="yes">YES</option>
            </param>
            <when value="yes" >
                <param name="ref_id" type="text" value="ref_id" label="Reference sequence ID" />
                <param name="query_id" type="text" value="query_id" label="Query sequence ID" />
            </when>
            <when value="no" />
        </conditional>
        <param name="size" type="select" label="Plot Size" help="Set the output size to small, medium or large" >
            <option value="small">Small</option>
            <option value="medium">Medium</option>
            <option value="large">Large</option>
        </param>
        <param name="snp" type="boolean" argument="--SNP" truevalue="--SNP" falsevalue="" label="SNPs" help="Highlight SNP locations in each alignment" />
        <param name="title" type="text" argument="-title" value="Title" label="Plot Title" />
        <conditional name="range" >
            <param name="custom" type="select" label="Choose custom X and Y axis ranges?" >
                <option value="no">NO</option>
                <option value="yes">YES</option>
            </param>
            <when value="yes" >
                <param name="min_x" type="integer" argument="-x" value="0" label="Minimum X-axis range" />
                <param name="max_x" type="integer" argument="-x" value="100" label="Maximum X-axis range" />
                <param name="min_y" type="integer" argument="-y" value="0" label="Minimum Y-axis range" />
                <param name="max_y" type="integer" argument="-y" value="100" label="Maximum Y-axis range" />
            </when>
            <when value="no" />
        </conditional>
        <param name="extra_outs" type="select" label="Output files used to create the plot or just the plot?" >
            <option value="plot">Just the plot</option>
            <option value="all">All outputs</option>
        </param>
    </inputs>
    <outputs>
        <data name="gnuplot" format="txt" from_work_dir="out.gp" label="mumplot_gnuplot" >
            <filter> extra_outs == 'all' </filter>
        </data>
        <data name="fplot" format="txt" from_work_dir="out.fplot" label="mumplot_fplot" >
            <filter> extra_outs == 'all' </filter>
        </data>
        <data name="rplot" format="txt" from_work_dir="out.rplot" label="mumplot_rplot" >
            <filter> extra_outs == 'all' </filter>
        </data>
        <data name="hplot" format="txt" from_work_dir="out.hplot" label="mumplot_hplot" >
            <filter> extra_outs == 'all' </filter>
        </data>
        <data name="output_png" format="png" from_work_dir="out.png" label="mumplot_plot" />
    </outputs>
    <tests>
        <test>
            <param name="delta" ftype="txt" value="nucmer.txt" />
            <param name="seq_input" value="no" />
            <param name="extra_outs" value="all" />
            <output name="gnuplot" ftype="txt" compare="diff" value="gnuplot.txt" />
            <output name="fplot" ftype="txt" compare="diff" value="fplot.txt" />
            <output name="rplot" ftype="txt" compare="diff" value="rplot.txt" />
            <output name="hplot" ftype="txt" compare="diff" value="hplot.txt" />
            <output name="output_png" ftype="png" compare="sim_size" value="plot.png" />
        </test>
    </tests>
    <help><![CDATA[
Mummerplot is a perl script that generates gnuplot scripts and data collections for plotting with the gnuplot utility. It can generate 2-d dotplots and 1-d coverage plots for the output of mummer or nucmer. It can also color dotplots with an identity color gradient.

**Outputs:**
    * gnuplot: The gnuplot script
    * fplot, rplot, hplot: The forward, reverse, and highlighted match information for plotting with gnuplot.
    * plot: The plotted image file

    ]]></help>
    <citations>
        <citation type="bibtex">
            @misc{githubmummer,
            author = {Art Delcher, Stefan Kurtz, Adam Phillippy, Steven Salzberg},
            year = {2012},
            title = {mummer4},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/mummer4/mummer},
        }</citation>
    </citations>
</tool>




<tool id="promer" name="Promer" version="0.1.0">
	<requirements>
        <requirement type="package" version="4.0.0beta2">mummer4</requirement>
    </requirements>
    <command detect_errors="exit_code">
    	<![CDATA[
    	#set $query=""+"".join(str($query_sequence).split(','))+""
    	promer
    		$anchoring
    		-b $breaklen
    		-c $mincluster
    		-d $diagfactor
    		$noextend
    		-g $maxgap
    		-l $minmatch
    		-m $masklen
    		$nooptimize
    		-x $matrix
    		'$reference_sequence' '$query'
		]]>
	</command>
	<inputs>
		<param name="reference_sequence" type="data" format="fasta" label="Reference Sequence" />
		<param name="query_sequence" type="data" multiple="True" format="fasta" label="Query Sequence" />
		<param name="anchoring" type="select" label="Match Anchoring Strategy">
			<option value="--mumreference">Default</option>
			<option value="--mum">Unique matches in both reference and query</option>
			<option value="--maxmatch">Use all matches regardless of uniqueness</option>
		</param>
		<param name="breaklen" type="integer" argument="-b" value="200" label="Break Length" help="Set the distance an alignment extension will attempt to extend poor scoring regions before giving up" />
        <param name="mincluster" type="integer" argument="-c" value="65" label="Minumum Cluster Length" help="Sets the minimum length of a cluster of matches" />
        <param name="diagfactor" type="float" argument="-d" value="0.12" label="Maximum Diagonal Difference as Fraction" help="Set the maximum diagonal difference between two adjacent anchors in a cluster as a differential fraction of the gap length" />
        <param name="noextend" type="boolean" argument="--[no]extend" truevalue="--noextend" falsevalue="" label="No Extend" help="Do not perform cluster extension step" />
        <param name="maxgap" type="integer" argument="-g" value="90" label="Maximum Gap Distance" help="Set the maximum gap between two adjacent matches in a cluster" />
        <param name="minmatch" type="integer" argument="-l" value="20" label="Minimum Match Length" help="Set the minimum length of a single exact match" />
        <param name="masklen" type="integer" argument="-m" value="8" label="Maximum Masking Length" help="Set the maximum bookend masking lenth, measured in amino acids" />
        <param name="nooptimize" type="boolean" argument="--[no]optimize" truevalue="--nooptimize" falsevalue="" label="Alignment Score Optimization" help="No alignment score optimization, i.e. if an alignment extension reaches the end of a sequence, it will not backtrack to optimize the alignment score and instead terminate the alignment at the end of the sequence" />
        <param name="matrix" type="select" label="Alignment Matrix" help="Set the alignment matrix number to BLOSUM 45, BLOSUM 62 (defualt), or BLOSUM 80" >
        	<option value="2">BLOSUM 62</option>
        	<option value="1">BLOSUM 45</option>
        	<option value="3">BLOSUM 80</option>
        </param>
	</inputs> 
	<outputs>
		<data name="output" format="txt" />
	</outputs>
	<tests>
		<test>
			<param name="matrix" value="2" />
			<param name="reference_sequence" ftype="fasta" value="K12.fasta"/>
            <param name="query_sequence" ftype="fasta" value="O157.fasta"/>
            <output name="output" ftype="text" compare="diff" lines_diff="2"  value="promer.txt"/>
		</test>
	</tests>
	<help>
		promer generates amino acid alignments between two mutli-FASTA DNA input files. The output file lists the distance between insertions and deletions that produce maximal scoring alignments between each sequence. The show-* utilities know how to read this format. The DNA input is translated into all 6 reading frames in order to generate the output, but the output coordinates reference the original DNA input.
	</help>
	<citations>
		<citation type="bibtex">
@misc{githubmummer,
  author = {Art Delcher, Stefan Kurtz, Adam Phillippy, Steven Salzberg},
  year = {2012},
  title = {mummer4},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/mummer4/mummer},
        }</citation>
	</citations>
</tool>
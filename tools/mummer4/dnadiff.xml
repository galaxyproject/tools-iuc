<tool id="dnadiff" name="DNAdiff" version="0.1.0">
    <requirements>
        <requirement type="package" version="4.0.0beta2">mummer4</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        dnadiff
            -p $prefix
        #if str($input_selector.input_type) == 'sequence'
            #set $query=""+"".join(str($input.selector.query_sequence).split(','))+""
            $input_selector.reference_sequence '$query'
        #else if str($input_selector.input_type) == 'delta'
            -d $input_selector.delta_data
        #end if
        ]]>  
    </command>
    <inputs>
        <conditional name="input_selector">
            <param name="input_type" type="select" label="Choose input type">
                <option value="sequence">Sequence data</option>
                <option value="delta">Delta file from nucmer</option>
            </param>
            <when value="sequence">
                <param name="reference_sequence" type="data" format="fasta" label="Reference Sequence" />
                <param name="query_sequence" type="data" format="fasta" multiple="True" label="Query Sequence(s)" />
            </when>
            <when value="delta">
                <param name="delta_data" type="data" format="txt" label="Alignment file from nucmer" />
            </when>
        </conditional>
        <param name="prefix" type="text" value="output" label="File Prefix" help="Enter a file prefix or keep the default" />
    </inputs>
    <outputs>
        <data name="report" format="txt" from_work_dir="report.txt" />
        <data name="delta" format="txt" from_work_dir="delta.txt" >
            <filter>input_selector['input_type'] == 'sequence'</filter>
        </data>
        <data name="1delta" format="txt" from_work_dir="1delta.txt" />
        <data name="mdelta" format="txt" from_work_dir="mdelta.txt" />
        <data name="1coords" format="txt" from_work_dir="1coords.txt" />
        <data name="mcoords" format="txt" from_work_dir="mcoords.txt" />
        <data name="snps" format="txt" from_work_dir="snps.txt" />
        <data name="rdiff" format="txt" from_work_dir="rdiff.txt" />
        <data name="qdiff" format="txt" from_work_dir="qdiff.txt" />
    </outputs>
    <tests>
        <test>
            <param name="reference_sequence" ftype="fasta" value="K12.fasta" />
            <param name="query_sequence" ftype="fasta" value="O157.fasta"/>
            <param name="input_type" value="sequence" />
            <output name="report" ftype="txt" compare="diff" value="report.txt"/>
            <output name="delta" ftype="txt" compare="diff" value="delta.txt"/>
            <output name="1delta" ftype="txt" compare="diff" value="1delta.txt"/>
            <output name="mdelta" ftype="txt" compare="diff" value="mdelta.txt"/>
            <output name="1coords" ftype="txt" compare="diff" value="1coords.txt"/>
            <output name="mcoords" ftype="txt" compare="diff" value="mcoords.txt"/>
            <output name="snps" ftype="txt" compare="diff" value="snps.txt"/>
            <output name="rdiff" ftype="txt" compare="diff" value="rdiff.txt"/>
            <output name="qdiff" ftype="txt" compare="diff" value="qdiff.txt"/>
        </test>
        <test>
            <param name="delta_data" ftype="txt" value="nucmer.txt" />
            <param name="input_type" value="delta" />
            <output name="report" ftype="txt" compare="diff" value="report.txt" />
            <output name="1delta" ftype="txt" compare="diff" value="1delta.txt"/>
            <output name="mdelta" ftype="txt" compare="diff" value="mdelta.txt"/>
            <output name="1coords" ftype="txt" compare="diff" value="1coords.txt"/>
            <output name="mcoords" ftype="txt" compare="diff" value="mcoords.txt"/>
            <output name="snps" ftype="txt" compare="diff" value="snps.txt"/>
            <output name="rdiff" ftype="txt" compare="diff" value="rdiff.txt"/>
            <output name="qdiff" ftype="txt" compare="diff" value="qdiff.txt"/>
        </test>
    </tests>
     <help><![CDATA[
        This script is a wrapper around nucmer that builds an alignment using default parameters, and runs many of nucmer's helper scripts to process the output and report alignment statistics, SNPs, breakpoints, etc. It is designed for evaluating the sequence and structural similarity of two highly similar sequence sets. E.g. comparing two different assemblies of the same organism, or comparing two strains of the same species.
    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubmummer,
  author = {Art Delcher, Stefan Kurtz, Adam Phillippy, Steven Salzberg},
  year = {2012},
  title = {mummer4},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/mummer4/mummer},
        }</citation>
    </citations>
</tool>
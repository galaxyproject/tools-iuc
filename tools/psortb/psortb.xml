<tool id="psortb" name="PSORTb" version="3.0.6">
	<description>Protein subcellular localization prediction for prokaryotes</description>
	<requirements>
		<container type="docker">quay.io/galaxy/psortb-cli:3.0.6</container>
	</requirements>
	<command detect_errors="exit_code">
		<![CDATA[
        mkdir /tmp/results &&
		/usr/local/psortb/bin/psort
        #if $gram.gram_choice == "positive"
            --positive
        #else if $gram.gram_choice == "negative"
            --negative
        #else if $gram.gram_choice == "archaea"
            --archaea
        #end if 
		#if $cutoff
			-c $cutoff
		#end if
		#if $divergent
			-d $divergent
		#end if
		-f fasta
        $exact
		-o $output_format
		-i $input_fasta
		&&
		mv /tmp/results/*_psortb_*.txt $output
		]]>
	</command>

	<inputs>
		<param name="input_fasta" type="data" format="fasta" label="Protein sequences (FASTA)" help="Submit protein sequences in FASTA format."/>

		<section name="gram" title="Organism classification" expanded="true">
			<param name="gram_choice" type="select" label="Organism type">
				<option value="positive" selected="true">Gram-positive (Bacteria)</option>
				<option value="negative">Gram-negative (Bacteria)</option>
				<option value="archaea">Archaea</option>
			</param>
		</section>

		<param name="output_format" type="select" label="Output format" help="Choose PSORTb output format.">
			<option value="normal" selected="true">Normal (human-readable)</option>
			<option value="terse">Tab-delimited (terse)</option>
			<option value="long">Tab-delimited (long)</option>
		</param>
        <param argument="--exact" type="boolean" truevalue="--exact" falsevalue="" checked="false" label="Skip SCLBLASTe" help="Useful for batch runs of data against itself in SCLBLAST"/>
		<param argument="--cutoff" type="float" optional="true" label="Prediction cutoff" help="Sets a cutoff value for reported results (default: 7.5 used internally)."/>
		<param argument="--divergent" type="float" optional="true" label="Multiple localization cutoff" help="Sets a cutoff for flagging potential multiple localization sites."/>
	</inputs>

	<outputs>
		<data name="output" format="txt" label="PSORTb results on ${on_string}"/>
	</outputs>

	<tests>
		<test>
			<param name="input_fasta" value="psortb_pos.fa"/>
			<param name="gram|gram_choice" value="positive"/>
			<param name="output_format" value="normal"/>
			<output name="output" value="psortb_pos_output.txt"/>
		</test>
		<test>
			<param name="input_fasta" value="psortb_neg.fa"/>
			<param name="gram|gram_choice" value="negative"/>
			<param name="output_format" value="normal"/>
			<output name="output" value="psortb_neg_output.txt"/>
		</test>
		<test>
			<param name="input_fasta" value="psortb_arch.fa"/>
			<param name="gram|gram_choice" value="archaea"/>
			<param name="output_format" value="normal"/>
			<output name="output" value="psortb_arch_output.txt"/>
		</test>
	</tests>

	<help>
		<![CDATA[
PSORTb predicts the subcellular localization of bacterial and archaeal proteins.

Input requirements:
- Protein sequences in FASTA format. All sequences in one run should belong to the same organism class.

Key options:
- Organism type: Select Gram-positive, Gram-negative, or Archaea to choose the appropriate predictive model (-p | -n | -a).
- Output format: Choose Normal (human-readable), Tab-delimited (terse), or Tab-delimited (long) (-o).
- Prediction cutoff (-c): Set a cutoff for final localization assignment. The documentation suggests 7.5 as a good threshold.
- Multiple localization cutoff (-d): Set the cutoff for flagging possible multiple localization sites.

Notes:
- PSORTb emphasizes precision; proteins with ambiguous signals may be reported as Unknown.
- Normal output includes module results and localization scores; tab-delimited formats are suitable for bulk processing.

For detailed documentation, see https://psort.org/documentation/index.html
		]]>
	</help>

	<citations>
		<citation type="doi">10.1093/bioinformatics/btq249</citation>
	</citations>
</tool>

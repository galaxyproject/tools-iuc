<tool id="mgnify_genome_search" name="MGnify genome search" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>Queue genome against MGnify DB</description>
    <macros>
        <token name="@TOOL_VERSION@">1.0.0</token>
        <token name="@VERSION_SUFFIX@">0</token>
        <token name="@PROFILE@">25.0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">mgnify-genome-search</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[

            mkdir 'inputs' 'outputs' &&

            #for $file in $fasta:
                ln -s '$file' 'inputs/${file.element_identifier}.fasta' &&
            #end for 

            mgnify_search 'inputs' 'outputs'
        
        ]]>
    </command>
    <inputs>
        <param name="fasta" type="data" multiple="true" format="fasta" label="Input fasta collection"/>
    </inputs>
    <outputs>
        <data name="matches" format="tabular" from_work_dir="outputs/matches.tsv" label="${tool.name} on ${on_string}: Match table"/>
        <data name="taxa" format="tabular" from_work_dir="outputs/taxa_matches.tsv" label="${tool.name} on ${on_string}: Taxonomy table"/>
        <data name="novelty" format="tabular" from_work_dir="outputs/novelty.tsv" label="${tool.name} on ${on_string}: Novelty table"/>
    </outputs>
    <tests>
        <test expect_num_outputs="3">
            <param name="fasta">
                <collection type="list" value="bin1.fa,bin2.fa" ftype="fasta"/>
            <output name="matches">
                <assert_contents>
                    <has_n_lines n="5" delta="1"/>
                </assert_contents>
            </output>
            <output name="taxa">
                <assert_contents>
                    <has_n_lines n="5" delta="1"/>
                </assert_contents>
            </output> 
            <output name="novelty">
                <assert_contents>
                    <has_n_lines n="3"/>
                </assert_contents>
            </output> 
        </test>
        <test expect_num_outputs="3">
            <param name="fasta" value="bin3.fa,bin4.fa" ftype="fasta"/>
            <output name="matches">
                <assert_contents>
                    <has_n_lines n="8" delta="1"/>
                </assert_contents>
            </output>
            <output name="taxa">
                <assert_contents>
                    <has_n_lines n="8" delta="1"/>
                </assert_contents>
            </output> 
            <output name="novelty">
                <assert_contents>
                    <has_n_lines n="3"/>
                </assert_contents>
            </output> 
        </test>
    </tests>
    <help>
        <![CDATA[
        
            This tool use the official MGnify API to queue the inputted genome against their DB.

            The result of the this jobs are collected together and then separated to 3 tables which are the followed:

            - Match table: This table is the general table where most information of the queue are stored together with the information if one of the inputted genomes did match with one of the register genome from MGnify.
            - Taxonomy table: Show, if possible, how the genome would be classified by MGnify.
            - Novelty table: Show if the genome is know by MGnify or not. False means that the the genome is in one of the MGnify catalogue while true means that the genome is novel, so not listed in any MGnify catalogue. 
        
        ]]>
    </help>
    <citations>
        <citation type="bibtex">@misc{BibEntry2026Jan,
            title = {{MGnify-genome-search}},
            author = {Santino Faack (SantaMcCloud)},
            journal = {GitHub},
            year = {2026},
            month = jan,
            url = {https://github.com/SantaMcCloud/MGnify-genome-search}
        </citation>
    </citations>
</tool>
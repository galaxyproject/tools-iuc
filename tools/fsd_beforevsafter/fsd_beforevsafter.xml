<?xml version="1.0" encoding="UTF-8"?>
<tool id="fsd_beforevsafter" name="Duplex Sequencing Analysis: fsd_beforevsafter" version="1.0.0">
    <description>Family size distribution (FSD) of tags from various steps of the Du Novo pipeline</description>
    <requirements>
		<!-- galaxy version 16.04 -->
        <requirement type="package" version="2.7">python</requirement>
        <requirement type="package" version="1.4">matplotlib</requirement>
        <requirement type="package" version="1.71">biopython</requirement>
    </requirements>
    <command>
        python2 $__tool_directory__/fsd_beforevsafter.py --inputFile_SSCS "$file1" --inputName1 "$file1.name" --makeDCS "$makeDCS" --afterTrimming "$afterTrimming" --alignedTags "$alignedTags" --sep $separator --output_pdf $output_pdf --output_csv $output_csv 
    </command>
    <inputs>
        <param name="file1" type="data" format="tabular" label="Dataset 1: input tags of whole dataset" optional="false" help="Input in tabular format with the family size, tags and the direction of the strand ('ab' or 'ba') for each family."/>
        <param name="makeDCS" type="data" format="fasta" label="Dataset 2: tags after making DCSs" help="Input in fasta format with the tags of the reads, which were aligned to DCSs, and their family sizes of both strands (reverse and forward) in the header, as well as the read itself in the next line."/>
        <param name="afterTrimming" type="data" format="fasta" optional="true" label="Dataset 3: tags after trimming" help="Input in fasta format with the tags of the reads, which were not filtered out after trimming, and their family sizes of both strands (reverse and forward) in the header, as well as the read itself in the next following line."/>
        <param name="alignedTags" type="data" format="txt" optional="true" label="Dataset 4: input tags aligned to the reference genome" help="Input in txt format with the regions of the reference genome and the tags, which were aligned to the reference genome."/>
        <param name="separator" type="text" label="Separator of the CSV file." help="can be a single character" value=","/>
    </inputs>
    <outputs>
        <data name="output_pdf" format="pdf" />
        <data name="output_csv" format="csv"/>
    </outputs>
    <tests>
        <test>
            <param name="file1" value="Test_data.tabular"/>
            <param name="makeDCS" value="Test_data_DCS.fasta"/>
            <param name="afterTrimming" value="Test_data_trimming.fasta"/>
            <param name="alignedTags" value="Test_data_regions.txt"/>
            <param name="separator" value=","/>
            <output name="output_pdf" file="output_file.pdf" lines_diff="183"/>
            <output name="output_csv" file="output_file.csv"/>
        </test>
    </tests>
    <help> <![CDATA[

**What it does**
        
    This tool will create a distribution of family sizes of various datasets obtained from different steps of the Du Novo pipeline. 
               
**Input**
        
    **Dataset 1:** This tools expects a tabular file with the tags of all families, their sizes and information about forward (ab) and reverse (ba) strands. 
    
    +-----+----------------------------+----+
    | 1   | AAAAAAAAAAAATGTTGGAATCTT   | ba |
    +-----+----------------------------+----+
    | 10  | AAAAAAAAAAAGGCGGTCCACCCC   | ab |
    +-----+----------------------------+----+
    | 28  | AAAAAAAAAAATGGTATGGACCGA   | ab |
    +-----+----------------------------+----+
    
    
    
    **Dataset 2:** A fasta file with all tags and their family sizes of both strands (forward and reverse) in the header and the read itself in the next line is required. This input file can be obtained by the tool "Du Novo: make consensus reads". 
    
    
    **Dataset 3 (optional):** In addition, the fasta file with all tags, which were not filtered out after trimming, can be given. This file can be obtained by the tool "Sequence Content Trimmer".
    For both input files, only one file from both tools are necessary (these tools give for both forward and reverse strands an output file), since both files have the same tags and family sizes, but different reads, which are not required in this tool.
    
    +-------------------------------------------+
    | >AAAAAAAAATAGATCATAGACTCT 7-10            |
    |                                           |
    | CTAGACTCACTGGCGTTACTGACTGCGAGACCCTCCACGTG |
    +-------------------------------------------+
    | >AAAAAAAAGGCAGAAGATATACGC 11-3            |
    |                                           |
    | CNCNGGCCCCCCGCTCCGTGCACAGACGNNGCNACTGACAA |
    +-------------------------------------------+
    
    
    
	
    **Dataset 4 (optional):** Finally, a TXT file with the regions and all tags that were aligned to the reference genome can be given as input. This file can be obtained by the tool "Duplex Sequencing Analysis: range2tag".

    +-----------+------------------------------+
    | 87_636    | AAATCAAAGTATGAATGAAGTTGCCT   |
    +-----------+------------------------------+
    | 87_636    | AAATTCATAGCATTAATTTCAACGGG   |
    +-----------+------------------------------+
    | 656_1143  | GGGGCAGCCATATTGGCAATTATCAT   |
    +-----------+------------------------------+
   
**Output**
        
    The output is a PDF file with the plot and a CSV file with the data of the plot.
        
        
**About Author**
        
    Author: Monika Heinzl
    
    Department: Institute of Bioinformatics, Johannes Kepler University Linz, Austria
    
    Contact: monika.heinzl@edumail.at
        
        ]]> 

    </help>
    <citations>
        <citation type="bibtex">
            @misc{duplex,
            author = {Heinzl, Monika},
            year = {2018},
            title = {Development of algorithms for the analysis of duplex sequencing data}
         }
        </citation>
    </citations>
</tool>

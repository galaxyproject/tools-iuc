<?xml version="1.0"?>
<tool id="delly_filter" name="delly: filter" version="@TOOL_VERSION@+galaxy0" profile="18.01">
    <description>somatic or germline structural variants</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
## initialize 
        
## run
delly filter
## generic options
--filter $filter
--outfile 'out.bcf'

## discovery options

## genotyping options


|& tee log.txt

&& bcftools view delly.bcf > delly.vcf ## todo if clause
    ]]></command>
    <inputs>
        <param argument="input" type="data" format="BCF" label="Select input sample"/> <!-- multiple ? -->
        <section name="generic" title="Generic options">
            <conditional name="mode_cond">
                <param argument="mode_sel" type="select" label="Select filter mode">
                    <option value="somatic" selected="true">Somatic</option>
                    <option value="germline">Germline</option>
                </param>
                <when value="somatic">
                    <param argument="--samples" type="data" format="tabular" label="Select sample file" help="Two-column sample file listing sample name and tumor or control."/>
                    <param argument="--coverage" type="integer" value="10" label="Set minimum coverage in tumor."/>
                    <param argument="--controlcontamination" type="integer" value="0" label="Set maximum fractional ALT support in control"/>
                </when>
                <when value="germline">
                    <param argument="--gq" type="integer" value="15" label="Set minimum median GQ for carriers and   non-carriers"/>
                    <param argument="--rddel" type="float" value="0.800000012"  label="Set maximum read-depth ratio of carrier vs. non-carrier for a deletion"/>
                    <param argument="--rddup" type="float" value="1.20000005" label="Set minimum read-depth ratio of carrier vs. non-carrier for a duplication"/>
                </when>
            </conditional>
            <param argument="--altaf" type="float" value="0.200000003" label="Set minimum fractional ALT support"/> <!-- todo -->
            <param argument="--minsize" type="integer" value="0" label="Set minimum SV size"/>
            <param argument="--maxsize" type="integer" value="500000000" label="Set maximum SV size"/>      
            <param argument="--ratiogeno" type="float" value="0.75" label="Set minimum fraction of genotyped samples"/>
            <param argument="--pass" type="boolean" truevalue="--pass" falsevalue="" label="Filter sites for PASS?"/>
        </section>
        <section name="oo" title="Output options">
            <param name="out" type="select" multiple="true" optional="false" label="Select output file(s)">
                <option value="log">Log</option>
            </param> 
        </section>
    </inputs>
    <outputs>
        <data name="out_log" format="tabular" from_work_dir="log.txt" label="${tool.name} on ${on_string}: Log">
            <filter>'log' in oo['out']</filter>
        </data>
    </outputs>
    <tests>
        <!-- #1 default -->
        <test expect_num_outputs="1">
            <param name="input" value="normal.bam"/>
            <output name="out_log">
                <assert_contents>
                    <has_text_matching expression=".+"/>
                </assert_contents>
            </output>            
        </test>              
    </tests>
   <help><![CDATA[
.. class:: infomark

**What it does**

@WID@

This module *filter* uses ...

**Input**

Delly needs a sorted, indexed and duplicate marked bam file for every input sample. An indexed reference genome is required to identify split-reads.

**Output**

The output is in BCF format with a csi index. Delly supports germline and somatic SV discovery, genotyping and filtering.

.. class:: infomark

**References**

@REFERENCES@
    ]]></help>
    <expand macro="citations"/>
</tool>
<?xml version="1.0"?>
<tool id="delly_call" name="delly: call" version="@TOOL_VERSION@+galaxy0" profile="18.01">
    <description>discover and genotype structural variants</description>    
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[     
## run
delly
## generic options
--svtype $generic.svtype
--genome '$generic.genome' ## todo filetype required?
--exclude '$generic.exclude' ## todo filetype required?
--outfile 'out.bcf'
## discovery options
--map-qual $discovery.map-qual
--qual-tra $discovery.qual-tra
--mad-cutoff $discovery.mad-cutoff
--minclip $discovery.minclip
--minrefsep $discovery.minrefsep
--maxreadsep $discovery.maxreadsep
## genotyping options
--vcffile '$genotyping.vcffile'
--geno-qual $genotyping.geno-qual
--dump 'out.gz'
    ]]></command>
    <inputs>
        <section name="generic" title="Generic options">
            <param argument="--svtype" type="select" label="Set SV type to compute">
                <option value="ALL" selected="true">ALL</option>
                <option value="DEL">DEL</option>
                <option value="INS">INS</option>
                <option value="DUP">DUP</option>
                <option value="INV">INV</option>
                <option value="BND">BND</option>
            </param>
            <param argument="--genome" type="data" format="fasta" label="Select genome"/>
            <param argument="--exclude" type="data" format="txt" label="Select file with regions to exclude"/> <!-- filetype ?! --> 
        </section>
        <section name="discovery" title="Discovery options">
            <param argument="--map-qual" type="integer" value="1" label="Set minimum paired-end (PE) mapping quality"/>
            <param argument="--qual-tra" type="integer" value="20" label="Set minimum PE quality for translocation"/>
            <param argument="--mad-cutoff" type="integer" value="9" label="Set insert size cutoff" help="median+s*MAD, deletions only)"/>
            <param argument="--minclip" type="integer" value="25" label="Set minimum clipping length"/>
            <param argument="--minrefsep" type="integer" value="25" label="Set minimum reference separation"/>
            <param argument="--maxreadsep" type="integer" value="40" label="Set maximum read separation"/>
            <!-- todo min max -->
        </section>
        <section name="genotyping" title="Discovery options">
            <param argument="--vcffile" type="data" format="vcf,bcf" label="Select genotyping file"/>
            <param argument="--geno-qual" type="integer" value="5" label="Set minimum mapping quality for genotyping"/> <!-- todo min max -->
        </section>
    </inputs>
    <outputs>
        <data name="out" format="tabular" from_work_dir="out" label="${tool.name} on ${on_string}: Out"/>
    </outputs>
    <tests>
        <!-- #1 default -->
        <test expect_num_outputs="1">
            <section name="generic">
                <param name="svtype" value="ALL"/>
            </section>
            <output name="out">
                <assert_contents>
                    <has_text_matching expression=".+"/>
                </assert_contents>
            </output>            
        </test>                                                   
    </tests>
    <help><![CDATA[
.. class:: infomark

**What it does**

@WID@

**Input**

Delly needs a sorted, indexed and duplicate marked bam file for every input sample. An indexed reference genome is required to identify split-reads.

**Output**

The output is in BCF format with a csi index. Delly supports germline and somatic SV discovery, genotyping and filtering.

.. class:: infomark

**References**

@REFERENCES@
    ]]></help>
    <expand macro="citations"/>
</tool>
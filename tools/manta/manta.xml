<tool id="manta" name="Manta" version="1.6.0">
	<description>
	   for calling of structural variants
	</description>
    <requirements>
        <requirement type="package" version="1.6.0">manta</requirement>
    </requirements>
    <command><![CDATA[

		<!-- Linking BAM Indexs to current working directory -->
    ln -s $normal normal.bam;
    ln -s $normal.metadata.bam_index normal.bam.bai;
    ln -s $tumour tumour.bam;
    ln -s $tumour.metadata.bam_index tumour.bam.bai;

    <!-- Index Reference if from History -->
    #if $reference_source.reference_source_selector == "history":
        ln -s $reference_source.ref_file ref.fa;
        samtools faidx ref.fa;
    #end if

    python \$MANTA_INSTALL_DIR/install/bin/configManta.py
      --normalBam=normal.bam
      --tumorBam=tumour.bam
      #if $reference_source.reference_source_selector == "history":
        --referenceFasta=ref.fa
      #else
        --referenceFasta=${reference_source.ref_file.fields.path}
      #end if
      --runDir=./output;

    ./output/runWorkflow.py 
      -m local
      -j \${GALAXY_SLOTS:-1}
      --quiet;

    gunzip -c ./output/results/variants/somaticSV.vcf.gz > $output;

	]]></command>
	<inputs>
        <conditional name="reference_source">
            <param label="Choose the source for the reference files" name="reference_source_selector" type="select">
                <option value="cached">Locally Cached</option>
                <option value="history">History</option>
            </param>
            <when value="cached">
                <param label="Genome" name="ref_file" type="select">
                    <options from_data_table="fasta_indexes"/>
                </param>
            </when>
            <when value="history">
                <param label="Genome" name="ref_file" type="data" format="fasta"/>
            </when>
        </conditional>
        <param type="data" format="bam" name="normal" label="Normal Alignment File"/>
        <param type="data" format="bam" name="tumour" label="Tumour Alignment File"/>   
    </inputs>
	<outputs>
		<data format="vcf" name="output"/>
	</outputs>
	<tests>
	</tests>
    <help><![CDATA[
**Manta** calls structural variants (SVs) and indels from mapped paired-end sequencing reads.

It is optimized for analysis of germline variation in small sets of individuals and somatic variation in tumor/normal sample pairs. Manta discovers, assembles and scores large-scale SVs, medium-sized indels and large insertions within a single efficient workflow. The method is designed for rapid analysis on standard compute hardware: NA12878 at 50x genomic coverage is analyzed in less than 20 minutes on a 20 core server, and most WGS tumor/normal analyses can be completed within 2 hours. Manta combines paired and split-read evidence during SV discovery and scoring to improve accuracy, but does not require split-reads or successful breakpoint assemblies to report a variant in cases where there is strong evidence otherwise. It provides scoring models for germline variants in small sets of diploid samples and somatic variants in matched tumor/normal sample pairs. There is experimental support for analysis of unmatched tumor samples as well (see details below). Manta accepts input read mappings from BAM or CRAM files and reports all SV and indel inferences in VCF 4.1 format.
]]></help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/btv710</citation>
    </citations>
</tool>

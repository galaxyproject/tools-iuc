<tool id="qiime_make_otu_table" name="Make OTU table" version="@WRAPPER_VERSION@.0">
    <description>Make an OTU table from an OTU map and a taxonomy assignment file</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <version_command>make_otu_table.py --version</version_command>
    <command detect_errors="aggressive"><![CDATA[
        make_otu_table.py
            --otu_map_fp '$otu_map_fp'
            --output_biom_fp '$output_biom_fp'
            #if $taxonomy
                --taxonomy '$taxonomy'
            #end if
            #if $exclude_otus_fp
                --exclude_otus_fp '$exclude_otus_fp'
            #end if
            #if $mapping_fp
                --mapping_fp '$mapping_fp'
            #end if
    ]]></command>
    <inputs>
        <param argument="--otu_map_fp" type="data" format="tabular,txt,biom" label="OTU map" help="An OTU map file generated by the pick_otus.py script" />
        <param argument="--taxonomy" type="data" format="txt" optional="True" label="Taxonomy assignment" help="Text file generated by the assign_taxonomy.py script and contains the assignments of taxons to sequences" />
        <param argument="--exclude_otus_fp" type="data" format="tabular,fasta,txt" optional="True" label="List of OTU identifiers to reject" help="A text file listing OTU identifiers that should not be included in the OTU table (generated by the identify_chimeric_seqs.py script) or a failure file in fasta format (generated by the align_seqs.py script)" />
        <param argument="--mapping_fp" type="data" format="tabular,txt" optional="True" label="Validated mapping file" help="A mapping file in tabular format verified by the validate_mapping_file.py script" />
    </inputs>
    <outputs>
        <data name="output_biom_fp" format="biom1" label="${tool.name} on ${on_string}: OTU table (biom format)"/>
    </outputs>
    <tests>
        <!-- Qiime make_otu_table.py generates a binary file that can't be compared directly with diff -->
        <!-- In addition, the files generated by 2 different executions of make_otu_table with the same input data are different -->
        <!-- As a consequence, standard comparisons based on "diff" or md5 checksums/SHA hash are impossible -->
        <!-- The following tests are then based on a comparison of file sizes with a maximum delta of 0 bytes -->
        <test>
            <param name="otu_map_fp" value="make_otu_table/otu_map.txt" />
            <param name="taxonomy" value="make_otu_table/tax_assignments.txt" />
            <param name="exclude_otus_fp" value="make_otu_table/chimeric_seqs.txt" />
            <param name="mapping_fp" value="make_otu_table/mapping_file.txt" />
            <output name="output_biom_fp" file="make_otu_table/OTU_table_chimeric.biom" compare="sim_size" />
        </test>
        <test>
            <param name="otu_map_fp" value="make_otu_table/otu_map.txt" />
            <param name="taxonomy" value="make_otu_table/tax_assignments.txt" />
            <param name="exclude_otus_fp" value="make_otu_table/pynast_failures.fna" />
            <param name="mapping_fp" value="make_otu_table/mapping_file.txt" />
            <output name="output_biom_fp" file="make_otu_table/OTU_table_pynast.biom" compare="sim_size" />
        </test>
    </tests>
    <help><![CDATA[
**What it does**

The script `make_otu_table.py <http://qiime.org/scripts/make_otu_table.html>`_ tabulates the number of times an OTU is found in each
sample, and adds the taxonomic predictions for each OTU in the last column if a taxonomy file is supplied.

The output of `make_otu_table.py <http://qiime.org/scripts/make_otu_table.html>`_ is a `biom file <http://biom-format.org/>`_, where the columns correspond to
Samples and rows correspond to OTUs and the number of times a sample appears in a particular OTU.

More information about this tool is available on
`QIIME documentation <http://qiime.org/scripts/make_otu_table.html>`_.
    ]]></help>
    <citations>
        <expand macro="citations"/>
    </citations>
</tool>

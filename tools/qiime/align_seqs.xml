<?xml version="1.0" ?>
<tool id="1-9_align_seqs" name="10 - align seqs" version="1.9.0">
    <description>Align sequences using a variety of alignment methods</description>
    <macros>
        <import>macros.xml</import>
    </macros>

    <expand macro="requirements" />

    <command>

align_seqs.py -i $input_fasta_fp

#if str($alignment_method) != 'None':
 -m $alignment_method
#end if

#if str($pairwise_alignment_method) != 'None':
 -a $pairwise_alignment_method
#end if

#if str($template_fp) != 'None':
 -t $template_fp
#end if

#if $min_length:
 -e $min_length
#end if

#if $min_percent_id:
 -p $min_percent_id
#end if

 -o align_seqs_output;

</command>
    <inputs>
        <param label="-i/--input_fasta_fp: path to the input fasta file" name="input_fasta_fp" optional="False" type="data"/>
        <param label="-m/--alignment_method: Method for aligning sequences. Valid choices are: pynast, infernal, clustalw, muscle, infernal, mafft [default: pynast]" name="alignment_method" optional="True" type="select">
            <option selected="True" value="None">Selection is Optional</option>
            <option value="pynast">pynast</option>
            <option value="infernal">infernal</option>
            <option value="clustalw">clustalw</option>
            <option value="muscle">muscle</option>
            <option value="infernal">infernal</option>
            <option value="mafft">mafft</option>
        </param>
        <param label="-a/--pairwise_alignment_method: method for performing pairwise alignment in PyNAST. Valid choices are muscle, pair_hmm, clustal, blast, uclust, mafft [default: uclust]" name="pairwise_alignment_method" optional="True" type="select">
            <option selected="True" value="None">Selection is Optional</option>
            <option value="muscle">muscle</option>
            <option value="pair_hmm">pair_hmm</option>
            <option value="clustal">clustal</option>
            <option value="blast">blast</option>
            <option value="uclust">uclust</option>
            <option value="mafft">mafft</option>
        </param>
        <param default="/home12/caparmor/bioinfo/softs/sources/Qiime/data/core_set_aligned.fasta.imputed" label="-t/--template_fp: Filepath for template alignment [default: /home12/caparmor/bioinfo/softs/sources/Qiime/data/core_set_aligned.fasta.imputed]" name="template_fp" optional="True" type="data"/>
        <param default="-1" label="-e/--min_length: Minimum sequence length to include in alignment [default: 75% of the median input sequence length]" name="min_length" optional="True" type="integer"/>
        <param default="0.75" label="-p/--min_percent_id: Minimum percent sequence identity to closest blast hit to include sequence in alignment [default: 0.75]" name="min_percent_id" optional="True" type="float"/>
    </inputs>
    <outputs>
        <data format="txt" from_work_dir="align_seqs_output/*_aligned.fasta" name="output_dir_aligned" label="${alignment_method}_aligned.fasta" />
        <data format="txt" from_work_dir="align_seqs_output/*_failures.fasta" name="output_dir_failures" label="${alignment_method}_failures.fasta"/>
        <data format="txt" from_work_dir="align_seqs_output/*_log.txt" name="output_dir_log"  label="s${alignment_method}_log.txt"/>
    </outputs>
    <help>
This script aligns the sequences in a FASTA file to each other or to a template sequence alignment, depending on the method chosen. Currently, there are three methods which can be used by the user:

1. PyNAST (Caporaso et al., 2009) - The default alignment method is PyNAST, a python implementation of the NAST alignment algorithm.  The NAST algorithm aligns each provided sequence (the &quot;candidate&quot; sequence) to the best-matching sequence in a pre-aligned database of sequences (the &quot;template&quot; sequence).  Candidate sequences are not permitted to introduce new gap characters into the template database, so the algorithm introduces local mis-alignments to preserve the existing template sequence.

2. MUSCLE (Edgar, 2004) - MUSCLE is an alignment method which stands for MUltiple Sequence Comparison by Log-Expectation.

3. INFERNAL (Nawrocki, Kolbe, &amp; Eddy, 2009) - Infernal (&quot;INFERence of RNA ALignment&quot;) is for an alignment method for using RNA structure and sequence similarities.

All aligners will output a fasta file containing the alignment and log file in the directory specified by --output_dir (default &lt;alignment_method&gt;_aligned). PyNAST additionally outputs a failures file, containing the sequences which failed to align. So the result of %prog will be up to three files, where the prefix of each file depends on the user supplied FASTA file:

1. &quot;..._aligned.fasta&quot; - This is a FASTA file containing all aligned sequences.

2. &quot;..._failures.fasta&quot; - This is a FASTA file containing all sequences which did not meet all the criteria specified. (PyNAST only)

3. &quot;..._log.txt&quot; - This is a log file containing information pertaining to the results obtained from a particular method (e.g. BLAST percent identity, etc.).</help>
</tool>

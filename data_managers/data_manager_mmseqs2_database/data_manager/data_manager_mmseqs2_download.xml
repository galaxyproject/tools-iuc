<tool id="data_manager_mmseqs2_download" name="Download MMseqs2 databases" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" tool_type="manage_data" profile="22.05">
    <description></description>
    <macros>
        <token name="@TOOL_VERSION@">15.6f452</token>
        <token name="@VERSION_SUFFIX@">0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">mmseqs2</requirement>
    </requirements>
    <stdio>
        <exit_code range=":-1" level="fatal" description="Error: Cannot open file"/>
        <exit_code range="1:" level="fatal" description="Error"/>
    </stdio>
    <command><![CDATA[
        mmseqs databases '$db_name' '$db_name' tmp &&
        cp '$dmjson' '$out_file'
    ]]></command>
     <configfiles>
        <configfile name="dmjson"><![CDATA[
#from datetime import date
{
  "data_tables":{
    "mmseqs2_databases":[
      {
        "dbkey": "$db_name.@TOOL_VERSION@",
        "value": "${db_name}-#echo date.today().strftime('%d%m%Y')#",
        "name": "${db_name} (MMseqs2)",
        "path": "$db_name",
        "version": "@TOOL_VERSION@"
      }
    ]
  }
}]]>
        </configfile>
    </configfiles>
    <inputs>
        <param name="db_name" type="select" label="MMseqs2 databases">
            <option value="UniRef100" selected="true">UniRef100</option>
            <option value="UniRef90">UniRef90</option>
            <option value="UniRef50">UniRef50</option>
            <option value="UniProtKB">UniProtKB</option>
            <option value="UniProtKB/TrEMBL">TrEMBL (UniProtKB)</option>
            <option value="UniProtKB/Swiss-Prot">Swiss-Prot (UniProtKB)</option>
            <option value="NR">NR (Non-redundant protein sequences from GenPept, Swissprot, PIR, PDF, PDB, and NCBI RefSeq)</option>
            <option value="NT">NT (Partially non-redundant nucleotide sequences from all traditional divisions of GenBank, EMBL, and DDBJ excluding GSS, STS, PAT, EST, HTG, and WGS)</option>
            <option value="GTDB">GTDB (Genome Taxonomy Database)</option>
            <option value="PDB">PDB (The Protein Data Bank)</option>
            <option value="PDB70">PDB70 (PDB clustered to 70% sequence identity)</option>
            <option value="Pfam-A.full">Pfam-A.full</option>
            <option value="Pfam-A.seed">Pfam-A.seed</option>
            <option value="Pfam-B">Pfam-B</option>
            <option value="CDD">CDD (Conserved Domain Database)</option>
            <option value="VOGDB">VOGDB (Virus Orthologous Groups)</option>
            <option value="dbCAN2">dbCAN2 (database of carbohydrate-active enzymes)</option>
            <option value="SILVA">SILVA</option>
            <option value="Resfinder">Resfinder</option>
            <option value="Kalamari">Kalamari</option>            
        </param>
    </inputs>
    <outputs>
        <data name="out_file" format="data_manager_json" label="${tool.name}"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="db_name" value="Resfinder"/>
            <output name="out_file">
                <assert_contents>
                    <has_text text='"mmseqs2_databases":'/>
                    <has_text text='"dbkey": "Resfinder.15.6f452"'/>
                    <has_text_matching expression='"value": "Resfinder-[0-9]{8}"'/>
                    <has_text text='"name": "Resfinder (MMseqs2)"'/>
                    <has_text text='"path": "Resfinder"'/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
This tool downloads databases that can be used with MMseqs2.
    ]]></help>
    <citations>
        <citation type="doi">10.1038/nbt.3988</citation>
    </citations>
</tool>
<tool id="data_manager_fetch_liana_resources" name="Download LIANA Resources" tool_type="manage_data" version="1.0+galaxy0" profile="25.0">
    <description>Download ligand-receptor, ortholog, and metalinks resources from LIANA</description>
    
    <requirements>
        <requirement type="package" version="1.7.1">liana</requirement>
    </requirements>
    
    <command detect_errors="exit_code"><![CDATA[
        python '$__tool_directory__/liana_resources_downloader.py'
            --resource '$resource_select'
            --output '$output_file'
    ]]></command>
    
    <inputs>
        <param name="resource_select" type="select" label="Resources to download" help="Choose which LIANA resources to download and cache">
            <!-- LIGAND-RECEPTOR RESOURCES (DEFAULT) -->
            <option value="ligand_receptor_consensus" selected="true">L-R: Consensus only (1-2 MB, FASTEST)</option>
            <option value="ligand_receptor_main">L-R: Main databases: consensus, cellphonedb, cellchatdb (5-8 MB)</option>
            <option value="ligand_receptor_single_cell">L-R: Single-cell methods (15-25 MB)</option>
            <option value="ligand_receptor_all">L-R: All 17 databases (50-100 MB, COMPREHENSIVE)</option>
            
            <!-- ORTHOLOG MAPPING RESOURCES -->
            <option value="orthologs_common">Orthologs: Human-Mouse and Human-Rat (HCOP)</option>
            <option value="orthologs_all">Orthologs: All species pairs (Human-Mouse, Human-Rat, Human-Chicken, Human-Zebrafish)</option>
            
            <!-- METALINKS RESOURCES -->
            <option value="metalinks_blood">Metalinks: Blood biospecimens only</option>
            <option value="metalinks_plasma">Metalinks: Plasma biospecimens only</option>
            <option value="metalinks_all">Metalinks: All biospecimens (metabolite-protein)</option>
            
            <!-- COMBINATION -->
            <option value="all">ALL: Complete LIANA resources (all L-R + orthologs + metalinks, ~200 MB)</option>
        </param>
    </inputs>
    
    <outputs>
        <data name="output_file" format="data_manager_json"/>
    </outputs>
    
    <tests>
        <test>
            <param name="resource_select" value="ligand_receptor_consensus"/>
            <output name="output_file" file="ligand_receptor_consensus.json">
                <assert_contents>
                    <has_text text="consensus"/>
                    <has_text text="data_tables"/>
                    <has_text text="liana_resources"/>
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="resource_select" value="orthologs_common"/>
            <output name="output_file" file="orthologs_common.json">
                <assert_contents>
                    <has_text text="hcop"/>
                    <has_text text="data_tables"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    
    <help><![CDATA[
    **What it does**
    
    This data manager downloads LIANA+ resources including:
    - **Ligand-Receptor interaction databases** (17 databases)
    - **Ortholog mappings** from HCOP (Human to Mouse/Rat/Chicken/Zebrafish)
    - **Metabolite-Protein interactions** from Metalinks
    
    Resources are cached locally on your Galaxy instance for fast, offline access.
    
    **LIGAND-RECEPTOR RESOURCES**
    
    17 L-R interaction databases including:
    - consensus (RECOMMENDED): Combined resource
    - cellphonedb, cellchatdb, connectomedb2020, cellcall, cellinker, celltalkdb
    - embrace, guide2pharma, hpmr, icellnet, italk, kirouac2010, lrdb
    - mouseconsensus (mouse-specific), ramilowski2015, baccin2019
    
    Download Options:
    - **Consensus** (1-2 MB, ~30 sec): Fastest, recommended for most analyses
    - **Main** (5-8 MB, 1-2 min): Consensus + CellPhoneDB + CellChat
    - **Single-cell** (15-25 MB, 2-3 min): Optimized for single-cell methods
    - **All** (50-100 MB, 3-5 min): Complete set of all databases
    
    **ORTHOLOG MAPPING RESOURCES (HCOP)**
    
    Gene ortholog mappings from HCOP (HGNC Comparison of Orthology Predictions):
    - Human to Mouse (Mus musculus)
    - Human to Rat (Rattus norvegicus)
    - Human to Chicken (Gallus gallus)
    - Human to Zebrafish (Danio rerio)
    
    Download Options:
    - **Common** (RECOMMENDED): Human-Mouse + Human-Rat (~20 MB)
    - **All**: All four species pairs (~40 MB)
    
    Use these for translating L-R resources to other species via `translate_resource`.
    
    **METALINKS RESOURCES**
    
    Metabolite-protein interaction data for metabolite-mediated cell-cell communication:
    - All biospecimens combined (largest coverage)
    - Blood biospecimens only
    - Plasma biospecimens only
    - Urine biospecimens only
    
    Download Options:
    - **Blood/Plasma/Urine**: Filtered by biospecimen type (~10-30 MB each)
    - **All**: Complete metabolite-protein database (~50 MB)
    
    **BENEFITS OF CACHING**
    
    After running this data manager:
    - LIANA tools load resources in < 1 second (vs 30-60 sec download time)
    - No internet access required during tool execution
    - Consistent resource versions across all jobs
    - Significant bandwidth savings
    - Seamless integration: existing tools use cache automatically
    
    **RECOMMENDED SETUP**
    
    For first-time setup, select:
    - **L-R: Main databases** (good balance of coverage and size)
    - **Orthologs: Common** (covers mammalian models)
    
    Then optionally add metalinks if needed for your analyses.
    
    Alternatively, use **L-R: Consensus** for the smallest, fastest setup.
    
    **USAGE**
    
    1. Galaxy Administrator opens Admin > Data Managers
    2. Selects "Download LIANA Resources"
    3. Chooses desired resource(s)
    4. Executes (takes 2-10 minutes depending on selection)
    5. LIANA tools automatically use cached resources
    
    **NOTES**
    
    - Can be re-run to update resources or add additional types
    - Data is stored in ``<galaxy_data_manager_data_path>/liana-db/``
    - Resources persist across Galaxy restarts
    - No manual intervention needed in tool definitions
    ]]></help>
    
    <citations>
        <citation type="doi">10.1038/s41556-024-01469-w</citation>
    </citations>
</tool>

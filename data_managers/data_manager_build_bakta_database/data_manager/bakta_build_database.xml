<?xml version="1.0"?>
<tool id="bakta_build_database" name="Bakta" tool_type="manage_data" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description> Bakta database builder </description>
    <macros>
        <import>macro.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="aggressive"><![CDATA[
        python '$__tool_directory__/bakta_build_database.py'
        #if $database_command == "download"
            download --output $output_file
        #else if $database_command == "update"
        #else if $database_command == "update"
            update --db $output_file
        #end if
    ]]></command>
    <inputs>
        <conditional>
            <param name="database_command" type="select" label="Database action" multiple="false" help="Action on bakta database. Install or update database">
                <option value="download"> Download a prebuild bakta database</option>
                <option value="custom"> Download a custom database</option>
                <option value="update"> Update the databases</option>
            </param>
            <when value="download"/>
            <when value="update"/>
            <when value="custom">
              <param name="db_link"></param>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output_file" format="data_manager_json" />
    </outputs>
    <tests>

        <!-- TEST2 update -->
        <test expect_num_outputs="1">
            <param name="database_command" value="update"/>
            <output name="output_file">
                <assert_contents>
                    <has_text text="pangoLEARN data release 2021-04-01"/>
                    <has_text text='"format_version": "1.0"'/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        Download, update or list bakta databases <https://github.com/oschwengers/bakta#database>
    ]]></help>
    <citations>
        <citation type="doi">10.1099/mgen.0.000685</citation>
    </citations>
</tool>

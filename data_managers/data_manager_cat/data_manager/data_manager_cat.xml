<tool id="data_manager_cat" name="CAT DB" version="5.0.3.0" tool_type="manage_data">
    <description>Install a new CAT database</description>
    <requirements>
        <requirement type="package" version="@VERSION@">cat</requirement>
    </requirements>
    <version_command>CAT --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
mkdir -p '$out_file.extra_files_path' &&
python '${__tool_directory__}/data_manager_cat.py'
 --config_file '$out_file'
 --install_path '$out_file.extra_files_path' 
#if $test == 'download'
    #import os.path
    #set path = 'file:' + $os.path.dirname($__tool_directory__) + '/test-data/CAT_prepare_test.tar.gz'
    --db_url '$path'
#elif $db.src == 'download'
    --db_url '$db_url'
#end if
    ]]></command>
    <inputs>
        <conditional name="db">
            <param name="src" type="select" label="Download or Build DBs">
                <option value="download">download</option>
                <option value="build">build</option>
            </param>
            <when value="download">
                <param name="db_url" type="text" label="DB rul at https://tbb.bio.uu.nl/bastiaan/CAT_prepare/"
                     help="example: https://tbb.bio.uu.nl/bastiaan/CAT_prepare/CAT_prepare_20190719.tar.gz">
                </param>
            </when>
            <when value="build">
            </when>
        </conditional>
        <param name="test" type="hidden" value="no"/>
    </inputs>
    <outputs>
        <data name="out_file" format="data_manager_json" label="${tool.name}"/>
    </outputs>
    <tests>
        <test>
            <param name="test" value="download"/>
            <output name="out_file">
                <assert_contents>
                    <has_text text="CAT_prepare_test/taxonomy" />
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
This tool prepares reference data for CAT, the Contig Annotation Tool.  
It can either download prebuilt reference data from https://tbb.bio.uu.nl/bastiaan/CAT_prepare/
or build new reference data using the CAT prepare application.

This requires at least 100GB of RAM, 250GB of disk space, and 24 hours.
    ]]></help>
    <expand macro="citations" />
</tool>

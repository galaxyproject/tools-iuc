<tool id="data_manager_cat" name="CAT DB" version="@VERSION@.0" tool_type="manage_data">
    <description>Install a new CAT database</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="version_command" />
    <command detect_errors="exit_code"><![CDATA[
#import json, os
#set params = json.loads(open(str($out_file)).read())
#set install_path = $params['output_data'][0]['extra_files_path'].encode('ascii', 'replace')
mkdir -p $install_path &&
python '${__tool_directory__}/data_manager_cat.py' --config_file '$out_file' --install_path '$install_path' 
#if $db.src == 'download'
    --db_url '$db_url'
#end if
    ]]></command>
    <inputs>
        <conditional name="db">
            <param name="src" type="select" label="Download or Build DBs">
                <option value="download">download</option>
                <option value="build">build</option>
            </param>
            <when value="download">
                <param name="db_url" type="text" label="DB rul at https://tbb.bio.uu.nl/bastiaan/CAT_prepare/"
                     help="example: https://tbb.bio.uu.nl/bastiaan/CAT_prepare/CAT_prepare_20190719.tar.gz">
                </param>
            </when>
            <when value="build">
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="out_file" format="data_manager_json" label="${tool.name}"/>
    </outputs>
    <tests>
    </tests>
    <help><![CDATA[
This tool prepares reference data for CAT, the Contig Annotation Tool.  
It can either download prebuilt reference data from https://tbb.bio.uu.nl/bastiaan/CAT_prepare/
or build new reference data using the CAT prepare application.

This requires at least 100GB of RAM, 250GB of disk space, and 24 hours.
    ]]></help>
    <expand macro="citations" />
</tool>

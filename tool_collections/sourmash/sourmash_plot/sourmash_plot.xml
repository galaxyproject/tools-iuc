<tool id="sourmash_plot" name="sourmash plot" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
    <macros>
        <import>macros.xml</import>
    </macros>
    <requirements>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        ln -s $input cmp.dist &&

        #if $labels_cond.labels_param == "--labels":
            ln -s $labels_cond.labels_file cmp.dist.labels.txt &&
        #end if
        
        sourmash plot cmp.dist

        $labels_cond.labels_param

    ]]></command>
    <inputs>
        <param name="input" type="data" format="binary" label="Input file" help="input file generated distance matrix file generated with sourmash compare"/>
        <conditional name="labels_cond">
            <param name="labels_param" type="select" label="Show labels" help="show sample labels on dendrogram/matrix">
                <option value="--labels"> Yes</option>
                <option value="--no-labels" selected="true"> No</option>
            </param>
            <when value="--labels">
                <param name="labels_file" type="data" format="txt" label="Lables file" help="labels file generated with sourmash compare"/>
            </when>
            <when value="--no-labels"></when>
        </conditional>
    </inputs>
    <outputs>
        <data name="matrix" format="png" from_work_dir="cmp.dist.matrix.png" label='${tool.name} on ${on_string}: matrix'/>
        <data name="histogram" format="png" from_work_dir="cmp.dist.hist.png" label='${tool.name} on ${on_string}: histogram'/>
        <data name="dendrogram" format="png" from_work_dir="cmp.dist.dendro.png" label='${tool.name} on ${on_string}: dendrogram'/>
    </outputs>
    <tests>
        <!-- 1) basic no labels-->
        <test expect_num_outputs="3">
            <param name="input" value="cmp.dist" />       
            <output name="matrix" ftype="png">
                <assert_contents>
                    <has_size size="12k" delta="1k"/>
                </assert_contents>
            </output>
            <output name="histogram" ftype="png">
                <assert_contents>
                    <has_size size="9k" delta="1k"/>
                </assert_contents>
            </output>
            <output name="dendrogram" ftype="png">
                <assert_contents>
                    <has_size size="4k" delta="1k"/>
                </assert_contents>
            </output>
        </test>
        <!-- 2) labels-->
        <test expect_num_outputs="3">
            <param name="input" value="cmp.dist" />       
            <conditional name="labels_cond">
                <param name="labels_param" value="--labels"/>
                <param name="labels_file" value="cmp.dist.labels.txt"/>
            </conditional>
            <output name="matrix" ftype="png">
                <assert_contents>
                    <has_size size="22k" delta="1k"/>
                </assert_contents>
            </output>
            <output name="histogram" ftype="png">
                <assert_contents>
                    <has_size size="9k" delta="1k"/>
                </assert_contents>
            </output>
            <output name="dendrogram" ftype="png">
                <assert_contents>
                    <has_size size="7k" delta="1k"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        Sourmash plot

        usage:  plot [-h] [--pdf] [--labels] [--no-labels] [--labeltext LABELTEXT] [--indices] [--no-indices] [--vmin VMIN] [--vmax VMAX]
             [--subsample N] [--subsample-seed S] [-f] [--output-dir DIR] [--csv F] [--labels-from LABELS_FROM]
             distances

        options:

            -h, --help            show this help message and exit
            --pdf                 output PDF; default is PNG
            --labels              show sample labels on dendrogram/matrix
            --no-labels           do not show sample labels
            --labeltext LABELTEXT filename containing list of labels (overrides signature names); implies --labels
            --indices             show sample indices but not labels; overridden by --labels
            --no-indices          do not show sample indices
            --vmin VMIN           lower limit of heatmap scale; default=0.000000
            --vmax VMAX           upper limit of heatmap scale; default=1.000000
            --subsample N         randomly downsample to this many samples, max
            --subsample-seed S    random seed for --subsample; default=1
            -f, --force           forcibly plot non-distance matrices
            --output-dir DIR      directory for output plots
            --csv F               write clustered matrix and labels out in CSV format (with column headers) to this file
            --labels-from, --labels-load LABELS_FROM a CSV file containing label information to use on plot; implies --labels
    ]]></help>
    <expand macro="citations"/>
    <creator>
        <organization name="Galaxy Europe"/>
        <person givenName="Ahmad" familyName="Mahagna" url="https://github.com/Smkingsize"/>
        <person givenName="Saim" familyName="Momin" url="https://github.com/SaimMomin12"/>
    </creator>
</tool>

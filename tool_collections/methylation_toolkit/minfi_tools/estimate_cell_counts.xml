<tool id="estimate_cell_counts" name="Cell Proportion Estimation for 450k data" version="1.0">
    <description>Composition estimates across all samples and cell types</description>
    <requirements>
        <requirement type="R-module" version="1.15.7">minfi</requirement>
        <requirement type="R-module">FlowSorted.Blood.450k</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" />
    </stdio>
	<command interpreter="Rscript">
		estimate_cell_count.R --rgset=$RGset
	</command>
    <inputs>
        <param name="RGset" type="data" format="rdata" label="Choose RGset for Density plot" />
    </inputs>
	<outputs>
	  <data format="txt" name="output" label="Estimated Cell Counts"/>
	</outputs>
    <help>

**What it does**

Estimates the relative proportion of pure cell types within a sample. For example, given peripheral blood samples, this function will return the relative proportions of lymphocytes, monocytes, B-cells, and neutrophils.

Details:

This is an implementaion of the Houseman et al (2012) regression calibration approachalgorithm
to the Illumina 450k microarray for deconvoluting heterogeneous tissue sources like blood. For
example, this function will take an RGChannelSet from a DNA methylation (DNAm) study of
blood, and return the relative proportions of CD4+ and CD8+ T-cells, natural killer cells, monocytes,
granulocytes, and b-cells in each sample.
The meanPlot should be used to check for large batch effects in the data, reducing the confidence
placed in the composition estimates. This plot depicts the average DNA methylation across the
cell-type discrimating probes in both the provided and sorted data. The means from the provided
heterogeneous samples should be within the range of the sorted samples. If the sample means fall
outside the range of the sorted means, the cell type estimates will inflated to the closest cell type.
Note that we quantile normalize the sorted data with the provided data to reduce these batch effects.

Houseman, Eugene A., et al. "DNA methylation arrays as surrogate measures of cell mixture distribution."
BMC bioinformatics 13.1 (2012): 86.

Andrew E. Jaffe and Rafael A. Irizarry. Accounting for cellular heterogeneity is critical in epigenomewide
association studies.

**Input** :

rgSet The input RGChannelSet for the procedures

meanPlot Whether to plots the average DNA methylation across the cell-type discrimating
probes within the mixed and sorted samples.

**Output**:

Matrix of composition estimates across all samples and cell types.
    </help>
    <citations>
        <citation type="doi">10.1093/bioinformatics/btu049</citation>
    </citations>
</tool>
<tool id="samtools_collate" name="Samtools collate" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>shuffle and group reads together by their names</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="stdio"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
        @ADDTHREADS@
        samtools collate
        $no_pg
        $fast_mode
        '$input'
        --output-fmt BAM
        -o '$output_file'
    ]]></command>
    <inputs>
        <param name="input" type="data" format="sam,bam" label="Input File"/>
        <param argument="--no-pg" type="boolean" label="Add @PG in Header" checked="true" truevalue="" falsevalue="--no-PG" help="Add a @PG line to the header of the output file. "/>
        <param name="fast_mode" argument="-f" type="boolean" label="Fast Mode" truevalue="-f" falsevalue="" checked="false" help="Fast mode will output only primary alignments that have either the READ1 or READ2 flags set (but not both). Any other alignment records will be filtered out. The collation will only work correctly if there are no more than two reads for any given QNAME after filtering. "/>
    </inputs>
    <outputs>
        <data name="output_file" format="unsorted.bam"/>
    </outputs>
    <tests>
        <!-- Test 01: Default Test -->
        <test expect_num_outputs="1">
            <param name="input" value="fast_collate.sam" ftype="sam"/>
            <output name="output_file" file="test01.bam" ftype="unsorted.bam"/>
        </test>
        <!-- Test 02: Testing NO PG -->
        <test expect_num_outputs="1">
            <param name="input" value="fast_collate.sam" ftype="sam"/>
            <param name="no_pg" value="true"/>
            <output name="output_file" file="test02.bam" ftype="unsorted.bam"/>
        </test>
        <!-- Test 03: Testing Fast mode-->
        <test expect_num_outputs="1">
            <param name="input" value="fast_collate.sam" ftype="sam"/>
            <param name="no_pg" value="false"/>
            <param name="fast_mode" value="true"/>
            <output name="output_file" file="test03.bam" ftype="unsorted.bam"/>
        </test>
        <!-- Test 04: BAM file as input -->
        <test expect_num_outputs="1">
            <param name="input" value="input.bam" ftype="bam"/>
            <param name="no_pg" value="false"/>
            <param name="fast_mode" value="true"/>
            <output name="output_file" file="test04.bam" ftype="unsorted.bam"/>
        </test>
    </tests>
    <help><![CDATA[
**What it does**
  
Samtools collate shuffles and groups reads in a BAM file together by their read names (QNAME). 
This is useful as a preprocessing step for tools that need reads from the same template (pairs or 
multiple segments) to be grouped together.

Note: The tools makes no guarantees about the order of read names between groups.

**Fast Mode** : Only processes primary alignments, which speeds up collation but may lose secondary/supplementary alignments

**Note**: Unlike 'samtools sort -n', collate does not produce a fully sorted output. Reads with the same 
name are grouped but groups appear in pseudo-random order. This is sufficient for tools that 
need paired reads together but is faster than full name sorting.

.. class:: infomark

**More information**

For more details, see the samtools documentation at http://www.htslib.org/doc/samtools-collate.html

    ]]></help>
    <expand macro="citations"/>
    <creator>
        <organization name="Galaxy Europe"/>
        <person givenName="Ahmad" familyName="Mahagna" url="https://github.com/Smkingsize"/>
        <person givenName="Saim" familyName="Momin" url="https://github.com/SaimMomin12"/>
    </creator>
</tool>